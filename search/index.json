[{"content":"å‰è¨€ ç¬”è€…è¿‘å‡ å¹´ä½¿ç”¨ Python è¯­è¨€æ¥åšæ·±åº¦å­¦ä¹ ã€è®¡ç®—æœºè§†è§‰é¢†åŸŸç›¸å…³ç§‘ç ”ä¸å·¥ä½œï¼Œå¯¹äºè°ƒè¯•ç¨‹åºï¼Œä½¿ç”¨è¾ƒå¤šçš„å·¥å…·é™¤äº† JetBrains å®¶çš„å„ä¸ª IDE ä»¥å¤–ï¼Œå°±æ˜¯ä½¿ç”¨ Python è‡ªå¸¦çš„ pdb æ¨¡å—æ¥è°ƒè¯• Python ç¨‹åºï¼Œå‘½ä»¤è¡Œç•Œé¢è°ƒè¯•ä»£ç æ—¢çµæ´»ï¼Œè€Œä¸”é€Ÿåº¦ä¹Ÿå¿«ï¼Œéå¸¸å¥½ç”¨ã€‚æœ€è¿‘ï¼Œå› ä¸ºé¡¹ç›®åŸå› æ¥è§¦ c/c++ ä»£ç æ›´å¤šä¸€äº›ï¼Œé€šè¿‡æœ¬ç¯‡åšå®¢å¯¹ GDB å­¦ä¹ å¹¶ä¸”è®°å½•ç›¸å…³å¸¸ç”¨å‘½ä»¤ã€‚\nGDBæ˜¯ä¸€ä¸ªç”±GNUå¼€æºç»„ç»‡å‘å¸ƒçš„ã€UNIX / LINUXæ“ä½œç³»ç»Ÿä¸‹çš„ã€åŸºäºå‘½ä»¤è¡Œçš„ã€åŠŸèƒ½å¼ºå¤§çš„ç¨‹åºè°ƒè¯•å·¥å…·ã€‚ å¯¹äºä¸€åLinuxä¸‹å·¥ä½œçš„c/c++ç¨‹åºå‘˜ï¼Œgdbæ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ï¼Œå¦å¤–ï¼ŒGDBå¯ä»¥è°ƒè¯•Adaã€Cã€ C++ã€ Asmã€ Minimalã€ Dã€ Fortranã€ Objective-cã€ Goã€ Javaã€ Pascalç­‰è¯­è¨€ã€‚æ ‡å‡†çš„ GDB æ˜¯çº¯å‘½ä»¤è¡Œå¼çš„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›åŸºäºå®ƒçš„å›¾å½¢åŒ–å·¥å…·ï¼ˆæ¯”å¦‚ DDDã€Data Display Debuggerï¼‰ï¼Œä½†ç”¨å¥½ GDB å‘½ä»¤è¡Œè°ƒè¯•ï¼Œè¿˜æ˜¯æˆ‘ä»¬çš„ä¸€é¡¹åŸºæœ¬ç´ è´¨ã€‚\næœ¬ç¯‡æ–‡ç« å°†ç®€å•åœ°ä»‹ç» GDB å¸¸è§ç”¨æ³•ï¼Œæ›´å¤šå†…å®¹é€šè¿‡æœ¬åšå®¢ä¸‹é¢çš„å‚è€ƒèµ„æ–™å­¦ä¹ ã€‚\nGDB ä½¿ç”¨æµç¨‹ å¯åŠ¨ GDB è°ƒè¯• å­¦ä¹  GDB è°ƒè¯•æµ‹è¯•çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #include\u0026lt;stdio.h\u0026gt; int square(int x) { return x * x; } int get_num(int x) { int x_2 = square(x); return x_2; } int main(){ int a = 10; int b = get_num(a); } é€šè¿‡ä¸‹é¢å‘½ä»¤ç¼–è¯‘ C++ ä»£ç ï¼Œæ³¨æ„éœ€è¦ä½¿ç”¨ -g å‚æ•°ï¼Œåœ¨ç¼–è¯‘ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­åŠ å…¥æºç ä¿¡æ¯ï¼Œå¹¶å¯åŠ¨ GDB è°ƒè¯•ä»£ç ï¼š\n1 2 3 gcc -g test.cpp -o test # ç¼–è¯‘æºæ–‡ä»¶ gdb test # å¯åŠ¨ gdb å¼€å§‹è°ƒè¯•ä»£ç  gdb -q test # -q è¡¨ç¤ºä¸æ‰“å°gdbç‰ˆæœ¬ä¿¡æ¯ï¼Œç•Œé¢è¾ƒä¸ºå¹²å‡€ï¼› æŸ¥çœ‹æºç  list(ç®€å†™ l)ï¼š æŸ¥çœ‹æºç¨‹åºä»£ç ï¼Œé»˜è®¤æ˜¾ç¤º10è¡Œï¼ŒæŒ‰å›è½¦é”®æˆ–ç»§ç»­è¾“å…¥læŸ¥çœ‹ä¸‹10è¡Œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 Reading symbols from test... (gdb) l 1 #include\u0026lt;stdio.h\u0026gt; 2 int square(int x) { 3 return x * x; 4 } 5 6 int get_num(int x) { 7 int x_2 = square(x); 8 return x_2; 9 } 10 (gdb) l 11 int main(){ 12 int a = 10; 13 int b = get_num(a); 14 } (gdb) l Line number 15 out of range; test.cpp has 14 lines. è¿è¡Œç¨‹åº run(ç®€å†™ r) ï¼šè¿è¡Œç¨‹åºç›´åˆ°é‡åˆ° ç»“æŸæˆ–è€…é‡åˆ°æ–­ç‚¹ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤ï¼š\n1 2 3 4 5 (gdb) c The program is not being run. (gdb) r Starting program: /data1/workplace/tmp/test [Inferior 1 (process 1044104) exited normally] è®¾ç½®æ–­ç‚¹ break(ç®€å†™ b) ï¼šå‘½ä»¤æ ¼å¼ b è¡Œå·ï¼Œåœ¨æŸè¡Œè®¾ç½®æ–­ç‚¹ï¼š info breakpoints (ç®€å†™ i b) ï¼šæ˜¾ç¤ºæ–­ç‚¹ä¿¡æ¯ã€‚\nNumï¼š æ–­ç‚¹ç¼–å· Typeï¼šç±»å‹ï¼Œbreakpoint æˆ–è€… watchpoint Dispï¼šæ–­ç‚¹æ‰§è¡Œä¸€æ¬¡ä¹‹åæ˜¯å¦æœ‰æ•ˆ kepï¼šæœ‰æ•ˆ disï¼šæ— æ•ˆ Enbï¼š å½“å‰æ–­ç‚¹æ˜¯å¦æœ‰æ•ˆ yï¼šæœ‰æ•ˆ nï¼šæ— æ•ˆ Addressï¼šå†…å­˜åœ°å€ Whatï¼šä½ç½® 1 2 3 4 5 6 (gdb) b 13 Breakpoint 1 at 0x555555555170: file test.cpp, line 13. (gdb) i b Num Type Disp Enb Address What 1 breakpoint keep y 0x0000555555555170 in main() at test.cpp:13 (gdb) å•æ­¥æ‰§è¡Œ é¦–å…ˆéœ€è¦è¾“å…¥ run å¯åŠ¨ç¨‹åºï¼Œè¿è¡Œåˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹å¤„ï¼Œç„¶åå¯ä»¥é€‰æ‹© step å•æ­¥è°ƒè¯•ï¼ˆå¦‚æœæœ‰å‡½æ•°è°ƒç”¨åˆ™è¿›å…¥å‡½æ•°ï¼‰ï¼Œnext å•æ­¥è·Ÿè¸ªç¨‹åºï¼ˆé‡åˆ°å‡½æ•°è°ƒç”¨ï¼Œç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œä¸ä¼šè¿›å…¥å‡½æ•°ä½“å†…ï¼‰ï¼Œcontinue ç»§ç»­è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å¤„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 (gdb) r Starting program: /data1/workplace/tmp/test Breakpoint 2, main () at test.cpp:12 12 int a = 10; (gdb) s Breakpoint 1, main () at test.cpp:13 13 int b = get_num(a); (gdb) s get_num (x=21845) at test.cpp:6 6 int get_num(int x) { (gdb) s 7 int x_2 = square(x); (gdb) n 8 return x_2; (gdb) l 8 3 return x * x; 4 } 5 6 int get_num(int x) { 7 int x_2 = square(x); 8 return x_2; 9 } 10 11 int main(){ 12 int a = 10; (gdb) è¿è¡Œç¨‹åºç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š\nrunï¼šç®€è®°ä¸º r ï¼Œå…¶ä½œç”¨æ˜¯è¿è¡Œç¨‹åºï¼Œå½“é‡åˆ°æ–­ç‚¹åï¼Œç¨‹åºä¼šåœ¨æ–­ç‚¹å¤„åœæ­¢è¿è¡Œï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥ä¸‹ä¸€æ­¥çš„å‘½ä»¤ï¼› continue ï¼ˆç®€å†™ c ï¼‰ï¼šç»§ç»­æ‰§è¡Œï¼Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å¤„ï¼ˆæˆ–è¿è¡Œç»“æŸï¼‰ï¼› nextï¼šï¼ˆç®€å†™ n ï¼‰ï¼Œå•æ­¥è·Ÿè¸ªç¨‹åºï¼Œå½“é‡åˆ°å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¹Ÿä¸è¿›å…¥æ­¤å‡½æ•°ä½“ï¼›æ­¤å‘½ä»¤åŒstep çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œstep é‡åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå°†æ­¥è¿›åˆ°å‡½æ•°ä¸­å»è¿è¡Œï¼Œè€Œ next åˆ™ç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œä¸ä¼šè¿›å…¥åˆ°å‡½æ•°ä½“å†…ã€‚ stepï¼šï¼ˆç®€å†™sï¼‰ï¼šå•æ­¥è°ƒè¯•å¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œåˆ™è¿›å…¥å‡½æ•°ï¼›ä¸å‘½ä»¤ n ä¸åŒï¼Œn æ˜¯ä¸è¿›å…¥è°ƒç”¨çš„å‡½æ•°çš„ï¼› untilï¼šå½“ä½ åŒå€¦äº†åœ¨ä¸€ä¸ªå¾ªç¯ä½“å†…å•æ­¥è·Ÿè¸ªæ—¶ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥è¿è¡Œç¨‹åºç›´åˆ°é€€å‡ºå¾ªç¯ä½“ï¼› until è¡Œå·ï¼š è¿è¡Œè‡³æŸè¡Œï¼Œä¸ä»…ä»…ç”¨æ¥è·³å‡ºå¾ªç¯ï¼› finishï¼š è¿è¡Œç¨‹åºï¼Œç›´åˆ°å½“å‰å‡½æ•°å®Œæˆè¿”å›ï¼Œå¹¶æ‰“å°å‡½æ•°è¿”å›æ—¶çš„å †æ ˆåœ°å€å’Œè¿”å›å€¼åŠå‚æ•°å€¼ç­‰ä¿¡æ¯ã€‚ call å‡½æ•°(å‚æ•°)ï¼šè°ƒç”¨ç¨‹åºä¸­å¯è§çš„å‡½æ•°ï¼Œå¹¶ä¼ é€’â€œå‚æ•°â€ï¼Œå¦‚ï¼šcall gdb_test(55) æŸ¥çœ‹å˜é‡ print ï¼šç®€è®° pï¼Œæ‰“å°å˜é‡æˆ–è¡¨è¾¾å¼çš„å€¼ï¼› whatis ï¼šæŸ¥è¯¢å˜é‡æˆ–å‡½æ•°çš„ç±»å‹ï¼› pt ï¼šè·Ÿ whatis ä½œç”¨ç±»ä¼¼ï¼Œå¯èƒ½æ˜¯ print type çš„ç®€å†™ï¼› displayï¼šåœ¨å•æ­¥è°ƒè¯•çš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼Œä½¿ç”¨ display å‘½ä»¤è®¾ç½®ä¸€ä¸ªè¡¨è¾¾å¼åï¼Œå®ƒå°†åœ¨æ¯æ¬¡å•æ­¥è¿›è¡ŒæŒ‡ä»¤åï¼Œç´§æ¥ç€è¾“å‡ºè¢«è®¾ç½®çš„è¡¨è¾¾å¼åŠå€¼ï¼› info dispalyï¼ŒæŸ¥çœ‹å½“å‰è¢«è®¾ç½®çš„å˜é‡ï¼Œç„¶åå¯ä»¥ç”¨ undisplay numï¼ˆå˜é‡å¯¹åº”çš„ç¼–å·ï¼‰ å–æ¶ˆè®¾ç½®ï¼› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 (gdb) p x $11 = 10 (gdb) whatis x type = int (gdb) whatis square type = int (int) (gdb) pt square type = int (int) (gdb) display x*x + 2 1: x*x + 2 = 102 (gdb) display 1: x*x + 2 = 102 (gdb) info display Auto-display expressions now in effect: Num Enb Expression 1: y x*x + 2 (gdb) é€€å‡º GDB ä½¿ç”¨ quit ï¼ˆç®€è®° q ï¼‰å‘½ä»¤é€€å‡ºå³å¯ã€‚\nGDB å¸¸ç”¨å‘½ä»¤ ä¸‹é¢åˆ—å‡ºæœ€å¸¸ç”¨çš„GDBå‘½ä»¤ï¼š\nptï¼šæŸ¥çœ‹å˜é‡çš„çœŸå®ç±»å‹ï¼Œä¸å— typedef çš„å½±å“ï¼› btï¼šæ˜¾ç¤ºå½“å‰è°ƒç”¨å †æ ˆï¼› up/downï¼šåœ¨å‡½æ•°è°ƒç”¨æ ˆé‡Œä¸Šä¸‹ç§»åŠ¨ã€‚æˆ–è€…ä½¿ç”¨frame å‡½æ•°å¸§å·è·³è½¬ï¼› finï¼šç›´æ¥è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼› i bï¼šæŸ¥çœ‹æ‰€æœ‰çš„æ–­ç‚¹ä¿¡æ¯ï¼› i localsï¼šæŸ¥çœ‹å½“å‰å †æ ˆé¡µçš„æ‰€æœ‰å˜é‡ï¼› whï¼šå¯åŠ¨â€œå¯è§†åŒ–è°ƒè¯•â€ã€‚è¿™ä¸ªæ˜¯æˆ‘æœ€å–œæ¬¢çš„å‘½ä»¤ï¼Œå¯ä»¥æŠŠå±å¹•åˆ†æˆä¸Šä¸‹ä¸¤ä¸ªçª—å£ï¼Œä¸Šé¢æ˜¾ç¤ºæºç ï¼Œä¸‹é¢æ˜¯ GDB å‘½ä»¤è¾“å‡ºï¼Œä¸å¿…å†ç”¨â€œlâ€é¢‘ç¹åœ°åˆ—å‡ºæºç äº†ï¼Œèƒ½å¤Ÿå¤§å¤§æé«˜è°ƒè¯•çš„æ•ˆç‡ï¼› ctrl x + a ï¼šé€€å‡ºæˆ–è¿›å…¥å¯è§†åŒ–æ¨¡å¼ï¼› layout regsï¼šæ˜¾ç¤ºæºä»£ç /æ±‡ç¼–å’Œå¯„å­˜å™¨çª—å£ï¼› layout splitï¼šæ˜¾ç¤ºæºä»£ç å’Œæ±‡ç¼–çª—å£ï¼› p *array@10ï¼šæŸ¥çœ‹æ•°ç»„å†…å®¹ï¼Œè¿™é‡Œ10è¡¨ç¤ºæŸ¥çœ‹æ•°ç»„çš„å¤§å°ï¼› ptypeï¼šæŸ¥çœ‹å˜é‡çš„ç±»å‹ï¼Œè¿™é‡Œæ‰“å°å‡ºå˜é‡çš„ç»“æ„å®šä¹‰ï¼› set args config.txtï¼šæŒ‡å®šè¿è¡Œæ—¶çš„å‚æ•°ï¼› å‚è€ƒ GDBè°ƒè¯•å…¥é—¨æŒ‡å—\nGDBå­¦ä¹ ç¬”è®°\nå­¦ä¹ ä½¿ç”¨ GDB è°ƒè¯•ä»£ç \nlinuxä¸‹gdbè°ƒè¯•æ–¹æ³•ä¸æŠ€å·§æ•´ç†\n100ä¸ªgdbå°æŠ€å·§\n","date":"2022-07-12T16:59:57+08:00","permalink":"https://qiyueliuhuo.github.io/posts/gdb%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0/","title":"GDBè°ƒè¯•å­¦ä¹ "},{"content":"æ¢¯åº¦ä¸‹é™æ³•æ¨å¯¼ ä»€ä¹ˆæ˜¯æ¢¯åº¦ï¼Ÿ æ¢¯åº¦çš„æœ¬æ„æ˜¯ä¸€ä¸ªå‘é‡ï¼ˆçŸ¢é‡ï¼‰ï¼Œè¡¨ç¤ºæŸä¸€å‡½æ•°åœ¨è¯¥ç‚¹å¤„çš„æ–¹å‘å¯¼æ•°æ²¿ç€è¯¥æ–¹å‘å–å¾—æœ€å¤§å€¼ï¼Œå³å‡½æ•°åœ¨è¯¥ç‚¹å¤„æ²¿ç€è¯¥æ–¹å‘ï¼ˆæ­¤æ¢¯åº¦çš„æ–¹å‘ï¼‰å˜åŒ–æœ€å¿«ï¼Œå˜åŒ–ç‡æœ€å¤§ï¼ˆä¸ºè¯¥æ¢¯åº¦çš„æ¨¡ï¼‰ã€‚\né€šä¿—æ¥è¯´ï¼Œæ¢¯åº¦å°±æ˜¯è¡¨ç¤ºæŸä¸€å‡½æ•°åœ¨è¯¥ç‚¹å¤„çš„æ–¹å‘å¯¼æ•°æ²¿ç€è¯¥æ–¹å‘å–å¾—ï¼ˆæ¨¡ï¼‰è¾ƒå¤§å€¼ï¼Œå³å‡½æ•°åœ¨å½“å‰ä½ç½®çš„å¯¼æ•°ã€‚ç¬”è€…ç†è§£ï¼šåœ¨é«˜ç»´ç©ºé—´ä¸­å‚æ•° $\\boldsymbol{\\theta}$ å’Œ $f(\\boldsymbol{\\theta})$ å½¢æˆè¶…æ›²é¢ä¸Šï¼Œå½“ $\\boldsymbol{\\theta}$ ç§»åŠ¨ç›¸åŒçš„ $\\lVert\\nabla\\boldsymbol{\\theta}\\lVert$ æ¨¡å€¼ï¼ˆè¶…è·ç¦»ï¼‰æ—¶ï¼Œæ²¿ç€æ¢¯åº¦çš„æ–¹å‘ï¼Œå¯ä»¥ä½¿å¾— $f(\\boldsymbol{\\theta})$ å˜åŒ–é‡ï¼ˆå¢åŠ ï¼‰æœ€å¤§ã€‚æ¢¯åº¦è¡¨ç¤ºä¸ºå¦‚ä¸‹ï¼š $$ \\nabla f(\\boldsymbol{\\theta})=\\frac{\\partial f(\\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\theta}} $$ å…¶ä¸­ï¼Œ$\\boldsymbol{\\theta}$ä¸ºçŸ¢é‡ï¼ˆå‘é‡ï¼‰ï¼Œå¤§å°ä¸º $1 \\times n$ï¼›$f(\\boldsymbol{\\theta})$ä¸ºæ ‡é‡ï¼Œè¯¥å‡½æ•°ç§°ä¸ºç›®æ ‡å‡½æ•°ï¼Œä¹Ÿå«åšæŸå¤±å‡½æ•°ï¼Œæœ‰æ—¶å€™ä¹Ÿç”¨ $L$ æˆ–è€… $J$ è¡¨ç¤ºï¼›$\\nabla f(\\boldsymbol{\\theta})$ ä¸ºçŸ¢é‡ï¼Œå¤§å°ä¸º $n \\times 1$ã€‚\nå¦‚æœå‡½æ•° $f(\\boldsymbol{\\theta})$ æ˜¯å‡¸å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•è¿›è¡Œä¼˜åŒ–ã€‚ $$ \\boldsymbol{\\theta} = \\boldsymbol{\\theta_0} - \\eta \\cdot \\nabla f(\\boldsymbol{\\theta_0}) $$ å…¶ä¸­ï¼Œ$\\boldsymbol{\\theta_0}$ æ˜¯è‡ªå˜é‡å‚æ•°ï¼Œä»£è¡¨å½“å‰å‚æ•°ä½ç½®åæ ‡ï¼›$\\eta$ æ˜¯å­¦ä¹ å› å­ï¼ˆå­¦ä¹ ç‡ï¼‰ï¼Œç”¨æ¥è°ƒæ•´ä¸‹é™æ—¶æ­¥è¿›é•¿åº¦ï¼›$\\boldsymbol{\\theta}$ æ˜¯æ›´æ–°åçš„å‚æ•°å€¼ï¼Œå³é€šè¿‡ä¸€æ¬¡æ¢¯åº¦ä¸‹é™æ³•ä¹‹åçš„å‚æ•°åæ ‡ä½ç½®ã€‚\næ¨å¯¼æ¢¯åº¦ä¸‹é™æ³•å…¬å¼ æˆ‘ä»¬å¯¹ $f(\\boldsymbol{\\theta})$ è¿›è¡Œä¸€é˜¶æ³°å‹’å±•å¼€ï¼Œå¦‚ä¸‹ï¼š $$ f(\\boldsymbol{\\theta}) = f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) + o\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) $$ æ³¨æ„ï¼Œä¸Šé¢ç­‰å¼å½“ $f(\\boldsymbol{\\theta})$ åœ¨ $\\boldsymbol{\\theta_{0}}$ å¯å¯¼æ—¶ï¼Œæ’æˆç«‹ï¼›å…¶ä¸­ï¼Œ$ o\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) $ ä¸ºä½™é¡¹ï¼ˆæˆ–è€…ç§°ä¸ºçº¿æ€§è¿‘ä¼¼è¯¯å·®ï¼‰ã€‚è€Œä¸”ï¼Œè¿™é‡Œåªæœ‰ $\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\rightarrow 0$æ—¶ï¼Œ$o\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)$ æ‰ä¸ºæ— ç©·å°é‡ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ç”¨å‰ä¸¤é¡¹è¿‘ä¼¼ $f(\\boldsymbol{\\theta})$ å€¼ï¼Œæ‰€ä»¥å¦‚æœ $\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)$ å¤ªå¤§ï¼Œè¯¯å·®ä¼šæ¯”è¾ƒå¤§ã€‚\né‚£ä¹ˆï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ $f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ æ¥è¿‘ä¼¼ $f(\\boldsymbol{\\theta})$æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®— $\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ï¼Œå³ä¸ºç›®æ ‡å‡½æ•°åœ¨å½“å‰å‚æ•°ä½ç½® $f(\\boldsymbol{\\theta_{0}})$ å¤„çš„æ¢¯åº¦ã€‚ $$ f(\\boldsymbol{\\theta}) \\approx f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) $$ è¿™é‡Œï¼Œ$\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}$ æ˜¯ä¸€ä¸ªå¾®å°é‡ï¼Œæˆ‘ä»¬ä»¤ $\\lVert\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\lVert$ ä¸º $\\eta$ï¼Œ$\\eta$ ä¸ºæ ‡é‡ï¼Œä»¤å•ä½å‘é‡ $\\frac{\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}}{\\lVert\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\rVert}$ ä¸º $\\boldsymbol{v}$ è¡¨ç¤ºï¼Œåˆ™ $$ \\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}} = \\eta \\boldsymbol{v} $$ ä»£å…¥åˆ°ä¸Šé¢çš„è¡¨è¾¾å¼åï¼š $$ f(\\boldsymbol{\\theta}) \\approx f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\eta \\boldsymbol{v} \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) $$ æ­¤å¤„æ˜¯é‡ç‚¹ï¼ï¼! å±€éƒ¨ä¸‹é™çš„ç›®çš„æ˜¯å¸Œæœ›æ¯æ¬¡ $\\boldsymbol{\\theta}$ æ›´æ–°ï¼Œéƒ½èƒ½è®©å‡½æ•°å€¼ $f(\\boldsymbol{\\theta})$ å˜å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¸Œæœ›ä¸Šå¼ $f(\\boldsymbol{\\theta})\u0026lt;f\\left(\\boldsymbol{\\theta_{0}}\\right)$ã€‚é‚£ä¹ˆï¼Œå¸Œæœ›ä¸‹é¢å¼å­æ¯æ¬¡æ›´æ–°éƒ½å¯ä»¥æˆç«‹ï¼š $$ f(\\boldsymbol{\\theta})-f\\left(\\boldsymbol{\\theta_{0}}\\right) \\approx \\eta \\boldsymbol{v} \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\u0026lt;0 $$ å› ä¸º $\\eta$ ä¸ºæ ‡é‡ï¼Œä¸”ä¸€èˆ¬è®¾å®šä¸ºæ­£å€¼ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ï¼Œä¸ç­‰å¼ç­‰ä»·äºï¼š $$ \\boldsymbol{v} \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\u0026lt;0 $$ å…¶ä¸­ï¼Œ$\\boldsymbol{v}$ å’Œ $\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ éƒ½æ˜¯å‘é‡ï¼Œ$\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ æ˜¯å½“å‰ä½ç½®çš„æ¢¯åº¦ï¼Œ$\\boldsymbol{v}$ è¡¨ç¤ºä¸‹ä¸€æ­¥å‰è¿›çš„å•ä½å‘é‡ï¼Œæ˜¯éœ€è¦æ±‚è§£çš„, ä»è€Œå°±èƒ½æ ¹æ® $\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}=\\eta \\boldsymbol{v}$ ç¡®å®š $\\boldsymbol{\\theta}$ çš„å€¼äº†ã€‚\nè®©æˆ‘ä»¬æ¥åˆ†æï¼Œå½“ $\\boldsymbol{v}$ å’Œ $\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ äº’ä¸ºåå‘ï¼Œå³ $\\boldsymbol{v}$ ä¸ºå½“å‰æ¢¯åº¦æ–¹å‘çš„è´Ÿæ–¹å‘çš„æ—¶å€™ï¼Œèƒ½è®© $\\lvert \\boldsymbol{v} \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) \\rvert$ æœ€å¤§ï¼Œä»è€Œä½¿å¾— $f(\\boldsymbol{\\theta})$ æœ€å¤§ç¨‹åº¦åœ°å‡å°ï¼Œä¹Ÿå°±ä¿è¯äº† $\\boldsymbol{v}$ çš„æ–¹å‘æ˜¯å±€éƒ¨æœ€å¤§ç¨‹åº¦ä¸‹é™çš„æ–¹å‘ã€‚é‚£ä¹ˆï¼š $$ \\boldsymbol{v}=-\\frac{\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T}}{\\lVert\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\lVert} $$ å†æ ¹æ® $\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}} = \\eta \\boldsymbol{v}$ å¾—åˆ°ï¼š $$ \\boldsymbol{\\theta} = \\boldsymbol{\\theta_{0}} - \\eta \\frac{\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T}}{\\lVert\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\lVert} $$ ä¸€èˆ¬åœ°ï¼Œå› ä¸º $\\lVert\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\lVert$ æ˜¯æ ‡é‡ï¼Œå¯ä»¥å¹¶å…¥åˆ°å› å­ $\\eta$ ä¸­ï¼Œå³ç®€åŒ–ä¸º $$ \\boldsymbol{\\theta} = \\boldsymbol{\\theta_{0}} - \\eta^{\\prime} \\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} $$ ä¸€èˆ¬ $\\eta^{\\prime}$ ä¸ºå­¦ä¹ ç‡ï¼Œæ˜¯ä¸€ä¸ªå¾®å°å¸¸é‡ï¼Œé€šå¸¸å–0.01ï¼Œ0.001ï¼Œ0.0001ç­‰å€¼ã€‚\næ¢¯åº¦ä¸‹é™æ³•åˆ†æ å¦‚æœå°† $f(\\boldsymbol{\\theta})$ åœ¨ $\\boldsymbol{\\theta_{0}}$ å¤„è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€ï¼š $$ f(\\boldsymbol{\\theta}) = f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) + \\frac{1}{2}\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)\\boldsymbol{H}\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)^{T} + o\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) $$ å…¶ä¸­ï¼Œ$\\boldsymbol{H}$ ä¸ºHessiançŸ©é˜µï¼Œå…¶å±•å¼€å½¢å¼ä¸ºï¼š\n$$ H=\\left(\\begin{array}{cccc} \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\\\ \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\\\ \\vdots \u0026amp; \\vdots \u0026amp; \u0026amp; \\vdots \\\\ \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\end{array}\\right) $$\næˆ‘ä»¬å°†æ¢¯åº¦ä¸‹é™æ³•çš„è¿­ä»£å…¬å¼ $\\boldsymbol{\\theta} = \\boldsymbol{\\theta_{0}} - \\eta^{\\prime} \\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T}$ ä»£å…¥åˆ°äºŒé˜¶æ³°å‹’å±•å¼€å¼ä¸­ï¼Œå¹¶ä¸”å¿½ç•¥äºŒé˜¶ä½™é¡¹è¯¯å·®ï¼Œå¾—åˆ°ï¼š $$ f(\\boldsymbol{\\theta})-f\\left(\\boldsymbol{\\theta_{0}}\\right) \\approx -\\eta^{\\prime}\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\frac{1}{2} \\eta^{\\prime2} \\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\boldsymbol{H}\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) $$ ä¸Šé¢å¼å­å³è¾¹æ˜¯æ¢¯åº¦ä¸‹é™æ³•ä¸€æ­¥è¿­ä»£åå¼•èµ·ç›®æ ‡å‡½æ•° $f(\\boldsymbol{\\theta})$ çš„å˜åŒ–é‡ï¼Œæ¯æ¬¡è¿­ä»£çš„å˜åŒ–é‡å…¶å®ä¸ä¸€å®šæ˜¯è´Ÿçš„ï¼Œä½¿å¾— $f(\\boldsymbol{\\theta})$ å‡å°ï¼Œä¹Ÿå¯èƒ½å¼•èµ· $f(\\boldsymbol{\\theta})$ å¢åŠ ã€‚\nåŸå› åˆ†æï¼š\nç†è®ºåˆ†ææ¥è®²ï¼Œå½“ $\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\rightarrow 0$æ—¶å€™ï¼Œå³å½“å­¦ä¹ ç‡ $\\eta^{\\prime}$ è¶³å¤Ÿå°æ—¶ï¼Œä¸€é˜¶å±•å¼€ä½™é¡¹ $o\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)$ è¶‹è¿‘äº0ï¼Œä¸ä¼šä½¿å¾—ä¸Šå¼å³è¾¹ä¸ºè´Ÿï¼Œä¹Ÿå°±å¯ä»¥ä¿è¯è¿­ä»£å¯ä»¥æˆåŠŸä¸‹é™ï¼Œä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´è¾¾åˆ°æå°å€¼éœ€è¦çš„è¿­ä»£æ¬¡æ•°å¢åŠ ï¼Œä½¿å¾—å­¦ä¹ è¿‡æ…¢ï¼Œå¢åŠ è®¡ç®—å’Œæ—¶é—´æˆæœ¬ã€‚ å¦‚æœHessiançŸ©é˜µæ˜¯è´Ÿå®šçš„ï¼Œå¯ä»¥ä¿è¯ $\\frac{1}{2} \\eta^{\\prime2} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)^{T} \\boldsymbol{H}\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ é¡¹ä¸ºè´Ÿï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä¿è¯ä¸€æ¬¡æ¢¯åº¦ä¸‹é™è¿­ä»£åï¼Œä½¿å¾—ç›®æ ‡å‡½æ•°ä¸‹é™ï¼Œå…³äºHessiançŸ©é˜µçš„ç†è§£ï¼Œå¯ä»¥å‚è€ƒHessiançŸ©é˜µå’Œæå€¼åˆ¤æ–­ã€‚ å½“å­¦ä¹ ç‡ $\\eta^{\\prime}$è¿‡å¤§æ—¶ï¼ŒäºŒé˜¶ä½™é¡¹è¯¯å·®å˜å¤§ï¼ŒäºŒé˜¶æ³°å‹’å±•å¼€çš„å‡†ç¡®æ€§ä¹Ÿå°±ä¸é«˜äº†ï¼Œå› æ­¤å¯ä»¥ç”¨å¯å‘å¼å¯»æ‰¾åˆé€‚çš„å­¦ä¹ ç‡ã€‚ã€å»¶ä¼¸é˜…è¯»ã€‘ ä¸‹é¢å¯¹äº $\\frac{1}{2} \\eta^{\\prime2} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)^{T} \\boldsymbol{H}\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)$ ä¸ºæ­£è¿›è¡Œåˆ†æè®¨è®ºã€‚\nå¦‚æœæˆ‘ä»¬ä½¿ä¸Šé¢å¼å­å³è¾¹å°äº0ï¼Œå³ï¼š $$ -\\eta^{\\prime}\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\frac{1}{2} \\eta^{\\prime2} \\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\boldsymbol{H}\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) \u0026lt; 0 $$ æ•´ç† $\\eta^{\\prime}$ å¾—åˆ°ï¼š $$ \\eta^{\\prime} \u0026lt; \\frac{\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)}{\\left(\\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)\\right)^{T} \\boldsymbol{H} \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right)} $$ é‚£ä¹ˆï¼Œå½“å­¦ä¹ ç‡æ»¡è¶³ä¸Šé¢å¼å­æ—¶ï¼ˆè¶³å¤Ÿå°ï¼‰ï¼Œæ€»å¯ä»¥æ¢¯åº¦ä¸‹é™ã€‚ä¸è¿‡ä¸Šé¢å¼å­ä¹Ÿæ˜¯åœ¨æ³°å‹’äºŒé˜¶å±•å¼€ä¸‹çš„è¿‘ä¼¼åˆ†æã€‚\nä¸‹é¢ä½¿ç”¨å‚æ•°åªæœ‰ä¸€ç»´æƒ…å†µä¸‹çš„ç‰¹ä¾‹æƒ…å†µä¸‹ï¼Œç”»å›¾è¯´æ˜ä¸Šé¢çš„æƒ…å†µï¼š\nç‰›é¡¿è¿­ä»£æ³•æ¨å¯¼ é€šè¿‡ä¸Šé¢æ³°å‹’å±•å¼€å¼åˆ†ææ¢¯åº¦ä¸‹é™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¢¯åº¦ä¸‹é™æ³•ä»…ä½¿ç”¨æ¢¯åº¦ä¿¡æ¯è¿›è¡Œè¿­ä»£ä¸‹é™ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ•ˆæœè¿˜å¯ä»¥ï¼Œå¹¶ä¸”ç”±äºç›®å‰ç¥ç»ç½‘ç»œä¸­åå‘ä¼ æ’­ç®—æ³•å¯ä»¥é«˜æ•ˆæ±‚è§£æ¢¯åº¦ï¼Œæ‰€ä»¥å½“å‰å¯¹äºç¥ç»ç½‘ç»œçš„ä¼˜åŒ–æ™®é€šé‡‡ç”¨æ¢¯åº¦ä¸‹é™æ³•ã€‚å…³äºåå‘ä¼ æ’­ç®—æ³•å¯ä»¥åœ¨æˆ‘çš„ç¥ç»ç½‘ç»œä¹‹åå‘ä¼ æ’­ç®—æ³•æ–‡ç« ä¸­äº†è§£ã€‚\nç‰›é¡¿æ³•è¿­ä»£å…¬å¼ äºŒé˜¶æ³°å‹’å±•å¼€è¿‘ä¼¼å…¬å¼ä¸ºï¼š $$ f(\\boldsymbol{\\theta}) \\approx f\\left(\\boldsymbol{\\theta_{0}}\\right)+\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right) \\cdot \\nabla f\\left(\\boldsymbol{\\theta_{0}}\\right) + \\frac{1}{2}\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)\\boldsymbol{H}\\left(\\boldsymbol{\\theta}-\\boldsymbol{\\theta_{0}}\\right)^{T} $$ æˆ‘ä»¬å¯¹å¼å­å³è¾¹æ±‚æå€¼ç‚¹ï¼Œåˆ™å¯ä»¥å¾—åˆ°ï¼š\næ·±åº¦å­¦ä¹ ä¸­å¸¸è§çš„ä¼˜åŒ–å™¨ SGD Adam å‚è€ƒ æ¢¯åº¦ä¸‹é™æ³•çš„æ¨å¯¼\nç›¸ä¿¡æˆ‘ä½ æ²¡çœŸæ˜ç™½ç‰›é¡¿æ³•ä¸æ¢¯åº¦ä¸‹é™æ³•\nä¼˜åŒ–ç†è®ºâ€”â€”æ¢¯åº¦ä¸‹é™æ³•ä¸ç‰›é¡¿æ³•\nçº¿æ€§ä»£æ•°ç¬”è®°12ï¼šäºŒæ¬¡å‹ä¸å‡½æ•°æå€¼\nç‰›é¡¿æ³•\nåº”ç”¨äºæœ€ä¼˜åŒ–çš„ç‰›é¡¿æ³•\nHessiançŸ©é˜µå’Œæå€¼åˆ¤æ–­\nå»¶ä¼¸é˜…è¯» è®ºæ–‡ ã€ŠA stochastic quasi-Newton method for large-scale optimization ã€‹ ã€ŠA Linearly-Convergent Stochastic L-BFGS Algorithmã€‹ ã€ŠA Multi-Batch L-BFGS Method for Machine Learningã€‹ ã€ŠFast Exact Multiplication by the Hessianã€‹ ç–‘é—® ä¸ºä»€ä¹ˆç¥ç»ç½‘ç»œæ¯ä¸€å±‚çš„å­¦ä¹ ç‡ä¸€æ ·ï¼Œåº”è¯¥æ˜¯å‰é¢å±‚å­¦ä¹ ç‡å°ï¼Œåé¢å±‚å­¦ä¹ ç‡å¤§ã€‚\n","date":"2022-06-23T11:17:44+08:00","permalink":"https://qiyueliuhuo.github.io/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/","title":"æœºå™¨å­¦ä¹ ä¸­çš„ä¼˜åŒ–æ–¹æ³•"},{"content":"å‰è¨€ OpenMMLabå­¦ä¹ èµ„æ–™ï¼šOpenMMLab æ¨¡å—åŒ–è®¾è®¡èƒŒåçš„åŠŸè‡£\nå¯¹äºmmdetectionçš„å­¦ä¹ ï¼Œå¯ä»¥ç›´æ¥é˜…è¯»å®˜æ–¹çš„æ–‡æ¡£ï¼Œç°åœ¨å®˜æ–¹æä¾›äº†ä¸­æ–‡æ–‡æ¡£ï¼Œéå¸¸è¯¦ç»†ï¼Œç‚¹å‡»mmdetectionä¸­æ–‡æ–‡æ¡£é˜…è¯»ã€‚\nå…³äºåŸºäºmmdetectionæ¡†æ¶å®ç°Faster R-CNNç®—æ³•ï¼Œå¯ä»¥å…ˆé˜…è¯»å®˜æ–¹åœ¨çŸ¥ä¹ä¸Šå‘å¸ƒçš„æ–‡ç« ï¼Œè½»æ¾æŒæ¡ MMDetection ä¸­å¸¸ç”¨ç®—æ³•(äºŒ)ï¼šFaster R-CNN|Mask R-CNNï¼Œæœ¬ç¯‡åšå®¢æ˜¯å¯¹å…¶è¿›è¡Œä»æºç å®ç°å±‚é¢è¿›è¡Œè¡¥å……è§£è¯»ã€‚\nmmdetectionä»£ç æ¡†æ¶ é€šè¿‡ä¸‹é¢å‘½ä»¤æ‹‰å–æœ€æ–°çš„ä»£ç \n1 git clone git@github.com:open-mmlab/mmdetection.git ä»£ç ä»“åº“ä¸»åˆ†æ”¯ä¸ºmasteråˆ†æ”¯ï¼Œç›®å‰è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­ç›®æ ‡æ£€æµ‹ç®—æ³•æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œmmdetectionä¹Ÿä¸æ–­åœ°å®ç°æ–°çš„ç®—æ³•ï¼Œæœ€æ–°å®ç°çš„ç®—æ³•æŸ¥çœ‹CHANGELOGã€‚\nå¦‚æœè§‰å¾—masterä»£ç æ›´æ–°æ¯”è¾ƒé¢‘ç¹ï¼Œå½±å“è‡ªå·±åŸºäºmmdetectionçš„ç®—æ³•å®ç°ï¼Œä¹Ÿå¯ä»¥åŸºäºæœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬åˆ›å»ºè‡ªå·±çš„åˆ†æ”¯ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼š\n1 git checkout -b newbranch v2.25.0 # æˆªæ­¢2022.06.19å‘å¸ƒçš„æœ€æ–°ç¨³å®šç‰ˆ ç›®å‰è¿˜æ˜¯æ¨èç›´æ¥ä½¿ç”¨masterä»£ç ï¼Œå¹¶ä¸”è¦ç»å¸¸ git pull æ‹‰å–æœ€æ–°çš„ä»£ç ï¼Œè¿™æ ·æœ€æ–°çš„ä¸€äº›ç»„ä»¶ä¹Ÿä¼šæ›´æ–°ï¼Œæ–¹ä¾¿åŸºäºæœ€æ–°çš„ç»„ä»¶æ­å»ºè‡ªå·±çš„ç½‘ç»œç®—æ³•ã€‚\nä¹‹å‰é˜…è¯»çš„YOLO v4è®ºæ–‡ä¸­ï¼Œä½œè€…å°†ç›®æ ‡æ£€æµ‹æŠ½è±¡ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼Œmmdetectionçš„ä»£ç ä¹Ÿæ˜¯è¿™æ ·æŠ½è±¡çš„ï¼š\nä¸‹é¢ä»£ç åˆ†æåŸºäºmmdetectionçš„æºç å½“å‰æœ€è¿‘commit: ca11860f4f3c3ca2ce8340e2686eeaec05b29111 ï¼Œæ—¶é—´ 2022.06.20ã€‚\nä¸‹é¢æ˜¯mmdetectionä»£ç æ¡†æ¶çš„ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 . â”œâ”€â”€ CITATION.cff â”œâ”€â”€ LICENSE â”œâ”€â”€ MANIFEST.in â”œâ”€â”€ README.md â”œâ”€â”€ README_zh-CN.md â”œâ”€â”€ andy_README.md â”œâ”€â”€ configs # å­˜æ”¾æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è‡ªå·±å†™é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç»§æ‰¿è‡ª_base_ä¸‹çš„å››ç§é…ç½®æ–‡ä»¶ â”œâ”€â”€ demo â”œâ”€â”€ docker â”œâ”€â”€ docs â”œâ”€â”€ mmdet # mmdeteetionçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œå…¶ä»–å·¥å…·éƒ½ä¾èµ–äºè¯¥éƒ¨åˆ†çš„ä»£ç  â”œâ”€â”€ model-index.yml â”œâ”€â”€ pytest.ini â”œâ”€â”€ requirements â”œâ”€â”€ requirements.txt â”œâ”€â”€ resources â”œâ”€â”€ setup.cfg â”œâ”€â”€ setup.py â”œâ”€â”€ tests # é›†æˆæµ‹è¯•ç›¸å…³ä»£ç  â””â”€â”€ tools # æä¾›è®­ç»ƒã€æµ‹è¯•ç­‰å·¥å…·ä»£ç  ä»¥ä¸‹æ˜¯configsç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶è¯´æ˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 configs â”œâ”€â”€ _base_ â”‚Â â”œâ”€â”€ datasets # æ•°æ®é›†åŠ è½½ï¼Œä¸åŒçš„æ•°æ®é›†æ ¼å¼è·å–æ•°æ®ä»£ç ã€‚ â”‚Â â”œâ”€â”€ default_runtime.py # é»˜è®¤çš„è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼Œä¸»è¦é…ç½®åŒ…æ‹¬æƒé‡ä¿å­˜é¢‘ç‡ã€æ—¥å¿—é¢‘ç‡ï¼Œæ—¥å¿—ç­‰çº§ç­‰ä¿¡æ¯ã€‚ â”‚Â â”œâ”€â”€ models # ä¸åŒçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹é…ç½®æ–‡ä»¶ â”‚Â â””â”€â”€ schedules # å„ç§è®­ç»ƒç­–ç•¥é…ç½®æ–‡ä»¶ â”œâ”€â”€ albu_example # ...å…¶ä»–ç›®å½•æ–‡ä»¶ï¼š1ï¼‰ç»§æ‰¿è‡ªä¸Šé¢çš„å››ç§æ–‡ä»¶ï¼Œå¹¶åšä¸€äº›é’ˆå¯¹æ€§ä¿®æ”¹ï¼›2ï¼‰å¯ä»¥è‡ªå·±å†™é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ‰€æœ‰å‚æ•°ã€‚ â”‚Â â”œâ”€â”€ README.md â”‚Â â””â”€â”€ mask_rcnn_r50_fpn_albu_1x_coco.py â”œâ”€â”€ atss â”‚Â â”œâ”€â”€ README.md â”‚Â â”œâ”€â”€ atss_r101_fpn_1x_coco.py â”‚Â â”œâ”€â”€ atss_r50_fpn_1x_coco.py â”‚Â â””â”€â”€ metafile.yml â”œâ”€â”€ autoassign ä»¥ä¸‹æ˜¯mmdetï¼ˆæ ¸å¿ƒä»£ç ï¼‰ç›®å½•ä¸‹çš„ä»£ç è¯´æ˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 mmdet â”œâ”€â”€ __init__.py # åˆ¤æ–­é…ç½®çš„mmcvæ˜¯å¦ç¬¦åˆè¦æ±‚ â”œâ”€â”€ apis # è®­ç»ƒå’Œæµ‹è¯•ç›¸å…³ä¾èµ–çš„å‡½æ•°ï¼Œæœ‰éšæœºç§å­ç”Ÿæˆã€è®­ç»ƒã€å•GPUæµ‹è¯•ã€å¤šGPUæµ‹è¯•ç­‰ â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ inference.py â”‚Â â”œâ”€â”€ test.py â”‚Â â””â”€â”€ train.py â”œâ”€â”€ core # å†…æ ¸ä»£ç ï¼ŒåŒ…æ‹¬é”šæ¡†ç”Ÿæˆã€è¾¹ç•Œæ¡†è®¡ç®—ã€ç»“æœè¯„ä¼°ã€æ•°æ®ç»“æ„ã€æ©ç ç”Ÿæˆã€å¯è§†åŒ–ã€é’©å­å‡½æ•°ç­‰ç­‰æ ¸å¿ƒä»£ç  â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ anchor â”‚Â â”œâ”€â”€ bbox â”‚Â â”œâ”€â”€ data_structures â”‚Â â”œâ”€â”€ evaluation â”‚Â â”œâ”€â”€ export â”‚Â â”œâ”€â”€ hook â”‚Â â”œâ”€â”€ mask â”‚Â â”œâ”€â”€ optimizers â”‚Â â”œâ”€â”€ post_processing â”‚Â â”œâ”€â”€ utils â”‚Â â””â”€â”€ visualization â”œâ”€â”€ datasets # æ•°æ®åŠ è½½å™¨çš„å…·ä½“å®ç°ï¼Œå¯¹åº”configs/datasets â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ api_wrappers â”‚Â â”œâ”€â”€ builder.py â”‚Â â”œâ”€â”€ cityscapes.py â”‚Â â”œâ”€â”€ coco.py â”‚Â â”œâ”€â”€ coco_panoptic.py â”‚Â â”œâ”€â”€ custom.py â”‚Â â”œâ”€â”€ dataset_wrappers.py â”‚Â â”œâ”€â”€ deepfashion.py â”‚Â â”œâ”€â”€ lvis.py â”‚Â â”œâ”€â”€ openimages.py â”‚Â â”œâ”€â”€ pipelines â”‚Â â”œâ”€â”€ samplers â”‚Â â”œâ”€â”€ utils.py â”‚Â â”œâ”€â”€ voc.py â”‚Â â”œâ”€â”€ wider_face.py â”‚Â â””â”€â”€ xml_style.py â”œâ”€â”€ models # ä¸åŒæ¨¡å‹çš„å…·ä½“å®ç°ï¼Œåˆ†ä¸ºä¸åŒçš„ä¸»å¹²ã€é¢ˆéƒ¨ã€å¤´éƒ¨ã€æŸå¤±å‡½æ•°ç­‰ç­‰ï¼Œå¯¹åº” configs/models â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ backbones â”‚Â â”œâ”€â”€ builder.py â”‚Â â”œâ”€â”€ dense_heads â”‚Â â”œâ”€â”€ detectors â”‚Â â”œâ”€â”€ losses â”‚Â â”œâ”€â”€ necks â”‚Â â”œâ”€â”€ plugins â”‚Â â”œâ”€â”€ roi_heads â”‚Â â”œâ”€â”€ seg_heads â”‚Â â””â”€â”€ utils â”œâ”€â”€ utils # é€šç”¨å·¥å…· â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ collect_env.py â”‚Â â”œâ”€â”€ compat_config.py â”‚Â â”œâ”€â”€ contextmanagers.py â”‚Â â”œâ”€â”€ logger.py â”‚Â â”œâ”€â”€ memory.py â”‚Â â”œâ”€â”€ misc.py â”‚Â â”œâ”€â”€ profiling.py â”‚Â â”œâ”€â”€ replace_cfg_vals.py â”‚Â â”œâ”€â”€ setup_env.py â”‚Â â”œâ”€â”€ split_batch.py â”‚Â â”œâ”€â”€ util_distribution.py â”‚Â â”œâ”€â”€ util_mixins.py â”‚Â â””â”€â”€ util_random.py â””â”€â”€ version.py # è®°å½•mmdetection çš„ç‰ˆæœ¬ ä»¥ä¸‹æ˜¯toolsç›®å½•ä¸‹çš„ä»£ç è¯´æ˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 tools â”œâ”€â”€ analysis_tools # åˆ†ææ—¥å¿—å’Œé¢„æµ‹æ•ˆæœ â”œâ”€â”€ dataset_converters # æ•°æ®é›†è½¬æ¢ â”œâ”€â”€ deployment # éƒ¨ç½²å·¥å…· â”œâ”€â”€ dist_test.sh â”œâ”€â”€ dist_train.sh â”œâ”€â”€ misc # æ‚é¡¹ï¼Œä¸‹è½½æ•°æ®é›†ã€æ‰“å°é…ç½®ä¿¡æ¯ç­‰å·¥å…· â”œâ”€â”€ model_converters â”œâ”€â”€ slurm_test.sh â”œâ”€â”€ slurm_train.sh â”œâ”€â”€ test.py # æµ‹è¯•æ¨¡å‹ â””â”€â”€ train.py # æ ¹æ®é…ç½®æ–‡ä»¶è¿›è¡Œè®­ç»ƒ Faster R-CNN æ¨¡å‹è®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 data â””â”€â”€ VOCdevkit â”œâ”€â”€ VOC2007 â”‚Â â”œâ”€â”€ Annotations â”‚Â â”œâ”€â”€ ImageSets â”‚Â â”œâ”€â”€ JPEGImages â”‚Â â”œâ”€â”€ SegmentationClass â”‚Â â””â”€â”€ SegmentationObject â””â”€â”€ VOC2012 â”œâ”€â”€ Annotations â”œâ”€â”€ ImageSets â”œâ”€â”€ JPEGImages â”œâ”€â”€ SegmentationClass â””â”€â”€ SegmentationObject æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œé…ç½®ç›¸å…³ç¯å¢ƒï¼Œä¸‹è½½VOCæ•°æ®é›†ï¼ˆè¿™é‡Œé€‰æ‹©ç›¸å¯¹è¾ƒå°çš„VOCæ•°æ®è¿›è¡Œè®­ç»ƒï¼‰ï¼Œå¹¶ä¸”ç»„ç»‡å¥½æ•°æ®é›†ç›®å½•ç»“æ„ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿›è¡Œè®­ç»ƒï¼š\n1 python tools/train.py configs/pascal_voc/faster_rcnn_r50_fpn_1x_voc0712.py ç¬”è€…è®­ç»ƒå¾—åˆ°çš„ç»“æœæ˜¯ï¼šmAP 78.8ï¼Œè¯¥ç»“æœå’Œå®˜æ–¹ç»™çš„ä»£ç ç»“æœå·®å°†è¿‘ä¸¤ä¸ªç‚¹ï¼Œå¯èƒ½æ˜¯è®­ç»ƒæ—¶å€™çš„å‚æ•°è®¾ç½®ä¸ä¸€æ ·å¯¼è‡´çš„ã€‚\nFaster R-CNN æ¨¡å‹æµ‹è¯• ä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š\n1 python tools/test.py configs/pascal_voc/faster_rcnn_r50_fpn_1x_voc0712.py checkpoints/faster_rcnn_r50_fpn_1x_voc0712_20220320_192712-54bef0f3.pth --eval mAP è¿™é‡Œçš„checkpointsç›®å½•ä¸‹çš„æ¨¡å‹æ–‡ä»¶æ˜¯æˆ‘ä¸‹è½½mmdetectionè®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯ä»¥æ›¿æ¢æˆè‡ªå·±è®­ç»ƒå¥½çš„æ–‡ä»¶ï¼Œè¿›è¡Œæµ‹è¯•ã€‚\nFaster R-CNN é…ç½®æ–‡ä»¶è§£è¯» ä¸Šé¢è®­ç»ƒå’Œæµ‹è¯•ä½¿ç”¨çš„æ¨¡å‹é…ç½®æ–‡ä»¶éƒ½æ˜¯configs/pascal_voc/faster_rcnn_r50_fpn_1x_voc0712.pyï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 _base_ = [ \u0026#39;../_base_/models/faster_rcnn_r50_fpn.py\u0026#39;, \u0026#39;../_base_/datasets/voc0712.py\u0026#39;, \u0026#39;../_base_/default_runtime.py\u0026#39; ] model = dict(roi_head=dict(bbox_head=dict(num_classes=20))) # ä¿®æ”¹ç±»åˆ«ä¸ªæ•° # optimizer optimizer = dict(type=\u0026#39;SGD\u0026#39;, lr=0.01, momentum=0.9, weight_decay=0.0001) optimizer_config = dict(grad_clip=None) # ä¸è¿›è¡Œæ¢¯åº¦æˆªæ–­ # learning policy # actual epoch = 3 * 3 = 9 lr_config = dict(policy=\u0026#39;step\u0026#39;, step=[3]) # runtime settings runner = dict( type=\u0026#39;EpochBasedRunner\u0026#39;, max_epochs=4) # actual epoch = 4 * 3 = 12 å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œç»§æ‰¿è‡ªä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸‹é¢è§£è¯»configs/_base_/models/faster_rcnn_r50_fpn.pyæ¨¡å‹é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 # model settings model = dict( type=\u0026#39;FasterRCNN\u0026#39;, backbone=dict( type=\u0026#39;ResNet\u0026#39;, # éª¨æ¶ç½‘ç»œç±»å depth=50, # è¡¨ç¤ºä½¿ç”¨ ResNet50 num_stages=4, # ResNet ç³»åˆ—åŒ…æ‹¬ stem + 4ä¸ª stage è¾“å‡º # è¡¨ç¤ºæœ¬æ¨¡å—è¾“å‡ºçš„ç‰¹å¾å›¾ç´¢å¼•ï¼Œ(0, 1, 2, 3),è¡¨ç¤º4ä¸ª stage è¾“å‡ºéƒ½éœ€è¦ï¼Œ # å…¶ stride ä¸º (4,8,16,32)ï¼Œchannel ä¸º (256, 512, 1024, 2048) out_indices=(0, 1, 2, 3), frozen_stages=1, # è¡¨ç¤ºå›ºå®š stem åŠ ä¸Šç¬¬ä¸€ä¸ª stage çš„æƒé‡ï¼Œä¸è¿›è¡Œè®­ç»ƒ norm_cfg=dict(type=\u0026#39;BN\u0026#39;, requires_grad=True), # BN å±‚ norm_eval=True, # backbone æ‰€æœ‰çš„ BN å±‚çš„å‡å€¼å’Œæ–¹å·®éƒ½ç›´æ¥é‡‡ç”¨å…¨å±€é¢„è®­ç»ƒå€¼ï¼Œä¸è¿›è¡Œæ›´æ–° style=\u0026#39;pytorch\u0026#39;, # é»˜è®¤é‡‡ç”¨ pytorch æ¨¡å¼ init_cfg=dict(type=\u0026#39;Pretrained\u0026#39;, checkpoint=\u0026#39;torchvision://resnet50\u0026#39;)), neck=dict( type=\u0026#39;FPN\u0026#39;, in_channels=[256, 512, 1024, 2048], # ResNet æ¨¡å—è¾“å‡ºçš„4ä¸ªå°ºåº¦ç‰¹å¾å›¾é€šé“æ•° out_channels=256, # FPN è¾“å‡ºçš„æ¯ä¸ªå°ºåº¦è¾“å‡ºç‰¹å¾å›¾é€šé“ num_outs=5), # FPN è¾“å‡ºç‰¹å¾å›¾ä¸ªæ•°ï¼Œå°†æœ€é«˜å±‚ç‰¹å¾å›¾å†è¿›è¡Œä¸€ä¸ªpoolingæ“ä½œï¼Œäº§ç”Ÿæ›´é«˜å±‚ç‰¹å¾å›¾ rpn_head=dict( type=\u0026#39;RPNHead\u0026#39;, in_channels=256, # FPN å±‚è¾“å‡ºç‰¹å¾å›¾é€šé“æ•° feat_channels=256, # ä¸­é—´ç‰¹å¾å›¾é€šé“æ•° anchor_generator=dict( type=\u0026#39;AnchorGenerator\u0026#39;, # ç›¸å½“äº octave_base_scaleï¼Œè¡¨ç¤ºæ¯ä¸ªç‰¹å¾å›¾çš„ base scales ??? # FPN å·²ç»æœ‰å¤šå°ºåº¦æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œå°ºåº¦åªæœ‰ä¸€ä¸ª8x8 scales=[8], # ç„¶åé€šè¿‡æ§åˆ¶ä¸åŒçš„é•¿å®½æ¯”å»äº§ç”Ÿä¸åŒæ¯”åˆ—çš„æè®®æ¡† ratios=[0.5, 1.0, 2.0], # æ¯ä¸ªç‰¹å¾å›¾æœ‰ 3 ä¸ªé«˜å®½æ¯”ä¾‹ strides=[4, 8, 16, 32, 64]), # ç‰¹å¾å›¾å¯¹åº”çš„ strideï¼Œå¿…é¡»å’Œç‰¹å¾å›¾ stride ä¸€è‡´ï¼Œä¸å¯ä»¥éšæ„æ›´æ”¹ ??? bbox_coder=dict( # å¸¸ç”¨ï¼ å¯¹è¾¹ç•Œæ¡†å›å½’çš„ç›®æ ‡å€¼è¿›è¡Œä¸€ä¸ªç¼–ç  type=\u0026#39;DeltaXYWHBBoxCoder\u0026#39;, target_means=[.0, .0, .0, .0], target_stds=[1.0, 1.0, 1.0, 1.0]), loss_cls=dict( type=\u0026#39;CrossEntropyLoss\u0026#39;, use_sigmoid=True, loss_weight=1.0), loss_bbox=dict(type=\u0026#39;L1Loss\u0026#39;, loss_weight=1.0)), roi_head=dict( # roi_headä¼šåŸºäºrpn_headäº§ç”Ÿçš„æè®®æ¡†ï¼Œä»¥åŠåŸå›¾çš„ç‰¹å¾å›¾è¿›è¡Œé¢„æµ‹ type=\u0026#39;StandardRoIHead\u0026#39;, bbox_roi_extractor=dict( # æŠŠæè®®æ¡†åŒºåŸŸå†…çš„ç‰¹å¾å›¾ä»å…¨å›¾ç‰¹å¾å›¾ä¸­è£å‰ªä¸‹æ¥ type=\u0026#39;SingleRoIExtractor\u0026#39;, roi_layer=dict(type=\u0026#39;RoIAlign\u0026#39;, output_size=7, sampling_ratio=0), out_channels=256, featmap_strides=[4, 8, 16, 32]), bbox_head=dict( # ä½¿ç”¨ä¸Šé¢è£å‰ªä¸‹æ¥çš„ç‰¹å¾é€å…¥ type=\u0026#39;Shared2FCBBoxHead\u0026#39;, # 2 ä¸ªå…±äº« FC æ¨¡å— in_channels=256, # è¾“å…¥é€šé“æ•°ï¼Œç›¸ç­‰äº FPN è¾“å‡ºé€šé“ fc_out_channels=1024, # ä¸­é—´ FC å±‚èŠ‚ç‚¹ä¸ªæ•° roi_feat_size=7, # RoIAlign æˆ– RoIPool è¾“å‡ºçš„ç‰¹å¾å›¾å¤§å° num_classes=80, # ç±»åˆ«ä¸ªæ•° bbox_coder=dict( # bbox ç¼–è§£ç ç­–ç•¥ï¼Ÿï¼Ÿï¼Ÿï¼Œé™¤äº†å‚æ•°å¤–å’Œ RPN ç›¸åŒ type=\u0026#39;DeltaXYWHBBoxCoder\u0026#39;, target_means=[0., 0., 0., 0.], target_stds=[0.1, 0.1, 0.2, 0.2]), # å½±å“ bbox åˆ†æ”¯çš„é€šé“æ•°ï¼ŒTrue è¡¨ç¤º 4 é€šé“è¾“å‡ºï¼ŒFalse è¡¨ç¤º 4Ã—num_classes é€šé“è¾“å‡º reg_class_agnostic=False, loss_cls=dict( # 80ç±»åˆ†ç±»é—®é¢˜ï¼Œæ²¡æœ‰ä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•° type=\u0026#39;CrossEntropyLoss\u0026#39;, use_sigmoid=False, loss_weight=1.0), loss_bbox=dict(type=\u0026#39;L1Loss\u0026#39;, loss_weight=1.0))), # model training and testing settings train_cfg=dict( rpn=dict( assigner=dict( type=\u0026#39;MaxIoUAssigner\u0026#39;, # æœ€å¤§ IoU åŸåˆ™åˆ†é…å™¨ pos_iou_thr=0.7, # æ­£æ ·æœ¬é˜ˆå€¼ neg_iou_thr=0.3, # è´Ÿæ ·æœ¬é˜ˆå€¼ min_pos_iou=0.3, # æ­£æ ·æœ¬é˜ˆå€¼ä¸‹é™ ??? match_low_quality=True, ignore_iof_thr=-1), # å¿½ç•¥ bboxes çš„é˜ˆå€¼ï¼Œ-1 è¡¨ç¤ºä¸å¿½ç•¥ sampler=dict( type=\u0026#39;RandomSampler\u0026#39;, # éšæœºé‡‡æ · num=256, # äº§ç”Ÿ1000ä¸ªæ¡†ï¼Œåªé‡‡æ ·256ä¸ªè¿›è¡Œè®­ç»ƒï¼Œé‡‡æ ·åæ¯å¼ å›¾ç‰‡çš„è®­ç»ƒæ ·æœ¬æ€»æ•°ï¼Œä¸åŒ…æ‹¬å¿½ç•¥æ ·æœ¬ pos_fraction=0.5, # æ­£æ ·æœ¬æ¯”ä¾‹ neg_pos_ub=-1, # æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹ï¼Œç”¨äºç¡®å®šè´Ÿæ ·æœ¬é‡‡æ ·ä¸ªæ•°ä¸Šç•Œ add_gt_as_proposals=False), # æ˜¯å¦åŠ å…¥ gt ä½œä¸º proposals ä»¥å¢åŠ é«˜è´¨é‡æ­£æ ·æœ¬æ•° allowed_border=-1, pos_weight=-1, debug=False), rpn_proposal=dict( nms_pre=2000, # nmsä¹‹å‰ max_per_img=1000, # nmsä¹‹å nms=dict(type=\u0026#39;nms\u0026#39;, iou_threshold=0.7), min_bbox_size=0), rcnn=dict( assigner=dict( type=\u0026#39;MaxIoUAssigner\u0026#39;, pos_iou_thr=0.5, neg_iou_thr=0.5, min_pos_iou=0.5, match_low_quality=False, ignore_iof_thr=-1), sampler=dict( type=\u0026#39;RandomSampler\u0026#39;, num=512, pos_fraction=0.25, neg_pos_ub=-1, add_gt_as_proposals=True), pos_weight=-1, debug=False)), test_cfg=dict( rpn=dict( nms_pre=1000, max_per_img=1000, nms=dict(type=\u0026#39;nms\u0026#39;, iou_threshold=0.7), min_bbox_size=0), rcnn=dict( score_thr=0.05, nms=dict(type=\u0026#39;nms\u0026#39;, iou_threshold=0.5), max_per_img=100) # soft-nms is also supported for rcnn testing # e.g., nms=dict(type=\u0026#39;soft_nms\u0026#39;, iou_threshold=0.5, min_score=0.05) )) ä¸‹é¢å¯¹configs/_base_/datasets/voc0712.pyæ•°æ®é›†é…ç½®æ–‡ä»¶è¿›è¡Œè§£è¯»ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 _base_ = [ \u0026#39;../_base_/models/faster_rcnn_r50_fpn.py\u0026#39;, \u0026#39;../_base_/datasets/voc0712.py\u0026#39;, \u0026#39;../_base_/default_runtime.py\u0026#39; ] model = dict(roi_head=dict(bbox_head=dict(num_classes=20))) # ä¿®æ”¹ç±»åˆ«ä¸ªæ•° data = dict( samples_per_gpu=8, # ä¿®æ”¹GPUçš„batch_sizeï¼Œæ³¨æ„ä¸èƒ½è®©å…¶è¶…è¿‡æ˜¾å­˜ workers_per_gpu=8, # ä¿®æ”¹GPUçš„workers ) # optimizer optimizer = dict(type=\u0026#39;SGD\u0026#39;, lr=0.01, momentum=0.9, weight_decay=0.0001) optimizer_config = dict(grad_clip=None) # ä¸è¿›è¡Œæ¢¯åº¦æˆªæ–­ # learning policy # æœ‰è¯¯ actual epoch = 3 * 3 = 9 lr_config = dict(policy=\u0026#39;step\u0026#39;, step=[8, 11]) # runtime settings runner = dict( type=\u0026#39;EpochBasedRunner\u0026#39;, max_epochs=12) # æœ‰è¯¯ actual epoch = 4 * 3 = 12 ç¬”è€…åœ¨æºç åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¿®æ”¹ï¼Œå°†samples_per_gpuä¿®æ”¹ä¸º8ï¼Œworkers_per_gpuä¿®æ”¹ä¸º8ï¼Œlr_configä¿®æ”¹ä¸ºdict(policy='step', step=[8, 11])ï¼Œrunnerä¿®æ”¹ä¸ºdict(type='EpochBasedRunner', max_epochs=12)ï¼Œæ³¨æ„å®é™…è®­ç»ƒæ—¶å€™batch_sizeä¸ºsamples_per_gpu x gpusï¼Œæˆ‘è¿™é‡Œè®­ç»ƒæ—¶å€™åªç”¨äº†ä¸€ä¸ªGPUï¼Œæ‰€ä»¥batch_sizeä¸º 8ã€‚\nè®­ç»ƒä»£ç è§£è¯» é¦–å…ˆä»toolsé‡Œé¢çš„train.pyå…¥æ‰‹ï¼Œå®˜æ–¹æºç æ–‡ä»¶train.pyã€‚\nè¯¥pythonæ–‡ä»¶ä¸­mainå‡½æ•°å…¶å®å°±åšäº†å››ä»¶äº‹ï¼Œè¿™ä¹Ÿæ˜¯è®­ç»ƒç¥ç»ç½‘ç»œé€šç”¨çš„æ­¥éª¤ï¼š\nè®¾å®šå’Œè¯»å–å„ç§é…ç½®ï¼› åˆ›å»ºæ¨¡å‹ï¼› åˆ›å»ºæ•°æ®é›†ï¼› å°†æ¨¡å‹ï¼Œæ•°æ®é›†å’Œé…ç½®ä¼ è¿›è®­ç»ƒå‡½æ•°ï¼Œè¿›è¡Œè®­ç»ƒï¼› ä¸‹é¢æˆªå–tools/train.pyä¸­mainå‡½æ•°çš„ä»£ç ç‰‡æ®µè¿›è¡Œè§£è¯»ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 def main(): # ç¬¬ä¸€ä»¶äº‹ args = parse_args() cfg = Config.fromfile(args.config) ... # çœç•¥éƒ¨åˆ†ä»£ç ï¼Œè¯¥éƒ¨åˆ†ä»£ç å¯¹è®­ç»ƒæ—¶ä¸Šä¸‹æ–‡è¿›è¡Œè®¾ç½®å’Œæ ¡éªŒ # ç¬¬äºŒä»¶äº‹ã€€åˆ›å»ºæ¨¡å‹ # ç¬¬ä¸€ä¸ªå‚æ•°cfg.model # æ¨¡å‹é…ç½®é‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ªç§ç±»typeï¼ŒåŒ…æ‹¬ç»å…¸çš„ç®—æ³•å¦‚Faster RCNN, MaskRCNNç­‰ # å…¶æ¬¡ï¼Œè¿˜åŒ…å«å‡ ä¸ªéƒ¨åˆ†ï¼Œå¦‚backbone, neck, head # backboneæœ‰æ·±åº¦ï¼Œstageç­‰ä¿¡æ¯ï¼Œå¦‚resnet50å¯¹åº”ç€3,4,6,3å››ä¸ªé‡å¤stages # neckä¸€èˆ¬FPN(feature pyramid network)ï¼Œéœ€è¦æŒ‡å®šnum_outså‡ ä¸ªè¾“å‡ºä¹‹ç±»çš„ä¿¡æ¯ï¼ˆä¹‹åä¼šçœ‹åˆ°ï¼‰ # head å°±æ˜¯å…·ä½“åˆ°ä¸Šå±‚rpn_head,ã€€shared_headï¼Œã€€bbox_headä¹‹ç±»çš„ model = build_detector( cfg.model, train_cfg=cfg.train_cfg, test_cfg=cfg.test_cfg) model.init_weights() # åˆå§‹åŒ–æ¨¡å‹å‚æ•° # ç¬¬ä¸‰ä»¶äº‹ datasets = [build_dataset(cfg.data.train)] if len(cfg.workflow) == 2: #æ˜¯å¦æ·»åŠ éªŒè¯é›† val_dataset = copy.deepcopy(cfg.data.val) val_dataset.pipeline = cfg.data.train.pipeline datasets.append(build_dataset(val_dataset)) if cfg.checkpoint_config is not None: # save mmdet version, config file content and class names in # checkpoints as meta data cfg.checkpoint_config.meta = dict( mmdet_version=__version__ + get_git_hash()[:7], CLASSES=datasets[0].CLASSES) # add an attribute for visualization convenience model.CLASSES = datasets[0].CLASSES # ç¬¬å››ä»¶äº‹ train_detector( model, datasets, cfg, distributed=distributed, validate=args.validate, logger=logger) è®©æˆ‘ä»¬ç»§ç»­é˜…è¯»build_detectorå‡½æ•°çš„ä»£ç ç‰‡æ®µï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼Œè¯¥ä»£ç åœ¨mmdect/models/builder.pyä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # Copyright (c) OpenMMLab. All rights reserved. import warnings from mmcv.cnn import MODELS as MMCV_MODELS # mmdetä¸­MODELSç»§æ‰¿è‡ªè¯¥MMCV_MODELS from mmcv.utils import Registry MODELS = Registry(\u0026#39;models\u0026#39;, parent=MMCV_MODELS) BACKBONES = MODELS NECKS = MODELS ROI_EXTRACTORS = MODELS SHARED_HEADS = MODELS HEADS = MODELS LOSSES = MODELS DETECTORS = MODELS ... # çœç•¥éƒ¨åˆ†ä»£ç  def build_detector(cfg, train_cfg=None, test_cfg=None): \u0026#34;\u0026#34;\u0026#34;Build detector.\u0026#34;\u0026#34;\u0026#34; if train_cfg is not None or test_cfg is not None: warnings.warn( \u0026#39;train_cfg and test_cfg is deprecated, \u0026#39; \u0026#39;please specify them in model\u0026#39;, UserWarning) assert cfg.get(\u0026#39;train_cfg\u0026#39;) is None or train_cfg is None, \\ \u0026#39;train_cfg specified in both outer field and model field \u0026#39; assert cfg.get(\u0026#39;test_cfg\u0026#39;) is None or test_cfg is None, \\ \u0026#39;test_cfg specified in both outer field and model field \u0026#39; return DETECTORS.build( cfg, default_args=dict(train_cfg=train_cfg, test_cfg=test_cfg)) è¿™é‡Œé‡‡ç”¨äº†Registryæ–¹å¼ï¼Œå³åœ¨mmdet/models/builder.pyä¸­å®ä¾‹åŒ–äº†ä¸€ä¸ªRegistryå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„çˆ¶ç±»æ˜¯MMCV_MODELSï¼Œè¯¥ç±»æ˜¯mmcvä¸­çš„ä¸€ä¸ªç±»ï¼Œå…¶ä½œç”¨æ˜¯ç”¨æ¥ç®¡ç†å¤šä¸ªæ¨¡å‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªbuildå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯æ ¹æ®æ¨¡å‹çš„é…ç½®ä¿¡æ¯ï¼Œåˆ›å»ºæ¨¡å‹ï¼Œå¹¶è¿”å›æ¨¡å‹å¯¹è±¡ã€‚\nä¸‹é¢ä»£ç æ¥è‡ªmmcvï¼Œç‰ˆæœ¬ä¸º1.5.2ã€‚\nä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œmmdetä¸­åˆ›å»ºæ¨¡å‹çš„å‡½æ•°build_model_from_cfgç»§æ‰¿è‡ªmmcv/cnn/builder.pyä¸­çš„build_model_from_cfgå‡½æ•°ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # Copyright (c) OpenMMLab. All rights reserved. from ..runner import Sequential from ..utils import Registry, build_from_cfg def build_model_from_cfg(cfg, registry, default_args=None): \u0026#34;\u0026#34;\u0026#34;Build a PyTorch model from config dict(s). Different from ``build_from_cfg``, if cfg is a list, a ``nn.Sequential`` will be built. Args: cfg (dict, list[dict]): The config of modules, is is either a config dict or a list of config dicts. If cfg is a list, a the built modules will be wrapped with ``nn.Sequential``. registry (:obj:`Registry`): A registry the module belongs to. default_args (dict, optional): Default arguments to build the module. Defaults to None. Returns: nn.Module: A built nn module. \u0026#34;\u0026#34;\u0026#34; if isinstance(cfg, list): modules = [ build_from_cfg(cfg_, registry, default_args) for cfg_ in cfg ] return Sequential(*modules) else: return build_from_cfg(cfg, registry, default_args) MODELS = Registry(\u0026#39;model\u0026#39;, build_func=build_model_from_cfg) ä¸‹é¢æˆ‘ä»¬åœ¨mmcv/utils/registry.pyä¸­æŸ¥çœ‹build_from_cfgä»£ç ï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 def build_from_cfg(cfg, registry, default_args=None): \u0026#34;\u0026#34;\u0026#34;Build a module from config dict when it is a class configuration, or call a function from config dict when it is a function configuration. Example: \u0026gt;\u0026gt;\u0026gt; MODELS = Registry(\u0026#39;models\u0026#39;) \u0026gt;\u0026gt;\u0026gt; @MODELS.register_module() \u0026gt;\u0026gt;\u0026gt; class ResNet: \u0026gt;\u0026gt;\u0026gt; pass \u0026gt;\u0026gt;\u0026gt; resnet = build_from_cfg(dict(type=\u0026#39;Resnet\u0026#39;), MODELS) \u0026gt;\u0026gt;\u0026gt; # Returns an instantiated object \u0026gt;\u0026gt;\u0026gt; @MODELS.register_module() \u0026gt;\u0026gt;\u0026gt; def resnet50(): \u0026gt;\u0026gt;\u0026gt; pass \u0026gt;\u0026gt;\u0026gt; resnet = build_from_cfg(dict(type=\u0026#39;resnet50\u0026#39;), MODELS) \u0026gt;\u0026gt;\u0026gt; # Return a result of the calling function Args: cfg (dict): Config dict. It should at least contain the key \u0026#34;type\u0026#34;. registry (:obj:`Registry`): The registry to search the type from. default_args (dict, optional): Default initialization arguments. Returns: object: The constructed object. \u0026#34;\u0026#34;\u0026#34; if not isinstance(cfg, dict): raise TypeError(f\u0026#39;cfg must be a dict, but got {type(cfg)}\u0026#39;) if \u0026#39;type\u0026#39; not in cfg: # typeå¿…é¡»åœ¨é…ç½®æ–‡ä»¶é‡Œ if default_args is None or \u0026#39;type\u0026#39; not in default_args: raise KeyError( \u0026#39;`cfg` or `default_args` must contain the key \u0026#34;type\u0026#34;, \u0026#39; f\u0026#39;but got {cfg}\\n{default_args}\u0026#39;) if not isinstance(registry, Registry): raise TypeError(\u0026#39;registry must be an mmcv.Registry object, \u0026#39; f\u0026#39;but got {type(registry)}\u0026#39;) if not (isinstance(default_args, dict) or default_args is None): raise TypeError(\u0026#39;default_args must be a dict or None, \u0026#39; f\u0026#39;but got {type(default_args)}\u0026#39;) args = cfg.copy() if default_args is not None: for name, value in default_args.items(): args.setdefault(name, value) obj_type = args.pop(\u0026#39;type\u0026#39;) # å–å‡ºtypeçš„å€¼ if isinstance(obj_type, str): obj_cls = registry.get(obj_type) #ã€€ä»æ³¨å†Œå™¨é‡Œé¢å–å‡ºtypeï¼Œæ³¨å†Œè¿‡æ‰èƒ½ç”¨ if obj_cls is None: raise KeyError( f\u0026#39;{obj_type} is not in the {registry.name} registry\u0026#39;) elif inspect.isclass(obj_type) or inspect.isfunction(obj_type): obj_cls = obj_type else: raise TypeError( f\u0026#39;type must be a str or valid type, but got {type(obj_type)}\u0026#39;) try: # æ ¹æ®é…ç½®å‚æ•°å®ä¾‹åŒ–æ¨¡å‹ï¼Œå°±æ˜¯typeå®šä¹‰çš„é‚£ä¸ªç±»ï¼ˆFasterRCNNï¼‰çš„å®ä¾‹åŒ–ï¼Œè¿”å›äº†è¿™ä¸ªç±»çš„å¯¹è±¡ã€‚ # åé¢ä¼šå†åˆ†æå…·ä½“æ¨¡å‹ç±»ï¼ˆFasterRCNNï¼‰çš„å®šä¹‰ã€‚ return obj_cls(**args) except Exception as e: # Normal TypeError does not print class name. raise type(e)(f\u0026#39;{obj_cls.__name__}: {e}\u0026#39;) mmcvæºç æŸ¥çœ‹ï¼Œåˆ°æ­¤ä¸ºæ­¢ã€‚\næœ¬ç¯‡åšå®¢åˆ†æFaster R-CNNï¼Œè¯¥ç®—æ³•åœ¨mmdetä¸­æ¨¡å‹æ³¨å†Œtypeä¸ºFasterRCNNï¼Œæˆ‘ä»¬æ‰¾åˆ°è¯¥ç±»çš„å®ç°ï¼Œä½ç½®ä¸ºmmdet/models/detectors/faster_rcnn.pyï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @DETECTORS.register_module() class FasterRCNN(TwoStageDetector): \u0026#34;\u0026#34;\u0026#34;Implementation of `Faster R-CNN \u0026lt;https://arxiv.org/abs/1506.01497\u0026gt;`_\u0026#34;\u0026#34;\u0026#34; def __init__(self, backbone, rpn_head, roi_head, train_cfg, test_cfg, neck=None, pretrained=None, init_cfg=None): super(FasterRCNN, self).__init__( backbone=backbone, neck=neck, rpn_head=rpn_head, roi_head=roi_head, train_cfg=train_cfg, test_cfg=test_cfg, pretrained=pretrained, init_cfg=init_cfg) é‚£ä¹ˆæ ¸å¿ƒåŠŸèƒ½è‚¯å®šéƒ½åœ¨TwoStageDetectoré‡Œäº†ã€‚çœ‹ä»£ç ä¹‹å‰é¦–å…ˆå›é¡¾ä¸€ä¸‹ä¸€ä¸ªç»å…¸çš„åŒé˜¶æ®µæ£€æµ‹Faster R-CNNçš„æµç¨‹ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‹/mmdet/models/detectors/two_stage.pyæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 @DETECTORS.register_module() class TwoStageDetector(BaseDetector): \u0026#34;\u0026#34;\u0026#34;Base class for two-stage detectors. Two-stage detectors typically consisting of a region proposal network and a task-specific regression head. \u0026#34;\u0026#34;\u0026#34; def __init__(self, backbone, neck=None, rpn_head=None, roi_head=None, train_cfg=None, test_cfg=None, pretrained=None, init_cfg=None): super(TwoStageDetector, self).__init__(init_cfg) if pretrained: warnings.warn(\u0026#39;DeprecationWarning: pretrained is deprecated, \u0026#39; \u0026#39;please use \u0026#34;init_cfg\u0026#34; instead\u0026#39;) backbone.pretrained = pretrained self.backbone = build_backbone(backbone) if neck is not None: self.neck = build_neck(neck) if rpn_head is not None: rpn_train_cfg = train_cfg.rpn if train_cfg is not None else None rpn_head_ = rpn_head.copy() rpn_head_.update(train_cfg=rpn_train_cfg, test_cfg=test_cfg.rpn) self.rpn_head = build_head(rpn_head_) if roi_head is not None: # update train and test cfg here for now # TODO: refactor assigner \u0026amp; sampler rcnn_train_cfg = train_cfg.rcnn if train_cfg is not None else None roi_head.update(train_cfg=rcnn_train_cfg) roi_head.update(test_cfg=test_cfg.rcnn) roi_head.pretrained = pretrained self.roi_head = build_head(roi_head) self.train_cfg = train_cfg self.test_cfg = test_cfg @property def with_rpn(self): \u0026#34;\u0026#34;\u0026#34;bool: whether the detector has RPN\u0026#34;\u0026#34;\u0026#34; return hasattr(self, \u0026#39;rpn_head\u0026#39;) and self.rpn_head is not None @property def with_roi_head(self): \u0026#34;\u0026#34;\u0026#34;bool: whether the detector has a RoI head\u0026#34;\u0026#34;\u0026#34; return hasattr(self, \u0026#39;roi_head\u0026#39;) and self.roi_head is not None def extract_feat(self, img): \u0026#34;\u0026#34;\u0026#34;Directly extract features from the backbone+neck.\u0026#34;\u0026#34;\u0026#34; x = self.backbone(img) if self.with_neck: x = self.neck(x) return x def forward_dummy(self, img): \u0026#34;\u0026#34;\u0026#34;Used for computing network flops. See `mmdetection/tools/analysis_tools/get_flops.py` \u0026#34;\u0026#34;\u0026#34; outs = () # backbone x = self.extract_feat(img) # rpn if self.with_rpn: rpn_outs = self.rpn_head(x) outs = outs + (rpn_outs, ) proposals = torch.randn(1000, 4).to(img.device) # roi_head roi_outs = self.roi_head.forward_dummy(x, proposals) outs = outs + (roi_outs, ) return outs def forward_train(self, img, img_metas, gt_bboxes, gt_labels, gt_bboxes_ignore=None, gt_masks=None, proposals=None, **kwargs): \u0026#34;\u0026#34;\u0026#34; Args: img (Tensor): of shape (N, C, H, W) encoding input images. Typically these should be mean centered and std scaled. img_metas (list[dict]): list of image info dict where each dict has: \u0026#39;img_shape\u0026#39;, \u0026#39;scale_factor\u0026#39;, \u0026#39;flip\u0026#39;, and may also contain \u0026#39;filename\u0026#39;, \u0026#39;ori_shape\u0026#39;, \u0026#39;pad_shape\u0026#39;, and \u0026#39;img_norm_cfg\u0026#39;. For details on the values of these keys see `mmdet/datasets/pipelines/formatting.py:Collect`. gt_bboxes (list[Tensor]): Ground truth bboxes for each image with shape (num_gts, 4) in [tl_x, tl_y, br_x, br_y] format. gt_labels (list[Tensor]): class indices corresponding to each box gt_bboxes_ignore (None | list[Tensor]): specify which bounding boxes can be ignored when computing the loss. gt_masks (None | Tensor) : true segmentation masks for each box used if the architecture supports a segmentation task. proposals : override rpn proposals with custom proposals. Use when `with_rpn` is False. Returns: dict[str, Tensor]: a dictionary of loss components \u0026#34;\u0026#34;\u0026#34; x = self.extract_feat(img) losses = dict() # RPN forward and loss if self.with_rpn: proposal_cfg = self.train_cfg.get(\u0026#39;rpn_proposal\u0026#39;, self.test_cfg.rpn) rpn_losses, proposal_list = self.rpn_head.forward_train( x, img_metas, gt_bboxes, gt_labels=None, gt_bboxes_ignore=gt_bboxes_ignore, proposal_cfg=proposal_cfg, **kwargs) losses.update(rpn_losses) else: proposal_list = proposals roi_losses = self.roi_head.forward_train(x, img_metas, proposal_list, gt_bboxes, gt_labels, gt_bboxes_ignore, gt_masks, **kwargs) losses.update(roi_losses) return losses ... # çœç•¥éƒ¨åˆ†ä»£ç  å…³äºä¸Šé¢ä»£ç ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªç¤ºæ„å›¾ï¼Œå¯ä»¥æ–¹ä¾¿ç†è§£ä¸¤é˜¶æ®µæ£€æµ‹çš„æ¶æ„ã€‚ å¯ä»¥çœ‹åˆ° TwoStageDetector ç±»çš„ forward_train å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œæœ€éš¾çš„éƒ¨åˆ†ä¸ºä¸¤ä¸ª head ï¼Œåˆ†åˆ«ä¸º RPNHead å’Œ StandardRoIHeadï¼Œä¸‹é¢å…ˆåˆ†æ RPNHeadã€‚\nè¯¥ä»£ç ä½äºmmdet/models/dense_heads/rpn_head.pyã€‚\nå‚è€ƒæ–‡ç«  å…¥é—¨mmdetectionï¼ˆå£¹ï¼‰\n","date":"2022-06-18T17:14:15+08:00","permalink":"https://qiyueliuhuo.github.io/posts/%E5%9F%BA%E4%BA%8Emmdetection%E6%BA%90%E7%A0%81faster-r-cnn%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB/","title":"åŸºäºmmdetectionæºç :Faster R-CNNç®—æ³•è§£è¯»"},{"content":"åšå®¢è¿ç§»åˆ°hugoï¼Œè¿™æ˜¯ç¬¬ä¸€ç¯‡æµ‹è¯•æ–‡ç« ã€‚\nhugoå¸¸ç”¨å‘½ä»¤\n1 2 hugo new --kind post-bundle posts/æµ‹è¯•æ–‡ç«  # åˆ›å»ºä¸€ä¸ªæ–‡ç« ç›®å½• hugo server -D # å¯åŠ¨æœåŠ¡å™¨ï¼Œæ˜¾ç¤ºè‰ç¨¿æ–‡ç«  ","date":"2022-06-03T17:22:13+08:00","permalink":"https://qiyueliuhuo.github.io/posts/my-first-hugo-post/","title":"My First Hugo Post"},{"content":" äººç”Ÿäº¦æœ‰å‘½ï¼Œå®‰èƒ½è¡Œå¹å¤åæ„ï¼Ÿ â€”â€” æ‹Ÿè¡Œè·¯éš¾Â·å…¶å››\nç›®å‰åªåšå­—èŠ‚è·³åŠ¨ã€è…¾è®¯çš„ç®—æ³•å’Œåç«¯çš„é«˜é¢‘leetcodeç®—æ³•é¢˜ã€‚åˆ·é¢˜ä¹‹å‰å…ˆå¤ä¹ ç»å…¸çš„ä¸€äº›ç®—æ³•ï¼Œæœ‰ç›¸å½“å¤šç®—æ³•æ˜¯ç»å…¸ç®—æ³•çš„ä¿®æ”¹ç‰ˆã€‚\næ±‡æ€»åœ°å€ï¼š\né«˜é¢‘leetcodeé¢˜ğŸ”¥\næ•°æ®ç»“æ„ä¸ç®—æ³•ğŸ”¥\nç¬¦å·å®šä¹‰åŠå«ä¹‰ å½“è¾“å…¥è§„æ¨¡è¶³å¤Ÿå¤§ï¼Œä½¿å¾—è¿è¡Œæ—¶é—´åªä¸å¢é•¿é‡çº§æœ‰å…³æ—¶ï¼Œéœ€è¦ç ”ç©¶ç®—æ³•çš„æ¸è¿‘æ•ˆç‡ã€‚ä¹Ÿå°±æ˜¯ï¼Œå½“è¾“å…¥è§„æ¨¡æ— é™å¢åŠ æ—¶ï¼Œåœ¨æé™ä¸­ï¼Œç®—æ³•çš„è¿è¡Œæ—¶é—´å¦‚ä½•éšç€è¾“å…¥è§„æ¨¡çš„å˜å¤§è€Œå¢åŠ ã€‚è¿™é‡Œä»…å¼•å…¥ä¸¤ä¸ªå¸¸ç”¨çš„æ¸è¿›è®°å·ã€‚\n$\\Theta$ (è¥¿å¡”) æ¸è¿‘ç´§ç¡®ç•Œï¼Œå¦‚$\\frac{1}{2} n^{2}-3 n=\\Theta\\left(n^{2}\\right)$ï¼Œ$6n^{3} \\neq \\Theta (n^{2})$ï¼Œ$n \\neq \\Theta (n^{2})$ã€‚ $O$ï¼ˆå¤§oï¼‰æ¸è¿›ä¸Šç•Œï¼Œå¦‚$\\frac{1}{2} n^{2}-3 n=O\\left(n^{2}\\right)$ï¼Œ$6n^{3} \\neq O(n^{2})$ï¼Œ$n = O (n^{2})$ã€‚ æ¸è¿›è®°å·ä»£è¡¨çš„æ˜¯é›†åˆï¼Œè¿™é‡Œçš„$=$æ›´å¤šåœ°ä»£è¡¨$\\in$ã€‚ ç®—æ³•å¤æ‚åº¦åˆ†ä¸ºæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ã€‚æ—¶é—´å¤æ‚åº¦è¡¡é‡äº†æ‰§è¡Œç®—æ³•æ‰€éœ€è¦çš„è®¡ç®—å·¥ä½œé‡ï¼›è€Œç©ºé—´å¤æ‚åº¦æ˜¯æŒ‡æ‰§è¡Œè¿™ä¸ªç®—æ³•æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ã€‚ åœ¨ç›¸å½“å¤šæ–‡çŒ®èµ„æ–™ä¸­ï¼Œæœ‰æ—¶æˆ‘ä»¬å‘ç°$O$è®°å·éå½¢å¼åŒ–åœ°æè¿°æ¸è¿›ç¡®ç•Œï¼Œå³å·²ç»ä½¿ç”¨$\\Theta$è®°å·å®šä¹‰çš„ä¸œè¥¿ã€‚ ç»å…¸ç®—æ³• ç»å…¸æ’åºç®—æ³• å¿«é€Ÿæ’åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def Quick_Sort(L, start, end): if start \u0026lt; end: i, j = start, end base = L[i] while i \u0026lt; j: while(i \u0026lt; j) and (L[j] \u0026gt;= base): j -= 1 L[i] = L[j] while(i \u0026lt; j) and (L[i] \u0026lt;= base): i += 1 L[j] = L[i] L[i] = base Quick_Sort(L, start, i - 1) Quick_Sort(L, j + 1, end) return L ä¾‹é¢˜1ï¼š æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ï¼ˆåŠ›æ‰£215ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡6ï¼‰ ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚\nè¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚å¦‚ï¼Œè¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2ï¼Œè¾“å‡º: 5\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class Solution: def findKthLargest(self, nums: List[int], k: int) -\u0026gt; int: if len(nums) == 1: return nums[0] left = 0 right = len(nums) - 1 # è¿˜æ˜¯é»˜è®¤ä»å°åˆ°å¤§æ’åˆ—å§ while left \u0026lt;= right: # å¿…é¡»è¦ç­‰å·!! base = nums[left] i = left j = right while i \u0026lt; j: while i \u0026lt; j and nums[j] \u0026gt;= base: j -= 1 nums[i] = nums[j] while i \u0026lt; j and nums[i] \u0026lt;= base: i += 1 nums[j] = nums[i] nums[i] = base if k == len(nums) - i: return nums[i] elif k \u0026gt; len(nums) - i: # k = k - (len(nums) - i) ä¸è¦è¿™è¡Œ! ä¸ç”¨æ”¹å˜k right = i - 1 else: # kä¸å˜ left = i + 1 å‚è€ƒï¼šå¿«é€Ÿæ’åº-Python å®ç°\nå½’å¹¶æ’åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 def mergesort(L): \u0026#34;\u0026#34;\u0026#34;å½’å¹¶æ’åº\u0026#34;\u0026#34;\u0026#34; if len(L) \u0026lt;= 1: return L mid = len(L) // 2 # å°†åˆ—è¡¨åˆ†æˆæ›´å°çš„ä¸¤ä¸ªåˆ—è¡¨ # åˆ†åˆ«å¯¹å·¦å³ä¸¤ä¸ªåˆ—è¡¨è¿›è¡Œå¤„ç†ï¼Œåˆ†åˆ«è¿”å›ä¸¤ä¸ªæ’åºå¥½çš„åˆ—è¡¨ left_L = mergesort(L[:mid]) right_L = mergesort(L[mid:]) # å¯¹æ’åºå¥½çš„ä¸¤ä¸ªåˆ—è¡¨åˆå¹¶ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„æ’åºå¥½çš„åˆ—è¡¨ return merge(left_L, right_L) def merge(left_L, right_L): \u0026#34;\u0026#34;\u0026#34;åˆå¹¶ä¸¤ä¸ªå·²æ’åºå¥½çš„åˆ—è¡¨ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„å·²æ’åºå¥½çš„åˆ—è¡¨\u0026#34;\u0026#34;\u0026#34; result = [] # æ–°çš„å·²æ’åºå¥½çš„åˆ—è¡¨ i = 0 # ä¸‹æ ‡ j = 0 # å¯¹ä¸¤ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´  ä¸¤ä¸¤å¯¹æ¯”ã€‚ # å°†æœ€å°çš„å…ƒç´ ï¼Œæ”¾åˆ°resultä¸­ï¼Œå¹¶å¯¹å½“å‰åˆ—è¡¨ä¸‹æ ‡åŠ 1 while i \u0026lt; len(left_L) and j \u0026lt; len(right_L): if left_L[i] \u0026lt;= right_L[j]: result.append(left_L[i]) i += 1 else: result.append(right_L[j]) j += 1 result += left_L[i:] result += right_L[j:] return result ä¾‹é¢˜1ï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ ï¼ˆåŠ›æ‰£88ï¼‰ pythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 class Solution: def merge(self, nums1: List[int], m: int, nums2: List[int], n: int) -\u0026gt; None: \u0026#34;\u0026#34;\u0026#34; Do not return anything, modify nums1 in-place instead. \u0026#34;\u0026#34;\u0026#34; # å°†nums1åç§»nä¸ªä½ç½® for i in range(m - 1, -1, -1): nums1[i + n] = nums1[i] idx = 0 p = n q = 0 while p \u0026lt; m + n and q \u0026lt; n: if nums1[p] \u0026lt; nums2[q]: nums1[idx] = nums1[p] idx += 1 p += 1 else: nums1[idx] = nums2[q] idx += 1 q += 1 while p \u0026lt; m + n: nums1[idx] = nums1[p] idx += 1 p += 1 while q \u0026lt; n: nums1[idx] = nums2[q] idx += 1 q += 1 return æ•°ç»„ äºŒåˆ†æŸ¥æ‰¾ ä¾‹é¢˜1ï¼šçˆ±åƒé¦™è•‰çš„ç‚ç‚ï¼ˆåŠ›æ‰£875ï¼‰ ç‚ç‚å–œæ¬¢åƒé¦™è•‰ã€‚è¿™é‡Œæœ‰ N å †é¦™è•‰ï¼Œç¬¬ i å †ä¸­æœ‰ piles[i] æ ¹é¦™è•‰ã€‚è­¦å«å·²ç»ç¦»å¼€äº†ï¼Œå°†åœ¨ H å°æ—¶åå›æ¥ã€‚\nç‚ç‚å¯ä»¥å†³å®šå¥¹åƒé¦™è•‰çš„é€Ÿåº¦ Kï¼ˆå•ä½ï¼šæ ¹/å°æ—¶ï¼‰ã€‚æ¯ä¸ªå°æ—¶ï¼Œå¥¹å°†ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œä»ä¸­åƒæ‰ K æ ¹ã€‚å¦‚æœè¿™å †é¦™è•‰å°‘äº K æ ¹ï¼Œå¥¹å°†åƒæ‰è¿™å †çš„æ‰€æœ‰é¦™è•‰ï¼Œç„¶åè¿™ä¸€å°æ—¶å†…ä¸ä¼šå†åƒæ›´å¤šçš„é¦™è•‰ã€‚\nç‚ç‚å–œæ¬¢æ…¢æ…¢åƒï¼Œä½†ä»ç„¶æƒ³åœ¨è­¦å«å›æ¥å‰åƒæ‰æ‰€æœ‰çš„é¦™è•‰ã€‚\nè¿”å›å¥¹å¯ä»¥åœ¨ H å°æ—¶å†…åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ Kï¼ˆK ä¸ºæ•´æ•°ï¼‰\nåˆ†æ æ­¤é¢˜è§„çº¦ä¸ºåœ¨æ•°ç»„ä¸­å¯»æ‰¾ä¸€ä¸ªåˆ†è§£çº¿ï¼Œå·¦å³è¾¹ç¬¦åˆä¸åŒçš„æ¡ä»¶ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 class Solution: def minEatingSpeed(self, piles: List[int], h: int) -\u0026gt; int: k_left = 1 k_right = max(piles) while k_left \u0026lt; k_right: mid = (k_left + k_right) // 2 if self.canFinish(piles, h, mid): k_right = mid else: k_left = mid + 1 # å¿…é¡»åŠ 1 return k_left def canFinish(self, piles: List[int], h: int, k: int): h_ = 0 for pile in piles: h_ += pile // k h_ += 1 if pile % k != 0 else 0 return h \u0026gt;= h_ ä¾‹é¢˜2ï¼š x çš„å¹³æ–¹æ ¹ ï¼ˆåŠ›æ‰£69ï¼‰ ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° x ï¼Œè®¡ç®—å¹¶è¿”å› x çš„ ç®—æœ¯å¹³æ–¹æ ¹ ã€‚\nç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™ æ•´æ•°éƒ¨åˆ† ï¼Œå°æ•°éƒ¨åˆ†å°†è¢« èˆå» ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 class Solution: def mySqrt(self, x: int) -\u0026gt; int: l, r, ans = 0, x, -1 while l \u0026lt;= r: mid = (l + r) // 2 if mid * mid \u0026lt;= x: ans = mid l = mid + 1 else: r = mid - 1 return ans é“¾è¡¨ é“¾è¡¨ç¿»è½¬ ä¾‹é¢˜1ï¼šK ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ï¼ˆåŠ›æ‰£25ï¼‰ï¼ˆå­—èŠ‚-åç«¯-é¢‘æ¬¡60ï¼‰ pythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 class Solution: def reverseKGroup(self, head: Optional[ListNode], k: int) -\u0026gt; Optional[ListNode]: if k == 1: return head # å¤šæŒ‡é’ˆæ³• h = None p = head q = head q_pre = None n = 0 pre_last = None while q != None: q_pre = q q = q.next n += 1 if n == k: n = 0 first, last = self.reverse(p, q_pre) if h == None: h = first pre_last = last else: pre_last.next = first pre_last = last if n == 0: pre_last.next = q p = q return h # ç¿»è½¬pèŠ‚ç‚¹å’ŒqèŠ‚ç‚¹ä¹‹é—´çš„é“¾è¡¨ def reverse(self, p: Optional[ListNode], q: Optional[ListNode]): first = q last = p r = p.next last.next = None pre_r = None q_next = q.next while r != q_next: pre_r = r r = r.next pre_r.next = p p = pre_r return first, last äºŒå‰æ ‘ äºŒå‰æ ‘æ·±åº¦ä¼˜å…ˆéå† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: # å…ˆåºéå† Accepted def preOrder(self, root: TreeNode) -\u0026gt; List[int]: stack = [root] res = [] while stack: node = stack.pop() if node: res.append(node.val) # è®¿é—® stack.append(node.right) # å…ˆå°†å³èŠ‚ç‚¹åŠ å…¥æ ˆä¸­ stack.append(node.left) return res # ä¸­åºéå† Accepted def inOrder(self, root: TreeNode) -\u0026gt; List[int]: stack = [] res = [] while root or stack: while root: stack.append(root) root = root.left node = stack.pop() res.append(node.val) # è®¿é—® root = node.right return res # ååºéå† Accepted def postOrder(self, root: TreeNode) -\u0026gt; List[int]: stack = [] res = [] preNode = None while root or stack: while root: stack.append(root) root = root.left root = stack.pop() if root.right == None or preNode == root.right: # å…³é”®ï¼Œå–å‡ºæ¥çœ‹çœ‹å³è¾¹èŠ‚ç‚¹å­˜åœ¨æˆ–è€…æ˜¯å¦ä¸Šæ¬¡éå†è¿‡ res.append(root.val) preNode = root root = None # é¿å…é‡å¤è®¿é—®å·¦å­æ ‘ï¼Œä¸èƒ½ä¸¢ else: stack.append(root) root = root.right return res ä¾‹é¢˜1ï¼šæ±‚æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æ•°å­—ä¹‹å’Œï¼ˆåŠ›æ‰£129ï¼‰ ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜æ”¾æœ‰ä¸€ä¸ª 0 åˆ° 9 ä¹‹é—´çš„æ•°å­—ã€‚ æ¯æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„éƒ½ä»£è¡¨ä¸€ä¸ªæ•°å­—ï¼š\nä¾‹å¦‚ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„ 1 -\u0026gt; 2 -\u0026gt; 3 è¡¨ç¤ºæ•°å­— 123 ã€‚ è®¡ç®—ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹ç”Ÿæˆçš„ æ‰€æœ‰æ•°å­—ä¹‹å’Œ ã€‚\nå¶èŠ‚ç‚¹ æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: def __init__(self): self.sum = 0 def sumNumbers(self, root: TreeNode) -\u0026gt; int: self.sum = 0 self.do_sumNumbers(root, 0) return self.sum def do_sumNumbers(self, root: TreeNode, current: int): if root == None: return if root.left == None and root.right == None: self.sum += current * 10 + root.val else: self.do_sumNumbers(root.left, current * 10 + root.val) self.do_sumNumbers(root.right, current * 10 + root.val) ä¾‹é¢˜2ï¼šäºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆåŠ›æ‰£236ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡6ï¼‰ ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # å®Œå…¨æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•å¹³é“ºç›´å™ class Solution: def __init__(self): self.res = None def lowestCommonAncestor(self, root: \u0026#39;TreeNode\u0026#39;, p: \u0026#39;TreeNode\u0026#39;, q: \u0026#39;TreeNode\u0026#39;) -\u0026gt; \u0026#39;TreeNode\u0026#39;: self.res = None self.dfs(root, p, q) return self.res def dfs(self, root: \u0026#39;TreeNode\u0026#39;, p: \u0026#39;TreeNode\u0026#39;, q: \u0026#39;TreeNode\u0026#39;) -\u0026gt; bool: if root is not None: left = self.dfs(root.left, p, q) right = self.dfs(root.right, p, q) node = True if root == p or root == q else False if (left is True and right is True) or \\ (left is True and node is True) or \\ (right is True and node is True): self.res = root return True # returnä»€ä¹ˆéƒ½å¯ elif (left is True) or (right is True) or (node is True): return True else: return False else: return False äºŒå‰æ ‘å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆæŒ‰å±‚éå†ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: def levelOrder(self, root: TreeNode) -\u0026gt; List[List[int]]: import queue q = queue.Queue() res = [] if root: q.put(root) next_level_size = 0 # ç»´æŠ¤ä¸‹æ¬¡å±‚èŠ‚ç‚¹çš„ä¸ªæ•° cur_level_size = 1 level = [] while not q.empty(): node = q.get() level.append(node.val) cur_level_size -= 1 # NoneèŠ‚ç‚¹ä¸å…¥é˜Ÿåˆ— if node.left: q.put(node.left) next_level_size += 1 if node.right: q.put(node.right) next_level_size += 1 if cur_level_size == 0: res.append(level) level = [] # ä¸èƒ½ä¸¢ cur_level_size = next_level_size next_level_size = 0 return res å‰åºå’Œä¸­åºéå†æ„é€ äºŒå‰æ ‘ pythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Definition for a binary tree node. # class TreeNode: # def __init__(self, val=0, left=None, right=None): # self.val = val # self.left = left # self.right = right class Solution: def buildTree(self, preorder: List[int], inorder: List[int]) -\u0026gt; TreeNode: length = len(preorder) if not length: return None root = TreeNode(preorder[0]) i = inorder.index(preorder[0]) if i: root.left = self.buildTree(preorder[1:1+i], inorder[0:i]) if length - i - 1: # ç†è§£ä¸ºå³å­æ ‘çš„èŠ‚ç‚¹æ•°é‡ root.right = self.buildTree(preorder[1+i:length], inorder[i+1:]) return root ä¾‹é¢˜1ï¼šå‰åºå’Œä¸­åºéå†æ„é€ äºŒå‰æ ‘ ï¼ˆåŠ›æ‰£98ï¼‰ ä¾‹é¢˜2ï¼šäºŒå‰æ ‘çš„å³ä¾§è§†å›¾ ï¼ˆåŠ›æ‰£199ï¼‰ ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 class Solution: def solve(self , xianxu: List[int], zhongxu: List[int]) -\u0026gt; List[int]: # write code here # 10ï¼š21 # å¼•å…¥æ·±åº¦å˜é‡ def build(preOrder: List[int], inOrder: List[int], depth: int): length = len(preOrder) if not length: return if len(res) \u0026gt; depth: res[depth] = preOrder[0] else: res.append(preOrder[0]) i = inOrder.index(preOrder[0]) if i: build(preOrder[1:i+1], inOrder[0:i], depth + 1) if length - i - 1: build(preOrder[i+1:], inOrder[i+1:], depth + 1) res = [] build(xianxu, zhongxu, 0) return res äºŒå‰æœç´¢æ ‘ä¸­åºéå† ä¾‹é¢˜1ï¼šäºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ ï¼ˆåŠ›æ‰£230ï¼‰ ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œå’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªç®—æ³•æŸ¥æ‰¾å…¶ä¸­ç¬¬ k ä¸ªæœ€å°å…ƒç´ ï¼ˆä» 1 å¼€å§‹è®¡æ•°ï¼‰ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Solution: def __init__(self): self.n = 0 self.r = None def kthSmallest(self, root: Optional[TreeNode], k: int) -\u0026gt; int: self.n = 0 self.pre_visit(root, k) return self.r def pre_visit(self, root: Optional[TreeNode], k: int): if root != None: self.pre_visit(root.left, k) self.n += 1 if self.n == k: self.r = root.val return self.pre_visit(root.right, k) pythonä»£ç ï¼ˆå®˜æ–¹ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 class Solution: def kthSmallest(self, root: TreeNode, k: int) -\u0026gt; int: stack = [] while root or stack: while root: stack.append(root) root = root.left root = stack.pop() k -= 1 if k == 0: return root.val root = root.right å›¾ç»“æ„ 1 2 3 4 5 6 7 8 G = [[0, 1, 1, 1, 1, 1, 0, 0], [0, 0, 1, 0, 1, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 0, 1, 1], [0, 0, 0, 0, 0, 1, 0, 1], [0, 0, 0, 0, 0, 1, 1, 0]] å›¾éå† ä¸‹é¢çš„ä»£ç éƒ½æ˜¯github copilotè‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œçœ‹èµ·æ¥éå¸¸ä¸é”™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 # å‡è®¾å›¾ä¸ºæ— å‘è¿é€šå›¾ # å›¾æ·±åº¦ä¼˜å…ˆéå† def dfs(G: List[List[int]], v: int) -\u0026gt; List[int]: visited = [False] * len(G) stack = [v] res = [] while stack: v = stack.pop() if not visited[v]: visited[v] = True res.append(v) for i in range(len(G)): if G[v][i] == 1 and not visited[i]: stack.append(i) return res # å›¾å¹¿åº¦ä¼˜å…ˆéå† def bfs(G: List[List[int]], v: int) -\u0026gt; List[int]: visited = [False] * len(G) queue = [v] res = [] while queue: v = queue.pop(0) if not visited[v]: visited[v] = True res.append(v) for i in range(len(G)): if G[v][i] == 1 and not visited[i]: queue.append(i) return res # å›¾é€’å½’æ·±åº¦ä¼˜å…ˆéå† def dfs_recur(G: List[List[int]], v: int) -\u0026gt; List[int]: visited = [False] * len(G) res = [] def dfs_recur_helper(v: int): if not visited[v]: visited[v] = True res.append(v) for i in range(len(G)): if G[v][i] == 1 and not visited[i]: dfs_recur_helper(i) dfs_recur_helper(v) return res # å›¾é€’å½’å¹¿åº¦ä¼˜å…ˆéå† def bfs_recur(G: List[List[int]], v: int) -\u0026gt; List[int]: visited = [False] * len(G) res = [] def bfs_recur_helper(v: int): if not visited[v]: visited[v] = True res.append(v) for i in range(len(G)): if G[v][i] == 1 and not visited[i]: bfs_recur_helper(i) bfs_recur_helper(v) return res å‚è€ƒï¼š\nå›¾çš„ä¸¤ç§éå†æ–¹å¼ï¼šDFSã€BFS\nä¾‹é¢˜1ï¼šå²›å±¿æ•°é‡ï¼ˆåŠ›æ‰£200ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡5ï¼‰ ç»™ä½ ä¸€ä¸ªç”±Â \u0026lsquo;1\u0026rsquo;ï¼ˆé™†åœ°ï¼‰å’Œ \u0026lsquo;0\u0026rsquo;ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚\nå²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚\næ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Solution: def numIslands(self, grid: List[List[str]]) -\u0026gt; int: def dfs(i: int, j: int): if i \u0026gt;= 0 and i \u0026lt; len(grid) and j \u0026gt;= 0 and j \u0026lt; len(grid[i]) and grid[i][j] == \u0026#39;1\u0026#39;: grid[i][j] = \u0026#39;0\u0026#39; dfs(i - 1, j) dfs(i + 1, j) dfs(i, j - 1) dfs(i, j + 1) res = 0 for i in range(len(grid)): for j in range(len(grid[i])): if grid[i][j] == \u0026#39;1\u0026#39;: res += 1 dfs(i, j) return res å…¶ä»–ä¾‹é¢˜ è¢«å›´ç»•çš„åŒºåŸŸï¼ˆåŠ›æ‰£130ï¼‰ å¹¶æŸ¥é›† ä½è¿ç®— å‚è€ƒï¼šä½æ“ä½œåŸºç¡€ç¯‡ä¹‹ä½æ“ä½œå…¨é¢æ€»ç»“\nåŠ¨æ€è§„åˆ’ç®—æ³• å¼•å­ï¼šè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ— æ–æ³¢é‚£å¥‘æ•°åˆ—æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š0ã€1ã€1ã€2ã€3ã€5ã€8ã€13ã€21ã€34ã€55\u0026hellip;\u0026hellip;\næ–æ³¢çº³å¥‘æ•°åˆ—å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•å®šä¹‰ï¼š $$ \\left{\\begin{array}{l} F(0)=0, F(1)=1 \\ F(n)=F(n-1)+F(n-2), n \\text { ä¸º } \\geq 2 \\text { çš„æ•´æ•° } \\end{array}\\right. $$ å¦‚æœæˆ‘ä»¬è¦è®¡ç®—F(5)ï¼Œé€’å½’è®¡ç®—å›¾å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°å› ä¸ºé‡å¤æ±‚è§£ç›¸åŒçš„å­é—®é¢˜ï¼Œä½¿å¾—æµªè´¹å¤§é‡çš„è®¡ç®—æ—¶é—´å’Œè®¡ç®—èµ„æºã€‚é‚£ä¹ˆæ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—å¯ä»¥é‡‡ç”¨1ï¼‰å¸¦æœ‰å¤‡å¿˜å½•çš„é€’å½’ç®—æ³•ï¼›2ï¼‰è‡ªåº•å‘ä¸Šæ³•ã€‚\nä»æ–æ³¢é‚£å¥‘æ•°åˆ—åˆ°åŠ¨æ€è§„åˆ’ æœ´ç´ é€’å½’ç®—æ³•ä¹‹æ‰€ä»¥æ•ˆç‡å¾ˆä½ï¼Œæ˜¯å› ä¸ºå®ƒåå¤æ±‚è§£ç›¸åŒçš„å­é—®é¢˜ã€‚å› æ­¤ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•ä»”ç»†å®‰æ’æ±‚è§£é¡ºåºï¼Œå¯¹æ¯ä¸ªå­é—®é¢˜åªæ±‚è§£ä¸€æ¬¡ï¼Œå¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥ã€‚å¦‚æœéšåå†æ¬¡éœ€è¦æ­¤å­é—®é¢˜çš„è§£ï¼Œåªéœ€æŸ¥æ‰¾ä¿å­˜çš„ç»“æœï¼Œè€Œä¸å¿…é‡æ–°è®¡ç®—ã€‚å› æ­¤ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•æ—¶ä»˜å‡ºé¢å¤–çš„å†…å­˜ç©ºé—´æ¥èŠ‚çœæ—¶é—´ï¼Œæ˜¯å…¸å‹çš„æ—¶ç©ºæƒè¡¡çš„ä¾‹å­ã€‚è€Œæ—¶é—´ä¸Šçš„èŠ‚çœå¯èƒ½æ˜¯éå¸¸å·¨å¤§çš„ï¼šå¯èƒ½å°†ä¸€ä¸ªæŒ‡æ•°æ—¶é—´çš„è§£è½¬åŒ–ä¸ºä¸€ä¸ªå¤šé¡¹å¼æ—¶é—´çš„è§£ã€‚\nåŠ¨æ€è§„åˆ’æœ‰ä¸¤ç§ç­‰ä»·çš„å®ç°æ–¹æ³•ï¼š\nç¬¬ä¸€ç§æ–¹æ³•ç§°ä¸ºå¸¦å¤‡å¿˜çš„è‡ªé¡¶å‘ä¸‹ã€‚æ­¤æ–¹æ³•ä»æŒ‰è‡ªç„¶çš„é€’å½’å½¢å¼ç¼–å†™è¿‡ç¨‹ï¼Œä½†è¿‡ç¨‹æˆ–ä¿å­˜æ¯ä¸ªå­é—®é¢˜çš„è§£ï¼ˆé€šå¸¸åœ¨ä¸€ä¸ªæ•°ç»„æˆ–æ•£åˆ—è¡¨ï¼‰ã€‚å½“éœ€è¦ä¸€ä¸ªå­é—®é¢˜çš„è§£æ—¶ï¼Œè¿‡ç¨‹é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»ä¿å­˜è¿‡æ­¤è§£ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›ä¿å­˜çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†è®¡ç®—æ—¶é—´ï¼›å¦åˆ™ï¼ŒæŒ‰é€šå¸¸æ–¹å¼è®¡ç®—è¿™ä¸ªå­é—®é¢˜ã€‚ç§°è¿™ä¸ªé€’å½’è¿‡ç¨‹æ—¶å¸¦å¤‡å¿˜çš„ã€‚\nç¬¬äºŒç§æ–¹æ³•ç§°ä¸ºè‡ªåº•å‘ä¸Šæ³•ã€‚è¿™ç§æ–¹æ³•ä¸€èˆ¬éœ€è¦æ°å½“å®šä¹‰å­é—®é¢˜â€œè§„æ¨¡â€çš„æ¦‚å¿µï¼Œä½¿å¾—ä»»ä½•å­é—®é¢˜çš„æ±‚è§£éƒ½åªä¾èµ–ä¸â€œæ›´å°çš„â€å­é—®é¢˜çš„æ±‚è§£ã€‚å› æ­¤å¯ä»¥å°†å­é—®é¢˜æŒ‰è§„æ¨¡æ’åºï¼ŒæŒ‰ç”±å°åˆ°å¤§é¡ºåºè¿›è¡Œæ±‚è§£ã€‚å½“æ±‚è§£æŸä¸ªå­é—®é¢˜æ—¶ï¼Œå®ƒæ‰€ä¾èµ–çš„é‚£äº›æ›´å°çš„å­é—®é¢˜éƒ½å·²æ±‚è§£å®Œæ¯•ï¼Œç»“æœå·²ç»ä¿å­˜ã€‚æ¯ä¸ªå­é—®é¢˜åªéœ€æ±‚è§£ä¸€æ¬¡ï¼Œå½“æˆ‘ä»¬æ±‚è§£å®ƒæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å‰æå­é—®é¢˜éƒ½å·²æ±‚è§£å®Œæˆã€‚\nä¸¤ç§ç®—æ³•å¾—åˆ°çš„ç®—æ³•å…·æœ‰ç›¸åŒçš„æ¸è¿‘è¿è¡Œæ—¶é—´ï¼Œä»…æœ‰çš„å·®å¼‚åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè‡ªé¡¶å‘ä¸‹æ–¹æ³•å¹¶æœªçœŸæ­£é€’å½’åœ°è€ƒå¯Ÿæ‰€æœ‰å¯èƒ½çš„å­é—®é¢˜ã€‚ç”±äºæ²¡æœ‰é¢‘ç¹çš„é€’å½’å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œè‡ªåº•å‘ä¸Šæ–¹æ³•çš„æ—¶é—´å¤æ‚æ€§å‡½æ•°é€šå¸¸å…·æœ‰æ›´å°çš„ç³»æ•°ã€‚\nåŠ¨æ€è§„åˆ’é¢˜ä¸€èˆ¬æƒ…å†µï¼Œéœ€è¦å…ˆæ‰¾åˆ°åˆé€‚çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹/é€’æ¨å…¬å¼ï¼Œä¸­é—´ç»“æœçŠ¶æ€çš„ä¿å­˜ä¸€èˆ¬ç”¨æ•°ç»„æˆ–è€…å¤šç»´æ•°ç»„ï¼Œè¿™é‡Œï¼Œå¦‚æœçŠ¶æ€è½¬ç§»æ–¹ç¨‹åªä¾èµ–ä¹‹å‰è®¡ç®—çš„æœ‰é™é¡¹ï¼Œä¸”è¿™äº›æœ‰é™é¡¹ç¬¦åˆå›ºå®šçš„è§„åˆ™ï¼Œå¹¶ä¸”æœ€åè®¡ç®—çš„ç»“æœä¸æ˜¯åœ¨æ‰€æœ‰çŠ¶æ€ä¸­å¯»æ‰¾ï¼ˆå¦‚maxï¼‰æ±‚å¾—ï¼Œé‚£ä¹ˆå¾€å¾€å¹¶ä¸éœ€è¦ä¸€ä¸ªæ•°ç»„ï¼Œåªéœ€è¦è®°å½•æŸå‡ ä¸ªä¹‹å‰çš„çŠ¶æ€ï¼ˆå˜é‡å¯ä»¥é‡å¤åˆ©ç”¨ï¼‰ï¼Œå°±å¯ä»¥é€’æ¨åé¢çš„æƒ…å†µï¼Œé™ä½ç©ºé—´å¤æ‚åº¦ã€‚è¯¥æƒ³æ³•æ€»ç»“è‡ªæ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚\nä¾‹é¢˜ ä¾‹é¢˜1ï¼šæ‰“å®¶åŠ«èˆï¼ˆåŠ›æ‰£198ï¼‰ ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚å¦‚ï¼Œè¾“å…¥ï¼š[2,7,9,3,1] è¾“å‡ºï¼š12\né€’æ¨å…¬å¼ $$ \\left{ \\begin{array}{lr}\ndp[i][0] \\text{ä»£è¡¨å·äº†ç¬¬ié—´æˆ¿è·å¾—çš„æœ€å¤§æ”¶ç›Š} \\ dp[i][1] \\text{ä»£è¡¨æ²¡æœ‰å·ç¬¬ié—´æˆ¿è·å¾—çš„æœ€å¤§æ”¶ç›Š} \\ \\end{array}\n\\right. $$ $$ \\left{\n\\begin{array}{lr}\ndp[i + 1][0] = dp[i][1] + L[i + 1] \\ dp[i + 1][1] = max(dp[i][0], dp[i][1]) \\ \\end{array}\n\\right. $$\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 class Solution: def rob(self, nums: List[int]) -\u0026gt; int: length = len(nums) import numpy as np dp = np.zeros((length, 2)) dp[0][0] = nums[0] # å·äº†ç¬¬iå®¶è·å¾—çš„æœ€å¤§æ”¶ç›Š dp[0][1] = 0 # æ²¡å·äº†ç¬¬iå®¶è·å¾—çš„æœ€å¤§æ”¶ç›Š for i in range(length - 1): dp[i + 1][0] = dp[i][1] + nums[i + 1] dp[i + 1][1] = max(dp[i][0], dp[i][1]) return int(dp.max()) ä¼˜åŒ–ä¹‹åçš„é€’æ¨å…¬å¼ ç”¨ $d p[i]$ è¡¨ç¤ºå‰ $i$ é—´æˆ¿å±‹èƒ½å·çªƒåˆ°çš„æœ€é«˜æ€»é‡‘é¢, é‚£ä¹ˆå°±æœ‰å¦‚ä¸‹çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹: $$ d p[i]=\\max (d p[i-2]+n u m s[i], d p[i-1]) $$ è¾¹ç•Œæ¡ä»¶ä¸º: $$ \\begin{cases}d p[0]=n u m s[0] \u0026amp; \\text { åªæœ‰ä¸€é—´æˆ¿å±‹, åˆ™å·çª„è¯¥æˆ¿å±‹ } \\ d p[1]=\\max (n u m s[0], n u m s[1]) \u0026amp; \\text { åªæœ‰ä¸¤é—´æˆ¿å±‹, é€‰æ‹©å…¶ä¸­é‡‘é¢è¾ƒé«˜çš„æˆ¿å±‹è¿›è¡Œå·çªƒ }\\end{cases} $$ æœ€ç»ˆçš„ç­”æ¡ˆå³ä¸º $d p[n-1]$, å…¶ä¸­ $n$ æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚\nä¾‹é¢˜2ï¼šé›¶é’±å…‘æ¢ (åŠ›æ‰£322) ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ coins ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° amount ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1 ã€‚\nä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚ å¦‚ï¼Œè¾“å…¥ï¼šcoins = [1, 2, 5], amount = 11ï¼Œè¾“å‡ºï¼š3\nåˆ†æ é¦–å…ˆï¼Œæƒ³è¦å‡‘æˆæ€»é‡‘é¢åˆæƒ³ä½¿å¾—æ‰€éœ€çš„ç¡¬å¸ä¸ªæ•°æœ€å°‘ï¼Œé‚£ä¹ˆåœ¨ç»„åˆä¸­å°½å¯èƒ½å¾—ä½¿ç”¨æ›´å¤§é¢é¢çš„ç¡¬å¸ï¼›å¦‚æœæœ€å¤§é¢é¢çš„ç¡¬å¸å°äºæ‰€éœ€å‡‘æˆçš„æ€»é‡‘é¢ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•å…ˆç”¨ä¸€å®šæ•°é‡çš„æœ€å¤§é¢é¢ç¡¬å¸ï¼Œé‚£ä¹ˆå½¢æˆä¸€ä¸ªå­é—®é¢˜ä¸ºï¼š ä½¿ç”¨é™¤å»æœ€å¤§é¢é¢çš„ç¡¬å¸æ¥å‡‘æˆæ–°æ€»é‡‘é¢æ‰€éœ€æœ€å°çš„ç¡¬å¸ä¸ªæ•°ï¼Œæ–°æ€»é‡‘é¢ = æ€»é‡‘é¢ - æœ€å¤§é¢é¢ç¡¬å¸ * æœ€å¤§é¢é¢ç¡¬å¸ä¸ªæ•°ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 class Solution: def coinChange(self, coins: List[int], amount: int) -\u0026gt; int: dp = [float(\u0026#39;inf\u0026#39;)] * (amount + 1) dp[0] = 0 for coin in coins: for x in range(coin, amount + 1): dp[x] = min(dp[x], dp[x - coin] + 1) return dp[amount] if dp[amount] != float(\u0026#39;inf\u0026#39;) else -1 ä¾‹é¢˜3ï¼š æœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼ˆåŠ›æ‰£32ï¼‰ ç»™ä½ ä¸€ä¸ªåªåŒ…å« \u0026lsquo;(\u0026rsquo; å’Œ \u0026lsquo;)\u0026rsquo; çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿æœ‰æ•ˆï¼ˆæ ¼å¼æ­£ç¡®ä¸”è¿ç»­ï¼‰æ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚å¦‚ï¼Œè¾“å…¥ï¼šs = \u0026ldquo;)()())\u0026quot;ï¼Œè¾“å‡ºï¼š4ï¼Œè§£é‡Šï¼šæœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ \u0026ldquo;()()\u0026rdquo;\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 class Solution: def longestValidParentheses(self, s: str) -\u0026gt; int: n = len(s) if n==0:return 0 dp = [0]*n for i in range(len(s)): # i-dp[i-1]-1æ˜¯ä¸å½“å‰)å¯¹ç§°çš„ä½ç½® if s[i]==\u0026#39;)\u0026#39; and i-dp[i-1]-1\u0026gt;=0 and s[i-dp[i-1]-1]==\u0026#39;(\u0026#39;: dp[i]=dp[i-1]+dp[i-dp[i-1]-2]+2 # ä¼šå‡ºç°dp[-1]ï¼Œç„¶è€Œæ²¡å½±å“ return max(dp) ä¾‹é¢˜4ï¼šç¼–è¾‘è·ç¦» ï¼ˆåŠ›æ‰£72ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡8ï¼‰ ç»™ä½ ä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œ è¯·è¿”å›å°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°ã€‚\nä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼šæ’å…¥ä¸€ä¸ªå­—ç¬¦ã€åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚ï¼š è¾“å…¥ï¼šword1 = \u0026ldquo;horse\u0026rdquo;, word2 = \u0026ldquo;ros\u0026rdquo;\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š\nhorse -\u0026gt; rorse (å°† \u0026lsquo;h\u0026rsquo; æ›¿æ¢ä¸º \u0026lsquo;r\u0026rsquo;)\nrorse -\u0026gt; rose (åˆ é™¤ \u0026lsquo;r\u0026rsquo;)\nrose -\u0026gt; ros (åˆ é™¤ \u0026rsquo;e\u0026rsquo;)\nå®˜æ–¹ç»™çš„æ€è·¯å¦‚ä½•ä¿è¯æ˜¯å…¨å±€æœ€å°æ“ä½œæ•°å‘¢ï¼Ÿå¦å¤–ï¼Œå¤„ç†dpè¾¹ç•Œæ—¶å€™ï¼Œå¯ä»¥ç”³è¯·ä¸€ä¸ªé¢å¤–çš„ç©ºé—´i=0ï¼Œj=0ï¼Œå³ç”³è¯·dp[0\u0026hellip;n + 1][0\u0026hellip;m + 1]ç©ºé—´ï¼Œç„¶åæŠŠç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„å€¼è®¾ç½®ä¸ºè¾¹ç•Œï¼Œè¿™æ ·é€’æ¨ä»£ç ä¸­ä¸ç”¨é¢å¤–è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 class Solution: def minDistance(self, word1: str, word2: str) -\u0026gt; int: if len(word1) == 0: return len(word2) if len(word2) == 0: return len(word1) # é€’æ¨å¼å·²ç»ç¡®å®šäº†ï¼Œè¾¹ç•Œæ¡ä»¶æ³¨æ„å¼„å¯¹å°±okäº†ï¼ # è¿™é‡Œå…¶å®å¯ä»¥ç”³è¯·n + 1, m + 1å¤§å°çš„äºŒç»´æ•°ç»„ import numpy as np n, m = len(word1), len(word2) self.dp = np.zeros((n, m), dtype=int) for i in range(n): for j in range(m): if word1[i] == word2[j]: self.dp[i][j] = self.getDp(i - 1, j - 1) else: self.dp[i][j] = min(self.getDp(i, j - 1), self.getDp(i - 1, j), self.getDp(i - 1, j - 1)) + 1 return int(self.dp[n - 1][m - 1]) def getDp(self, i : int, j: int): if i \u0026lt; 0 and j \u0026lt; 0: return 0 if i \u0026lt; 0: return j + 1 if j \u0026lt; 0: return i + 1 return self.dp[i][j] ä¾‹é¢˜5ï¼šæœ€é•¿é€’å¢å­åºåˆ— ï¼ˆåŠ›æ‰£300ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡6ï¼‰ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\nå­åºåˆ—Â æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7] æ˜¯æ•°ç»„ [0,3,1,6,2,2,7] çš„å­åºåˆ—\nçœ‹ç€æœ‰äº›éš¾åº¦ï¼Œå®é™…ä¸Šåªè¦æƒ³åˆ°åŠ¨æ€è§„åˆ’ï¼Œå¹¶ä¸”ä»¥nums[i]å¤„ä½œä¸ºå­åºåˆ—çš„ç»“å°¾ï¼Œä»å°é€’æ¨åˆ°ç»™å®šçš„åºåˆ—çš„é•¿åº¦ï¼Œå°±å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚\npythonä»£ç  1 2 3 4 5 6 7 8 class Solution: def lengthOfLIS(self, nums: List[int]) -\u0026gt; int: dp = [1] * len(nums) for i in range(len(nums)): for j in range(i): if nums[i] \u0026gt; nums[j]: dp[i] = max(dp[i], dp[j] + 1) # æ›´ç²¾ç®€ return max(dp) å…¶ä»–ä¾‹é¢˜ é’è›™è¿‡æ²³ï¼ˆåŠ›æ‰£403ï¼‰ åŠ¨æ€è§„åˆ’ä¸­å¸¸ç”¨æ€æƒ³ å¢é‡æ³•ï¼šå­—ç¬¦ä¸²/çŸ©é˜µè¡¨ç¤ºçš„ç»“æ„ä¸­ï¼Œå¾€å¾€å¯ä»¥è€ƒè™‘å°¾éƒ¨å¢åŠ ä¸€ä¸ªå­—ç¬¦æ‰€å¸¦æ¥çš„å½±å“/å˜åŒ–ï¼Œä»è€Œè€ƒè™‘å¤šä¸ªæƒ…å†µï¼Œå»ºç«‹é€’å½’å…¬å¼ã€‚ åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºçš„ç»“æ„ä¸­ï¼Œä»»ä½•ä¸€ä¸ªå­ä¸²/å­åºåˆ—ï¼Œéƒ½å¿…é¡»æœ‰ä¸€ä¸ªç»“å°¾å­—ç¬¦ï¼Œå¾€å¾€å¯ä»¥è€ƒè™‘å°†ä»¥å­—ç¬¦ç»“å°¾çš„æŸä¸ªDPå˜é‡ä½œä¸ºåŠ¨æ€è§„åˆ’çŠ¶æ€ï¼Œä»è€Œè€ƒè™‘æ›´é•¿çš„å­—ç¬¦ä¸²ã€‚ å¥‡æ·«æŠ€å·§ï¼ˆå°é¢˜å¤§åšï¼‰ ä¾‹é¢˜1ï¼šå¯»æ‰¾é‡å¤æ•° ï¼ˆåŠ›æ‰£287ï¼‰ï¼ˆå­—èŠ‚-ç®—æ³•-é¢‘æ¬¡3ï¼‰ å†…æ¨ å­—èŠ‚è·³åŠ¨å†…æ¨é“¾æ¥ï¼šå­—èŠ‚å†…æ¨ï¼Œæœ‰éœ€è¦çš„åŒå­¦è‡ªå–ã€‚\nå‚è€ƒï¼š\nåŠ¨æ€è§„åˆ’è¯¾ä»¶å’Œä»£ç \n","date":"2022-02-18T13:08:49Z","permalink":"https://qiyueliuhuo.github.io/posts/leetcode%E7%AE%97%E6%B3%95%E9%A2%98%E6%80%BB%E7%BB%93/","title":"Leetcodeç®—æ³•é¢˜æ€»ç»“"},{"content":"ç”¨çŸ©é˜µæ¨å¯¼ç½‘ç»œã€‚\nç¬¦å·å®šä¹‰ ä½¿ç”¨å°å†™å­—æ¯$x$è¡¨ç¤ºæ ‡é‡ï¼Œç²—ä½“å°å†™å­—æ¯$\\boldsymbol{x}$è¡¨ç¤ºå‘é‡ï¼Œæ³¨æ„å‘é‡å¯èƒ½ä¸ºè¡Œå‘é‡æˆ–è€…åˆ—å‘é‡ï¼Œå¤§å†™å­—æ¯$X$è¡¨ç¤ºçŸ©é˜µã€‚ $\\sigma$ä¸ºé€å…ƒç´ sigmoidå‡½æ•°ï¼š$\\sigma(z)=\\frac{1}{1+\\mathrm{e}^{-z}}$ã€‚ $\\boldsymbol{1}$ä¸ºåˆ—å‘é‡ï¼Œ$\\boldsymbol{1}=(1, 1, 1 \\cdots 1, 1, 1)^{T}$ï¼ŒéæŒ‡ç¤ºå‡½æ•°ã€‚ $exp(\\boldsymbol{a})$è¡¨ç¤ºé€å…ƒç´ æ±‚æŒ‡æ•°ã€‚ $log(\\boldsymbol{a})$è¡¨ç¤ºé€å…ƒç´ æ±‚è‡ªç„¶å¯¹æ•°ã€‚ ç¬¦å·å«ä¹‰ åˆ—å‘é‡$\\boldsymbol{x}=\\left(x_{1}, x_{2}, x_{3} \\cdots x_{n-2}, x_{n-1}, x_{n}\\right)^{T}$ä»£è¡¨ä¸€ä¸ªè¾“å…¥æ ·æœ¬ï¼Œå…·æœ‰$n$ä¸ªç‰¹å¾å€¼ã€‚ è®¾åˆ—å‘é‡$\\boldsymbol{z}=\\left(z_{1}, z_{2}, z_{3} \\cdots z_{n-2}, z_{n-1}, z_{n}\\right)^{T}$ï¼Œ\n$\\sigma(\\boldsymbol{z}) = \\left(\\sigma(z_{1}), \\sigma(z_{2}), \\sigma(z_{3}) \\cdots \\sigma(z_{n-2}), \\sigma(z_{n-1}), \\sigma(z_{n})\\right)$ è®¾åˆ—å‘é‡$\\boldsymbol{a}=\\left(a_{1}, a_{2}, a_{3} \\cdots a_{n-2}, a_{n-1}, a_{n}\\right)^{T}$ï¼Œ$\\operatorname{softmax}(\\boldsymbol{a})=\\frac{\\exp (\\boldsymbol{a})}{\\mathbf{1}^{T} \\exp (\\boldsymbol{a})}$ï¼Œåˆ†æ¯ä¸ºè¡Œå‘é‡ä¹˜ä»¥åˆ—å‘é‡ä¸ºæ ‡é‡ï¼Œåˆ†å­ä¸ºåˆ—å‘é‡ï¼Œæ‰€ä»¥ç»“æœä»ä¸ºåˆ—å‘é‡ã€‚ è¿ç®—æ³•åˆ™ ç›¸å…³ç†è§£å‚è€ƒï¼š\nçŸ©é˜µæ±‚å¯¼æœ¯ï¼ˆä¸Šï¼‰\nçŸ©é˜µæ±‚å¯¼æœ¯ï¼ˆä¸‹ï¼‰\nçŸ©é˜µè¿ç®—æ³•åˆ™ å¯¹å°ºå¯¸ç›¸åŒçš„çŸ©é˜µ$A, B$ï¼Œ$\\operatorname{tr}\\left(A^{T} B\\right)=\\sum_{i, j} A_{i j} B_{i j}$ã€‚ çŸ©é˜µå¾®åˆ†è¿ç®—ç¬¦æ³•åˆ™ ç†è§£ å®šä¹‰ï¼šæ ‡é‡få¯¹çŸ©é˜µ $X$ çš„å¯¼æ•°, å®šä¹‰ä¸º $\\frac{\\partial f}{\\partial X}=\\left[\\frac{\\partial f}{\\partial X_{i j}}\\right]$ï¼Œå³få¯¹Xé€å…ƒç´ æ±‚å¯¼æ’æˆä¸Xå°ºå¯¸ç›¸åŒçš„çŸ©é˜µã€‚\nå°†çŸ©é˜µå¯¼æ•°ä¸å¾®åˆ†å»ºç«‹è”ç³»ï¼š$d f=\\sum_{i=1}^{m} \\sum_{j=1}^{n} \\frac{\\partial f}{\\partial X_{i j}} d X_{i j}=\\operatorname{tr}\\left(\\frac{\\partial f^{T}}{\\partial X} d X\\right)$ã€‚\nç†è§£ï¼š 1. å¾®åˆ†ç®—å­$d$ä½œç”¨äºçŸ©é˜µ$X$ï¼Œè¡¨ç¤ºä¸ºé€å…ƒç´ ä½œç”¨ã€‚ 2. ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å…¨å¾®åˆ†å…¬å¼ï¼Œç¬¬äºŒä¸ªç­‰å·è¡¨è¾¾äº†çŸ©é˜µå¯¼æ•°ä¸å¾®åˆ†çš„è”ç³»ã€‚ 3. $tr()$ä»£è¡¨è¿¹(trace)æ˜¯æ–¹é˜µå¯¹è§’çº¿å…ƒç´ ä¹‹å’Œã€‚ 4. ä¸¾ä¾‹ï¼šè®¾$X=\\left[\\begin{array}{l}X_{0_0}, X_{01} \\\\ X_{10}, X_{11}\\end{array}\\right]$, $d X=\\left[\\begin{array}{l}dX_{00}, dX_{01} \\\\ dX_{10}, dX_{11}\\end{array}\\right]$ï¼Œ$\\frac{d f}{d X}=\\left[\\begin{array}{ll}\\frac{\\partial f}{\\partial X_{00}}, \\frac{\\partial f}{\\partial X_{01}} \\\\ \\frac{\\partial f}{\\partial X_{10}}, \\frac{\\partial f}{\\partial X_{11}}\\end{array}\\right]$ï¼Œ$\\operatorname{tr}\\left(\\frac{\\partial f^{T}}{\\partial X} d X\\right)=\\operatorname{tr}\\left(\\left[\\begin{array}{ll}\\frac{\\partial f}{\\partial X_{00}}, \\frac{\\partial f}{\\partial X_{10}} \\\\ \\frac{\\partial f}{\\partial X_{01}}, \\frac{\\partial f}{\\partial X_{11}}\\end{array}\\right]\\left[\\begin{array}{l}dX_{00}, dX_{01} \\\\ dX_{10}, dX_{11}\\end{array}\\right]\\right)$\næ€è€ƒ æ ·æœ¬ç‰¹å¾å€¼æ’åˆ—ä¸ºåˆ—å‘é‡ï¼Œæ–¹ä¾¿ç»Ÿä¸€å½¢å¼ä¸ºæƒé‡å‚æ•°$W$æ”¾åœ¨$\\boldsymbol{x}$å‰ï¼Œè¿›è¡Œä¹˜ç§¯ã€‚ å…¨è¿æ¥ç½‘ç»œ $$ l=-\\boldsymbol{y}^{T} \\log \\operatorname{softmax}\\left(W_{2} \\sigma\\left(W_{1} \\boldsymbol{x}\\right)\\right) $$\nç¬¦å·è¯´æ˜ $l$ä¸ºæŸå¤±å‡½æ•°ã€‚ $\\boldsymbol{x}$ä¸ºå•æ ·æœ¬ï¼Œåˆ™$l$åªåŒ…å«ä¸€ä¸ªæ ·æœ¬çš„æŸå¤±å‡½æ•°ã€‚ åˆ†ç±»ç½‘ç»œç±»åˆ«æ•°ä¸º$m$ï¼Œ$\\boldsymbol{y}$ æ˜¯é™¤ä¸€ä¸ªå…ƒç´ ä¸º1å¤–å…¶å®ƒå…ƒç´ ä¸º 0 çš„çš„ $m \\times 1$ åˆ—å‘é‡, $W_{2}$ æ˜¯ $m \\times p$ çŸ©é˜µ, $W_{1}$ æ˜¯ $p \\times n$ çŸ©é˜µ, $\\boldsymbol{x}$ æ˜¯ $n \\times 1$ åˆ—å‘é‡, $l$ æ˜¯æ ‡é‡ æ¨å¯¼ $\\frac{\\partial l}{\\partial W_{1}}$ å’Œ $\\frac{\\partial l}{\\partial W_{2}}$ å®šä¹‰ï¼š$\\boldsymbol{a}{1}=W{1} \\boldsymbol{x}, \\boldsymbol{h}{1}=\\sigma\\left(\\boldsymbol{a}{1}\\right), \\boldsymbol{a}{2}=W{2} \\boldsymbol{h}{1}$, åˆ™ $l=-\\boldsymbol{y}^{T} \\log \\operatorname{softmax}\\left(\\boldsymbol{a}{2}\\right)$ã€‚\nå·²çŸ¥$\\frac{\\partial l}{\\partial \\boldsymbol{a}{2}}=\\operatorname{softmax}\\left(\\boldsymbol{a}{2}\\right)-\\boldsymbol{y}$ ã€‚\næ¨å¯¼ç»“æœï¼š $$ \\frac{\\partial l}{\\partial W_{2}}=\\frac{\\partial l}{\\partial \\boldsymbol{a}{2}} \\boldsymbol{h}{1}^{T} $$ $$ \\frac{\\partial l}{\\partial W_{1}}=\\frac{\\partial l}{\\partial \\boldsymbol{a}_{1}} \\boldsymbol{x}^{T} $$\næ¨å¹¿åˆ°å¤šä¸ªæ ·æœ¬ ä½¿ç”¨çŸ©é˜µæ¥è¡¨ç¤ºNä¸ªæ ·æœ¬ï¼Œä»¥ç®€åŒ–å½¢å¼ã€‚\nå®šä¹‰ï¼š$X=\\left[\\boldsymbol{x}{1}, \\cdots, \\boldsymbol{x}{N}\\right]$ï¼Œ$A_{1}=\\left[\\boldsymbol{a}{1,1}, \\cdots, \\boldsymbol{a}{1, N}\\right]=W_{1} X+\\boldsymbol{b}{1} \\mathbf{1}^{T}, \\quad H{1}=\\left[\\boldsymbol{h}{1,1}, \\cdots, \\boldsymbol{h}{1, N}\\right]=\\sigma\\left(A_{1}\\right) \\text {, }$ï¼Œ$A_{2}=\\left[\\boldsymbol{a}{2,1}, \\cdots, \\boldsymbol{a}{2, N}\\right]=W_{2} H_{1}+\\boldsymbol{b}_{2} \\mathbf{1}^{T}$, æ³¨æ„è¿™é‡Œä½¿ç”¨å…¨1å‘é‡æ¥æ‰©å±•ç»´åº¦ã€‚\næ¨å¯¼ç»“æœï¼š $$ \\frac{\\partial l}{\\partial W_{1}}=\\frac{\\partial l}{\\partial A_{1}} X^{T}, \\quad \\frac{\\partial l}{\\partial \\boldsymbol{b}{1}}=\\frac{\\partial l}{\\partial A{1}} \\mathbf{1} $$ $$ \\frac{\\partial l}{\\partial W_{2}}=\\frac{\\partial l}{\\partial A_{2}} H_{1}^{T}, \\quad \\frac{\\partial l}{\\partial \\boldsymbol{b}{2}}=\\frac{\\partial l}{\\partial A{2}} \\mathbf{1} $$\nå‚è€ƒ ç¥ç»ç½‘ç»œçš„ä¸€äº›å…¬å¼æ€»ç»“\næ›´æ–°è®°å½• è°ƒæ•´æ ¼å¼å’Œæ’ç‰ˆã€‚ â€”â€” 2022.07.19\n","date":"2021-10-29T11:20:28Z","permalink":"https://qiyueliuhuo.github.io/posts/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9F%A9%E9%98%B5%E5%88%86%E6%9E%90/","title":"ç¥ç»ç½‘ç»œçŸ©é˜µåˆ†æ"},{"content":"ä¸ºäº†æ›´æ·±å…¥ç†è§£å·ç§¯ç¥ç»ç½‘ç»œï¼Œè¿™ç¯‡åšå®¢ä»‹ç»åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­å¸¸ç”¨çš„å·ç§¯æ“ä½œåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚\nå·ç§¯ å·ç§¯æœ¬èº«çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯é€šè¿‡åœ¨ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨å·ç§¯æ ¸æ¥å®Œæˆçš„ï¼Œå¦‚ä¸‹é¢ä¸¤ä¸ªåŠ¨å›¾ï¼Œå½¢è±¡åœ°å±•ç¤ºäº†å•é€šé“å·ç§¯å’Œå¤šé€šé“å·ç§¯æ“ä½œã€‚\nå•é€šé“å·ç§¯ å¤šé€šé“å·ç§¯ å¤šé€šé“å·ç§¯è®¡ç®—åº•å±‚å®ç° å‡è®¾è¾“å…¥å›¾åƒåŠå·ç§¯å’Œå¤§å°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸€æ­¥ï¼šåˆ†åˆ«å°†ç‰¹å¾å›¾å’Œå·ç§¯è½¬æ¢ä¸ºçŸ©é˜µ å·ç§¯æ ¸ å¯¹äº2Då·ç§¯ï¼Œæœ¬èº«æ˜¯å››ç»´çš„å·ç§¯æ ¸ï¼Œå°†å…¶è½¬æ¢ä¸ºäºŒç»´ç”±$C_{\\text {out }} \\times C \\times K \\times K$å˜ä¸º$C_{\\text {out }} \\times M$ï¼Œå…¶ä¸­$M=C \\times K \\times K$ã€‚\nä¾‹å¦‚ï¼Œå¦‚ä¸‹å·ç§¯æ ¸çš„ç»´åº¦æ˜¯$2 \\times 3 \\times 2 \\times 2$ï¼Œåˆ†åˆ«ä¸º filter 1 å’Œ filter 2ã€‚\n$$ \\left[\\begin{array}{ll} 1 \u0026amp; 1 \\\\ 2 \u0026amp; 2 \\end{array}\\right]\\left[\\begin{array}{ll} 1 \u0026amp; 1 \\\\ 1 \u0026amp; 1 \\end{array}\\right]\\left[\\begin{array}{ll} 0 \u0026amp; 1 \\\\ 1 \u0026amp; 0 \\end{array}\\right] $$\n$$ \\left[\\begin{array}{ll} 1 \u0026amp; 0 \\\\ 0 \u0026amp; 1 \\end{array}\\right]\\left[\\begin{array}{ll} 2 \u0026amp; 1 \\\\ 2 \u0026amp; 1 \\end{array}\\right]\\left[\\begin{array}{ll} 1 \u0026amp; 2 \\\\ 2 \u0026amp; 0 \\end{array}\\right] $$\nè½¬æ¢æˆ$C_{\\text {out }} \\times M$çŸ©é˜µä¸º$2 \\times 12$å¤§å°ï¼Œå¦‚ä¸‹ï¼š $$ \\left[\\begin{array}{llllllllllll} 1 \u0026amp; 1 \u0026amp; 2 \u0026amp; 2 \u0026amp; 1 \u0026amp; 1 \u0026amp; 1 \u0026amp; 1 \u0026amp; 0 \u0026amp; 1 \u0026amp; 1 \u0026amp; 0 \\\\ 1 \u0026amp; 0 \u0026amp; 0 \u0026amp; 1 \u0026amp; 2 \u0026amp; 1 \u0026amp; 2 \u0026amp; 1 \u0026amp; 1 \u0026amp; 2 \u0026amp; 2 \u0026amp; 0 \\end{array}\\right] $$\nç‰¹å¾å›¾ å¯¹äºè¾“å…¥ä¸º$C \\times H \\times W$çš„ç‰¹å¾å›¾, å°†å…¶è½¬æ¢ä¸º$\\left(H^{\\prime} \\times W^{\\prime}\\right) \\times(C \\times K \\times K)$çš„çŸ©é˜µã€‚å…¶ä¸­$H^{\\prime}$å’Œ $W^{\\prime}$ä¸ºè¾“å‡ºç‰¹å¾å›¾çš„é•¿å’Œå®½ã€‚ä¸å·ç§¯æ ¸kernelçš„å˜æ¢ä¸åŒï¼Œfeature mapä¸æ˜¯å•çº¯å°†çŸ©é˜µresizeä¸€ä¸‹å°±è¡Œ, è€Œæ˜¯è¦æ ¹æ®å·ç§¯æ ¸çš„å°ºå¯¸ã€ä¸ç‰¹å¾å›¾çš„ä½œç”¨è¿‡ç¨‹éœ€è¦çš„strideå’Œpaddingï¼Œä»è¾“å…¥ç‰¹å¾ä¸­é€‰æ‹©ç›¸åº”çš„å€¼ç»„æˆè½¬æ¢åçš„çŸ©é˜µã€‚\nä¾‹å¦‚, å‡è®¾è¾“å…¥çš„ç‰¹å¾å›¾çš„å¤§å°ä¸º $3 \\times 3 \\times 3$, ç‰¹å¾å›¾ä¸ºï¼š $$ \\left[\\begin{array}{lll} 1 \u0026amp; 2 \u0026amp; 0 \\ 1 \u0026amp; 1 \u0026amp; 3 \\ 0 \u0026amp; 2 \u0026amp; 2 \\end{array}\\right]\\left[\\begin{array}{lll} 0 \u0026amp; 2 \u0026amp; 1 \\ 0 \u0026amp; 3 \u0026amp; 2 \\ 1 \u0026amp; 1 \u0026amp; 0 \\end{array}\\right]\\left[\\begin{array}{lll} 1 \u0026amp; 2 \u0026amp; 1 \\ 0 \u0026amp; 1 \u0026amp; 3 \\ 3 \u0026amp; 3 \u0026amp; 2 \\end{array}\\right] $$ é‡‡ç”¨ $2 \\times 2$ å·ç§¯æ ¸, strideä¸º $1$, paddingä¸º $0$ ï¼Œè½¬æ¢å¾—åˆ°å¦‚ä¸‹ï¼š $$ \\left[\\begin{array}{llllllllllll} 1 \u0026amp; 2 \u0026amp; 1 \u0026amp; 1 \u0026amp; 0 \u0026amp; 2 \u0026amp; 0 \u0026amp; 3 \u0026amp; 1 \u0026amp; 2 \u0026amp; 0 \u0026amp; 1 \\ 2 \u0026amp; 0 \u0026amp; 1 \u0026amp; 3 \u0026amp; 2 \u0026amp; 1 \u0026amp; 3 \u0026amp; 2 \u0026amp; 2 \u0026amp; 1 \u0026amp; 1 \u0026amp; 3 \\ 1 \u0026amp; 1 \u0026amp; 0 \u0026amp; 2 \u0026amp; 0 \u0026amp; 3 \u0026amp; 1 \u0026amp; 1 \u0026amp; 0 \u0026amp; 1 \u0026amp; 3 \u0026amp; 3 \\ 1 \u0026amp; 3 \u0026amp; 2 \u0026amp; 2 \u0026amp; 3 \u0026amp; 2 \u0026amp; 1 \u0026amp; 0 \u0026amp; 1 \u0026amp; 3 \u0026amp; 3 \u0026amp; 2 \\end{array}\\right] $$ è¿™æ ·, æœ€ç»ˆçš„è®¡ç®—ç»“æœå°±å˜æˆäº†\n$F \\times C^{T}=\\left(\\left(H^{\\prime} \\times W^{\\prime}\\right) \\times(C \\times K \\times K)\\right) \\times\\left(C_{\\text {out }} \\times(C \\times K \\times K)\\right)^{T}=\\left(H^{\\prime} \\times W^{\\prime}\\right) \\times C_{\\text {out }}$\næ•´ä½“çš„æµç¨‹å¯ä»¥ç®€åŒ–ä¸º ä¸‹é¢ç”¨ä»£ç å®ç°ä¸Šé¢å·ç§¯è¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import torch from torch.nn.functional import unfold, fold x = torch.Tensor([[[[1, 2, 0], [1, 1, 3], [0, 2, 2]], [[0, 2, 1], [0, 3, 2], [1, 1, 0]], [[1, 2, 1], [0, 1, 3],[3, 3, 2]]]]) print(x.shape) weight = torch.Tensor([[[[1, 1], [2, 2]], [[1, 1], [1, 1]], [[0, 1], [1, 0]]], [[[1, 0], [0, 1]], [[2, 1], [2, 1]], [[1, 2], [2, 0]]]]) print(weight.shape) kernel_size = 2 F = unfold(x, kernel_size).transpose(1, 2) print(F) C = weight.view(weight.size(0), -1) print(C) # F x C\u0026#39; out_unf = F.matmul(C.t()) print(out_unf) out = fold(out_unf.transpose(1, 2), (2, 2), (1, 1)) print(out) print(out.shape) å¦‚æœæŠŠç‰¹å¾å›¾æŒ‰ç…§è¡Œä¼˜å…ˆå±•å¼€ä¸ºä¸€ç»´å‘é‡ï¼Œé‚£ä¹ˆå¯¹åº”çš„å·ç§¯æ“ä½œå¦‚ä¸‹ï¼š æ€»ç»“ä¸åˆ†æ è¾“å‡ºå±‚çš„èŠ‚ç‚¹å€¼å¹¶ä¸æ˜¯ç”±å…¨éƒ¨è¾“å…¥å±‚çš„èŠ‚ç‚¹å€¼ä¸æƒé‡ä¹˜ç§¯å’Œå¾—åˆ°ï¼Œè€Œåªæœ‰éƒ¨åˆ†è¾“å…¥èŠ‚ç‚¹å‚ä¸åˆ°è®¡ç®—ï¼›ä»å¦ä¸€çš„è§’åº¦å¯ä»¥å½“æˆæ˜¯æœ‰ä¸€éƒ¨åˆ†æƒé‡ä¸ºé›¶ã€‚ æœ‰å¤§é‡æƒé‡è¢«å…±äº«ï¼Œæœ‰å‡ ä¸ªæ»¤æ³¢å™¨å°±å…±äº«äº†å‡ å¥—æƒé‡å‚æ•°ï¼Œè¿™ç‚¹åŸå› åº”è¯¥æ˜¯ç©ºé—´å¹³ç§»ä¸å˜æ€§ï¼Œå³æŸä¸€åŒºåŸŸå’Œå¦ä¸€åŒºåŸŸå¹¶æ²¡æœ‰å·®åˆ«ã€‚ ä¸Šé¢å°†æ‰€æœ‰ç‰¹å¾å›¾æ‹‰æˆä¸€ç»´å‘é‡ï¼Œè¿™æ ·åªæ˜¯å’Œå…¨è¿æ¥å±‚åšå¯¹æ¯”ï¼Œå®é™…ä¸Šï¼Œå› ä¸ºå›¾åƒæ•°æ®å­˜åœ¨å¤šé€šé“ï¼Œä¾‹å¦‚ä¸€èˆ¬æƒ…å†µä¸‹çš„RGBä¸‰é€šé“å›¾åƒï¼Œæ¯ä¸ªé€šé“åŒ…å«ä¸€ä¸ªç»´åº¦çš„ä¿¡æ¯ï¼›å¦å¤–å›¾åƒä¸­åƒç´ ç‚¹ä¹‹é—´çš„ä½ç½®ä¿¡æ¯åœ¨äºŒç»´å›¾åƒä¸­å¯ä»¥æ›´å¥½çš„å‘ˆç°ï¼ˆç¼–ç ï¼‰ï¼Œè€Œæ‹‰æˆä¸€ç»´å‘é‡ä¼šä¸¢å¤±è¿™äº›ä¿¡æ¯ã€‚ ä»ä¿¡æ¯è®ºè§’åº¦æ¥è¯´ï¼Œä¸‰é€šé“å›¾åƒæ˜¯å¦æœ‰å›¾å½¢çš„ä¿¡æ¯å­˜åœ¨å†—ä½™ã€‚ å‚è€ƒï¼š å·ç§¯è®¡ç®—çš„åº•å±‚å®ç°\nYJangoçš„å·ç§¯ç¥ç»ç½‘ç»œ\næ›´æ–°è®°å½• è°ƒæ•´æ ¼å¼å’Œæ’ç‰ˆã€‚ â€”â€” 2022.07.19\n","date":"2021-10-22T15:15:50Z","permalink":"https://qiyueliuhuo.github.io/posts/%E5%8D%B7%E7%A7%AF%E8%AE%A1%E7%AE%97%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/","title":"å·ç§¯è®¡ç®—åº•å±‚å®ç°"},{"content":"C++ç¼–ç¨‹åŸºç¡€ Hello, world! 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #include \u0026lt;iostream\u0026gt; #include \u0026lt;stdlib.h\u0026gt; //ä½¿ç”¨atexit() using namespace std; void show1(void) { cout \u0026lt;\u0026lt; \u0026#34;first exit main()\u0026#34; \u0026lt;\u0026lt; endl; } void show2(void) { cout \u0026lt;\u0026lt; \u0026#34;second exit main()\u0026#34; \u0026lt;\u0026lt; endl; } int main(int argc, char* argv[]) { atexit(show1); atexit(show2); cout \u0026lt;\u0026lt; \u0026#34;Hello, world!\u0026#34; \u0026lt;\u0026lt; endl; system(\u0026#34;pause\u0026#34;); return 0; } /*æ‰“å° Hello, world! second exit main() first exit main() */ main å‡½æ•°å‰é¢çš„æ•°æ®ç±»å‹ int ä¸ void main å‡½æ•°çš„è¿”å›å€¼æ˜¯è¿”å›ç»™ä¸»è°ƒè¿›ç¨‹ï¼Œä½¿ä¸»è°ƒè¿›ç¨‹å¾—çŸ¥è¢«è°ƒç”¨ç¨‹åºçš„è¿è¡Œç»“æœã€‚\næ ‡å‡†è§„èŒƒä¸­è§„å®š main å‡½æ•°çš„è¿”å›å€¼ä¸º intï¼Œä¸€èˆ¬çº¦å®šè¿”å› 0 å€¼æ—¶ä»£è¡¨ç¨‹åºè¿è¡Œæ— é”™è¯¯ï¼Œå…¶å®ƒå€¼å‡ä¸ºé”™è¯¯å·ï¼Œä½†è¯¥çº¦å®šå¹¶éå¼ºåˆ¶ã€‚\nå¦‚æœç¨‹åºçš„è¿è¡Œç»“æœä¸éœ€è¦è¿”å›ç»™ä¸»è°ƒè¿›ç¨‹ï¼Œæˆ–ç¨‹åºå¼€å‘äººå‘˜ç¡®è®¤è¯¥çŠ¶æ€å¹¶ä¸é‡è¦ï¼Œæ¯”å¦‚æ‰€æœ‰å‡ºé”™ä¿¡æ¯å‡åœ¨ç¨‹åºä¸­æœ‰æ˜ç¡®æç¤ºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸å†™ main å‡½æ•°çš„è¿”å›å€¼ã€‚åœ¨ä¸€äº›æ£€æŸ¥ä¸æ˜¯å¾ˆä¸¥æ ¼çš„ç¼–è¯‘å™¨ä¸­ï¼Œæ¯”å¦‚ VC, VS ç­‰ï¼Œvoid ç±»å‹çš„ main æ˜¯å…è®¸çš„ã€‚ä¸è¿‡åœ¨ä¸€äº›æ£€æŸ¥ä¸¥æ ¼çš„ç¼–è¯‘å™¨ä¸‹ï¼Œæ¯”å¦‚ g++, åˆ™è¦æ±‚ main å‡½æ•°çš„è¿”å›å€¼å¿…é¡»ä¸º int å‹ã€‚\næ‰€ä»¥åœ¨ç¼–ç¨‹æ—¶ï¼ŒåŒºåˆ†ç¨‹åºè¿è¡Œç»“æœå¹¶ä»¥ int å‹è¿”å›ï¼Œæ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚\nmain å‡½æ•°æ‰§è¡Œå®Œåæ‰§è¡Œå…¶ä»–è¯­å¥ æœ‰æ—¶å€™éœ€è¦åœ¨ç¨‹åºé€€å‡ºæ—¶åšä¸€äº›è¯¸å¦‚é‡Šæ”¾èµ„æºçš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ç”¨ atexit() å‡½æ•°æ¥æ³¨å†Œç¨‹åºæ­£å¸¸ç»ˆæ­¢æ—¶è¦è¢«è°ƒç”¨çš„å‡½æ•°ã€‚\natexit() åœ¨ä¸€ä¸ªç¨‹åºä¸­æœ€å¤šå¯ä»¥æ³¨å†Œ32ä¸ªå¤„ç†å‡½æ•°ï¼Œè¿™äº›å¤„ç†å‡½æ•°çš„è°ƒç”¨é¡ºåºä¸æ³¨å†Œé¡ºåºç›¸åï¼Œå³åæ³¨å†Œçš„å‡½æ•°å…ˆè¢«è°ƒç”¨ã€‚\næœ‰å¿…è¦è¡¥å……ä¸€ä¸‹ï¼Œmainå‡½æ•°æ‰§è¡Œä¹‹å‰ä¼šåšä»€ä¹ˆï¼Ÿå…¨å±€å¯¹è±¡çš„æ„é€ å‡½æ•°ä¼šåœ¨mainå‡½æ•°ä¹‹å‰æ‰§è¡Œã€‚ä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 class C { public: C() { std::cout \u0026lt;\u0026lt; \u0026#34;call C()\u0026#34; \u0026lt;\u0026lt; std::endl; }; }; C c0; //å…¨å±€å˜é‡ int main() { std::cout \u0026lt;\u0026lt; \u0026#34;main() start\u0026#34; \u0026lt;\u0026lt; std::endl; C c1; // call C() return 0; } /** call C() main() start call C() */ mainå‡½æ•°ä¹‹å‰æ‰§è¡Œçš„æ“ä½œ mainå‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œä¸»è¦å°±æ˜¯åˆå§‹åŒ–ç³»ç»Ÿç›¸å…³èµ„æºï¼š\nè®¾ç½®æ ˆæŒ‡é’ˆ åˆå§‹åŒ–é™æ€staticå˜é‡å’Œglobalå…¨å±€å˜é‡ï¼Œå³.dataæ®µçš„å†…å®¹ å°†æœªåˆå§‹åŒ–éƒ¨åˆ†çš„å…¨å±€å˜é‡èµ‹åˆå€¼ï¼šæ•°å€¼å‹shortï¼Œintï¼Œlongç­‰ä¸º0ï¼Œboolä¸ºFALSEï¼ŒæŒ‡é’ˆä¸ºNULLç­‰ç­‰ï¼Œå³.bssæ®µçš„å†…å®¹ å…¨å±€å¯¹è±¡åˆå§‹åŒ–ï¼Œåœ¨mainä¹‹å‰è°ƒç”¨æ„é€ å‡½æ•° å°†mainå‡½æ•°çš„å‚æ•°argcï¼Œargvç­‰ä¼ é€’ç»™mainå‡½æ•°ï¼Œç„¶åæ‰çœŸæ­£è¿è¡Œmainå‡½æ•° \u0026ldquo;\\n\u0026rdquo; ä¸ endl çš„åŒºåˆ« åœ¨ C++ ä¸­ï¼Œç»ˆç«¯è¾“å‡ºæ¢è¡Œæ—¶ï¼Œç”¨cout\u0026lt;\u0026lt;......\u0026lt;\u0026lt; endl ä¸\u0026quot;\\n\u0026quot; éƒ½å¯ä»¥ï¼Œè¿™æ˜¯åˆçº§çš„è®¤è¯†ã€‚ä½†äºŒè€…æœ‰å°å°çš„åŒºåˆ«ï¼Œç”¨ endl æ—¶ä¼šåˆ·æ–°ç¼“å†²åŒºï¼Œä½¿å¾—æ ˆä¸­çš„ä¸œè¥¿åˆ·æ–°ä¸€æ¬¡ï¼Œä½†ç”¨ \u0026ldquo;\\n\u0026rdquo; ä¸ä¼šåˆ·æ–°ï¼Œå®ƒåªä¼šæ¢è¡Œï¼Œæ ˆå†…æ•°æ®æ²¡æœ‰å˜åŒ–ã€‚ä½†ä¸€èˆ¬æƒ…å†µï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯å¾ˆå°çš„ï¼Œå»ºè®®ç”¨ endl æ¥æ¢è¡Œã€‚\n1 std::cout \u0026lt;\u0026lt; std::endl; ç›¸å½“äº:\n1 std::cout \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39; \u0026lt;\u0026lt; std::flush; æˆ–è€…\n1 std::cout \u0026lt;\u0026lt; \u0026#39;\\n\u0026#39;; std::fflush(stdout); endl é™¤äº†å†™ '\\n' ä¹‹å¤–ï¼Œè¿˜è°ƒç”¨ flush å‡½æ•°ï¼Œåˆ·æ–°ç¼“å†²åŒºï¼ŒæŠŠç¼“å†²åŒºé‡Œçš„æ•°æ®å†™å…¥æ–‡ä»¶æˆ–å±å¹•ã€‚è€ƒè™‘æ•ˆç‡å°±ç”¨ '\\n'ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸åŠ endlå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½æ­£å¸¸è¾“å‡ºï¼Œæ˜¯å› ä¸ºåœ¨ç³»ç»Ÿè¾ƒä¸ºç©ºé—²æ—¶å€™ï¼Œä¼šæŸ¥çœ‹ç¼“å­˜åŒºçš„å†…å®¹ï¼Œå¦‚æœå‘ç°æ–°çš„å†…å®¹ï¼Œä¾¿è¿›è¡Œè¾“å‡ºã€‚ä½†æ˜¯ä½ å¹¶ä¸æ¸…æ¥šï¼Œç³»ç»Ÿä»€ä¹ˆæ—¶å€™è¾“å‡ºï¼Œä»€ä¹ˆæ—¶å€™ä¸è¾“å‡ºï¼Œä¸ç³»ç»Ÿè‡ªèº«çš„è¿è¡ŒçŠ¶å†µæœ‰å…³ã€‚è€Œåˆ·æ–°ç¼“å­˜åŒºï¼Œæ˜¯å¼ºåˆ¶æ€§çš„ï¼Œç»å¯¹æ€§çš„è¾“å‡ºï¼Œä¸å–å†³äºç³»ç»Ÿè¿è¡ŒçŠ¶å†µã€‚æ‰€ä»¥æ­£å¦‚ã€ŠC++ Primerã€‹ä¹¦ä¸­æ‰€å†™ï¼Œä¸ºäº†é¿å…å‡ºç°æ²¡æœ‰åˆ·æ–°è¾“å‡ºæµçš„æƒ…å†µå‘ç”Ÿï¼Œåœ¨ä½¿ç”¨æ‰“å°è¯­å¥æ¥è°ƒè¯•ç¨‹åºæ—¶ï¼Œä¸€å®šè¦åŠ å…¥ endlæˆ– flush æ“çºµç¬¦ã€‚\nè¿™é‡Œå¯èƒ½ä¼šæƒ³åˆ°ï¼Œä»¥åé‡åˆ°è¿™ç±»é—®é¢˜ï¼Œå¹²è„†ç›´æ¥éƒ½ä½¿ç”¨ endlï¼Œä¸ç”¨ \\n ä¸å°±å¥½äº†å—ï¼Ÿ\nä¹Ÿä¸æ˜¯ï¼Œè¦çŸ¥é“ï¼Œendlä¼šä¸åœåœ°åˆ·æ–°è¾“å‡ºæµï¼Œé¢‘ç¹çš„æ“ä½œä¼šé™ä½ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œè¿™ä¹Ÿæ˜¯C++æ ‡å‡†åº“å¯¹æµçš„è¾“å…¥/è¾“å‡ºæ“ä½œä½¿ç”¨ç¼“å†²åŒºçš„åŸå› ã€‚æ²¡æœ‰å¿…è¦åˆ·æ–°è¾“å‡ºæµçš„æ—¶å€™åº”å°½é‡ä½¿ç”¨ \\nï¼Œæ¯”å¦‚å¯¹äºæ— ç¼“å†²çš„æµ cerrï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ \\nã€‚\nå¤´æ–‡ä»¶é‡Œçš„ \u0026quot; \u0026quot; ä¸ \u0026lt; \u0026gt; \u0026lt;\u0026gt; é»˜è®¤å»ç³»ç»Ÿç›®å½•ä¸­æ‰¾å¤´æ–‡ä»¶ã€‚åƒæ ‡å‡†çš„ C å¤´æ–‡ä»¶ stdio.hã€stdlib.h å’Œ C++ å¤´æ–‡ä»¶ iostreamã€string ç­‰ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ \u0026quot; \u0026quot; é¦–å…ˆåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå†åˆ°ç³»ç»Ÿç›®å½•ä¸­å¯»æ‰¾ã€‚ è¿™ä¸ªç”¨äº include è‡ªå®šä¹‰çš„å¤´æ–‡ä»¶ï¼Œè®©ç³»ç»Ÿä¼˜å…ˆä½¿ç”¨å½“å‰ç›®å½•ä¸­å®šä¹‰çš„ã€‚\nå‘½åç©ºé—´ std æ‰€è°“åç§°ç©ºé—´å®ƒæ˜¯ä¸€ç§å°†åº“å‡½æ•°å°è£…èµ·æ¥çš„æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥é¿å…å’Œåº”ç”¨ç¨‹åºå‘ç”Ÿå‘½åå†²çªçš„é—®é¢˜ã€‚\nå¦‚æœæƒ³è¦ä½¿ç”¨ cinï¼Œcout è¿™ä¸¤ä¸ª iostreamå¯¹è±¡ï¼Œä¸ä»…è¦åŒ…å« \u0026lt;iostream\u0026gt; å¤´æ–‡ä»¶ï¼Œè¿˜å¾—è®©å‘½åç©ºé—´stdå†…çš„åç§°æ›å…‰ï¼Œå³ using namespace std;\nçœŸæ­£çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ å°½é‡é¿å…ä½¿ç”¨ using namespace std; ç­‰ç›´æ¥å¼•å…¥æ•´ä¸ªå‘½åç©ºé—´ï¼Œå¦åˆ™ä¼šå› ä¸ºå‘½åç©ºé—´æ±¡æŸ“å¯¼è‡´å¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜ï¼Œ æ¯”å¦‚è‡ªå·±å†™çš„æŸä¸ªå‡½æ•°ï¼Œåç§°æ­£å¥½å’Œ std ä¸­çš„ä¸€æ ·ï¼Œ ç¼–è¯‘å™¨ä¼šä¸çŸ¥é“ä½¿ç”¨å“ªä¸€ä¸ªï¼Œ å¼•èµ·ç¼–è¯‘æŠ¥é”™ï¼Œ å»ºè®®ä½¿ç”¨ç”±å‘½åç©ºé—´ç»„åˆèµ·æ¥çš„å…¨ç§°ï¼š std::cout \u0026lt;\u0026lt; \u0026quot;Hello World\u0026quot; \u0026lt;\u0026lt; std::endl;\nsystem(\u0026ldquo;pause\u0026rdquo;) åŒ…å«å¤´æ–‡ä»¶ stdlib.hï¼Œå¹¶åœ¨ä¸»ç¨‹åºä¸­åŠ å…¥ system(\u0026quot;pause\u0026quot;); å¯ä»¥åœ¨ç¨‹åºè¿è¡Œå®Œä»¥åä½¿é»‘æ¡†æš‚åœæ˜¾ç¤ºï¼Œç­‰å¾…è¾“å…¥ï¼Œè€Œä¸æ˜¯é—ªé€€ã€‚linuxç¯å¢ƒä¸‹è¿è¡Œè¯¥ç¨‹åºéœ€å»æ‰è¯¥è¯­å¥ã€‚\ncout ä¸ printf() cout æµé€Ÿåº¦è¾ƒæ…¢ï¼Œå¦‚æœé€Ÿåº¦è¿‡æ…¢å¯ä»¥ç”¨ \u0026lt;stdio.h\u0026gt; åº“ä¸­çš„ printf() æ ¼å¼åŒ–è¾“å‡ºå‡½æ•°ï¼Œä¸éœ€è¦ using namespace std;ã€‚ä½†æ³¨æ„ printf() ä¸­ä¸èƒ½ä½¿ç”¨ endlã€‚printf æ˜¯å‡½æ•°ã€‚coutæ˜¯ostreamå¯¹è±¡ï¼Œå’Œ \u0026laquo; é…åˆä½¿ç”¨ã€‚å¦‚æœ printf ç¢°åˆ°ä¸è®¤è¯†çš„ç±»å‹å°±æ²¡åŠæ³•äº†ï¼Œè€Œcoutå¯ä»¥é‡è½½è¿›è¡Œæ‰©å±•ã€‚\nmainå‡½æ•°ä¸å‘½ä»¤è¡Œå‚æ•° ä¸€ä¸ªç¨‹åºçš„main()å‡½æ•°å¯ä»¥åŒ…æ‹¬ä¸¤ä¸ªå‚æ•°\nç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ä¸ºintå‹ï¼› ç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²æ•°ç»„ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°å‘½åä¸ºargcï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºargvï¼ˆå½“ç„¶å‚æ•°åå­—å¯ä»¥æ¢ï¼‰ã€‚ç”±äºå­—ç¬¦ä¸²æ•°ç»„æœ‰ä¸¤ç§è¡¨è¾¾æ–¹å¼ï¼Œå› æ­¤ï¼Œmainå‡½æ•°å­˜åœ¨ä¸¤ç§ä¹¦å†™æ–¹æ³•ï¼š\n1 2 3 int main(int argc, char* argv[])//è¿™é‡Œä½¿ç”¨char* argv[] int main(int argc, char** argv)//è¿™é‡Œä½¿ç”¨char **argv int argcï¼šè¡¨ç¤ºå­—ç¬¦ä¸²çš„æ•°é‡ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ•°å­—ï¼Œç¨‹åºå‘˜ä¸ç”¨ç®¡ï¼Œåªéœ€è¦æ­£ç¡®ä½¿ç”¨å³å¯ã€‚è‹¥ç”¨æˆ·è¾“å…¥Nä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆargc= N + 1ï¼›å› ä¸º argv[0] ä¸ºç¨‹åºçš„è·¯å¾„ã€‚\nchar* argv[]ï¼šå­—ç¬¦ä¸²æ•°ç»„ï¼Œå³å¤šä¸ªå­—ç¬¦ä¸²ã€‚ä¸ºç”¨æˆ·è¾“å…¥çš„ä¸€ç³»åˆ—å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¹‹é—´ä»¥ç©ºæ ¼é—´éš”ï¼Œå½¢å¼ä¸ºï¼šstr1 str2 str3 åœ¨linuxä¸‹ï¼Œè‹¥å­˜åœ¨å¯æ‰§è¡Œæ–‡ä»¶a.outï¼Œåˆ™è¿è¡Œè¯¥ç¨‹åºå‘½ä»¤ä¸ºï¼š\n1 ./a.out str1 str2 str3 é¢„å¤„ç†ã€ç¼–è¯‘ä¸é“¾æ¥ é¢„å¤„ç†ï¼š é¢„å¤„ç†ä¹Ÿç§°ä¸ºé¢„ç¼–è¯‘ï¼Œå®ƒä¸ºç¼–è¯‘åšå‡†å¤‡å·¥ä½œï¼Œä¸»è¦è¿›è¡Œä»£ç æ–‡æœ¬çš„æ›¿æ¢ï¼Œç”¨äºå¤„ç†#å¼€å¤´çš„æŒ‡ä»¤ ã€‚\nç¼–è¯‘ï¼šç¼–è¯‘æ˜¯å°†ç¼–è¯‘å¥½çš„æºç¨‹åº*.cppæ–‡ä»¶ç¿»è¯‘æˆäºŒè¿›åˆ¶ç›®æ ‡ä»£ç çš„è¿‡ç¨‹ã€‚ç¼–è¯‘è¿‡ç¨‹æ˜¯ä½¿ç”¨C++æä¾›çš„ç¼–è¯‘ç¨‹åºå®Œæˆçš„ï¼Œè¯¥è¿‡ç¨‹ä¼šæ£€æŸ¥ç¨‹åºè¯­æ³•é”™è¯¯ã€å‡½æ•°å˜é‡çš„å£°æ˜æ˜¯å¦æ­£ç¡®ã€‚æ­£ç¡®çš„æºç¨‹åºæ–‡ä»¶ç»è¿‡ç¼–è¯‘åœ¨ç£ç›˜ä¸Šç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼ˆwindowsä¸Šæ˜¯*.objï¼Œlinuxä¸Šæ˜¯*.oï¼‰ã€‚\né“¾æ¥ï¼šé“¾æ¥å°†ç¼–è¯‘ç”Ÿæˆçš„å„ä¸ªç›®æ ‡ç¨‹åºæ¨¡å—ï¼ˆä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼‰åŠç³»ç»Ÿæˆ–è€…ç¬¬ä¸‰æ–¹æä¾›çš„åº“å‡½æ•°*.libé“¾æ¥åœ¨ä¸€èµ·ï¼Œç”Ÿæˆå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸Šç›´æ¥è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆwindowsä¸Šçš„*.exeï¼‰\nå®‰è£… g++\n1 sudo apt-get install g++ build-essential å°†æºæ–‡ä»¶hello.cppç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶hello\n1 g++ hello.cpp -o hello è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶\n1 ./hello å¦‚æœçœç•¥-o helloä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚ç”±äºå‘½ä»¤è¡Œä¸­æœªæŒ‡å®šå¯æ‰§è¡Œç¨‹åºçš„æ–‡ä»¶åï¼Œç¼–è¯‘å™¨é‡‡ç”¨é»˜è®¤çš„ a.outã€‚ç¨‹åºå¯ä»¥è¿™æ ·æ¥è¿è¡Œï¼š\n1 ./a.out å¦‚æœæ˜¯å¤šä¸ª C++ä»£ç æ–‡ä»¶ï¼Œå¦‚f1.cppï¼Œf2.cppï¼Œç¼–è¯‘å‘½ä»¤å¦‚ä¸‹ï¼š\n1 g++ f1.cpp f2.cpp -o myexec åˆ™ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºmyexecçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\né™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ è¦ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿…é¡»ç»å†ä¸¤ä¸ªé˜¶æ®µï¼Œå³ç¼–è¯‘ã€é“¾æ¥ã€‚\nåœ¨é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œé™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥å°±å‡ºç°äº†åŒºåˆ«ã€‚é™æ€é“¾æ¥çš„è¿‡ç¨‹å°±å·²ç»æŠŠè¦é“¾æ¥çš„å†…å®¹å·²ç»é“¾æ¥åˆ°äº†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå°±ç®—ä½ åœ¨å»æŠŠé™æ€åº“åˆ é™¤ä¹Ÿä¸ä¼šå½±å“å¯æ‰§è¡Œç¨‹åºçš„æ‰§è¡Œï¼›è€ŒåŠ¨æ€é“¾æ¥è¿™ä¸ªè¿‡ç¨‹å´æ²¡æœ‰æŠŠå†…å®¹é“¾æ¥è¿›å»ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå†å»æ‰¾è¦é“¾æ¥çš„å†…å®¹ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰è¦é“¾æ¥çš„å†…å®¹ï¼Œæ‰€ä»¥å½“ä½ åˆ é™¤åŠ¨æ€åº“æ—¶ï¼Œå¯æ‰§è¡Œç¨‹åºå°±ä¸èƒ½è¿è¡Œã€‚æ‰€ä»¥åŠ¨æ€é“¾æ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶è¦æ¯”é™æ€é“¾æ¥ç”Ÿæˆçš„æ–‡ä»¶è¦å°ä¸€äº›ã€‚\nå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š\né™æ€é“¾æ¥åº“æ‰§è¡Œé€Ÿåº¦æ¯”åŠ¨æ€é“¾æ¥åº“å¿«ã€‚ï¼ˆæ‰§è¡Œè¿‡ç¨‹ä¸éœ€è¦æ‰¾é“¾æ¥çš„å†…å®¹ï¼‰\nåŠ¨æ€é“¾æ¥åº“æ›´èŠ‚çœå†…å­˜ã€‚ï¼ˆæœªå†™å…¥è¦é“¾æ¥çš„å†…å®¹ï¼‰\næ·±å…¥æµ…å‡ºé™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥\niostream å¤´æ–‡ä»¶ å‡½æ•°å’Œæè¿° \u0026lt;iostream\u0026gt; è¯¥æ–‡ä»¶å®šä¹‰äº† cinã€coutã€cerr å’Œ clog å¯¹è±¡ï¼Œåˆ†åˆ«å¯¹åº”äºæ ‡å‡†è¾“å…¥æµã€æ ‡å‡†è¾“å‡ºæµã€éç¼“å†²æ ‡å‡†é”™è¯¯æµå’Œç¼“å†²æ ‡å‡†é”™è¯¯æµã€‚ \u0026lt;iomanip\u0026gt; è¯¥æ–‡ä»¶é€šè¿‡æ‰€è°“çš„å‚æ•°åŒ–çš„æµæ“çºµå™¨ï¼ˆæ¯”å¦‚ setw å’Œ setprecisionï¼‰ï¼Œæ¥å£°æ˜å¯¹æ‰§è¡Œæ ‡å‡†åŒ– I/O æœ‰ç”¨çš„æœåŠ¡ã€‚ \u0026lt;fstream\u0026gt; è¯¥æ–‡ä»¶ä¸ºç”¨æˆ·æ§åˆ¶çš„æ–‡ä»¶å¤„ç†å£°æ˜æœåŠ¡ã€‚ æ ‡å‡†è¾“å…¥æµ cin\n1 2 3 4 5 6 char name[50]; short age; cout \u0026lt;\u0026lt; \u0026#34;è¯·è¾“å…¥æ‚¨çš„åç§°ä¸å¹´é¾„ï¼š \u0026#34;; cin \u0026gt;\u0026gt; name \u0026gt;\u0026gt; age; //C++ ç¼–è¯‘å™¨æ ¹æ®è¦è¾“å…¥å€¼çš„æ•°æ®ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„æµæå–è¿ç®—ç¬¦æ¥æå–å€¼ï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åœ¨ç»™å®šçš„å˜é‡ä¸­ã€‚ //æµæå–è¿ç®—ç¬¦ \u0026gt;\u0026gt; åœ¨ä¸€ä¸ªè¯­å¥ä¸­å¯ä»¥å¤šæ¬¡ä½¿ç”¨ æ ‡å‡†è¾“å‡ºæµ cout\n1 2 char str[] = \u0026#34;Hello C++\u0026#34;; cout \u0026lt;\u0026lt; \u0026#34;Value of str is : \u0026#34; \u0026lt;\u0026lt; str \u0026lt;\u0026lt; endl; æ ‡å‡†é”™è¯¯æµ cerr\ncerr å¯¹è±¡é™„å±åˆ°æ ‡å‡†é”™è¯¯è®¾å¤‡ï¼Œé€šå¸¸ä¹Ÿæ˜¯æ˜¾ç¤ºå±ï¼Œä½†æ˜¯ cerr å¯¹è±¡æ˜¯éç¼“å†²çš„ï¼Œä¸”æ¯ä¸ªæµæ’å…¥åˆ° cerr éƒ½ä¼šç«‹å³è¾“å‡ºã€‚\n1 2 char str[] = \u0026#34;Unable to read....\u0026#34;; cerr \u0026lt;\u0026lt; \u0026#34;Error message : \u0026#34; \u0026lt;\u0026lt; str \u0026lt;\u0026lt; endl; æ ‡å‡†æ—¥å¿—æµ clog\nclog å¯¹è±¡é™„å±åˆ°æ ‡å‡†é”™è¯¯è®¾å¤‡ï¼Œé€šå¸¸ä¹Ÿæ˜¯æ˜¾ç¤ºå±ï¼Œä½†æ˜¯ clog å¯¹è±¡æ˜¯ç¼“å†²çš„ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæµæ’å…¥åˆ° clog éƒ½ä¼šå…ˆå­˜å‚¨åœ¨ç¼“å†²åœ¨ï¼Œç›´åˆ°ç¼“å†²å¡«æ»¡æˆ–è€…ç¼“å†²åŒºåˆ·æ–°æ—¶æ‰ä¼šè¾“å‡ºã€‚\n1 2 char str[] = \u0026#34;Unable to read....\u0026#34;; clog \u0026lt;\u0026lt; \u0026#34;Error message : \u0026#34; \u0026lt;\u0026lt; str \u0026lt;\u0026lt; endl; 1 2 3 4 5 6 7 8 #include \u0026lt;iostream\u0026gt; using namespace std; int main() { cout \u0026lt;\u0026lt; \u0026#34;cout\u0026#34; \u0026lt;\u0026lt; endl; cerr \u0026lt;\u0026lt; \u0026#34;cerr\u0026#34; \u0026lt;\u0026lt; endl; return 0; } linuxä¸‹å‘½ä»¤è¡Œè¾“å…¥ï¼š\n1 2 g++ main.cpp -o a ./a \u0026gt;\u0026gt; test.log ç»ˆç«¯è¾“å‡ºâ€œcerrâ€ï¼Œ\næ‰“å¼€test.logï¼Œé‡Œé¢åªæœ‰ä¸€è¡Œå­—ç¬¦ä¸²â€œcoutâ€ã€‚\ncouté»˜è®¤æƒ…å†µä¸‹æ˜¯åœ¨ç»ˆç«¯æ˜¾ç¤ºå™¨è¾“å‡ºï¼Œcoutæµåœ¨å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªç¼“å†²åŒºï¼Œç”¨æ¥å­˜æ”¾æµä¸­çš„æ•°æ®ï¼Œå½“å‘coutæµæ’å…¥ä¸€ä¸ªendlï¼Œä¸è®ºç¼“å†²åŒºæ˜¯å¦æ»¡äº†ï¼Œéƒ½ç«‹å³è¾“å‡ºæµä¸­æ‰€æœ‰æ•°æ®ï¼Œç„¶åæ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚coutå¯ä»¥è¢«é‡å®šå‘åˆ°æ–‡ä»¶ã€‚\ncerrä¸ç»è¿‡ç¼“å†²è€Œç›´æ¥è¾“å‡ºï¼Œä¸€èˆ¬ç”¨äºè¿…é€Ÿè¾“å‡ºå‡ºé”™ä¿¡æ¯ï¼Œæ˜¯æ ‡å‡†é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹è¢«å…³è”åˆ°æ ‡å‡†è¾“å‡ºæµï¼Œä½†å®ƒä¸è¢«ç¼“å†²ï¼Œä¹Ÿå°±è¯´é”™è¯¯æ¶ˆæ¯å¯ä»¥ç›´æ¥å‘é€åˆ°æ˜¾ç¤ºå™¨ï¼Œè€Œæ— éœ€ç­‰åˆ°ç¼“å†²åŒºæˆ–è€…æ–°çš„æ¢è¡Œç¬¦æ—¶ï¼Œæ‰è¢«æ˜¾ç¤ºã€‚ä¸è¢«é‡å®šå‘ã€‚\næœ‰æ—¶ç¨‹åºè°ƒç”¨å¯¼è‡´æ ˆè¢«ç”¨å®Œäº†ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨cout ä¼šå¯¼è‡´æ— å†…å­˜è¾“å‡ºã€‚ä½¿ç”¨cerr ä¼šåœ¨ä»»ä½•æƒ…å†µä¸‹è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ ä¸è¢«ç¼“å†²å°±æ˜¯ä½ æ‰“ä¸€ä¸ªå­—ç¬¦å°±é©¬ä¸Šåœ¨æ˜¾ç¤ºå™¨æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯ç­‰åˆ°endlæ‰æ‰“å°ã€‚ clogæµä¹Ÿæ˜¯æ ‡å‡†é”™è¯¯æµï¼Œä½œç”¨å’Œcerrä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºcerrä¸ç»è¿‡ç¼“å†²åŒºï¼Œç›´æ¥å‘æ˜¾ç¤ºå™¨è¾“å‡ºä¿¡æ¯ï¼Œè€Œclogä¸­çš„ä¿¡æ¯å­˜æ”¾åœ¨ç¼“å†²åŒºï¼Œç¼“å†²åŒºæ»¡æˆ–è€…é‡åˆ°endlæ—¶æ‰è¾“å‡ºã€‚clogç”¨çš„å°‘ã€‚\nå˜é‡ å‹¿æ··ç”¨å¸¦ç¬¦å·ç±»å‹å’Œæ— ç¬¦å·ç±»å‹ ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼ä¸­æ—¢æœ‰æ— ç¬¦å·åˆæœ‰æœ‰ç¬¦å·æ—¶ï¼Œå¦‚intï¼Œé‚£ä¸ªintå°±ä¼šè½¬æ¢ä¸ºæ— ç¬¦å·æ•°\n1 2 3 4 unsigned u = 10; int i = -42; std::cout \u0026lt;\u0026lt; i + i \u0026lt;\u0026lt; std::endl; // è¾“å‡º-84 std::cout \u0026lt;\u0026lt; u + i \u0026lt;\u0026lt; std::endl; // å¦‚æœintå 32ä½ï¼Œè¾“å‡º4294967264 æ— ç¬¦å·æ•°ä¸ä¼šå°äº0è¿™ä¸€äº‹å®å…³ç³»åˆ°å¾ªç¯çš„å†™æ³• ã€PRIMER 34ã€‘\n1 2 3 // WRONG: u can never be less than 0; the condition will always succeed for (unsigned u = 10; u \u0026gt;= 0; --u) std::cout \u0026lt;\u0026lt; u \u0026lt;\u0026lt; std::endl; å½“uç­‰äº0æ—¶ï¼Œ\u0026ndash;uçš„ç»“æœå°†ä¼šæ˜¯4294967295ã€‚ä¸€ç§è§£å†³åŠæ³•æ˜¯ç”¨whileè¯­å¥æ¥ä»£æ›¿forè¯­å¥ï¼Œå‰è€…å¯ä»¥åœ¨è¾“å‡ºå˜é‡å‰å…ˆå‡å»1ã€‚\n1 2 3 4 5 6 unsigned u = 11; // start the loop one past the first element we want to print while (u \u0026gt; 0) { --u; // decrement first, so that the last iteration will print 0 std::cout \u0026lt;\u0026lt; u \u0026lt;\u0026lt; std::endl; } åˆå§‹åŒ– åˆå§‹åŒ–ä¸ç­‰äºèµ‹å€¼ï¼ˆassignmentï¼‰ã€‚åˆå§‹åŒ–çš„å«ä¹‰æ˜¯åˆ›å»ºå˜é‡æ—¶èµ‹äºˆå…¶ä¸€ä¸ªåˆå§‹å€¼ï¼Œè€Œèµ‹å€¼çš„å«ä¹‰æ˜¯æŠŠå¯¹è±¡çš„å½“å‰å€¼æ“¦é™¤ï¼Œå†ç”¨ä¸€ä¸ªæ–°å€¼æ¥æ›¿ä»£ã€‚ã€PRIMER 39ã€‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 int a(5); // æ„é€ å‡½æ•°è¯­æ³•ï¼Œæ¯”å¦‚å¤æ•°éœ€è¦åˆå§‹åŒ–ä¸¤ä¸ªå€¼ complex\u0026lt;double\u0026gt; purei(0, 7); int b = 6; // C é£æ ¼çš„è¿ç®—ç¬¦ï¼ˆ=ï¼‰åˆå§‹åŒ– //å…³äºæŒ‡é’ˆ int arr[5] = {1, 2, 3, 4, 5}; int *p = arr; // åˆæ³•ï¼Œæ•°ç»„åå³é¦–åœ°å€ cout \u0026lt;\u0026lt; p[1] \u0026lt;\u0026lt; endl; // å¦‚æœè¦å¯¹æ•°ç»„æ±‚å€ï¼Œå°±éœ€è¦å®šä¹‰ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªåŒ…å«5ä¸ªå…ƒç´ çš„æ•°ç»„ int(*pa)[5] = \u0026amp;arr; cout \u0026lt;\u0026lt; \u0026#34;arr[0] = \u0026#34; \u0026lt;\u0026lt; **pa \u0026lt;\u0026lt; \u0026#34;, arr[2] = \u0026#34; \u0026lt;\u0026lt; (*pa)[2] \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;p[1] - [p0] = \u0026#34; \u0026lt;\u0026lt; pa[1] - pa[0] \u0026lt;\u0026lt; endl; // è¾“å‡ºï¼š // arr[0] = 1, arr[2] = 3 // p[1] - [p0] = 5ï¼Œè¡¨æ˜æ•°ç»„æŒ‡é’ˆåŒ…å« 5 ä¸ªå…ƒç´  vector\u0026lt;int\u0026gt; vec(arr, arr + 5); vector\u0026lt;int\u0026gt; *pv = \u0026amp;vec; // åˆæ³• //è€Œ vector\u0026lt;int\u0026gt; *pv = vec; ä¸åˆæ³•ï¼Œå› ä¸º vec æ˜¯ vector å‹å¯¹è±¡ï¼Œå®ƒçš„åå­—ä¸æ˜¯é¦–åœ°å€ cout \u0026lt;\u0026lt; vec[1] \u0026lt;\u0026lt; endl; // æ³¨æ„ä¸æ•°ç»„çš„å·®åˆ« new ä¸ vector å®šä¹‰å¤šç»´å˜é•¿æ•°ç»„å¹¶åˆå§‹åŒ–ï¼ŒæŸ¥çœ‹code\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #include \u0026lt;iostream\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; int main() { int row = 2; int col = 3; int **p = new int*[row]; for (int i = 0; i \u0026lt; row; ++i) { p[i] = new int[col]; for (int j = 0; j \u0026lt; col; ++j) { p[i][j] = i * col + j; } } for (int i = 0; i \u0026lt; row; ++i) for (int j = 0; j \u0026lt; col; ++j) printf(\u0026#34;p[%d][%d] = %d\\n\u0026#34;, i, j, p[i][j]); cout \u0026lt;\u0026lt; \u0026#34;--------------------\u0026#34; \u0026lt;\u0026lt; endl; int *p1 = new int[5]; // æœªåˆå§‹åŒ–ï¼Œ p æŒ‡å‘å« 5 çš„æ•´æ•°çš„å †å†…å­˜ç©ºé—´çš„é¦–åœ°å€ cout \u0026lt;\u0026lt; p1[0] \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; p1[1] \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; *p1 \u0026lt;\u0026lt; endl; int *p2 = new int(5); // åˆå§‹åŒ–ä¸€ä¸ªå€¼ï¼Œp æŒ‡å‘ä¸€ä¸ªæ•° cout \u0026lt;\u0026lt; p2[0] \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; p2[1] \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; *p2 \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;----------------------\u0026#34; \u0026lt;\u0026lt; endl; int a = 2, b = 2, c = 3; vector\u0026lt;vector\u0026lt;vector\u0026lt;int\u0026gt; \u0026gt; \u0026gt; v(a, vector\u0026lt;vector\u0026lt;int\u0026gt; \u0026gt;(b, vector\u0026lt;int\u0026gt;(c, 5))); for (int i = 0; i \u0026lt; v.size(); ++i) for (int j = 0; j \u0026lt; v[0].size(); ++j) for (int k = 0; k \u0026lt; v[0][0].size(); ++k) printf(\u0026#34;v[%d][%d][%d] = %d\\n\u0026#34;, i, j, k, v[i][j][k]); cout \u0026lt;\u0026lt; \u0026#34;-------------------------\u0026#34; \u0026lt;\u0026lt; endl; vector\u0026lt;int\u0026gt; v1(c, 6); vector\u0026lt;vector\u0026lt;int\u0026gt; \u0026gt;v2(b, v1); vector\u0026lt;vector\u0026lt;vector\u0026lt;int\u0026gt; \u0026gt; \u0026gt;v3(a, v2); for (int i = 0; i \u0026lt; v.size(); ++i) for (int j = 0; j \u0026lt; v[0].size(); ++j) for (int k = 0; k \u0026lt; v[0][0].size(); ++k) printf(\u0026#34;v3[%d][%d][%d] = %d\\n\u0026#34;, i, j, k, v3[i][j][k]); cout \u0026lt;\u0026lt; \u0026#34;-------------------------\u0026#34; \u0026lt;\u0026lt; endl; int* pmalloc = (int *)malloc(sizeof(int) * row * col); for (int i = 0; i \u0026lt; row; ++i) for (int j = 0; j \u0026lt; col; ++j) pmalloc[i * col + j] = i * col + j; for (int i = 0; i \u0026lt; row; ++i) for (int j = 0; j \u0026lt; col; ++j) printf(\u0026#34;pmalloc[%d * %d + %d] = %d\\n\u0026#34;, i, col, j, pmalloc[i * col + j]); free(pmalloc); } é€—å·è¡¨è¾¾å¼ 1 2 3 4 5 6 7 8 9 10 // ã€ä¾‹ 1ã€‘ cout \u0026lt;\u0026lt; a_string \u0026lt;\u0026lt; (cnt % line_size ? \u0026#39; \u0026#39; : \u0026#39;\\n\u0026#39;); // è‹¥æŸä¸€è¡Œè®¡æ•°ä¸è¶…è¿‡ line_sizeï¼Œå°±æ‰“å°ç©ºæ ¼ï¼Œå¦åˆ™æ¢è¡Œã€‚ç”¨æ¥é™åˆ¶æŸä¸€è¡Œå­—ç¬¦æ‰“å°çš„ä¸ªæ•° //ã€ESS 11ã€‘ // ã€ä¾‹ 2ã€‘ fun(f2(v1,v2),(v3,v4,v5),(v6,max(v7,v8))); // fun å‡½æ•°çš„å®å‚ä¸ªæ•°æœ‰å‡ ä¸ªï¼Ÿ // ç­”ï¼šä¸‰ä¸ªã€‚ // ç¬¬ä¸€ä¸ªæ˜¯ f2 çš„è¿”å›å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯é€—å·è¡¨è¾¾å¼(v3,v4,v5)çš„å€¼ï¼Œç¬¬ä¸‰ä¸ªæ˜¯é€—å·è¡¨è¾¾å¼(v6,max(v7,v8))çš„å€¼ã€‚ æŒ‡é’ˆ å¦‚æœæŒ‡é’ˆä¸æŒ‡å‘ä»»ä½•å¯¹è±¡ï¼Œåˆ™ã€æé¢†ã€‘æ“ä½œï¼ˆä¹Ÿå¯ç§°ä¸ºã€è§£å¼•ç”¨ã€‘ï¼Œå³å–æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼‰ä¼šå¯¼è‡´æœªçŸ¥çš„æ‰§è¡Œç»“æœã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œå¿…é¡»åœ¨æé¢†å‰ç¡®å®šå®ƒçš„ç¡®æŒ‡å‘æŸå¯¹è±¡ã€‚\nä¸€ä¸ªæœªæŒ‡å‘ä»»ä½•å¯¹è±¡çš„æŒ‡é’ˆï¼Œå…¶åœ°å€ä¸º0ï¼Œä¹Ÿè¢«ç§°ä¸º nullptr æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰é˜¶æ®µä¾¿åˆå§‹åŒ–æŒ‡é’ˆï¼Œä»¤å…¶å€¼ä¸º 0.\n1 2 3 4 5 int *p = 0; // åˆå§‹åŒ–æŒ‡é’ˆåœ°å€ä¸º0 if (p \u0026amp;\u0026amp; *p != 1024) // å¦‚æœ p åœ°å€ä¸ä¸ºé›¶ï¼Œæ‰èƒ½æœ‰ *p æ“ä½œ *p = 1024; // å½“ p çš„åœ°å€ä¸º 0ï¼Œç›´æ¥æé¢†ï¼Œä¼šæŠ¥é”™ //ã€ESS 28ã€‘ é‡æŒ‡é’ˆ æŒ‡çš„æ˜¯æ²¡æœ‰è¢«åˆå§‹åŒ–è¿‡çš„æŒ‡é’ˆã€‚æŒ‡é’ˆå˜é‡æœªåˆå§‹åŒ–æ—¶ä¸ä¼šè‡ªåŠ¨æˆä¸º nullptrï¼Œè€Œæ˜¯ä¸€ä¸ªéšæœºå€¼ã€‚\n1 2 3 4 5 int main() { int* p; // æœªåˆå§‹åŒ– std::cout\u0026lt;\u0026lt; *p \u0026lt;\u0026lt; std::endl; // æœªåˆå§‹åŒ–å°±è¢«ä½¿ç”¨ return 0; } å› æ­¤ï¼Œä¸ºäº†é˜²æ­¢å‡ºé”™ï¼Œå¯¹äºæŒ‡é’ˆåˆå§‹åŒ–æ—¶éƒ½æ˜¯èµ‹å€¼ä¸º nullptrï¼Œè¿™æ ·åœ¨ä½¿ç”¨æ—¶ç¼–è¯‘å™¨å°±ä¼šç›´æ¥æŠ¥é”™ï¼Œäº§ç”Ÿéæ³•å†…å­˜è®¿é—®ã€‚\næ‚¬ç©ºæŒ‡é’ˆ æ‚¬ç©ºæŒ‡é’ˆï¼ŒæŒ‡é’ˆæœ€åˆæŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾äº†çš„ä¸€ç§æŒ‡é’ˆã€‚ï¼ˆæŒ‡é’ˆæ“ä½œè¶…è¶Šå˜é‡çš„ä½œç”¨åŸŸï¼Œæ¯”å¦‚å‡½æ•°è¿”å›æ ˆå†…å­˜çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼‰\n1 2 3 4 5 6 int main() { int * p = nullptr; int* p2 = new int; p = p2; delete p2; } æ­¤æ—¶ på’Œp2å°±æ˜¯æ‚¬ç©ºæŒ‡é’ˆï¼ŒæŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾ã€‚ç»§ç»­ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆï¼Œè¡Œä¸ºä¸å¯é¢„æ–™ã€‚éœ€è¦è®¾ç½®ä¸ºp=p2=nullptrã€‚æ­¤æ—¶å†ä½¿ç”¨ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥ä¿é”™ã€‚\né‡æŒ‡é’ˆå’Œæ‚¬ç©ºæŒ‡é’ˆï¼Œæ— æ³•é€šè¿‡ç®€å•åœ°åˆ¤æ–­æ˜¯å¦ä¸º nullptr é¿å…ï¼Œæ‰€ä»¥è¦ä¹ æƒ¯åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼æˆ–ææ„æ—¶èµ‹ä¸ºnullptrã€‚\nvoid*æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŒ‡é’ˆç±»å‹ï¼Œå¯ä»¥å­˜æ”¾ä»»æ„å¯¹è±¡çš„åœ°å€ï¼Œä½†ä¸èƒ½ç›´æ¥æ“ä½œvoid*æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ã€‚\næŒ‡é’ˆä¸æ•°ç»„åçš„åŒºåˆ« ä¿®æ”¹å†…å®¹ä¸Šçš„å·®åˆ«ï¼š\n1 2 3 4 char a[] = \u0026#34;hello\u0026#34;; a[0] = \u0026#39;H\u0026#39;; char *p = \u0026#34;world\u0026#34;; // p æŒ‡å‘å¸¸é‡å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å­˜å‚¨åœ¨æ–‡å­—å¸¸é‡åŒºï¼Œä¸å¯æ›´æ”¹ // p[0] = \u0026#34;W\u0026#34; // æ‰€ä»¥è¿™ä¸ªèµ‹å€¼æœ‰é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 int main() { char a[] = \u0026#34;hello\u0026#34;; char *p = a; // è¿™æ ·è®©æŒ‡é’ˆæŒ‡å‘æ•°ç»„ aï¼Œè€Œéå¸¸é‡å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥ä¿®æ”¹äº† p[0] = \u0026#39;H\u0026#39;; a[1] = \u0026#39;E\u0026#39;; printf(\u0026#34;%d\u0026#34;, sizeof(p)); // 64 ä½æœºå™¨ std::cout \u0026lt;\u0026lt; p \u0026lt;\u0026lt; std::endl; return 0; } //è¾“å‡ºï¼š8HEllo sizeof\n1 2 3 4 5 6 7 8 sizeof(a); // è¾“å‡º6ï¼ŒåŒ…å« \u0026#39;\\0\u0026#39; sizeof(p); // 64 ä½æœºå™¨è¾“å‡º 8 /* æŒ‡é’ˆç±»å‹å¯¹è±¡å ç”¨å†…å­˜ä¸ºä¸€ä¸ªæœºå™¨å­—çš„é•¿åº¦ï¼š è¿™æ„å‘³ç€åœ¨16ä½cpuä¸Šæ˜¯16ä½ = 2å­—èŠ‚ 32ä½cpuä¸Šæ˜¯32ä½ = 4å­—èŠ‚ 64ä½cpuä¸Šå°±æ˜¯64ä½ä¹Ÿå°±æ˜¯8å­—èŠ‚äº† */ æ•°ç»„æŒ‡é’ˆä¸æŒ‡é’ˆæ•°ç»„ 1 2 3 4 5 6 7 8 9 10 11 12 13 type (*p)[]; // æ•°ç»„æŒ‡é’ˆ /* type a[]ï¼Œa æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…å…ƒç´ éƒ½æ˜¯ type ç±»å‹ï¼Œå°† a æ¢æˆ (*p)ï¼Œ å¯ä»¥ç†è§£ä¸º ï¼ˆ*pï¼‰æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…å…ƒç´ éƒ½æ˜¯ type ç±»å‹ï¼Œé‚£ä¹ˆ p å°±æ˜¯æŒ‡å‘è¿™æ ·çš„æ•°ç»„çš„æŒ‡é’ˆï¼Œå³æ•°ç»„æŒ‡é’ˆã€‚ */ type *p[]; // æŒ‡é’ˆæ•°ç»„ /* type *p[]å³(type *)p[]ï¼Œåˆ™ p æ˜¯ä¸€ä¸ª type* ç±»å‹çš„æ•°ç»„(ç±»æ¯”int a[10]ï¼Œa æ˜¯ int å‹æ•°ç»„ï¼‰ å³ p æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…å…ƒç´ éƒ½æ˜¯æŒ‡é’ˆï¼ˆ type *ï¼‰ */ // åœ¨åæ–‡çš„ä»‹ç»ä¸­ä½¿ç”¨å³å·¦æ³•åˆ™ï¼Œæ›´å®¹æ˜“ç†è§£ ç¨å¾®å¤æ‚ä¸€äº›çš„æŒ‡é’ˆæ•°ç»„ï¼š\n1 2 3 4 5 6 7 8 9 const int seq_cnt = 6; vector\u0026lt;int\u0026gt; *seq_addrs[seq_cnt] = { \u0026amp;fibonacci, \u0026amp;lucas, \u0026amp;pell, \u0026amp;triangular, \u0026amp;square, \u0026amp;pentagonal }; // seq_addrs æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨ vector\u0026lt;int\u0026gt; * å‹çš„æŒ‡é’ˆï¼Œ // seq_addrs[0] çš„å†…å®¹ä¸ºæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ fibonacciï¼Œ // è€Œ fibonacci çš„ç±»å‹ä¸º vector\u0026lt;int\u0026gt;ã€‚ //ã€ESS 29ã€‘ æŒ‡é’ˆå‡½æ•°ä¸å‡½æ•°æŒ‡é’ˆ æŒ‡é’ˆå‡½æ•°ï¼šè¿”å›ç±»å‹æ˜¯æŒ‡é’ˆçš„å‡½æ•°ï¼Œå¦‚\n1 2 3 4 5 6 char *StrCat(char *ptr1, char *ptr2) { char *p; do something; return p; } å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå¦‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #include \u0026lt;stdio.h\u0026gt; int max(int x, int y) { return x \u0026gt; y? x: y; } int main() { // int max(int x, int y); int (*ptr)(int, int); ptr = max; int max_num = (*ptr)(12, 18); // int max_num = ptr(12, 18);ä¹Ÿæ˜¯å¯¹çš„ printf(\u0026#34;%d\u0026#34;, max_num); return 0; } // æ‰“å° 18ã€‚ 1 2 int (*ptr)(); // â€œ()â€ è¡¨æ˜è¯¥æŒ‡é’ˆæŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼ä¸º int int (*ptr)[3]; // â€œ[]â€ è¡¨æ˜è¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ç»´æ•°ç»„ï¼Œè¯¥æ•°ç»„é‡ŒåŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯intç±»å‹ã€‚ æ•°ç»„åæŒ‡å‘äº†å†…å­˜ä¸­ä¸€æ®µè¿ç»­çš„å­˜å‚¨åŒºåŸŸï¼Œå¯ä»¥é€šè¿‡æ•°ç»„åçš„æŒ‡é’ˆå½¢å¼å»è®¿é—®ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªç›¸åŒç±»å‹çš„æŒ‡é’ˆå˜é‡æŒ‡å‘è¿™æ®µå†…å­˜çš„èµ·å§‹åœ°å€ï¼Œä»è€Œé€šè¿‡æŒ‡é’ˆå˜é‡å»å¼•ç”¨æ•°ç»„å…ƒç´ ã€‚\næ¯ä¸€ä¸ªå‡½æ•°å ç”¨ä¸€æ®µå†…å­˜åŒºåŸŸï¼Œè€Œå‡½æ•°åå°±æ˜¯æŒ‡å‘å‡½æ•°æ‰€å å†…å­˜åŒºçš„èµ·å§‹åœ°å€çš„å‡½æ•°æŒ‡é’ˆï¼ˆåœ°å€å¸¸é‡ï¼‰ï¼Œæ•…å‡½æ•°æŒ‡é’ˆè§£å¼•ç”¨ä¸ä¸è§£å¼•ç”¨æ²¡æœ‰åŒºåˆ« ã€‚é€šè¿‡å¼•ç”¨å‡½æ•°åè¿™ä¸ªå‡½æ•°æŒ‡é’ˆè®©æ­£åœ¨è¿è¡Œçš„ç¨‹åºè½¬å‘è¯¥å…¥å£åœ°å€æ‰§è¡Œå‡½æ•°çš„å‡½æ•°ä½“ï¼Œä¹Ÿå¯ä»¥æŠŠå‡½æ•°çš„å…¥å£åœ°å€èµ‹ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä½¿è¯¥æŒ‡é’ˆå˜é‡æŒ‡å‘è¯¥å‡½æ•°ã€‚\nå¤æ‚æŒ‡é’ˆå£°æ˜ å‡½æ•°æŒ‡é’ˆæ•°ç»„\n1 2 3 4 const vector\u0026lt;int\u0026gt;* (*seq_array[])(int) = { fibon_seq, lucas_seq, pell_seq, triang_seq, square_seq, pent_seq }; seq_array æ˜¯ä¸€ä¸ªå¯ä»¥æŒæœ‰å…­ä¸ªå‡½æ•°æŒ‡é’ˆçš„æŒ‡é’ˆæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘å‡½æ•° fibon_seq()ï¼Œè¯¥å‡½æ•°åŸå‹ä¸º const vector\u0026lt;int\u0026gt; *fibon_seq(int);ã€‚\nã€ESS 62ã€‘\nè§£è¯»å¤æ‚æŒ‡é’ˆä½¿ç”¨å³å·¦æ³•åˆ™ï¼šé¦–å…ˆä»æœªå®šä¹‰çš„æ ‡è¯†ç¬¦æ‰€åœ¨çš„åœ†æ‹¬å·çœ‹èµ·ï¼Œç„¶åå¾€å³çœ‹ï¼Œå†å¾€å·¦çœ‹ã€‚æ¯å½“é‡åˆ°åœ†æ‹¬å·å°±è°ƒè½¬é˜…è¯»æ–¹å‘ã€‚ä¸€æ—¦è§£æå®Œåœ†æ‹¬å·é‡Œçš„ä¸œè¥¿ï¼Œå°±è·³å‡ºåœ†æ‹¬å·ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ•´ä¸ªå£°æ˜è§£æå®Œæ¯•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 int (*func)(int *p, int (*f)(int*)); // funcå·¦è¾¹æœ‰ä¸€ä¸ª*è¡¨æ˜funcæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè·³å‡ºåœ†æ‹¬å·çœ‹å³è¾¹ï¼Œå³è¾¹æœ‰æ‹¬å·ï¼Œè¯´æ˜funcæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œ // æŒ‡å‘çš„å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå½¢å‚ï¼Œåˆ†åˆ«æ˜¯æ•´å‹æŒ‡é’ˆ int * å’Œå‡½æ•°æŒ‡é’ˆ int (*f)(int*)ï¼Œè¿”å›å€¼ä¸º intã€‚ int (*func[5])(int *p); // func æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå«5ä¸ªå…ƒç´ ï¼Œå·¦è¾¹*å·ï¼Œè¡¨æ˜ func æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼ˆç”±äº[]ä¼˜å…ˆçº§é«˜äº*ï¼Œfuncå…ˆè·Ÿ[]ç»“åˆï¼Œç„¶å*ä¿®é¥°func[5]ï¼Œæ•…è¯¥æ•°ç»„çš„å…ƒç´ éƒ½æ˜¯æŒ‡é’ˆï¼‰ã€‚ //å†å¾€å³çœ‹ï¼Œæ˜¯æ‹¬å·ï¼Œè¯´æ˜ func é‡Œçš„æŒ‡é’ˆæ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å‡½æ•°æ¥æ”¶ int * å‹å‚æ•°å¹¶è¿”å› intã€‚ int (*(*func)[5])(int *p); // func æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å«æœ‰ 5 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ•°ç»„é‡Œçš„å…ƒç´ éƒ½æ˜¯æŒ‡é’ˆï¼Œè€Œä¸”éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œ // å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°æ¥æ”¶ int * å‹å½¢å‚å¹¶è¿”å› intã€‚ int (*(*func)(int *p))[5]; // func æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ int * å‹å‚æ•°è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œ // è¿”å›çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„å«æœ‰ 5 ä¸ªå…ƒç´ ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ int å‹ã€‚ æŒ‡é’ˆ(pointer)ä¸å¼•ç”¨(reference) 1 2 3 int ival = 1024; int *pi = \u0026amp;ival; // pointer int \u0026amp;rval = ival; // reference å¼•ç”¨æ˜¯åˆ«åï¼Œè€ŒæŒ‡é’ˆæ˜¯åœ°å€ã€‚æŒ‡é’ˆå¯ä»¥è¢«èµ‹å€¼ï¼Œä»¥æŒ‡å‘å¦ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œè€Œå¼•ç”¨åªèƒ½åœ¨å®šä¹‰æ—¶è¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä»¥åä¸èƒ½ä¿®æ”¹ï¼Œä½†å¼•ç”¨çš„é‚£ä¸ªå¯¹è±¡å†…å®¹å´å¯ä»¥æ”¹å˜ã€‚å¯ä»¥æŠŠå¼•ç”¨ç†è§£ä¸ºæŒ‡é’ˆå¸¸é‡ï¼Œè€Œæ™®é€šæŒ‡é’ˆä¸ºæŒ‡é’ˆå˜é‡ã€‚\nå¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼ŒæŒ‡é’ˆå¯ä»¥ä¸ºç©ºã€‚æ•…åœ¨ä½¿ç”¨ä¸Šï¼ŒæŒ‡é’ˆå¯èƒ½ï¼ˆä¹Ÿå¯èƒ½ä¸ï¼‰æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œæé¢†æ—¶ä¸€å®šè¦å…ˆç¡®å®šå…¶å€¼é 0ã€‚è€Œå¼•ç”¨ï¼Œåˆ™å¿…å®šä¼šä»£è¡¨æŸä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½œæ­¤æ£€æŸ¥ã€‚\nä»å†…å­˜åˆ†é…ä¸Šæ¥çœ‹ï¼Œç¨‹åºä¸ºæŒ‡é’ˆå˜é‡åˆ†é…å†…å­˜åŒºåŸŸï¼Œè€Œä¸ä¸ºå¼•ç”¨åˆ†é…å†…å­˜åŒºåŸŸã€‚\nå¼•ç”¨ä½¿ç”¨æ—¶æ— éœ€è§£å¼•ç”¨(*)ï¼ŒæŒ‡é’ˆéœ€è¦è§£å¼•ç”¨ï¼›\nå¼•ç”¨æ²¡æœ‰ constï¼ŒæŒ‡é’ˆæœ‰ constï¼›\nâ€œsizeof å¼•ç”¨â€ å¾—åˆ°çš„æ˜¯æ‰€æŒ‡å‘çš„å˜é‡(å¯¹è±¡)çš„å¤§å°ï¼Œè€Œ â€œsizeof æŒ‡é’ˆâ€ å¾—åˆ°çš„æ˜¯æŒ‡é’ˆæœ¬èº«çš„å¤§å°ï¼›\næŒ‡é’ˆå¯ä»¥æœ‰å¤šçº§ï¼Œä½†æ˜¯å¼•ç”¨åªèƒ½æ˜¯ä¸€çº§ï¼ˆint **pï¼›åˆæ³• è€Œ int \u0026amp;\u0026amp;aæ˜¯ä¸åˆæ³•çš„ï¼‰\næŒ‡é’ˆå’Œå¼•ç”¨çš„è‡ªå¢(++)è¿ç®—æ„ä¹‰ä¸ä¸€æ ·ï¼›\n1 2 3 4 5 6 int a = 0; int \u0026amp;b = a; int *p = \u0026amp;a; b++; // ç›¸å½“äº a++; b åªæ˜¯ a çš„ä¸€ä¸ªåˆ«åï¼Œå’Œ a ä¸€æ ·ä½¿ç”¨ã€‚ p++; // p æŒ‡å‘ a åé¢çš„å†…å­˜ (*p)++; // ç›¸å½“äº a++ ï¼ˆåœ¨äºŒè¿›åˆ¶å±‚é¢ï¼Œå¼•ç”¨ä¸€èˆ¬æ˜¯é€šè¿‡æŒ‡é’ˆæ¥å®ç°çš„ï¼Œåªä¸è¿‡ç¼–è¯‘å™¨å¸®æˆ‘ä»¬å®Œæˆäº†è½¬æ¢ã€‚æ€»çš„æ¥è¯´ï¼Œå¼•ç”¨æ—¢å…·æœ‰æŒ‡é’ˆçš„æ•ˆç‡ï¼Œåˆå…·æœ‰å˜é‡ä½¿ç”¨çš„æ–¹ä¾¿æ€§å’Œç›´è§‚æ€§ã€‚ï¼‰\nã€ESS 46ï¼Œ47ã€‘\nå¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•° ä¼ é€’å¼•ç”¨ç»™å‡½æ•°ä¸ä¼ é€’æŒ‡é’ˆç»™å‡½æ•°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚è¿™æ—¶ï¼Œè¢«è°ƒå‡½æ•°çš„å½¢å‚å°±æˆä¸ºåŸæ¥ä¸»è°ƒå‡½æ•°ä¸­çš„å®å‚å˜é‡æˆ–å¯¹è±¡çš„ä¸€ä¸ªåˆ«åæ¥ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨è¢«è°ƒå‡½æ•°ä¸­å¯¹å½¢å‚å˜é‡çš„æ“ä½œå°±æ˜¯å¯¹å…¶ç›¸åº”çš„ç›®æ ‡å¯¹è±¡ï¼ˆåœ¨ä¸»è°ƒå‡½æ•°ä¸­ï¼‰çš„æ“ä½œã€‚\nä½¿ç”¨å¼•ç”¨ä¼ é€’å‡½æ•°çš„å‚æ•°ï¼Œåœ¨å†…å­˜ä¸­å¹¶æ²¡æœ‰äº§ç”Ÿå®å‚çš„å‰¯æœ¬ï¼Œå®ƒæ˜¯ç›´æ¥å¯¹å®å‚æ“ä½œï¼›è€Œä½¿ç”¨ä¸€èˆ¬å˜é‡ä¼ é€’å‡½æ•°çš„å‚æ•°ï¼Œå½“å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œéœ€è¦ç»™å½¢å‚åˆ†é…ä¸´æ—¶å­˜å‚¨å•å…ƒï¼Œå½¢å‚å˜é‡æ˜¯å®å‚å˜é‡çš„å‰¯æœ¬ï¼›å¦‚æœä¼ é€’çš„æ˜¯å¯¹è±¡ï¼Œè¿˜å°†è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œå½“å‚æ•°ä¼ é€’çš„æ•°æ®è¾ƒå¤§æ—¶ï¼Œç”¨å¼•ç”¨æ¯”ç”¨ä¸€èˆ¬å˜é‡ä¼ é€’å‚æ•°çš„æ•ˆç‡å’Œæ‰€å ç©ºé—´éƒ½å¥½ã€‚\nä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‡½æ•°çš„å‚æ•°è™½ç„¶ä¹Ÿèƒ½è¾¾åˆ°ä¸ä½¿ç”¨å¼•ç”¨çš„æ•ˆæœï¼Œä½†æ˜¯ï¼Œåœ¨è¢«è°ƒå‡½æ•°ä¸­åŒæ ·è¦ç»™å½¢å‚åˆ†é…å­˜å‚¨å•å…ƒï¼Œä¸”éœ€è¦é‡å¤ä½¿ç”¨ \u0026ldquo;*æŒ‡é’ˆå˜é‡å\u0026rdquo; çš„å½¢å¼è¿›è¡Œè¿ç®—ï¼Œè¿™å¾ˆå®¹æ˜“äº§ç”Ÿé”™è¯¯ä¸”ç¨‹åºçš„å¯è¯»æ€§è¾ƒå·®ï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¸»è°ƒå‡½æ•°çš„è°ƒç”¨ç‚¹å¤„ï¼Œå¿…é¡»ç”¨å˜é‡çš„åœ°å€ä½œä¸ºå®å‚ã€‚è€Œå¼•ç”¨æ›´å®¹æ˜“ä½¿ç”¨ï¼Œæ›´æ¸…æ™°ã€‚\nå¸¸å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•° å¦‚æœæ—¢è¦åˆ©ç”¨å¼•ç”¨æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œåˆè¦ä¿æŠ¤ä¼ é€’ç»™å‡½æ•°çš„æ•°æ®ä¸åœ¨å‡½æ•°ä¸­è¢«æ”¹å˜ï¼Œå°±åº”ä½¿ç”¨å¸¸å¼•ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 void foo(const string \u0026amp;s) { cout \u0026lt;\u0026lt; s \u0026lt;\u0026lt; endl; } // å¦‚æœå½¢å‚é‡Œçš„ const å»æ‰ï¼Œç¨‹åºå°±æŠ¥é”™ï¼Œ // å› ä¸º ss ä¸ \u0026#34;world!\u0026#34; éƒ½æ˜¯å¸¸é‡ï¼Œä½ ä¸èƒ½æŠŠä¸€ä¸ª const ç±»å‹è½¬æ¢æˆé const ç±»å‹ã€‚ // æ‰€ä»¥ foo() å½¢å‚å¿…å®šè¦ç”¨ const ä¿®é¥°ã€‚ int main() { const string ss(\u0026#34;hello \u0026#34;); foo(ss); foo(\u0026#34;world!\u0026#34;); } å¯¹äºå¸¸é‡ç±»å‹çš„å˜é‡ï¼Œå…¶å¼•ç”¨ä¹Ÿå¿…é¡»æ˜¯å¸¸é‡ç±»å‹çš„ï¼›å¯¹äºéå¸¸é‡ç±»å‹çš„å˜é‡ï¼Œå…¶å¼•ç”¨å¯ä»¥æ˜¯éå¸¸é‡çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¸¸é‡çš„ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µéƒ½ä¸èƒ½ä½¿ç”¨å¸¸é‡å¼•ç”¨ä¿®æ”¹å…¶å¼•ç”¨çš„å˜é‡çš„å€¼ã€‚\nå‡½æ•°è¿”å›å¼•ç”¨ä¸è¿”å›å€¼ è¿”å›å¼•ç”¨çš„å¥½å¤„ï¼šåœ¨å†…å­˜ä¸­ä¸äº§ç”Ÿè¢«è¿”å›å€¼çš„å‰¯æœ¬ã€‚\nåŒæ—¶æ³¨æ„ï¼Œæ­£æ˜¯å› ä¸ºè¿™ç‚¹åŸå› ï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ªå±€éƒ¨å˜é‡çš„å¼•ç”¨æ˜¯ä¸å¯å–çš„ã€‚å› ä¸ºéšç€è¯¥å±€éƒ¨å˜é‡ç”Ÿå­˜æœŸçš„ç»“æŸï¼Œç›¸åº”çš„å¼•ç”¨ä¹Ÿä¼šå¤±æ•ˆï¼Œäº§ç”Ÿ runtime error!\nã€æ³¨æ„ã€‘\næœ€å¥½ä¸è¦è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨ï¼› æœ€å¥½ä¸è¦è¿”å›å‡½æ•°å†…éƒ¨ new åˆ†é…çš„å†…å­˜çš„å¼•ç”¨ï¼› æµæ“ä½œç¬¦é‡è½½è¿”å›å€¼åº”ä¸ºå¼•ç”¨ï¼› å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡çš„è¿”å›å€¼å¯ä»¥æ˜¯å¼•ç”¨ï¼› å¯ä»¥è¿”å›ç±»æˆå‘˜çš„å¼•ç”¨ï¼› æŒ‡é’ˆè¿ç®— *\u0026amp;på’Œ\u0026amp;*p \u0026amp;ï¼šå–å‡ºå˜é‡çš„å­˜å‚¨åœ°å€ã€‚å¯¹æŒ‡é’ˆå˜é‡ pï¼Œ\u0026amp;p å–æŒ‡é’ˆå˜é‡ p æ‰€å ç”¨å†…å­˜çš„åœ°å€ï¼Œå¯ä»¥è¯´æ˜¯äºŒçº§æŒ‡é’ˆã€‚ *ï¼šå¼•ç”¨æŒ‡é’ˆæ‰€æŒ‡å‘å•å…ƒçš„å†…å®¹ã€‚ 1 2 3 4 1ã€*\u0026amp;p ç­‰ä»·äº*(\u0026amp;p) 2ã€\u0026amp;*p ç­‰ä»·äº\u0026amp;(*p) p æ˜¯ int å˜é‡ï¼Œé‚£ä¹ˆ *\u0026amp;p = pï¼Œè€Œ \u0026amp;*p æ˜¯éæ³•çš„ã€‚å› ä¸º *p éæ³• p æ˜¯ int* å˜é‡ï¼Œé‚£ä¹ˆ *\u0026amp;p = pï¼Œ\u0026amp;*p = pï¼Œéƒ½æ˜¯ p p+(æˆ–-)n æŒ‡é’ˆåŠ å‡ä¸€ä¸ªæ•°ï¼Œæ˜¯æŒ‡è¯¥æŒ‡é’ˆä¸Šç§»æˆ–ä¸‹ç§»nä¸ªæ•°æ®ä¹‹åçš„å†…å­˜åœ°å€ã€‚å³ï¼š\n1 p +(æˆ–-) n * sizeof(type); *p++ï¼Œ*(p++)ï¼Œ (*p)++ï¼Œ*++pï¼Œ++*p *p++ å’Œ *(p++) æ²¡æœ‰åŒºåˆ«ï¼Œå› ä¸º ++ åœ¨å˜é‡ä¹‹åï¼Œè¿ç®—å¾—å…ˆç”¨å†è‡ªå¢ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œ*pï¼Œpå†è‡ªå¢ã€‚è¿™åˆä¸ (*p)++ æœ‰åŒºåˆ«ï¼Œè¿™é‡Œé¢å…ˆ *pï¼Œ*p å†è‡ªå¢è€Œä¸æ˜¯ p è‡ªå¢ã€‚\n1 2 3 4 5 // ä¸€ä¸ª ++ åœ¨å˜é‡åï¼Œå…ˆç”¨å†è‡ªå¢çš„ä¾‹å­ã€‚ int a = 3; int b = 3; printf(\u0026#34;%d\u0026#34;,a++); //æ‰“å°3,ä½†aå€¼å·²ç»å˜æˆ4äº†ã€‚å…ˆç”¨aï¼Œaå†è‡ªå¢ï¼Œæ‰€ä»¥å°±æ˜¯å…ˆæ‰“å°3,æ‰“å°å®Œå†è‡ªå¢ã€‚ printf(\u0026#34;%d\u0026#34;,++b); //å…ˆè‡ªå¢ï¼Œè‡ªå¢å®Œï¼Œå†ç”¨ã€‚ *++p ç­‰ä»·äº *(++p)ï¼Œp å…ˆè‡ªå¢ï¼Œè‡ªå¢å®Œåå†å– *p çš„å€¼ï¼Œå³å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œè€Œä¸æ˜¯å½“å‰å…ƒç´ ã€‚ ++*pï¼Œ*pè‡ªå¢ã€‚\ni++ ä¸ ++i çš„æ•ˆç‡ å¯¹äºå†…ç½®æ•°æ®ç±»å‹ï¼Œä¸¤è€…å·®åˆ«ä¸å¤§ï¼› å¯¹äºè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼ˆå¦‚ç±»ï¼‰ï¼Œ++i è¿”å›å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œ i++ è¿”å›å¯¹è±¡çš„å€¼ï¼Œå¯¼è‡´è¾ƒå¤§çš„å¤åˆ¶å¼€é”€ï¼Œå› æ­¤æ•ˆç‡ä½ã€‚ å‰ç¼€++å’Œåç¼€++çš„åŸå‹ä¸ºï¼šã€PRIMER 501ã€‘\n1 2 3 // class C; C\u0026amp; C::operator++(); // å‰ç¼€è¿ç®—ç¬¦è¿”å›é€’å¢æˆ–é€’å‡åå¯¹è±¡çš„å¼•ç”¨ C C::operator++(int); // åç¼€è¿ç®—ç¬¦è¿”å›å¯¹è±¡çš„å€¼ã€‚ä¸ºäº†ä¸å‰ç¼€è¿ç®—ç¬¦ä½œåŒºåˆ†ï¼Œåç¼€ç‰ˆæœ¬æ¥å—ä¸€ä¸ªï¼ˆä¸è¢«ä½¿ç”¨ï¼Œç¼–è¯‘å™¨é»˜è®¤è®¾ä¸º0ï¼‰intç±»å‹çš„å½¢å‚ã€‚ sizeof sizeof è®¡ç®—æ™®é€šå˜é‡ä¸æŒ‡é’ˆæ‰€å ç©ºé—´çš„å¤§å° 1 2 3 4 5 6 7 8 9 10 // åœ¨32 ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œç”¨ sizeof è®¡ç®—ä¸‹åˆ—å˜é‡æ‰€å ç©ºé—´çš„å¤§å° // 32ä½ï¼Œchar:1ï¼Œshort:2, int:4ï¼Œlong:4 char str[] = \u0026#34;hello\u0026#34;; // 6 char *p = str; // 4 int n = 10; // 4 void fun(char str[100]) { sizeof(str);\t// 4ï¼Œå‡½æ•°å½¢å‚å¯¹ä¼ å…¥çš„æ•°ç»„æ˜¯æŒ‰ç…§æŒ‡é’ˆå¤„ç†çš„ï¼Œåœ¨å‡½æ•°ä½“å†…å¯ä»¥é€šè¿‡ä¿®æ”¹ str ä¿®æ”¹å‡½æ•°å¤–çš„æ•°ç»„ } void *p = malloc(100);\t// 4, p æŒ‡å‘ 100 ä¸ªå­—èŠ‚çš„å †å†…å­˜ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯æŒ‡é’ˆã€‚ sizeof è®¡ç®—ç©ºç±»çš„å¤§å° 1 2 3 class A {}; cout \u0026lt;\u0026lt; sizeof(A) \u0026lt;\u0026lt; endl;\t// 1 // ç©ºç±»ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ï¼Œæœ¬æ¥æ±‚ sizeof çš„æ—¶å€™åº”è¯¥æ˜¯ 0ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å£°æ˜è¯¥ç±»å‹çš„å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒå¿…é¡»åœ¨å†…å­˜ä¸­å ç”¨ç©ºé—´ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚è‡³äºå å¤šå°‘ç©ºé—´ç”±ç¼–è¯‘å™¨æ¥å†³å®šï¼Œä½¿ç”¨ gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) ç¼–è¯‘æ‰“å° 1ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 class A { public: A() {}; ~A() {}; // virtual void f() {}; //ã€1ã€‘ // static int a; // ã€2ã€‘ }; cout \u0026lt;\u0026lt; sizeof(A) \u0026lt;\u0026lt; endl; // æ³¨é‡Šã€1ã€‘ã€2ã€‘ï¼Œæ— è™šå‡½æ•°ï¼Œä¾æ—§å ç”¨ç©ºé—´ 1 å­—èŠ‚ // åªæ³¨é‡Šã€1ã€‘ï¼Œå› ä¸º static å˜é‡ä¸å±äºç±»ï¼Œä¸”æ— è™šå‡½æ•°ï¼Œä¾æ—§å ç”¨ç©ºé—´ 1 å­—èŠ‚ // å¦‚æœå»æ‰ã€1ã€‘å¤„æ³¨é‡Šï¼Œå«è™šå‡½æ•°ï¼Œå¾—å ç”¨å†…å­˜ 4ã€‚æœ‰è™šå‡½æ•°æ—¶ï¼Œé»˜è®¤æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è™šå‡½æ•°è¡¨ã€‚è¯¥æŒ‡é’ˆå  4 å­—èŠ‚ã€‚ // æ™®é€šæˆå‘˜å‡½æ•°ä¸å ç”¨ç±»çš„ç©ºé—´ã€‚ç±»çš„å‡½æ•°æ˜¯è¯¥ç±»æ‰€æœ‰å®ä¾‹å…±äº«çš„ï¼Œè°ƒç”¨æ—¶é€šè¿‡éšè—çš„ this æŒ‡é’ˆå’Œç±»çš„å®ä¾‹ç›¸å…³è”ï¼Œ // æ™®é€šæˆå‘˜å‡½æ•°ä»£ç ç¼–è¯‘åå­˜å‚¨åœ¨ç¨‹åºä»£ç åŒºï¼Œæ ¹æœ¬å°±ä¸åœ¨ç±»å®ä¾‹ä¸­ï¼Œæ‰€ä»¥ä¸å å®ä¾‹ç©ºé—´ã€‚ sizeof è®¡ç®—ç±»å¯¹è±¡ä¸ç»“æ„ä½“ã€è”åˆä½“æ‰€å ç©ºé—´çš„å¤§å° åœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸Šï¼Œå ç”¨ç©ºé—´ char:1ï¼Œshort:2, int:4ï¼Œlong:4\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 class A\t// 1 { public: char ch; }; class B\t// 4 + 2 + å¡«å……2 = 8 { public: int i; short j; }; class C\t// 4 + 2 + 1 + 1 = 8 { public: int i; short j; char c1; char c2; }; class D\t// 1 + å¡«å……3 + 4 + 1 + å¡«å……1 + 2 = 12 { public: char c1; int i; char c2; short j; }; // ã€æ³¨æ„ã€‘ç±» Cï¼ŒD çš„åŒºåˆ«åœ¨äºå˜é‡å®šä¹‰çš„é¡ºåºä¸ä¸€æ · D d; printf(\u0026#34;%x, %x, %x, %x, %x\\n\u0026#34;, \u0026amp;d, \u0026amp;d.c1, \u0026amp;d.i, \u0026amp;d.c2, \u0026amp;d.j); // è¾“å‡ºï¼š12ffed4, 12ffed4, 12ffed8, 12ffedc, 12ffede 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // æ³¨æ„ S1 ä¸ S2 ä¹Ÿå°±æ˜¯æˆå‘˜å˜é‡å®šä¹‰æ—¶é¡ºåºä¸ä¸€æ ·è€Œå·² struct S1\t// 4 + 1 + 1 + å¡«å……2 = 8 { int a1; char c1; char c2; }; struct S2\t// 1 + å¡«å……3 + 4 + 1 + å¡«å……3 = 12 { char c1; int a1; char c2; }; S2 s2; printf(\u0026#34;%x, %x, %x, %x\\n\u0026#34;, \u0026amp;s2, \u0026amp;s2.c1, \u0026amp;s2.a1, \u0026amp;s2.c2); // è¾“å‡ºï¼š10ff794, 10ff794, 10ff798, 10ff79c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 union u1\t// 8 { double a; int b; }; union u2\t// 13ï¼Œå¯¹é½æ–¹å¼æ˜¯1ï¼Œ13 æ˜¯ 1 çš„æ•´æ•°å€ { char a[13]; char b; }; union u3\t// 16ï¼Œå¯¹é½æ–¹å¼æ˜¯ 4ï¼Œ16 æ˜¯ 4 çš„æ•´æ•°å€ { char a[13]; int b; }ï¼› è¿™ä¸€åˆ‡éƒ½ä¸å­—èŠ‚å¯¹é½æœ‰å…³ï¼š\nç»“æ„ä½“å˜é‡çš„é¦–åœ°å€èƒ½å¤Ÿè¢«å…¶æœ€å®½åŸºæœ¬ç±»å‹æˆå‘˜çš„å¤§å°æ‰€æ•´é™¤ï¼› ç»“æ„ä½“æ¯ä¸€ä¸ªæˆå‘˜ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€çš„åç§»é‡éƒ½æ˜¯æˆå‘˜å¤§å°çš„æ•´æ•°å€ï¼Œå¦‚æœ‰éœ€è¦ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æˆå‘˜ä¹‹é—´åŠ ä¸Šå¡«å……å­—èŠ‚ï¼› ç»“æ„ä½“çš„æ€»å¤§å°ä¸ºç»“æ„ä½“æœ€å®½åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜å¤§å°çš„æ•´æ•°å€ï¼Œå¦‚æœ‰éœ€è¦ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æœ€æœ«ä¸€ä¸ªæˆå‘˜ä¹‹ååŠ ä¸Šå¡«å……å­—èŠ‚ã€‚ è”åˆä½“ï¼ˆå…±ç”¨ä½“ï¼‰ï¼Œç±»åŒç†ã€‚\nsizeof ä¸ strlen åŒºåˆ« sizeof æ˜¯æ“ä½œç¬¦ï¼Œstrlen æ˜¯å‡½æ•°ï¼›\næ•°ç»„åš sizeof å‚æ•°ä¸é€€åŒ–ï¼Œä¼ é€’ç»™ strlen å°±é€€åŒ–æˆæŒ‡é’ˆï¼ˆå‡½æ•°çš„å½¢å‚å°†æ•°ç»„æŒ‰æŒ‡é’ˆå¤„ç†ï¼‰ï¼›\n1 2 3 4 5 6 7 8 9 10 char *s = \u0026#34;hello\u0026#34;; char str[20] = \u0026#34;hello\u0026#34;; cout \u0026lt;\u0026lt; sizeof(s) \u0026lt;\u0026lt; \u0026#39; \u0026#39; \u0026lt;\u0026lt; sizeof(str) \u0026lt;\u0026lt; endl; // sizeof å¯¹å­—ç¬¦æŒ‡é’ˆå’Œå­—ç¬¦æ•°ç»„çš„å¤„ç†ä¸åŒ // cout \u0026lt;\u0026lt; sizeof s \u0026lt;\u0026lt; \u0026#39; \u0026#39; \u0026lt;\u0026lt; sizeof str \u0026lt;\u0026lt; endl; // sizeof åé¢ä¸åŠ æ‹¬å·ä¹Ÿæ­£ç¡®ï¼Œå› ä¸º sizeof æ˜¯è¿ç®—ç¬¦ä¸æ˜¯å‡½æ•°ï¼Œä½†ç”¨ sizeof æ±‚ç±»å‹å¤§å°ï¼Œå¿…é¡»åŠ æ‹¬å·ï¼Œæ¯”å¦‚ sizeof(int) cout \u0026lt;\u0026lt; strlen(s) \u0026lt;\u0026lt; \u0026#39; \u0026#39; \u0026lt;\u0026lt; strlen(str) \u0026lt;\u0026lt; endl; /* æ‰“å° 4 20 5 5 */ sizeof åœ¨ç¼–è¯‘é˜¶æ®µå°±è®¡ç®—å‡ºæ¥äº†ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰æ•°ç»„çš„ç»´åº¦ï¼Œè€Œstrlenæ˜¯åœ¨è¿è¡Œæ—¶å€™æ‰è®¡ç®—å‡ºæ¥ï¼›\nstrcpy ä¸ memcpy åŒºåˆ« å¤åˆ¶çš„å†…å®¹ä¸åŒã€‚strcpy åªèƒ½å¤åˆ¶å­—ç¬¦ä¸²ï¼Œè€Œ memcpy å¯ä»¥å¤åˆ¶ä»»æ„å†…å®¹ï¼Œä¾‹å¦‚å­—ç¬¦æ•°ç»„ã€æ•´å‹ã€ç»“æ„ä½“ã€ç±»ç­‰ã€‚ å¤åˆ¶çš„æ–¹æ³•ä¸åŒã€‚strcpy ä¸éœ€è¦æŒ‡å®šé•¿åº¦ï¼Œå®ƒé‡åˆ°è¢«å¤åˆ¶å­—ç¬¦çš„ç»“æŸç¬¦ \u0026ldquo;\\0\u0026rdquo; æ‰ç»“æŸï¼Œæ‰€ä»¥å®¹æ˜“æº¢å‡ºã€‚memcpy åˆ™æ˜¯æ ¹æ®å…¶ç¬¬ 3 ä¸ªå‚æ•°å†³å®šå¤åˆ¶çš„é•¿åº¦ã€‚ ç”¨é€”ä¸åŒã€‚é€šå¸¸åœ¨å¤åˆ¶å­—ç¬¦ä¸²æ—¶ç”¨ strcpyï¼Œè€Œéœ€è¦å¤åˆ¶å…¶ä»–ç±»å‹æ•°æ®æ—¶åˆ™ä¸€èˆ¬ç”¨ memcpy ã€‚ ä½œç”¨åŸŸä¸ç”Ÿå­˜å‘¨æœŸ c++ å˜é‡æœ‰ä¸¤ä¸ªå±æ€§éå¸¸é‡è¦ï¼šä½œç”¨åŸŸå’Œç”Ÿå­˜å‘¨æœŸã€‚\nèŠ±æ‹¬å·ä½œç”¨åŸŸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // èŠ±æ‹¬å·å¯ä»¥çœ‹ä½œæ˜¯ä½œç”¨åŸŸæ ‡è¯†ç¬¦ï¼Œé™¤äº†åœ¨å†™å‡½æ•°æ—¶å€™ç”¨åˆ°ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯è¡¨ç¤ºå˜é‡çš„ä½œç”¨åŸŸï¼š { // å¤–èŠ±æ‹¬å· int a = 0; {\t// å†…èŠ±æ‹¬å· int b = 0; a = 1; //ã€1ã€‘æ­£ç¡®ï¼Œå¯¹å¤–èŠ±æ‹¬å·å†…çš„ a é‡æ–°èµ‹å€¼ } // b = 1; // é”™è¯¯ï¼Œb å·²ç»è¢«é”€æ¯äº† cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; /* è¾“å‡ºä¸º 1ã€‚å¦‚æœå°†ã€1ã€‘å¤„ a = 1ï¼› æ”¹æˆ int a = 1ï¼›æ­¤æ—¶è¾“å‡ºä¸º 0ã€‚ å› ä¸ºå‰è€… a = 1 è¡¨æ˜ä¿®æ”¹çš„æ˜¯å¤–èŠ±æ‹¬å·å†…çš„ aï¼Œè€Œåè€…è¡¨æ˜å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ a å¹¶åˆå§‹åŒ–ï¼Œ å†…èŠ±æ‹¬å·çš„ a å±è”½äº†å¤–èŠ±æ‹¬å·çš„ aï¼Œè€Œ cout æ‰“å°çš„æ˜¯å¤–èŠ±æ‹¬å·çš„ a */ } // å¯¹äº if, while, for åœ¨èŠ±æ‹¬å·é‡Œå®šä¹‰çš„å˜é‡ï¼Œå‡ºäº†èŠ±æ‹¬å·å°±è¢«é‡Šæ”¾äº†ï¼Œ int a = 1; for (int a = 2; a == 2; ++a) { cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; //for ä¸­å®šä¹‰çš„ a ä½œç”¨åŸŸåœ¨èŠ±æ‹¬å·å†…ï¼Œå±è”½ for å¤–å®šä¹‰çš„ a } cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; // æ‰“å°å¤–èŠ±æ‹¬å·çš„ a /* æ‰“å° 2 1 */ ã€PRIMER 44ã€‘\nä½œç”¨åŸŸä¸­ä¸€æ—¦å£°æ˜äº†æŸä¸ªåå­—ï¼Œåœ¨å®ƒæ‰€åµŒå¥—ç€çš„æ‰€æœ‰ä½œç”¨åŸŸä¸­éƒ½èƒ½è®¿é—®è¯¥åå­—ã€‚åŒæ—¶ï¼Œå…è®¸åœ¨å†…å±‚ä½œç”¨åŸŸä¸­é‡æ–°å®šä¹‰å¤–å±‚ä½œç”¨åŸŸå·²æœ‰çš„åå­—ï¼Œæ­¤æ—¶å†…å±‚ä½œç”¨åŸŸä¸­æ–°å®šä¹‰çš„åå­—å°†å±è”½å¤–å±‚ä½œç”¨åŸŸçš„åå­—ã€‚\nå¯ä»¥ç”¨ä½œç”¨åŸŸæ“ä½œç¬¦::æ¥è¦†ç›–é»˜è®¤çš„ä½œç”¨åŸŸè§„åˆ™ã€‚å› ä¸ºå…¨å±€ä½œç”¨åŸŸæœ¬èº«å¹¶æ²¡æœ‰åå­—ï¼Œæ‰€ä»¥å½“ä½œç”¨åŸŸæ“ä½œç¬¦çš„å·¦ä¾§ä¸ºç©ºæ—¶ï¼Œä¼šå‘å…¨å±€ä½œç”¨åŸŸå‘å‡ºè¯·æ±‚è·å–ä½œç”¨åŸŸæ“ä½œç¬¦å³ä¾§åå­—å¯¹åº”çš„å˜é‡ã€‚\nå†…å­˜åˆ†é… ä¸€ä¸ªç¨‹åºå°†æ“ä½œç³»ç»Ÿåˆ†é…ç»™å…¶è¿è¡Œçš„å†…å­˜å—åˆ†ä¸º 5 ä¸ªåŒºåŸŸï¼š\né™æ€åŒºï¼ˆå…¨å±€åŒºï¼‰ï¼šå­˜æ”¾ç¨‹åºçš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡åœ¨ä¸€ä¸ªåŒºåŸŸï¼Œ æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œæœªåˆå§‹åŒ–çš„é™æ€å˜é‡åœ¨ç›¸é‚»çš„å¦ä¸€å—åŒºåŸŸã€‚ç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚ï¼ˆåœ¨ä»¥å‰çš„Cè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡åˆåˆ†ä¸ºåˆå§‹åŒ–çš„å’Œæœªåˆå§‹åŒ–çš„ï¼Œåœ¨C++é‡Œé¢æ²¡æœ‰è¿™ä¸ªåŒºåˆ†äº†ï¼Œä»–ä»¬å…±åŒå ç”¨åŒä¸€å—å†…å­˜åŒºã€‚ï¼‰\nå †åŒºï¼šå­˜æ”¾ç¨‹åºçš„åŠ¨æ€æ•°æ®ã€‚\næ ˆåŒºï¼šå­˜æ”¾ç¨‹åºçš„å±€éƒ¨æ•°æ®ï¼Œå³å„ä¸ªå‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ç­‰ã€‚å‡½æ•°ç»“æŸï¼Œè‡ªåŠ¨é‡Šæ”¾ã€‚\nï¼ˆæ–‡å­—ï¼‰å¸¸é‡åŒºï¼šå¸¸é‡å­—ç¬¦ä¸²å­˜æ”¾çš„åŒºåŸŸï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚\nä»£ç åŒºï¼šå­˜æ”¾ç¨‹åºçš„ä»£ç ï¼Œå³ç¨‹åºä¸­çš„å„ä¸ªå‡½æ•°ä»£ç å—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 int a = 0; // å…¨å±€åˆå§‹åŒ–åŒº char *p1; // å…¨å±€æœªåˆå§‹åŒ–åŒº int main() { int b; // æ ˆ char s[] = \u0026#34;abc\u0026#34;; // æ ˆ char *p2; // æ ˆ char *p3 = \u0026#34;123456\u0026#34;; // å­—ç¬¦å¸¸é‡ â€œ123456\\0â€ åœ¨å¸¸é‡åŒºï¼Œp3 åœ¨æ ˆä¸Šã€‚ static int c = 0; // å…¨å±€ï¼ˆé™æ€ï¼‰åˆå§‹åŒ–åŒº p1 = (char *)malloc(10); p2 = (char *)malloc(20); // åˆ†é…å¾—æ¥çš„ 10 å’Œ 20 å­—èŠ‚çš„åŒºåŸŸåœ¨å †åŒºã€‚ strcpy(p1, \u0026#34;123456\u0026#34;); // â€œ123456\\0â€ æ”¾åœ¨æ–‡å­—å¸¸é‡åŒºï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°†å®ƒä¸ p3 æ‰€æŒ‡å‘çš„ \u0026#34;123456\\0\u0026#34; ä¼˜åŒ–æˆä¸€ä¸ªåœ°æ–¹ } å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ å±€éƒ¨å˜é‡ä¹Ÿç§°ä¸ºå†…éƒ¨å˜é‡ï¼Œå®ƒæ˜¯åœ¨å‡½æ•°å†…å®šä¹‰çš„ã€‚å…¶ä½œç”¨åŸŸä»…é™äºå‡½æ•°å†…ï¼Œç¦»å¼€è¯¥å‡½æ•°åå†ä½¿ç”¨è¿™ç§å˜é‡æ˜¯éæ³•çš„ã€‚\nå…¨å±€å˜é‡ä¹Ÿç§°ä¸ºå¤–éƒ¨å˜é‡ï¼Œå®ƒæ˜¯åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ã€‚å®ƒä¸å±äºå“ªä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå±äºä¸€ä¸ªæºç¨‹åºæ–‡ä»¶ã€‚å…¶ä½œç”¨åŸŸæ˜¯æ•´ä¸ªæºç¨‹åºã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå±€éƒ¨å˜é‡å¯ä»¥å±è”½å…¨å±€å˜é‡ã€‚å¦‚æœä¸€ä¸ªå…¨å±€å˜é‡ç”¨ static ä¿®é¥°ï¼Œå®ƒå°±æ˜¯é™æ€å…¨å±€å˜é‡ï¼Œå®ƒçš„ä½œç”¨åŸŸæ˜¯è¯¥æ–‡ä»¶èŒƒå›´ï¼ˆç§°ä¸ºæ–‡ä»¶ä½œç”¨åŸŸï¼Œå³å…¶å®ƒæ–‡ä»¶ä¸èƒ½ä½¿ç”¨å®ƒï¼‰\næ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆå˜é‡æ˜¯å…¨å±€è¿˜æ˜¯å±€éƒ¨ æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨ï¼Œå¯èƒ½æ˜¯é€šè¿‡å†…å­˜åˆ†é…çš„ä½ç½®æ¥çŸ¥é“çš„ï¼Œå…¨å±€å˜é‡åˆ†é…åœ¨å…¨å±€æ•°æ®æ®µå¹¶ä¸”åœ¨ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™è¢«åŠ è½½ã€‚å±€éƒ¨å˜é‡åˆ™åˆ†é…åœ¨å †æ ˆé‡Œé¢ã€‚\né™æ€å­˜å‚¨ä¸åŠ¨æ€å­˜å‚¨ å˜é‡çš„ç”Ÿå­˜å‘¨æœŸåªä¸å˜é‡çš„å­˜å‚¨ä½ç½®ï¼ˆå­˜å‚¨ç±»åˆ«ï¼‰æœ‰å…³ã€‚å¯ä»¥åˆ†ä¸ºï¼š\né™æ€å­˜å‚¨æ–¹å¼ï¼ˆåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œç³»ç»Ÿå¯¹å˜é‡åˆ†é…å›ºå®šçš„å­˜å‚¨ç©ºé—´ï¼‰ åŠ¨æ€å­˜å‚¨æ–¹å¼ï¼ˆåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œç³»ç»Ÿå¯¹å˜é‡åŠ¨æ€ï¼ˆä¸å›ºå®šï¼‰çš„åˆ†é…å­˜å‚¨ç©ºé—´ï¼‰ è€Œå˜é‡çš„å­˜å‚¨ç±»åˆ«å¯ä»¥åˆ†ä¸ºé™æ€å­˜å‚¨å’ŒåŠ¨æ€å­˜å‚¨\nauto è‡ªåŠ¨å˜é‡(åŠ¨æ€å­˜å‚¨æ–¹å¼) static é™æ€å˜é‡(é™æ€å­˜å‚¨æ–¹å¼) register å¯„å­˜å™¨å˜é‡(åŠ¨æ€å­˜å‚¨æ–¹å¼) extern å¤–éƒ¨å˜é‡(é™æ€å­˜å‚¨æ–¹å¼) C++å˜é‡ä¿å­˜åœ¨å †è¿˜æ˜¯æ ˆï¼Ÿ å¦‚æœå¯¹è±¡æ˜¯å‡½æ•°å†…çš„éé™æ€å±€éƒ¨å˜é‡ï¼Œåˆ™å¯¹è±¡ï¼Œå¯¹è±¡çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨æ ˆåŒºã€‚ å¦‚æœå¯¹è±¡æ˜¯å…¨å±€å˜é‡ï¼Œåˆ™å¯¹è±¡ï¼Œå¯¹è±¡çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨é™æ€åŒºã€‚ å¦‚æœå¯¹è±¡æ˜¯å‡½æ•°å†…çš„é™æ€å±€éƒ¨å˜é‡ï¼Œåˆ™å¯¹è±¡ï¼Œå¯¹è±¡çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨é™æ€åŒºã€‚ å¦‚æœå¯¹è±¡æ˜¯ new å‡ºæ¥çš„ï¼Œåˆ™å¯¹è±¡ï¼Œå¯¹è±¡çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨å †åŒºã€‚ 1 2 3 4 5 6 void foo() { int* p = new int[5]; } // åœ¨æ ˆå†…å­˜ä¸­å­˜æ”¾äº†ä¸€ä¸ªæŒ‡å‘ä¸€å—å †å†…å­˜çš„æŒ‡é’ˆ p // ç¨‹åºä¼šå…ˆç¡®å®šåœ¨å †ä¸­åˆ†é…å†…å­˜çš„å¤§å°ï¼Œç„¶åè°ƒç”¨ operator new åˆ†é…å†…å­˜ // ç„¶åè¿”å›è¿™å—å†…å­˜çš„é¦–åœ°å€ï¼Œå­˜å…¥æ ˆä¸­ å †ä¸æ ˆçš„æ•ˆç‡ æ ˆæ˜¯ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿåˆ†å¥½äº†ç»™ä½ çš„ï¼Œä½ è‡ªå·±ç”¨ï¼Œç³»ç»Ÿä¸å¹²é¢„ã€‚\nå †æ˜¯ç”¨çš„æ—¶å€™æ‰å‘ç³»ç»Ÿç”³è¯·çš„ï¼Œç”¨å®Œäº†è¿˜å›å»ï¼Œè¿™ä¸ªç”³è¯·å’Œäº¤è¿˜çš„è¿‡ç¨‹å¼€é”€ç›¸å¯¹å°±æ¯”è¾ƒå¤§äº†ã€‚\nå †ç›¸å¯¹äºæ ˆï¼Œæ•ˆç‡ä½ï¼Œå¤šæ¬¡åˆ†é…ï¼ˆmalloc/newï¼‰å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼Œä½¿ç”¨æ—¶æœ€å¥½ç»“åˆç›¸å…³æ“ä½œç³»ç»Ÿï¼ˆLinuxã€Windowsã€RTOS ï¼‰ä½¿ç”¨ï¼Œå› ä¸ºç³»ç»Ÿé’ˆå¯¹å†…å­˜ç®¡ç†æœ‰ä¸“é—¨çš„ä¼˜åŒ–ç®—æ³•ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€‚å †è™½ç„¶æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œä½†å…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨çµæ´»ï¼Œè€Œä¸”å †å®¹é‡å¤§ï¼Œä¸€èˆ¬éœ€è¦ç”³è¯·æ¯”è¾ƒå¤§çš„å†…å­˜å—æ—¶ï¼Œéƒ½ä¼šä»å †ä¸­ç”³è¯·ã€‚\nnew ä¸ delete å †å†…å­˜ï¼ˆç©ºé—²ç©ºé—´ï¼‰é‡Œçš„å†…å­˜åˆ†é…é€šè¿‡ new è¡¨è¾¾å¼æ¥å®Œæˆï¼Œé‡Šæ”¾é€šè¿‡ delete è¡¨è¾¾å¼æ¥å®Œæˆã€‚å †å†…å­˜ç”±ç¨‹åºå‘˜è‡ªè¡Œç®¡ç†ã€‚\n1 2 3 4 5 6 7 int *p1 = new int; // æœªåˆå§‹åŒ– int *p2 = new int(1024); // æŒ‡å®šåˆå€¼, p2 æŒ‡å‘ä¸€ä¸ª int å¯¹è±¡ï¼Œå…¶å€¼ä¸º 1024 int *p3 = new int[1024]; // ä» heap ä¸­åˆ†é…ä¸€ä¸ªæ•°ç»„ï¼Œå«æœ‰1024ä¸ªå…ƒç´ ï¼Œp3 æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  delete p1; delete p2; delete [] p3 // new[] ä¸ delete[] è¦ä¸€ä¸€å¯¹åº” // å¦‚æœä¸ä½¿ç”¨ deleteï¼Œç”± heap åˆ†é…è€Œæ¥çš„å¯¹è±¡å°±æ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾ï¼Œè¿™è¢«ç§°ä¹‹ä¸ºå†…å­˜æ³„æ¼ã€‚ ã€ESS 49ï¼Œ50ã€‘\nnew/delete ä¸ malloc/free å…³ç³» malloc/free æ˜¯ C/C++ çš„æ ‡å‡†åº“å‡½æ•°ï¼Œnew/delete æ˜¯ C++ çš„è¿ç®—ç¬¦ã€‚å®ƒä»¬éƒ½å¯ç”¨äºç”³è¯·åŠ¨æ€å†…å­˜å’Œé‡Šæ”¾å†…å­˜ã€‚\nå¯¹äºéå†…éƒ¨æ•°æ®ç±»å‹çš„å¯¹è±¡è€Œè¨€ï¼Œå…‰ç”¨ malloc/free æ— æ³•æ»¡è¶³åŠ¨æ€å¯¹è±¡çš„è¦æ±‚ã€‚å¯¹è±¡åœ¨åˆ›å»ºçš„åŒæ—¶è¦è‡ªåŠ¨æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå¯¹è±¡åœ¨æ¶ˆäº¡ä¹‹å‰è¦è‡ªåŠ¨æ‰§è¡Œææ„å‡½æ•°ã€‚ç”±äº malloc/free æ˜¯åº“å‡½æ•°è€Œä¸æ˜¯è¿ç®—ç¬¦ï¼Œä¸åœ¨ç¼–è¯‘å™¨æ§åˆ¶æƒé™ä¹‹å†…ï¼Œä¸èƒ½å¤ŸæŠŠæ‰§è¡Œæ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„ä»»åŠ¡å¼ºåŠ äº malloc/freeï¼ˆmalloc åªèƒ½ç”³è¯·å†…å­˜ï¼Œä¸èƒ½åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™å¯¹æ‰€ç”³è¯·çš„å†…å­˜è¿›è¡Œåˆå§‹åŒ–å·¥ä½œï¼Œè€Œæ„é€ å‡½æ•°å¯ä»¥ã€‚free åªèƒ½é‡Šæ”¾å†…å­˜ï¼Œè€Œå¦‚æœææ„å‡½æ•°è®¾è®¡å¾—å¥½çš„è¯ï¼Œåœ¨é‡Šæ”¾å†…å­˜çš„åŒæ—¶è¿˜å¯ä»¥å®Œæˆé¢å¤–çš„å…¶ä»–å·¥ä½œï¼‰ã€‚å› æ­¤ C++ è¯­è¨€éœ€è¦ä¸€ä¸ªèƒ½å®ŒæˆåŠ¨æ€å†…å­˜åˆ†é…å’Œåˆå§‹åŒ–å·¥ä½œçš„è¿ç®—ç¬¦ new ï¼Œä»¥åŠä¸€ä¸ªèƒ½å®Œæˆæ¸…ç†ä¸é‡Šæ”¾å†…å­˜å·¥ä½œçš„è¿ç®—ç¬¦ delete ã€‚\nnew / new[]ï¼šå®Œæˆä¸¤ä»¶äº‹ï¼Œå…ˆåº•å±‚è°ƒç”¨ malloc åˆ†é…å†…å­˜ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°ï¼ˆåˆ›å»ºå¯¹è±¡ï¼‰ã€‚ delete/delete[]ï¼šä¹Ÿå®Œæˆä¸¤ä»¶äº‹ï¼Œå…ˆè°ƒç”¨ææ„å‡½æ•°ï¼ˆæ¸…ç†èµ„æºï¼‰ï¼Œç„¶ååº•å±‚è°ƒç”¨ free é‡Šæ”¾ç©ºé—´ã€‚ new åœ¨ç”³è¯·å†…å­˜æ—¶ä¼šè‡ªåŠ¨è®¡ç®—æ‰€éœ€å­—èŠ‚æ•°ï¼Œè€Œ malloc åˆ™éœ€æˆ‘ä»¬è‡ªå·±è¾“å…¥ç”³è¯·å†…å­˜ç©ºé—´çš„å­—èŠ‚æ•°ã€‚ malloc/free çš„ä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 #include \u0026lt;iostream\u0026gt; using namespace std; int main() { int *score, num; cin \u0026gt;\u0026gt; num; if ((score = (int *)malloc(sizeof(int) * num)) == nullptr) cerr \u0026lt;\u0026lt; \u0026#34;fail\u0026#34; \u0026lt;\u0026lt; endl; else { do something; free(score); // é‡Šæ”¾å†…å­˜ } } mallocã€callocã€reallocçš„åŒºåˆ« mallocä¸callocçš„åŒºåˆ«ä¸º1å—ä¸nå—çš„åŒºåˆ«\nreallocå°† ptr æŒ‡å‘çš„å†…å­˜çš„å¤§å°å¢å¤§åˆ° sizeï¼Œæ–°å¢åŠ çš„å†…å­˜å—æ²¡æœ‰åˆå§‹åŒ–ã€‚\n1 2 3 (type *)malloc(sizeof(type));\t// åˆ†é…ä¸€ä¸ªé•¿åº¦ä¸º sizeof(type) çš„è¿ç»­ç©ºé—´ï¼Œä¸”æœªåˆå§‹åŒ–ï¼Œæ˜¯éšæœºæ•° (type *)calloc(n, sizeof(type)); // åˆ†é… n å— é•¿åº¦ä¸º sizeof(type) çš„è¿ç»­ç©ºé—´ï¼Œåˆå§‹åŒ–ï¼Œå‡ä¸º 0ã€‚ (type *)realloc(ptr, size) // å°†ptræŒ‡å‘çš„ç©ºé—´å¢å¤§åˆ°sizeï¼Œæ–°å¢åŠ çš„å†…å­˜å—æ²¡æœ‰åˆå§‹åŒ–ã€‚ å® 1 2 3 #define MAX(x, y) (((x) \u0026gt; (y)) ? (x) : (y)) #define POW(x) ((x) * (x)) // ä¸ºä»€ä¹ˆç”¨æ‹¬å·ï¼Ÿå› ä¸ºå®åªæ˜¯ç®€å•çš„å­—ç¬¦æ›¿æ¢ å¤´æ–‡ä»¶ å¤´æ–‡ä»¶çš„æ‰©å±•åä¹ æƒ¯ä¸Šæ˜¯.hï¼Œæ ‡å‡†åº“ä¾‹å¤–ã€‚ å‡½æ•°çš„å®šä¹‰åªèƒ½æœ‰ä¸€ä»½ï¼Œå€’æ˜¯å¯ä»¥æœ‰å¤šä»½å£°æ˜ã€‚æˆ‘ä»¬ä¸èƒ½æŠŠå‡½æ•°çš„å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ï¼Œå› ä¸ºä¸€ä¸ªç¨‹åºçš„å¤šä¸ªä»£ç æ–‡ä»¶å¯èƒ½éƒ½ä¼šåŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶ã€‚ä½†åªå®šä¹‰ä¸€ä»½çš„è§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå†…è”å‡½æ•°ã€‚ä¸ºäº†èƒ½å¤Ÿæ‰©å±•å†…è”å‡½æ•°çš„å†…å®¹ï¼Œä»¥ä¾¿åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ä¸Šï¼Œç¼–è¯‘å™¨éƒ½å–å¾—å…¶å®šä¹‰ï¼Œå¿…é¡»å°†å†…è”å‡½æ•°çš„å®šä¹‰æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åœ¨å„ä¸ªä¸åŒç¨‹åºä»£ç æ–‡ä»¶ä¸­ï¼ˆå¦‚æœä¸¤ä¸ªå‡½æ•°åœ¨å®šä¹‰æ—¶å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨éƒ½ä¸€æ ·(è¿”å›ç±»å‹å¯ä»¥ä¸ä¸€æ ·)ï¼Œåˆ™ä¼šå‡ºé”™ï¼Œå› ä¸ºé‡è½½è¦ä¿è¯å‚æ•°åˆ—è¡¨ä¸ä¸€æ ·ï¼‰ã€‚ ä¸€ä¸ªå¯¹è±¡å’Œå˜é‡åŒå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿåªèƒ½åœ¨ç¨‹åºä¸­å®šä¹‰ä¸€æ¬¡ï¼Œå› æ­¤ä¹Ÿåº”è¯¥å°†å®šä¹‰æ”¾åœ¨ç¨‹åºä»£ç æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å¤´æ–‡ä»¶ä¸­ã€‚ä¸€èˆ¬åœ°ï¼ŒåŠ ä¸Š extern å°±å¯ä»¥æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ä½œä¸ºå£°æ˜äº†ã€‚ 1 2 3 // å¦‚æœæƒ³å£°æ˜ä¸€ä¸ªå˜é‡è€Œéå®šä¹‰å®ƒï¼Œå°±åœ¨å˜é‡åå‰æ·»åŠ  extern å…³é”®å­—ï¼Œè€Œä¸”ä¸è¦æ˜¾å¼åœ°åˆå§‹åŒ–å˜é‡ extern int x; // å£°æ˜ x è€Œéå®šä¹‰ int y; // å£°æ˜å¹¶å®šä¹‰ y const int a = 6;å°±å¯ä»¥æ”¾å…¥å¤´æ–‡ä»¶ä¸­ï¼Œå› ä¸º const object å°±å’Œ inline å‡½æ•°ä¸€æ ·ï¼Œæ˜¯â€ä¸€æ¬¡å®šä¹‰â€œè§„åˆ™ä¸‹çš„ä¾‹å¤–ã€‚å› ä¸º const å®šä¹‰ä¸€å‡ºæ–‡ä»¶å¤–ä¾¿ä¸å¯è§ï¼ˆæ–‡ä»¶ä½œç”¨åŸŸï¼‰ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„æ–‡ä»¶ä¸­åŠ ä»¥å®šä¹‰ã€‚\nå¤´æ–‡ä»¶ç”¨ \u0026lt;\u0026gt; è¡¨æ˜æ­¤æ–‡ä»¶è¢«è®¤ä¸ºæ˜¯æ ‡å‡†çš„æˆ–é¡¹ç›®ä¸“å±çš„å¤´æ–‡ä»¶ï¼Œç¼–è¯‘å™¨æœç´¢æ­¤æ–‡ä»¶æ—¶ï¼Œä¼šå…ˆåœ¨ç³»ç»Ÿé»˜è®¤çš„ç£ç›˜ç›®å½•ä¸‹å¯»æ‰¾ï¼›å¤´æ–‡ä»¶ç”¨ â€ â€œ è¡¨æ˜æ­¤æ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ç”¨æˆ·æä¾›çš„å¤´æ–‡ä»¶ï¼Œä¼šå…ˆåœ¨åŒ…å«æ­¤æ–‡ä»¶çš„ç£ç›˜ç›®å½•å¼€å§‹å¯»æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»ç³»ç»Ÿé»˜è®¤çš„ç›®å½•ä¸‹å¯»æ‰¾ã€‚\nã€ESS 63ï¼Œ64ã€‘\n#ifndef/#define/#endifä½œç”¨ é˜²æ­¢å¤´æ–‡ä»¶çš„é‡å¤åŒ…å«å’Œç¼–è¯‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 #ifndef A_H // æ„æ€æ˜¯ if not define a.h\u0026#34; å¦‚æœä¸å­˜åœ¨a.h #define A_H // å°±å¼•å…¥ a.h #include \u0026lt;math.h\u0026gt; // å¼•ç”¨æ ‡å‡†åº“çš„å¤´æ–‡ä»¶ â€¦ #include â€œheader.hâ€ // å¼•ç”¨éæ ‡å‡†åº“çš„å¤´æ–‡ä»¶ â€¦ void Function1(â€¦); // å…¨å±€å‡½æ•°å£°æ˜ â€¦ class Box // ç±»ç»“æ„å£°æ˜ { â€¦ }; #endif // æœ€åä¸€å¥åº”è¯¥å†™ #endifï¼Œå®ƒçš„ä½œç”¨ç›¸å½“äº if çš„åèŠ±æ‹¬å· \u0026#39;}\u0026#39; extern â€œCâ€ ä½œä¸ºCè¯­è¨€çš„æ‰©å±•ï¼ŒC++ ä¿ç•™äº†ä¸€éƒ¨åˆ†è¿‡ç¨‹å¼è¯­è¨€çš„ç‰¹ç‚¹ï¼Œå› è€Œå®ƒå¯ä»¥å®šä¹‰ä¸å±äºä»»ä½•ç±»çš„å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚ä½†æ˜¯ï¼ŒC++ æ¯•ç«Ÿæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è®¾è®¡è¯­è¨€ï¼Œä¸ºäº†æ”¯æŒå‡½æ•°çš„é‡è½½ï¼ŒC++ å¯¹å…¨å±€å‡½æ•°çš„å¤„ç†æ–¹å¼æœ‰ç€æ˜æ˜¾çš„ä¸åŒã€‚\né¦–å…ˆçœ‹ä¸€ä¸‹ C++ å¯¹ç±»ä¼¼Cçš„å‡½æ•°æ˜¯æ€æ ·ç¼–è¯‘çš„ï¼š\nä½œä¸ºé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ŒC++ ä¸ºäº†æ”¯æŒå‡½æ•°é‡è½½ï¼Œå‡½æ•°åœ¨è¢« C++ ç¼–è¯‘ååœ¨ç¬¦å·åº“ä¸­çš„åå­—ä¸ C è¯­è¨€çš„ä¸åŒã€‚å‡å¦‚æŸä¸ªå‡½æ•°çš„åŸå‹ä¸º void foo(int x, int y);ï¼Œè¯¥å‡½æ•°è¢« C ç¼–è¯‘å™¨ç¼–è¯‘ååœ¨ç¬¦å·åº“ä¸­çš„åå­—ä¸º _fooï¼Œè€Œ C++ ç¼–è¯‘å™¨åˆ™ä¼šäº§ç”Ÿ _foo_int_int ä¹‹ç±»çš„åå­—ã€‚_foo_int_int è¿™æ ·çš„åå­—æ˜¯åŒ…å«äº†å‡½æ•°åä»¥åŠå½¢å‚ï¼ŒC++å°±æ˜¯é è¿™ç§æœºåˆ¶æ¥å®ç°å‡½æ•°é‡è½½çš„ã€‚ å¦‚æœåœ¨ C ä¸­è¿æ¥ C++ ç¼–è¯‘çš„ç¬¦å·æ—¶ï¼Œå°±ä¼šå› æ‰¾ä¸åˆ°ç¬¦å·é—®é¢˜è€Œå‘ç”Ÿè¿æ¥é”™è¯¯ã€‚\nè¢« extern â€œCâ€ ä¿®é¥°çš„å‡½æ•°æˆ–è€…å˜é‡æ˜¯æŒ‰ç…§ C è¯­è¨€æ–¹å¼ç¼–è¯‘å’Œé“¾æ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ extern â€œCâ€ çš„çœŸå®ç›®çš„ï¼šå®ç° C++ ä¸ C çš„æ··åˆç¼–ç¨‹ã€‚\ntypedef å£°æ˜ å¯ä»¥ä½¿ç”¨ typedef ä¸ºä¸€ä¸ªå·²æœ‰çš„ç±»å‹å–ä¸€ä¸ªæ–°çš„åå­—ã€‚\ntypedef å¯ä»¥å£°æ˜å„ç§ç±»å‹åï¼Œä½†ä¸èƒ½ç”¨æ¥å®šä¹‰å˜é‡ã€‚ç”¨ typedef å¯ä»¥å£°æ˜æ•°ç»„ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨æ¯”è¾ƒæ–¹ä¾¿ã€‚\nç”¨ typedef åªæ˜¯å¯¹å·²ç»å­˜åœ¨çš„ç±»å‹å¢åŠ ä¸€ä¸ªç±»å‹åï¼Œè€Œæ²¡æœ‰åˆ›é€ æ–°çš„ç±»å‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 typedef int feet;\t// å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œfeet æ˜¯ int çš„å¦ä¸€ä¸ªåç§°ï¼šå¯ä»¥ç†è§£ feet ä¸º int çš„åˆ«å feet distance;\t// å®ƒåˆ›å»ºäº†ä¸€ä¸ªæ•´å‹å˜é‡ distance typedef int A[];\t// å®šä¹‰äº†æ•°ç»„ç±»å‹ï¼Œæ•°ç»„å¤§å°ç”±åˆå§‹åŒ–æ—¶å€™å†³å®š typedef int B[9];\t// å®šä¹‰äº†å¤§å°ä¸º9çš„æ•°ç»„ç±»å‹ï¼Œç”¨ B å®šä¹‰å¹¶åˆå§‹åŒ–æ•°ç»„æ—¶ï¼Œå…ƒç´ ä¸ªæ•°ä¸åº”è¶…è¿‡9 A arra = { 0, 1, 2, 3, 4 };\t// arra é•¿åº¦ä¸º 5 cout \u0026lt;\u0026lt; arra[3] \u0026lt;\u0026lt; \u0026#39; \u0026#39; \u0026lt;\u0026lt; sizeof arra/sizeof arra[0] \u0026lt;\u0026lt; endl; // æ‰“å° 3 5 B arrb = { 0, 1, 2, 3, 4 }; // å®é™…æ˜¯ {0ï¼Œ 1ï¼Œ 2ï¼Œ 3ï¼Œ 4ï¼Œ 0ï¼Œ 0ï¼Œ 0ï¼Œ 0} cout \u0026lt;\u0026lt; arrb[8] \u0026lt;\u0026lt; \u0026#39; \u0026#39; \u0026lt;\u0026lt; sizeof arrb / sizeof arrb[0] \u0026lt;\u0026lt; endl; // æ‰“å° 0 9 typedef int (*pfun)(int x, int y); // å®šä¹‰ä¸€ä¸ª pfun ç±»å‹ï¼Œè¡¨æ˜ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç±»å‹ int fun(int x, int y); pfun p = fun;\t// å®šä¹‰äº†ä¸€ä¸ª pfun ç±»å‹çš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶æŒ‡å‘å‡½æ•° fun int ret = p(2, 3); typedef struct Student\t// å®šä¹‰äº†ä¸€ä¸ª ST ç±»å‹çš„ç»“æ„ä½“ï¼Œä¸‹æ¬¡å®šä¹‰ç»“æ„ä½“å¯ç›´æ¥ç”¨ ST å®šä¹‰ï¼Œ {\t// ST Lux = { 123, \u0026#39;F\u0026#39; }; int id; char sex; }ST; decltype ç±»å‹æŒ‡ç¤ºç¬¦ ã€PRIMER 62ã€‘\nC++11æ–°å¢decltypeç±»å‹æŒ‡ç¤ºç¬¦ï¼Œä½œç”¨æ˜¯é€‰æ‹©å¹¶è¿”å›æ“ä½œæ•°çš„æ•°æ®ç±»å‹ï¼Œæ­¤è¿‡ç¨‹ä¸­ç¼–è¯‘å™¨ä¸å®é™…è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚\n1 decltype(f()) sum = x; // sum has whatever type f returns decltypeå¤„ç†é¡¶å±‚constå’Œå¼•ç”¨çš„æ–¹å¼ä¸autoæœ‰äº›ä¸åŒï¼Œå¦‚æœdecltypeä½¿ç”¨çš„è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™decltypeè¿”å›è¯¥å˜é‡çš„ç±»å‹ï¼ˆåŒ…æ‹¬é¡¶å±‚constå’Œå¼•ç”¨ï¼‰ã€‚\n1 2 3 4 const int ci = 0, \u0026amp;cj = ci; decltype(ci) x = 0; // x has type const int decltype(cj) y = x; // y has type const int\u0026amp; and is bound to x decltype(cj) z; // error: z is a reference and must be initialized å¦‚æœdecltypeä½¿ç”¨çš„è¡¨è¾¾å¼ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™decltypeè¿”å›è¡¨è¾¾å¼ç»“æœå¯¹åº”çš„ç±»å‹ã€‚å¦‚æœè¡¨è¾¾å¼çš„å†…å®¹æ˜¯è§£å¼•ç”¨æ“ä½œï¼Œåˆ™decltypeå°†å¾—åˆ°å¼•ç”¨ç±»å‹ã€‚å¦‚æœdecltypeä½¿ç”¨çš„æ˜¯ä¸€ä¸ªä¸åŠ æ‹¬å·çš„å˜é‡ï¼Œåˆ™å¾—åˆ°çš„ç»“æœå°±æ˜¯è¯¥å˜é‡çš„ç±»å‹ï¼›å¦‚æœç»™å˜é‡åŠ ä¸Šäº†ä¸€å±‚æˆ–å¤šå±‚æ‹¬å·ï¼Œåˆ™decltypeä¼šå¾—åˆ°å¼•ç”¨ç±»å‹ï¼Œå› ä¸ºå˜é‡æ˜¯ä¸€ç§å¯ä»¥ä½œä¸ºèµ‹å€¼è¯­å¥å·¦å€¼çš„ç‰¹æ®Šè¡¨è¾¾å¼ã€‚\ndecltype((var))çš„ç»“æœæ°¸è¿œæ˜¯å¼•ç”¨ï¼Œè€Œdecltype(var)çš„ç»“æœåªæœ‰å½“varæœ¬èº«æ˜¯ä¸€ä¸ªå¼•ç”¨æ—¶æ‰ä¼šæ˜¯å¼•ç”¨ã€‚\n1 2 3 int i = 42; decltype((i)) d1 = i; // d1 has type int\u0026amp; decltype(i) d2 = i; // d2 has type int æšä¸¾ç±»å‹ å¦‚æœä¸€ä¸ªå˜é‡åªæœ‰å‡ ç§å¯èƒ½çš„å€¼ï¼Œå¯ä»¥å®šä¹‰ä¸ºæšä¸¾(enumeration)ç±»å‹ã€‚æ¯ä¸ªæšä¸¾å…ƒç´ åœ¨å£°æ˜æ—¶è¢«åˆ†é…ä¸€ä¸ªæ•´å‹å€¼ï¼Œé»˜è®¤ä» 0 å¼€å§‹ï¼Œé€ä¸ªåŠ  1ã€‚ä¹Ÿå¯ä»¥åœ¨å£°æ˜æ—¶å°†æšä¸¾å…ƒç´ çš„å€¼ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥ã€‚\næ³¨æ„\næšä¸¾å…ƒç´ æ˜¯å¸¸é‡ï¼Œé™¤äº†åˆå§‹åŒ–æ—¶ä¸å¯ç»™å®ƒèµ‹å€¼ã€‚ æšä¸¾å˜é‡çš„å€¼åªå¯å–åˆ—ä¸¾çš„æšä¸¾å…ƒç´ å€¼ã€‚ 1 2 3 4 5 6 enum æšä¸¾å{ æ ‡è¯†ç¬¦[=æ•´å‹å¸¸æ•°], æ ‡è¯†ç¬¦[=æ•´å‹å¸¸æ•°], ... æ ‡è¯†ç¬¦[=æ•´å‹å¸¸æ•°] } æšä¸¾å˜é‡; å¦‚æœæšä¸¾æ²¡æœ‰åˆå§‹åŒ–,ï¼Œå³çœæ‰ \u0026ldquo;=æ•´å‹å¸¸æ•°\u0026rdquo; æ—¶ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªæ ‡è¯†ç¬¦å¼€å§‹ã€‚\n1 2 3 4 5 enum color { red, green, blue } c; c = blue; // c ä¸ºæšä¸¾å˜é‡ï¼ŒæŠŠæšä¸¾å…ƒç´  blue èµ‹ç»™ cï¼Œæ­¤æ—¶ c = 2 // è‹¥ç›´æ¥è¿™æ ·èµ‹å€¼ c = 2ï¼›å°±ä¼šæŠ¥é”™ï¼ä½ åªèƒ½æŠŠ{ red, green, blue }èµ‹å€¼ç»™ cã€‚ // blue = 2ï¼›æŠ¥é”™ï¼blue æ˜¯å¸¸é‡è€Œä¸æ˜¯å˜é‡ã€‚ // æœªåˆå§‹åŒ–é»˜è®¤ red = 0, green = 1, blue = 2 è‹¥ç»™æŸä¸€ä¸ªæ ‡è¯†ç¬¦èµ‹å€¼å¦‚ green = 5\n1 2 3 4 5 6 enum color { red, green = 5, blue } c; c = blue;\t// 6 color d;\t// d ä¹Ÿä¸ºæšä¸¾å˜é‡ d = red;\t// d = 0 // éƒ¨åˆ†å€¼åˆå§‹åŒ–ï¼Œè¦æ»¡è¶³åé¢çš„å€¼æ¯”å‰é¢å€¼å¤§ 1ï¼Œæ­¤æ—¶ red é»˜è®¤ä¸º 0 // green åˆå§‹åŒ–ä¸º 5 ï¼Œblue è¦æ»¡è¶³æ¯” green å¤§ 1 å³ blue = 6 Cç»“æ„ä½“ã€C++ç»“æ„ä½“ã€C++ç±»çš„åŒºåˆ« C ç»“æ„ä½“ä¸ C++ ç»“æ„ä½“\nC è¯­è¨€ä¸­çš„ç»“æ„ä½“ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šæŠ¥é”™ C è¯­è¨€ä¸­çš„ç»“æ„ä½“åªæ¶‰åŠåˆ°æ•°æ®ç»“æ„ï¼Œè€Œä¸æ¶‰åŠåˆ°ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ C ä¸­æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯åˆ†ç¦»çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ C è¯­è¨€ä¸­çš„ç»“æ„ä½“åªèƒ½å®šä¹‰æˆå‘˜å˜é‡ï¼Œä½†æ˜¯ä¸èƒ½å®šä¹‰æˆå‘˜å‡½æ•°ï¼ˆè™½ç„¶å¯ä»¥å®šä¹‰å‡½æ•°æŒ‡é’ˆï¼Œä½†æ¯•ç«Ÿæ˜¯æŒ‡é’ˆè€Œä¸æ˜¯å‡½æ•°ï¼‰ã€‚ç„¶è€Œ C++ ä¸­ç»“æ„ä½“æ—¢å¯ä»¥å®šä¹‰æˆå‘˜å˜é‡åˆå¯ä»¥å®šä¹‰æˆå‘˜å‡½æ•°ï¼Œ C++ ä¸­çš„ç»“æ„ä½“å’Œç±»ä½“ç°äº†æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç»“åˆã€‚ C++ ä¸­ç»“æ„ä½“ä¸ç±»\nç›¸åŒä¹‹å¤„ï¼š ç»“æ„ä½“ä¸­ä¹Ÿå¯ä»¥åŒ…å«å‡½æ•°ï¼›ä¹Ÿå¯ä»¥å®šä¹‰ publicã€privateã€protected æ•°æ®æˆå‘˜ï¼›å®šä¹‰äº†ç»“æ„ä½“ä¹‹åï¼Œå¯ä»¥ç”¨ç»“æ„ä½“åæ¥åˆ›å»ºå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ C++ å½“ä¸­ï¼Œç»“æ„ä½“ä¸­å¯ä»¥æœ‰æˆå‘˜å˜é‡ï¼Œå¯ä»¥æœ‰æˆå‘˜å‡½æ•°ï¼Œå¯ä»¥ä»åˆ«çš„ç±»ç»§æ‰¿ï¼Œä¹Ÿå¯ä»¥è¢«åˆ«çš„ç±»ç»§æ‰¿ï¼Œå¯ä»¥æœ‰è™šå‡½æ•°ã€‚æ€»çš„ä¸€å¥è¯ï¼šclass å’Œ struct çš„è¯­æ³•åŸºæœ¬ç›¸åŒï¼Œä»å£°æ˜åˆ°ä½¿ç”¨ï¼Œéƒ½å¾ˆç›¸ä¼¼ã€‚ åŒºåˆ«ï¼šå¯¹äºæˆå‘˜è®¿é—®æƒé™å’Œç»§æ‰¿æ–¹å¼ï¼Œclass ä¸­é»˜è®¤çš„æ˜¯ privateï¼Œè€Œ struct ä¸­åˆ™æ˜¯ publicã€‚class è¿˜å¯ä»¥ç”¨äºè¡¨ç¤ºæ¨¡æ¿ç±»å‹ï¼Œstruct åˆ™ä¸è¡Œã€‚ å®é™…ä¸ŠC++ä¸­ä¿ç•™structå…³é”®å­—æ˜¯ä¸ºäº†ä½¿C++ç¼–è¯‘å™¨èƒ½å¤Ÿå…¼å®¹Cè¯­è¨€å¼€å‘çš„ç¨‹åº\nç»“æ„ä½“ä¸è”åˆä½“ï¼ˆå…±ç”¨ä½“ï¼‰çš„åŒºåˆ« ç»“æ„å’Œè”åˆéƒ½æ˜¯ç”±å¤šä¸ªä¸åŒçš„æ•°æ®ç±»å‹æˆå‘˜ç»„æˆ, ä½†åœ¨ä»»ä½•åŒä¸€æ—¶åˆ», è”åˆä¸­åªå­˜æ”¾äº†ä¸€ä¸ªè¢«é€‰ä¸­çš„æˆå‘˜ï¼ˆæ‰€æœ‰æˆå‘˜å…±ç”¨ä¸€å—åœ°å€ç©ºé—´ï¼‰, è€Œç»“æ„ä½“çš„æ‰€æœ‰æˆå‘˜éƒ½å­˜åœ¨ï¼ˆä¸åŒæˆå‘˜çš„å­˜æ”¾åœ°å€ä¸åŒï¼‰ã€‚ ï¼ˆåœ¨ struct ä¸­ï¼Œå„æˆå‘˜éƒ½å æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œå®ƒä»¬æ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚ä¸€ä¸ª struct å˜é‡çš„æ€»é•¿åº¦ç­‰äºæ‰€æœ‰æˆå‘˜é•¿åº¦ä¹‹å’Œã€‚åœ¨ Union ä¸­ï¼Œæ‰€æœ‰æˆå‘˜ä¸èƒ½åŒæ—¶å ç”¨å®ƒçš„å†…å­˜ç©ºé—´ï¼Œå®ƒä»¬ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚Union å˜é‡çš„é•¿åº¦ç­‰äºæœ€é•¿çš„æˆå‘˜çš„é•¿åº¦ã€‚ï¼‰ å¯¹è”åˆä½“ä¸åŒæˆå‘˜èµ‹å€¼, å°†ä¼šå¯¹å…¶å®ƒæˆå‘˜é‡å†™, åŸæ¥æˆå‘˜çš„å€¼å°±ä¸å­˜åœ¨äº†, è€Œå¯¹äºç»“æ„çš„ä¸åŒæˆå‘˜èµ‹å€¼æ˜¯äº’ä¸å½±å“çš„ã€‚ ç±»å‹è½¬æ¢ ã€PRIMER 142-146ã€‘\næ— é¡»ç¨‹åºå‘˜ä»‹å…¥ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œçš„ç±»å‹è½¬æ¢å«åšéšå¼è½¬æ¢ï¼ˆimplicit conversionsï¼‰ã€‚\nç®—æœ¯è½¬æ¢ ï¼ˆIntegral Promotionsï¼‰\næŠŠä¸€ç§ç®—æœ¯ç±»å‹è½¬æ¢æˆå¦ä¸€ç§ç®—æœ¯ç±»å‹å«åšç®—æœ¯è½¬æ¢ã€‚\næ•´å‹æå‡ï¼ˆintegral promotionsï¼‰è´Ÿè´£æŠŠå°æ•´æ•°ç±»å‹è½¬æ¢æˆè¾ƒå¤§çš„æ•´æ•°ç±»å‹ã€‚\nå…¶ä»–éšå¼ç±»å‹è½¬æ¢ ï¼ˆOther Implicit Conversionsï¼‰\nåœ¨å¤§å¤šæ•°è¡¨è¾¾å¼ä¸­ï¼Œæ•°ç»„åå­—è‡ªåŠ¨è½¬æ¢æˆæŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆã€‚\nå¸¸é‡æ•´æ•°å€¼0æˆ–å­—é¢å€¼nullptrèƒ½è½¬æ¢æˆä»»æ„æŒ‡é’ˆç±»å‹ï¼›æŒ‡å‘ä»»æ„éå¸¸é‡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆvoid*ï¼›æŒ‡å‘ä»»æ„å¯¹è±¡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆconst void*ã€‚\nä»»æ„ä¸€ç§ç®—æœ¯ç±»å‹æˆ–æŒ‡é’ˆç±»å‹éƒ½èƒ½è½¬æ¢æˆå¸ƒå°”ç±»å‹ã€‚å¦‚æœæŒ‡é’ˆæˆ–ç®—æœ¯ç±»å‹çš„å€¼ä¸º0ï¼Œè½¬æ¢ç»“æœæ˜¯falseï¼Œå¦åˆ™æ˜¯trueã€‚\næŒ‡å‘éå¸¸é‡ç±»å‹çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆæŒ‡å‘ç›¸åº”çš„å¸¸é‡ç±»å‹çš„æŒ‡é’ˆã€‚\næ˜¾å¼è½¬æ¢ ï¼ˆExplicit Conversionsï¼‰\næ˜¾å¼ç±»å‹è½¬æ¢ä¹Ÿå«åšå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆcastï¼‰ã€‚è™½ç„¶æœ‰æ—¶ä¸å¾—ä¸ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½†è¿™ç§æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯éå¸¸å±é™©çš„ã€‚å»ºè®®å°½é‡é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚\nå‘½åçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆnamed castï¼‰å½¢å¼å¦‚ä¸‹ï¼š\n1 cast-name\u0026lt;type\u0026gt;(expression); å…¶ä¸­typeæ˜¯è½¬æ¢çš„ç›®æ ‡ç±»å‹ï¼Œexpressionæ˜¯è¦è½¬æ¢çš„å€¼ã€‚å¦‚æœtypeæ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™è½¬æ¢ç»“æœæ˜¯å·¦å€¼ã€‚cast-nameæ˜¯static_castã€dynamic_castã€const_castå’Œreinterpret_castä¸­çš„ä¸€ç§ï¼Œç”¨æ¥æŒ‡å®šè½¬æ¢çš„æ–¹å¼ã€‚\ndynamic_castæ”¯æŒè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ã€‚ ä»»ä½•å…·æœ‰æ˜ç¡®å®šä¹‰çš„ç±»å‹è½¬æ¢ï¼Œåªè¦ä¸åŒ…å«åº•å±‚constï¼Œéƒ½èƒ½ä½¿ç”¨static_castã€‚ const_caståªèƒ½æ”¹å˜è¿ç®—å¯¹è±¡çš„åº•å±‚constï¼Œä¸èƒ½æ”¹å˜è¡¨è¾¾å¼çš„ç±»å‹ã€‚åŒæ—¶ä¹Ÿåªæœ‰const_castèƒ½æ”¹å˜è¡¨è¾¾å¼çš„å¸¸é‡å±æ€§ã€‚const_castå¸¸å¸¸ç”¨äºå‡½æ•°é‡è½½ã€‚ reinterpret_casté€šå¸¸ä¸ºè¿ç®—å¯¹è±¡çš„ä½æ¨¡å¼æä¾›åº•å±‚ä¸Šçš„é‡æ–°è§£é‡Šã€‚ æ—©æœŸç‰ˆæœ¬çš„C++è¯­è¨€ä¸­ï¼Œæ˜¾å¼ç±»å‹è½¬æ¢åŒ…å«ä¸¤ç§å½¢å¼ï¼š\n1 2 type (expression); // function-style cast notation (type) expression; // C-language-style cast notation ç±»å‹å®‰å…¨ ç±»å‹å®‰å…¨æ˜¯æŒ‡åŒä¸€æ®µå†…å­˜åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œä¼šè¢«å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ç›¸åŒçš„åŠæ³•æ¥è§£é‡Š(å†…å­˜ä¸­çš„æ•°æ®æ˜¯ç”¨ç±»å‹æ¥è§£é‡Šçš„)ã€‚\nJava è¯­è¨€æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œé™¤éå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚\nC è¯­è¨€ä¸æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå› ä¸ºåŒä¸€æ®µå†…å­˜å¯ä»¥ç”¨ä¸åŒçš„æ•°æ®ç±»å‹æ¥è§£é‡Šï¼Œæ¯”å¦‚ 1 ç”¨ int æ¥è§£é‡Šå°±æ˜¯ 1ï¼Œç”¨ booleanæ¥è§£é‡Šå°±æ˜¯ trueã€‚\nC++ ä¹Ÿä¸æ˜¯ç»å¯¹ç±»å‹å®‰å…¨çš„ï¼Œä½†ä½¿ç”¨å¾—å½“ï¼Œå®ƒå°†è¿œæ¯” C æ›´æœ‰ç±»å‹å®‰å…¨æ€§ã€‚\nC++æä¾›äº†ä¸€äº›æ–°çš„æœºåˆ¶ä¿éšœç±»å‹å®‰å…¨ï¼š\næ“ä½œç¬¦ new è¿”å›çš„æŒ‡é’ˆç±»å‹ä¸¥æ ¼ä¸å¯¹è±¡åŒ¹é…ï¼Œè€Œä¸æ˜¯ void C ä¸­å¾ˆå¤šä»¥ void* ä¸ºå‚æ•°çš„å‡½æ•°å¯ä»¥æ”¹å†™ä¸º C++ æ¨¡æ¿å‡½æ•°ï¼Œè€Œæ¨¡æ¿æ˜¯æ”¯æŒç±»å‹æ£€æŸ¥çš„ï¼› å¼•å…¥ const å…³é”®å­—ä»£æ›¿ #define constantsï¼Œå®ƒæ˜¯æœ‰ç±»å‹ã€æœ‰ä½œç”¨åŸŸçš„ï¼Œè€Œ #define constants åªæ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼› ä¸€äº› #define å®å¯è¢«æ”¹å†™ä¸º inline å‡½æ•°ï¼Œç»“åˆå‡½æ•°çš„é‡è½½ï¼Œå¯åœ¨ç±»å‹å®‰å…¨çš„å‰æä¸‹æ”¯æŒå¤šç§ç±»å‹ï¼Œå½“ç„¶æ”¹å†™ä¸ºæ¨¡æ¿ä¹Ÿèƒ½ä¿è¯ç±»å‹å®‰å…¨ï¼› C++ æä¾›äº† dynamic_cast å…³é”®å­—ï¼Œä½¿å¾—è½¬æ¢è¿‡ç¨‹æ›´åŠ å®‰å…¨ï¼Œå› ä¸º dynamic_cast æ¯” static_cast æ¶‰åŠæ›´å¤šå…·ä½“çš„ç±»å‹æ£€æŸ¥ã€‚ tryè¯­å¥å—å’Œå¼‚å¸¸å¤„ç† ã€PRIMER 172ã€‘\nå¼‚å¸¸ï¼ˆexceptionï¼‰æ˜¯æŒ‡ç¨‹åºè¿è¡Œæ—¶çš„åå¸¸è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºè¶…å‡ºäº†å‡½æ•°æ­£å¸¸åŠŸèƒ½çš„èŒƒå›´ã€‚å½“ç¨‹åºçš„æŸä¸€éƒ¨åˆ†æ£€æµ‹åˆ°ä¸€ä¸ªå®ƒæ— æ³•å¤„ç†çš„é—®é¢˜æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¼‚å¸¸å¤„ç†ï¼ˆexception handlingï¼‰ã€‚\nå¼‚å¸¸å¤„ç†æœºåˆ¶åŒ…æ‹¬throwè¡¨è¾¾å¼ï¼ˆthrow expressionï¼‰ã€tryè¯­å¥å—ï¼ˆtry blockï¼‰å’Œå¼‚å¸¸ç±»ï¼ˆexception classï¼‰ã€‚\nå¼‚å¸¸æ£€æµ‹éƒ¨åˆ†ä½¿ç”¨throwè¡¨è¾¾å¼è¡¨ç¤ºå®ƒé‡åˆ°äº†æ— æ³•å¤„ç†çš„é—®é¢˜ï¼ˆthrowå¼•å‘äº†å¼‚å¸¸ï¼‰ã€‚ å¼‚å¸¸å¤„ç†éƒ¨åˆ†ä½¿ç”¨tryè¯­å¥å—å¤„ç†å¼‚å¸¸ã€‚tryè¯­å¥å—ä»¥å…³é”®å­—tryå¼€å§‹ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªcatchå­å¥ï¼ˆcatch clauseï¼‰ç»“æŸã€‚tryè¯­å¥å—ä¸­ä»£ç æŠ›å‡ºçš„å¼‚å¸¸é€šå¸¸ä¼šè¢«æŸä¸ªcatchå­å¥å¤„ç†ï¼Œcatchå­å¥ä¹Ÿè¢«ç§°ä½œå¼‚å¸¸å¤„ç†ä»£ç ï¼ˆexception handlerï¼‰ã€‚ å¼‚å¸¸ç±»ç”¨äºåœ¨throwè¡¨è¾¾å¼å’Œç›¸å…³çš„catchå­å¥ä¹‹é—´ä¼ é€’å¼‚å¸¸çš„å…·ä½“ä¿¡æ¯ã€‚ throwè¡¨è¾¾å¼ throwè¡¨è¾¾å¼åŒ…å«å…³é”®å­—throwå’Œç´§éšå…¶åçš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶ä¸­è¡¨è¾¾å¼çš„ç±»å‹å°±æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚\ntryè¯­å¥å— tryè¯­å¥å—çš„é€šç”¨å½¢å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 try { program-statements } catch (exception-declaration) { handler-statements } catch (exception-declaration) { handler-statements } // . . . tryè¯­å¥å—ä¸­çš„program-statementsç»„æˆç¨‹åºçš„æ­£å¸¸é€»è¾‘ï¼Œå…¶å†…éƒ¨å£°æ˜çš„å˜é‡åœ¨å—å¤–æ— æ³•è®¿é—®ï¼Œå³ä½¿åœ¨catchå­å¥ä¸­ä¹Ÿä¸è¡Œã€‚catchå­å¥åŒ…å«å…³é”®å­—catchã€æ‹¬å·å†…ä¸€ä¸ªå¯¹è±¡çš„å£°æ˜ï¼ˆå¼‚å¸¸å£°æ˜ï¼Œexception declarationï¼‰å’Œä¸€ä¸ªå—ã€‚å½“é€‰ä¸­äº†æŸä¸ªcatchå­å¥å¤„ç†å¼‚å¸¸åï¼Œæ‰§è¡Œä¸ä¹‹å¯¹åº”çš„å—ã€‚catchä¸€æ—¦å®Œæˆï¼Œç¨‹åºä¼šè·³è¿‡å‰©ä½™çš„æ‰€æœ‰catchå­å¥ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„è¯­å¥ã€‚\nå¦‚æœæœ€ç»ˆæ²¡èƒ½æ‰¾åˆ°ä¸å¼‚å¸¸ç›¸åŒ¹é…çš„catchå­å¥ï¼Œç¨‹åºä¼šæ‰§è¡Œåä¸ºterminateçš„æ ‡å‡†åº“å‡½æ•°ã€‚è¯¥å‡½æ•°çš„è¡Œä¸ºä¸ç³»ç»Ÿæœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè¯¥å‡½æ•°å°†å¯¼è‡´ç¨‹åºéæ­£å¸¸é€€å‡ºã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœä¸€æ®µç¨‹åºæ²¡æœ‰tryè¯­å¥å—ä¸”å‘ç”Ÿäº†å¼‚å¸¸ï¼Œç³»ç»Ÿä¹Ÿä¼šè°ƒç”¨terminateå‡½æ•°å¹¶ç»ˆæ­¢å½“å‰ç¨‹åºçš„æ‰§è¡Œã€‚\næ ‡å‡†å¼‚å¸¸ å¼‚å¸¸ç±»åˆ†åˆ«å®šä¹‰åœ¨4ä¸ªå¤´æ–‡ä»¶ä¸­ï¼š\nå¤´æ–‡ä»¶exceptionå®šä¹‰äº†æœ€é€šç”¨çš„å¼‚å¸¸ç±»exceptionã€‚å®ƒåªæŠ¥å‘Šå¼‚å¸¸çš„å‘ç”Ÿï¼Œä¸æä¾›ä»»ä½•é¢å¤–ä¿¡æ¯ã€‚\nå¤´æ–‡ä»¶stdexceptå®šä¹‰äº†å‡ ç§å¸¸ç”¨çš„å¼‚å¸¸ç±»ã€‚\nå¤´æ–‡ä»¶newå®šä¹‰äº†bad_allocå¼‚å¸¸ç±»ã€‚\nå¤´æ–‡ä»¶type_infoå®šä¹‰äº†bad_castå¼‚å¸¸ç±»ã€‚\næ ‡å‡†åº“å¼‚å¸¸ç±»çš„ç»§æ‰¿ä½“ç³»ï¼š\nåªèƒ½ä»¥é»˜è®¤åˆå§‹åŒ–çš„æ–¹å¼åˆå§‹åŒ–exceptionã€bad_allocå’Œbad_castå¯¹è±¡ï¼Œä¸å…è®¸ä¸ºè¿™äº›å¯¹è±¡æä¾›åˆå§‹å€¼ã€‚å…¶ä»–å¼‚å¸¸ç±»çš„å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶å¿…é¡»æä¾›ä¸€ä¸ªstringæˆ–ä¸€ä¸ªCé£æ ¼å­—ç¬¦ä¸²ï¼Œé€šå¸¸è¡¨ç¤ºå¼‚å¸¸ä¿¡æ¯ã€‚whatæˆå‘˜å‡½æ•°å¯ä»¥è¿”å›è¯¥å­—ç¬¦ä¸²çš„stringå‰¯æœ¬ã€‚\nç±» \u0026amp; å¯¹è±¡ ç±»åŒ…å«å¯¹è±¡æ‰€éœ€çš„æ•°æ®ï¼Œä»¥åŠæè¿°ç”¨æˆ·ä¸æ•°æ®äº¤äº’æ‰€éœ€çš„æ“ä½œã€‚\næˆå‘˜å‡½æ•°å¯ä»¥å®šä¹‰åœ¨ç±»å†…éƒ¨ï¼Œæˆ–è€…å•ç‹¬ä½¿ç”¨èŒƒå›´è§£æè¿ç®—ç¬¦ï¼ˆåŸŸåŒºåˆ†ç¬¦ï¼‰ :: æ¥å®šä¹‰ã€‚åœ¨ç±»å®šä¹‰ä¸­å®šä¹‰çš„æˆå‘˜å‡½æ•°æŠŠå‡½æ•°å£°æ˜ä¸ºå†…è”çš„ï¼Œå³ä½¿æ²¡æœ‰ä½¿ç”¨ inline æ ‡è¯†ç¬¦ã€‚\nç±»çš„æˆå‘˜åå’Œæ–¹æ³•çš„å‚æ•°åä¸èƒ½ç›¸åŒï¼Œå»ºè®®æˆå‘˜ååŠ ä¸Š \u0026rsquo;m\u0026rsquo; å‰ç¼€æˆ–è€…æœ«å°¾åŠ ä¸Š \u0026lsquo;_\u0026rsquo;ã€‚\nã€PLUS 353ã€‘\nç±»å¯¹è±¡å£°æ˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 class C { public: C() { std::cout \u0026lt;\u0026lt; \u0026#34;call C()\u0026#34; \u0026lt;\u0026lt; std::endl; }; C(int _m) : m(_m) { std::cout \u0026lt;\u0026lt; \u0026#34;call C(int m)\u0026#34; \u0026lt;\u0026lt; std::endl; }; private: int m; }; int main() { C c1; // call C() C c2(); // ä»…ä»…å£°æ˜äº†ä¸€ä¸ªå‡½æ•° c2ï¼Œå®ƒè¿”å› C ç±»å‹ï¼Œæ‰€ä»¥ä¸è¦ä¹±åŠ æ‹¬å· C c3(1); // call C(int m) return 0; } ç±»è®¿é—®ä¿®é¥°ç¬¦ publicï¼šå…¬æœ‰æˆå‘˜åœ¨ç¨‹åºä¸­ç±»çš„å¤–éƒ¨æ˜¯å¯è®¿é—®çš„ã€‚å¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æˆå‘˜å‡½æ•°æ¥è®¾ç½®å’Œè·å–å…¬æœ‰å˜é‡çš„å€¼ã€‚ privateï¼šç§æœ‰æˆå‘˜å˜é‡æˆ–å‡½æ•°åœ¨ç±»çš„å¤–éƒ¨æ˜¯ä¸å¯è®¿é—®çš„ï¼Œç”šè‡³æ˜¯ä¸å¯æŸ¥çœ‹çš„ã€‚åªæœ‰ç±»å’Œå‹å…ƒå‡½æ•°å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜ï¼ˆæ´¾ç”Ÿç±»ä¹Ÿä¸èƒ½è®¿é—®ï¼‰ã€‚ protectedï¼šä¿æŠ¤æˆå‘˜å˜é‡æˆ–å‡½æ•°ä¸ç§æœ‰æˆå‘˜ååˆ†ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼Œä¿æŠ¤æˆå‘˜åœ¨æ´¾ç”Ÿç±»ï¼ˆå³å­ç±»ï¼‰ä¸­æ˜¯å¯è®¿é—®çš„ã€‚ å°è£…ç»§æ‰¿å¤šæ€ å°è£… å°è£…æ˜¯å®ç°é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡çš„ç¬¬ä¸€æ­¥ï¼Œå°è£…å°±æ˜¯å°†æ•°æ®æˆ–å‡½æ•°ç­‰é›†åˆåœ¨ä¸€ä¸ªä¸ªçš„å•å…ƒä¸­ï¼ˆç§°ä¹‹ä¸ºç±»ï¼‰ã€‚\nå°è£…çš„æ„ä¹‰åœ¨äºä¿æŠ¤æˆ–è€…é˜²æ­¢ä»£ç ï¼ˆæ•°æ®ï¼‰è¢«æ— æ„ä¸­ç ´åã€‚\nç»§æ‰¿ ç»§æ‰¿ä¸»è¦å®ç°ä»£ç é‡ç”¨ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ã€‚å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ä¸€äº›ä¸œè¥¿ã€‚\næœ‰ public, protected, private ä¸‰ç§ç»§æ‰¿æ–¹å¼ï¼Œå®ƒä»¬ç›¸åº”åœ°æ”¹å˜äº†æ´¾ç”Ÿç±»çš„ç”¨æˆ·ä»¥åŠæ´¾ç”Ÿç±»çš„æ´¾ç”Ÿç±»çš„è®¿é—®æƒé™ã€‚\npublic ç»§æ‰¿ï¼šåŸºç±» public æˆå‘˜ï¼Œprotected æˆå‘˜ï¼Œprivate æˆå‘˜çš„è®¿é—®å±æ€§åœ¨æ´¾ç”Ÿç±»ä¸­åˆ†åˆ«å˜æˆï¼špublic, protected, private\nprotected ç»§æ‰¿ï¼šåŸºç±» public æˆå‘˜ï¼Œprotected æˆå‘˜ï¼Œprivate æˆå‘˜çš„è®¿é—®å±æ€§åœ¨æ´¾ç”Ÿç±»ä¸­åˆ†åˆ«å˜æˆï¼šprotected, protected, private\nprivate ç»§æ‰¿ï¼šåŸºç±» public æˆå‘˜ï¼Œprotected æˆå‘˜ï¼Œprivate æˆå‘˜çš„è®¿é—®å±æ€§åœ¨æ´¾ç”Ÿç±»ä¸­åˆ†åˆ«å˜æˆï¼šprivate, private, private\nä½†æ— è®ºå“ªç§ç»§æ‰¿æ–¹å¼ï¼Œä¸Šé¢ä¸¤ç‚¹éƒ½æ²¡æœ‰æ”¹å˜ï¼š\nprivate æˆå‘˜åªèƒ½è¢«æœ¬ç±»æˆå‘˜ï¼ˆç±»å†…ï¼Œä¸æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡ï¼‰å’Œå‹å…ƒè®¿é—®ï¼Œä¸èƒ½è¢«æ´¾ç”Ÿç±»è®¿é—®ï¼› protected æˆå‘˜å¯ä»¥è¢«æ´¾ç”Ÿç±»ï¼ˆç±»å†…ï¼Œä¸æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡ï¼‰è®¿é—®ã€‚ ç§æœ‰ç»§æ‰¿çš„ä½œç”¨ ç§æœ‰ç»§æ‰¿æ—¶ï¼Œç¼–è¯‘å™¨ä¸€èˆ¬ä¸ä¼šå°†æ´¾ç”Ÿç±»å¯¹è±¡è½¬æ¢æˆåŸºç±»å¯¹è±¡ã€‚ä¸”æ´¾ç”Ÿç±»ä¸åŸºç±»ä¸æ˜¯ is a çš„å…³ç³»ï¼Œè€Œæ˜¯æ„å‘³ç€â€œis implement in terms ofâ€ï¼ˆä»¥\u0026hellip;\u0026hellip;å®ç°ï¼‰çš„å…³ç³»ã€‚å¦‚æœç±»Dç§æœ‰ç»§æ‰¿äºBï¼Œè¿™æ ·åšï¼Œåªæ˜¯å› ä¸ºDæƒ³ä½¿ç”¨Bä¸­çš„æŸäº›ä»£ç ï¼Œè€Œä¸æ˜¯å› ä¸ºç±»Dçš„å¯¹è±¡ä¸ç±»Bçš„å¯¹è±¡ä¹‹é—´å³ä»€ä¹ˆæ¦‚å¿µä¸Šçš„å…³ç³»ã€‚å› æ­¤ï¼Œç§æœ‰ç»§æ‰¿åœ¨è½¯ä»¶â€œè®¾è®¡â€è¿‡ç¨‹ä¸­æ¯«æ— æ„ä¹‰ï¼Œåªæ˜¯åœ¨è½¯ä»¶â€œå®ç°â€æ—¶æ‰æœ‰ç”¨ã€‚\nç§æœ‰ç»§æ‰¿ä¸ç»„åˆçš„ä¸åŒ ç»„åˆæ˜¯has aå…³ç³»ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„æŸäº›æ–¹æ³•ï¼Œå¯ä»¥ç”¨ç»„åˆï¼Œä¹Ÿå¯ä»¥ç§æœ‰ç»§æ‰¿ã€‚é€‰æ‹©å®ƒä»¬çš„åŸåˆ™æ˜¯å°½å¯èƒ½ä½¿ç”¨ç»„åˆï¼Œä¸‡ä¸å¾—å·²æ‰ä½¿ç”¨ç»§æ‰¿ã€‚ç»§æ‰¿æœ€å¤§çš„é—®é¢˜å°±åœ¨äºï¼šç»§æ‰¿å±‚æ¬¡è¿‡æ·±ã€ç»§æ‰¿å…³ç³»è¿‡äºå¤æ‚ä¼šå½±å“åˆ°ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ˆç»§æ‰¿äº†æ— ç”¨æˆ–è€…æœ‰å®³çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€ç­‰ï¼Œè¿˜æœ‰ï¼Œåœ¨ç»§æ‰¿æ—¶ï¼ŒåŸºç±»ä¹‹é—´æˆ–åŸºç±»ä¸æ´¾ç”Ÿç±»ä¹‹é—´å‘ç”Ÿæˆå‘˜åŒåæ—¶ï¼Œå°†å‡ºç°å¯¹æˆå‘˜è®¿é—®çš„ä¸ç¡®å®šæ€§ï¼Œå³åŒåäºŒä¹‰æ€§ï¼‰ã€‚ ç§æœ‰ç»§æ‰¿ä¸­æ´¾ç”Ÿç±»èƒ½è®¿é—®åŸºç±»çš„protectedæˆå‘˜ï¼Œå¹¶ä¸”å¯ä»¥é‡å†™åŸºç±»çš„è™šå‡½æ•°ï¼Œç”šè‡³å½“åŸºç±»æ˜¯æŠ½è±¡ç±»çš„æƒ…å†µã€‚ç»„åˆä¸å…·æœ‰è¿™æ ·çš„åŠŸèƒ½ã€‚ å¤šæ€ åŒä¸€ä¸ªæ–¹æ³•åœ¨æ´¾ç”Ÿç±»å’ŒåŸºç±»ä¸­çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼Œå³æ–¹æ³•çš„è¡Œä¸ºå–å†³äºè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚æœ‰ä¸¤ç§é‡è¦çš„æœºåˆ¶å¯ä»¥å®ç°å¤šæ€å…¬æœ‰ç»§æ‰¿ï¼š\nåœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰åŸºç±»çš„æ–¹æ³• ä½¿ç”¨è™šæ–¹æ³• ã€æ³¨æ„ã€‘åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰åŸºç±»çš„æ–¹æ³•ï¼Œä¼šå¯¼è‡´åŸºç±»æ–¹æ³•è¢«éšè—ï¼ˆå‡½æ•°éšè—ï¼‰ï¼Œè¿™ä¸æ˜¯é‡è½½ï¼Œé‡è½½æ˜¯ä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ä¸å¦ä¸€ä¸ªæ–¹æ³•åŒåï¼Œä½†æ˜¯å‚æ•°è¡¨ä¸åŒï¼Œè¿™ç§æ–¹æ³•ç§°ä¹‹ä¸ºé‡è½½æ–¹æ³•ã€‚\né‡è½½ä¸é‡å†™ é‡å†™ï¼ˆoverriedï¼Œè¦†ç›–ã€è¦†å†™ï¼‰ï¼šæ˜¯æŒ‡å­ç±»é‡æ–°å®šä¹‰çˆ¶ç±»è™šå‡½æ•°çš„æ–¹æ³•ã€‚ä¸å¤šæ€æœ‰å…³ã€‚\né‡è½½ï¼ˆoverloadï¼‰ï¼šæ˜¯æŒ‡å…è®¸å­˜åœ¨å¤šä¸ªåŒåå‡½æ•°ï¼Œè€Œè¿™äº›å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆæˆ–è®¸å‚æ•°ä¸ªæ•°ä¸åŒï¼Œæˆ–è®¸å‚æ•°ç±»å‹ä¸åŒï¼Œæˆ–è®¸ä¸¤è€…éƒ½ä¸åŒï¼‰è¿”å›å€¼ç±»å‹éšæ„ã€‚ä¸å¤šæ€æ— å…³ã€‚\nC++ä¸­ const ç”¨äºå‡½æ•°é‡è½½ã€‚å¸¸æˆå‘˜å‡½æ•°ä¸èƒ½æ›´æ–°ç±»çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨è¯¥ç±»ä¸­æ²¡æœ‰ç”¨constä¿®é¥°çš„æˆå‘˜å‡½æ•°ï¼Œåªèƒ½è°ƒç”¨å¸¸æˆå‘˜å‡½æ•°ã€‚éå¸¸é‡å¯¹è±¡å¯ä»¥è°ƒç”¨å¸¸æˆå‘˜å‡½æ•°å’Œéå¸¸æˆå‘˜å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæœ‰é‡è½½çš„éå¸¸æˆå‘˜å‡½æ•°åˆ™ä¼šè°ƒç”¨éå¸¸æˆå‘˜å‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class C { public: C(int v) : mValue(v){}; void fun() const { std::cout \u0026lt;\u0026lt; \u0026#34;void fun() const\u0026#34; \u0026lt;\u0026lt; std::endl; }; void fun() { std::cout \u0026lt;\u0026lt; \u0026#34;void fun()\u0026#34; \u0026lt;\u0026lt; std::endl; }; private: int mValue; }; int main() { const C c1(1); C c2(2); c1.fun(); c2.fun(); return 0; } /* æ‰“å° void fun() const void fun() **/ é¡¶å±‚constæ˜¯ä¸æ”¯æŒé‡è½½çš„ï¼Œå› ä¸ºå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå­˜åœ¨å½¢å®ç»“åˆçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸ç®¡æœ‰æ²¡æœ‰constéƒ½ä¸ä¼šæ”¹å˜å®å‚çš„å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 void fun(char *s) { std::cout \u0026lt;\u0026lt; \u0026#34;non-const fun() \u0026#34; \u0026lt;\u0026lt; s \u0026lt;\u0026lt; std::endl; } void fun(char *const s) // é¡¶å±‚ const ä¸æ”¯æŒé‡è½½ { std::cout \u0026lt;\u0026lt; \u0026#34;const fun() \u0026#34; \u0026lt;\u0026lt; s \u0026lt;\u0026lt; std::endl; } /** ç¼–è¯‘å‡ºé”™ test.cpp:21:6: error: redefinition of â€˜void fun(char*)â€™ void fun(char *const s) ^~~ test.cpp:16:6: note: â€˜void fun(char*)â€™ previously defined here void fun(char *s) ^~~ */ â€‹\tåº•å±‚constæ”¯æŒé‡è½½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 void fun(char *s) { std::cout \u0026lt;\u0026lt; \u0026#34;non-const fun() \u0026#34; \u0026lt;\u0026lt; s \u0026lt;\u0026lt; std::endl; } void fun(const char *s) // åº•å±‚ const æ”¯æŒé‡è½½ { std::cout \u0026lt;\u0026lt; \u0026#34;const fun() \u0026#34; \u0026lt;\u0026lt; s \u0026lt;\u0026lt; std::endl; } int main() { char *ptr1 = \u0026#34;hello\u0026#34;; const char *ptr2 = \u0026#34;world\u0026#34;; fun(ptr1); fun(ptr2); return 0; } /** non-const fun() hello const fun() world */ // å¯¹äºå¼•ç”¨ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå¦‚ // void fun(int \u0026amp;i) å’Œ void fun(const int \u0026amp;i) ä¹Ÿæ˜¯å¯ä»¥é‡è½½çš„ã€‚ // åŸå› æ˜¯ç¬¬ä¸€ä¸ª i å¼•ç”¨çš„æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œç¬¬äºŒä¸ª i å¼•ç”¨çš„æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸¤è€…æ˜¯ä¸ä¸€æ ·çš„ï¼Œç±»ä¼¼äºä¸Šé¢çš„æŒ‡å‘å˜é‡çš„æŒ‡é’ˆå’ŒæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆã€‚ æ„é€ å‡½æ•°ä¸ææ„å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class Line { private: double length; public: void setLength(double len); Line(double len); // æ„é€ å‡½æ•°çš„åç§°ä¸ç±»çš„åç§°å®Œå…¨ç›¸åŒã€‚ä¸ä¼šè¿”å›ä»»ä½•ç±»å‹ï¼Œä¹Ÿä¸ä¼šè¿”å› voidï¼Œå¸¸ç”¨äºèµ‹åˆå€¼ ~Line(); // ææ„å‡½æ•°ï¼Œå‡½æ•°åä¸ç±»å®Œå…¨ç›¸åŒï¼Œåªæ˜¯åœ¨å‰é¢åŠ äº†ä¸€ä¸ªæ³¢æµªå·ï¼ˆ~ï¼‰ä½œä¸ºå‰ç¼€ï¼Œå®ƒä¸ä¼šè¿”å›ä»»ä½•å€¼ï¼Œä¹Ÿä¸ä¼šè¿”å›voidï¼Œä¹Ÿä¸èƒ½å¸¦æœ‰ä»»ä½•å‚æ•°ï¼ˆæ‰€ä»¥ä¸å¯ä»¥è¢«é‡è½½ï¼‰ã€‚ææ„å‡½æ•°æœ‰åŠ©äºåœ¨è·³å‡ºç¨‹åºï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶ã€é‡Šæ”¾å†…å­˜ç­‰ï¼‰å‰é‡Šæ”¾èµ„æºã€‚ double Line::getLength(void) //æ–¹æ³•å¯ä»¥å®šä¹‰åœ¨ç±»ä¸­ { return length; } }; Line::Line(double len) // æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡èŒƒå›´è§£æè¿ç®—ç¬¦å®šä¹‰åœ¨ç±»å¤–ï¼Œè¿™æ˜¯æ„é€ å‡½æ•°çš„å…·ä½“å®ç°ï¼Œæ³¨æ„å‡½æ•°å‰æ— ç±»å‹ { cout \u0026lt;\u0026lt; \u0026#34;Object is being created, length = \u0026#34; \u0026lt;\u0026lt; len \u0026lt;\u0026lt; endl; length = len; //åˆå§‹åŒ–å±æ€§ } Line::~Line(void) { cout \u0026lt;\u0026lt; \u0026#34;Object is being deleted\u0026#34; \u0026lt;\u0026lt; endl; } ä¹Ÿå¯ä»¥ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹å±æ€§\n1 2 3 4 Line::Line( double len): length(len) { cout \u0026lt;\u0026lt; \u0026#34;Object is being created, length = \u0026#34; \u0026lt;\u0026lt; len \u0026lt;\u0026lt; endl; } 1 2 3 4 5 6 // åŒæ—¶åˆå§‹åŒ–å¤šä¸ªå€¼ Person::Person( double name, double age, double job): Name(name), Age(age), Job(job) // å°†å‚æ•° name, age, job åˆå§‹åŒ–ç»™å±æ€§ Name, Age, Job { .... } æ„é€ å‡½æ•°ä¸åŒäºç±»æ–¹æ³•ï¼Œå› ä¸ºå®ƒåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œå…¶ä»–ç±»å¯¹è±¡åªæ˜¯è¢«ç°æœ‰çš„ç±»è°ƒç”¨ã€‚è¿™æ˜¯æ„é€ å‡½æ•°ä¸èƒ½è¢«ç»§æ‰¿çš„åŸå› ä¹‹ä¸€ã€‚ ç»§æ‰¿æ„å‘³ç€æ´¾ç”Ÿç±»ç»§æ‰¿åŸºç±»çš„æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡ï¼Œç„¶è€Œï¼Œåœ¨æ„é€ å‡½æ•°å®Œæˆå…¶å·¥ä½œä¹‹å‰ï¼Œå¯¹è±¡å¹¶ä¸å­˜åœ¨ã€‚\nä¸€å®šè¦ä½¿ç”¨æ˜¾å¼ææ„å‡½æ•°æ¥é‡Šæ”¾ç±»æ„é€ å‡½æ•°ä½¿ç”¨ new åˆ†é…çš„æ‰€æœ‰å†…å­˜ï¼Œå¹¶å®Œæˆç±»å¯¹è±¡æ‰€éœ€çš„ä»»ä½•ç‰¹æ®Šçš„æ¸…ç†å·¥ä½œã€‚å¯¹äºåŸºç±»å³ä½¿å®ƒä¸éœ€è¦ææ„å‡½æ•°ï¼Œä¹Ÿåº”æä¾›ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚\nåˆå§‹åŒ–æ´¾ç”Ÿç±»æŠŠåŸºç±»ä¸­æ‰€æœ‰çš„æˆå‘˜ç»§æ‰¿è¿‡æ¥ï¼Œé™¤äº†æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ã€‚å‹å…ƒå‡½æ•°ä¸å±äºç±»ï¼Œå®ƒåªæ˜¯ç»™ç±»å¼€äº†ä¸€ä¸ªåé—¨ï¼Œè‡ªç„¶ä¸èƒ½è¢«ç»§æ‰¿ã€‚å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œé‚£ä¹ˆé»˜è®¤çš„ï¼Œå°±æ˜¯ç»§æ‰¿äº†çˆ¶ç±»çš„æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡ã€‚\nåˆå§‹åŒ–å­ç±»æ—¶ï¼Œä¼šå…ˆè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç„¶åæ‰è°ƒç”¨å­ç±»çš„æ„é€ å‡½æ•°ã€‚\nææ„æ—¶ï¼ŒæŒ‰ç›¸åé¡ºåºè¿›è¡Œã€‚\næ„é€ ä»ç±»å±‚æ¬¡çš„æœ€æ ¹å¤„å¼€å§‹ï¼Œåœ¨æ¯ä¸€å±‚ä¸­ï¼Œé¦–å…ˆè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨æˆå‘˜å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ææ„åˆ™ä¸¥æ ¼æŒ‰ç…§ä¸æ„é€ ç›¸åçš„æ¬¡åºæ‰§è¡Œï¼Œè¯¥æ¬¡åºæ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†æ— æ³•è‡ªåŠ¨æ‰§è¡Œææ„è¿‡ç¨‹ã€‚\nã€PLUS 524ï¼Œ525ï¼Œ527ã€‘\nä¸åŒäºå…¶ä»–å‡½æ•°ï¼Œæ„é€ å‡½æ•°ä¸èƒ½è¢«å£°æ˜ä¸ºconstã€‚å½“æˆ‘ä»¬åˆ›å»ºç±»çš„ä¸€ä¸ªconstå¯¹è±¡æ—¶ï¼Œç›´åˆ°æ„é€ å‡½æ•°å®Œæˆåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¯¹è±¡æ‰çœŸæ­£å–å¾—å…¶å¸¸é‡å±æ€§ã€‚å› æ­¤ï¼Œæ„é€ å‡½æ•°åœ¨constå¯¹è±¡çš„æ„é€ è¿‡ç¨‹ä¸­å¯ä»¥å‘å…¶å†™å€¼ã€‚\nã€PRIMER 235ã€‘\næ„é€ å‡½æ•°å¯ä»¥è¢«é‡è½½ï¼Œææ„å‡½æ•°ä¸å¯ä»¥è¢«é‡è½½ã€‚å› ä¸ºææ„å‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªä¸”ä¸å¸¦å‚æ•°ã€‚\nå§”æ‰˜æ„é€ å‡½æ•° C++11æ‰©å±•äº†æ„é€ å‡½æ•°åˆå§‹å€¼åŠŸèƒ½ï¼Œå¯ä»¥å®šä¹‰å§”æ‰˜æ„é€ å‡½æ•°ã€‚å§”æ‰˜æ„é€ å‡½æ•°ä½¿ç”¨å®ƒæ‰€å±ç±»çš„å…¶ä»–æ„é€ å‡½æ•°æ‰§è¡Œå®ƒè‡ªå·±çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ã€PRIMER 261ã€‘\n= defaultå’Œ= delete åœ¨C++ä¸­ï¼Œå£°æ˜è‡ªå®šä¹‰çš„ç±»å‹ä¹‹åï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤ç”Ÿæˆä¸€äº›æˆå‘˜å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¢«ç§°ä¸ºé»˜è®¤å‡½æ•°ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 class A { // C++03 A(); // é»˜è®¤æ„é€ å‡½æ•° A(const A \u0026amp;); // æ‹·è´æ„é€ å‡½æ•° ~A(); // ææ„å‡½æ•° A \u0026amp;operator=(const A \u0026amp;); // æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ // C++11 æ–°å¢ A(A \u0026amp;\u0026amp;); // ç§»åŠ¨æ„é€ å‡½æ•° A \u0026amp;operator=(A \u0026amp;\u0026amp;); // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ }; è¿™6ä¸ªå‡½æ•°çš„å®ç°ä¾‹å­ï¼Œä»¥stringä¸ºä¾‹ï¼ŒæŸ¥çœ‹å®ç°\nå¦å¤–ï¼Œç¼–è¯‘å™¨è¿˜ä¼šé»˜è®¤ç”Ÿæˆä¸€äº›æ“ä½œç¬¦å‡½æ•°ï¼ŒåŒ…æ‹¬ï¼š\nï¼ˆ7ï¼‰operator ,\nï¼ˆ8ï¼‰operator \u0026amp;ï¼Œæœ‰ä¸¤ä¸ªï¼Œconstç‰ˆæœ¬å’Œéconstç‰ˆæœ¬\n1 2 A* operator\u0026amp;(); //å–å€è¿ç®—ç¬¦ const A* operator\u0026amp;() const; //å–å€è¿ç®—ç¬¦(constç‰ˆæœ¬) ï¼ˆ9ï¼‰operator \u0026amp;\u0026amp;\nï¼ˆ10ï¼‰operator *\nï¼ˆ11ï¼‰operator -\u0026gt;\nï¼ˆ12ï¼‰operator -\u0026gt;*\nï¼ˆ13ï¼‰operator new\nï¼ˆ14ï¼‰operator delete\n= default æ˜¾ç¤ºç¼ºçœå‡½æ•° åªæœ‰å½“ç±»æ²¡æœ‰å£°æ˜ä»»ä½•æ„é€ å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€‚ä¸€æ—¦ç±»å®šä¹‰äº†å…¶ä»–æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆé™¤éå†æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™ç±»å°†æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ã€‚ã€PRIMER 236ã€‘\nåœ¨C++11ä¸­ï¼Œå¦‚æœç±»éœ€è¦é»˜è®¤çš„å‡½æ•°è¡Œä¸ºï¼Œå¯ä»¥é€šè¿‡åœ¨å‚æ•°åˆ—è¡¨åé¢æ·»åŠ =defaultæ¥è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆæ„é€ å‡½æ•°ã€‚å…¶ä¸­=defaultæ—¢å¯ä»¥å’Œå‡½æ•°å£°æ˜ä¸€èµ·å‡ºç°åœ¨ç±»çš„å†…éƒ¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå®šä¹‰å‡ºç°åœ¨ç±»çš„å¤–éƒ¨ã€‚å’Œå…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œå¦‚æœ=defaultåœ¨ç±»çš„å†…éƒ¨ï¼Œåˆ™é»˜è®¤æ„é€ å‡½æ•°æ˜¯å†…è”çš„ã€‚\n1 Sales_data() = default; = delete æ˜¾ç¤ºåˆ é™¤å‡½æ•° å¦ä¸€æ–¹é¢ï¼Œæœ‰æ—¶å€™å¯èƒ½éœ€è¦é™åˆ¶ä¸€äº›é»˜è®¤å‡½æ•°çš„ç”Ÿæˆã€‚\nä¾‹å¦‚ï¼šéœ€è¦ç¦æ­¢æ‹·è´æ„é€ å‡½æ•°çš„ä½¿ç”¨ã€‚ä»¥å‰é€šè¿‡æŠŠæ‹·è´æ„é€ å‡½æ•°å£°æ˜ä¸ºprivateè®¿é—®æƒé™ï¼Œè¿™æ ·ä¸€æ—¦ä½¿ç”¨ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚\nè€Œåœ¨ C++11 ä¸­ï¼Œåªè¦åœ¨å‡½æ•°çš„å®šä¹‰æˆ–è€…å£°æ˜åé¢åŠ ä¸Š= deleteå°±èƒ½å®ç°è¿™æ ·çš„æ•ˆæœã€‚è¿™ç§æ–¹å¼ä¸å®¹æ˜“çŠ¯é”™ï¼Œä¸”æ›´å®¹æ˜“ç†è§£ã€‚\nåœ¨C ++ 11ä¹‹å‰ï¼Œæ“ä½œç¬¦delete åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå³é‡Šæ”¾å·²åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚è€ŒC ++ 11æ ‡å‡†å¼•å…¥äº†æ­¤æ“ä½œç¬¦çš„å¦ä¸€ç§ç”¨æ³•ï¼Œå³ï¼šç¦ç”¨æˆå‘˜å‡½æ•°çš„ä½¿ç”¨ã€‚è¿™æ˜¯é€šè¿‡é™„åŠ = deleteè¯´æ˜ç¬¦åˆ°è¯¥å‡½æ•°å£°æ˜çš„ç»“å°¾ã€‚\næ‹·è´ï¼ˆå¤åˆ¶ï¼‰æ„é€ å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 class Line { public: Line(int len); //æ„é€ å‡½æ•° Line(const Line \u0026amp;obj); //æ‹·è´æ„é€ å‡½æ•° ~Line(); // ææ„å‡½æ•° private: int *ptr; }; // æˆå‘˜å‡½æ•°å®šä¹‰ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•° Line::Line(int len) { cout \u0026lt;\u0026lt; \u0026#34;è°ƒç”¨æ„é€ å‡½æ•°\u0026#34; \u0026lt;\u0026lt; endl; // ä¸ºæŒ‡é’ˆåˆ†é…å†…å­˜ ptr = new int; *ptr = len; } Line::Line(const Line \u0026amp;obj) { cout \u0026lt;\u0026lt; \u0026#34;è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°å¹¶ä¸ºæŒ‡é’ˆ ptr åˆ†é…å†…å­˜\u0026#34; \u0026lt;\u0026lt; endl; ptr = new int; *ptr = *obj.ptr; // æ‹·è´å€¼ } Line::~Line(void) { cout \u0026lt;\u0026lt; \u0026#34;é‡Šæ”¾å†…å­˜\u0026#34; \u0026lt;\u0026lt; endl; delete ptr; } ä»€ä¹ˆæƒ…å†µä½¿ç”¨æ‹·è´æ„é€ å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 class Test { public: int a; Test(int x) : a(x) { cout \u0026lt;\u0026lt; \u0026#34;Test(int x)\u0026#34; \u0026lt;\u0026lt; endl; } Test(const Test\u0026amp; t) { cout \u0026lt;\u0026lt; \u0026#34;copy constructor\u0026#34; \u0026lt;\u0026lt; endl; a = t.a; } }; void fun1(Test test) { cout \u0026lt;\u0026lt; \u0026#34;fun1()\u0026#34; \u0026lt;\u0026lt; endl; } Test fun2() { Test t(2); cout \u0026lt;\u0026lt; \u0026#34;fun2()\u0026#34; \u0026lt;\u0026lt; endl; return t; } int main(int argc, char* argv[]) { Test t1(1); cout \u0026lt;\u0026lt; \u0026#34;-------\\n\u0026#34;; Test t2(t1);\t// é€šè¿‡ä½¿ç”¨å¦ä¸€ä¸ªåŒç±»å‹çš„å¯¹è±¡æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ cout \u0026lt;\u0026lt; \u0026#34;-------\\n\u0026#34;; fun1(t1);\t// å¤åˆ¶å¯¹è±¡æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ cout \u0026lt;\u0026lt; \u0026#34;-------\\n\u0026#34;; fun2();\t// å¤åˆ¶å¯¹è±¡ï¼Œå¹¶ä»å‡½æ•°è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡æ—¶è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ã€‚ //Test t3 = fun2(); getchar(); return 0; } /* æ‰“å° Test(int x) ------- copy constructor ------- copy constructor fun1() ------- Test(int x) fun2() copy constructor */ **ç±»çš„å¯¹è±¡éœ€è¦æ‹·è´æ—¶ï¼Œæ‹·è´æ„é€ å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ã€‚**ä»¥ä¸‹æƒ…å†µéƒ½ä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼š\né€šè¿‡ä½¿ç”¨å¦ä¸€ä¸ªåŒç±»å‹çš„å¯¹è±¡æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ å¤åˆ¶å¯¹è±¡ï¼ŒæŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ å¤åˆ¶å¯¹è±¡ï¼Œå¹¶ä»å‡½æ•°è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚ æµ…å¤åˆ¶ä¸æ·±å¤åˆ¶ å¦‚æœåœ¨ç±»ä¸­æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆï¼Œç¼–è¯‘å™¨å°†ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°å®Œæˆå¯¹è±¡ä¹‹é—´çš„æµ…å¤åˆ¶ã€‚\nè‡ªå®šä¹‰å¤åˆ¶æ„é€ å‡½æ•°æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹é£æ ¼ï¼Œå®ƒå¯ä»¥é˜»æ­¢ç¼–è¯‘å™¨å½¢æˆé»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°ï¼Œæé«˜æºç æ•ˆç‡ã€‚\næ‰€è°“æµ…å¤åˆ¶ï¼Œç›´æ¥ä¸ºæ•°æ®æˆå‘˜èµ‹å€¼å³å¯ã€‚æ¯”å¦‚ä¸€ä¸ªå®ç±» c1 é‡Œçš„æ•°æ®æˆå‘˜é‡Œæœ‰ä¸€ä¸ªæŒ‡é’ˆ c1.p æŒ‡å‘å­—ç¬¦æ•°ç»„ str[] = â€œhelloâ€ï¼Œä½¿ç”¨æµ…å¤åˆ¶æ¥åˆå§‹åŒ–ç±» c2ï¼Œåˆ™èµ‹å€¼ä¸º c2.p = c1.pï¼Œé‚£ä¹ˆé€šè¿‡ c1.p æ”¹å˜äº† strï¼Œc2.p æŒ‡å‘çš„å†…å®¹ä¹Ÿä¼šæ”¹å˜ã€‚\nè€Œæ·±å¤åˆ¶è¦åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè¦ä¸ºå¯¹è±¡çš„æ•°æ®æˆå‘˜åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œç›´æ¥èµ‹å€¼å°±å°†å€¼ä¿å­˜åœ¨ç›¸åº”çš„ç©ºé—´ä¸­ã€‚æ¯”å¦‚\n1 2 3 // c1, c2 å‡æ˜¯ç±» c2.p = new char[strlen(c1.p) + 1]; strcpy(c2.p, c1.p); è®© c2.p æŒ‡å‘ new å‡ºæ¥çš„ç©ºé—´ï¼Œè¿™æ—¶ c1.p é‡Œçš„å†…å®¹æ”¹å˜äº†ä¹Ÿä¸ä¼šå½±å“ c2.pã€‚\nç¼–è¯‘å™¨ä¸é»˜è®¤çš„ copy constructor å¦‚æœç”¨æˆ·å®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆä¸æ˜¯æ‹·è´æ„é€ å‡½æ•°ï¼‰ï¼Œä¸”æ­¤æ—¶åœ¨ä»£ç ä¸­ç”¨åˆ°äº†æ‹·è´æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šç”Ÿæˆé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°ï¼›å¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šç”Ÿæˆé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°ï¼› å¦‚æœç”¨æˆ·å®šä¹‰äº†æ‹·è´æ„é€ å‡½æ•°ï¼Œåˆ™ç¼–è¯‘å™¨å°±ä¸ä¼šå†ç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°ã€‚ ä¸ºä»€ä¹ˆå¤åˆ¶æ„é€ å‡½æ•°å¯ä»¥è®¿é—®å‚æ•°å¯¹è±¡çš„ç§æœ‰æˆå‘˜ å°è£…æ˜¯ç¼–è¯‘æœŸçš„æ¦‚å¿µï¼Œæ˜¯é’ˆå¯¹ç±»å‹è€Œéå¯¹è±¡çš„ï¼Œåœ¨ç±»çš„æˆå‘˜å‡½æ•°ä¸­å¯ä»¥è®¿é—®åŒç±»å‹å®ä¾‹å¯¹è±¡çš„ç§æœ‰æˆå‘˜å˜é‡ã€‚\nå‚è€ƒï¼šhttps://blog.csdn.net/ganwenbo2011/article/details/100919900\næ‹·è´æ„é€ å‡½æ•°ä¸èµ‹å€¼å‡½æ•°çš„åŒºåˆ« 1 2 A (const A\u0026amp;other) // æ‹·è´æ„é€ å‡½æ•°é‡è½½å£°æ˜ A\u0026amp; operator = (const A\u0026amp; other) // èµ‹å€¼å‡½æ•°é‡è½½å£°æ˜ ä¸€èˆ¬æ¥è¯´åœ¨æ•°æ®æˆå‘˜åŒ…å«æŒ‡é’ˆå¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸¤ç§ä¸åŒçš„å¤„ç†éœ€æ±‚ï¼šä¸€ç§æ˜¯å¤åˆ¶æŒ‡é’ˆå¯¹è±¡ï¼Œå¦ä¸€ç§æ˜¯å¼•ç”¨æŒ‡é’ˆå¯¹è±¡ã€‚æ‹·è´æ„é€ å‡½æ•°å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¤åˆ¶ï¼Œè€Œèµ‹å€¼å‡½æ•°æ˜¯å¼•ç”¨å¯¹è±¡ã€‚\næ‹·è´æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡åˆå§‹åŒ–ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¿™å—å†…å­˜å°±æ˜¯æ–°å¯¹è±¡çš„å†…å­˜åŒºã€‚èµ‹å€¼æ„é€ å‡½æ•°åˆ™æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªåŸæœ‰çš„å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œå¯¹äºèµ‹å€¼å‡½æ•°ï¼Œå¦‚æœåŸæ¥çš„å¯¹è±¡ä¸­æœ‰å†…å­˜åˆ†é…ï¼Œå°±è¦å…ˆæŠŠå†…å­˜é‡Šæ”¾æ‰ï¼Œè€Œä¸”è¿˜è¦æ£€æŸ¥ä¸€ä¸‹ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¸åšä»»ä½•æ£€æµ‹ã€‚\n1 2 3 4 5 6 class A; A a; A b = a; // è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼ˆb ä¸å­˜åœ¨ï¼‰ A c(a) ; // è°ƒç”¨æ‹·è´æ„é€ å‡½æ•° A d; d = a; // è°ƒç”¨èµ‹å€¼å‡½æ•°ï¼ˆd å·²åˆå§‹åŒ–ï¼‰ ä»¥å­—ç¬¦ä¸²çš„ä¸ºä¾‹å­ï¼Œç†è§£æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 String::String(const String \u0026amp;other) //æ‹·è´æ„é€ å‡½æ•° { cout \u0026lt;\u0026lt; \u0026#34;copy construct\u0026#34; \u0026lt;\u0026lt; endl; m_string = new char[strlen(other.m_string) + 1]; //åˆ†é…ç©ºé—´å¹¶æ‹·è´ strcpy(m_string, other.m_string); } String \u0026amp;String::operator=(const String \u0026amp;other) //èµ‹å€¼è¿ç®—ç¬¦ { cout \u0026lt;\u0026lt; \u0026#34;operator =funtion\u0026#34; \u0026lt;\u0026lt; endl; if (this == \u0026amp;other) //å¦‚æœå¯¹è±¡å’Œotheræ˜¯ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥è¿”å›æœ¬èº« { return *this; } delete[] m_string; //å…ˆé‡Šæ”¾åŸæ¥çš„å†…å­˜ m_string = new char[strlen(other.m_string) + 1]; strcpy(m_string, other.m_string); return *this; } ä¸´æ—¶å¯¹è±¡çš„å¤åˆ¶ä¸ææ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 class C { public: C() : mValue(0) { std::cout \u0026lt;\u0026lt; \u0026#34;default constructor, value = \u0026#34; \u0026lt;\u0026lt; mValue \u0026lt;\u0026lt; std::endl; }; C(const C \u0026amp;c) { mValue = c.mValue; std::cout \u0026lt;\u0026lt; \u0026#34;copy constructor, value = \u0026#34; \u0026lt;\u0026lt; mValue \u0026lt;\u0026lt; \u0026#34;, this = \u0026#34; \u0026lt;\u0026lt; std::hex \u0026lt;\u0026lt; this \u0026lt;\u0026lt; std::endl; }; C \u0026amp;operator=(const C \u0026amp;c) { if (this == \u0026amp;c) return *this; mValue = c.mValue; std::cout \u0026lt;\u0026lt; \u0026#34;assignment function, value = \u0026#34; \u0026lt;\u0026lt; mValue \u0026lt;\u0026lt; \u0026#34;, this = \u0026#34; \u0026lt;\u0026lt; std::hex \u0026lt;\u0026lt; this \u0026lt;\u0026lt; std::endl; return *this; }; C(int v) : mValue(v) { std::cout \u0026lt;\u0026lt; \u0026#34;constructed by parameter: \u0026#34; \u0026lt;\u0026lt; std::dec \u0026lt;\u0026lt; mValue \u0026lt;\u0026lt; \u0026#34;, this = \u0026#34; \u0026lt;\u0026lt; std::hex \u0026lt;\u0026lt; this \u0026lt;\u0026lt; std::endl; }; virtual ~C() { std::cout \u0026lt;\u0026lt; \u0026#34;destructor, value = \u0026#34; \u0026lt;\u0026lt; mValue \u0026lt;\u0026lt; \u0026#34;, this = \u0026#34; \u0026lt;\u0026lt; std::hex \u0026lt;\u0026lt; this \u0026lt;\u0026lt; std::endl; }; private: int mValue; }; C create(C c) { std::cout \u0026lt;\u0026lt; \u0026#34;start creat\u0026#34; \u0026lt;\u0026lt; std::endl; return c; } int main() { C c1 = create(5); std::cout \u0026lt;\u0026lt; \u0026#34;finish creat c1\u0026#34; \u0026lt;\u0026lt; std::endl; C c2 = create(c1); std::cout \u0026lt;\u0026lt; \u0026#34;finish creat c2\u0026#34; \u0026lt;\u0026lt; std::endl; C c3 = create(8); std::cout \u0026lt;\u0026lt; \u0026#34;finish creat c3\u0026#34; \u0026lt;\u0026lt; std::endl; C c4 = 12; std::cout \u0026lt;\u0026lt; \u0026#34;finish creat c4\u0026#34; \u0026lt;\u0026lt; std::endl; c4 = c1; return 0; } // g++ test.cpp -o test -std=c++11 -m32 /* æ‰“å° constructed by parameter: 5, this = 0xffb5a528 // create å‡½æ•°å€¼ä¼ é€’ï¼Œè°ƒç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ start creat copy constructor, value = 5, this = 0xffb5a520 // return å€¼ï¼Œè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ destructor, value = 5, this = 0xffb5a528 // ææ„å€¼ä¼ é€’æ‰€äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡ï¼ˆå½¢å‚ï¼‰ finish creat c1 copy constructor, value = 5, this = 0xffb5a530 // create å‡½æ•°å€¼ä¼ é€’ï¼Œè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ start creat copy constructor, value = 5, this = 0xffb5a518 // return å€¼ï¼Œè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ destructor, value = 5, this = 0xffb5a530 // ææ„å€¼ä¼ é€’æ‰€äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡ï¼ˆå½¢å‚ï¼‰ finish creat c2 constructed by parameter: 8, this = 0xffb5a538 // create å‡½æ•°å€¼ä¼ é€’ï¼Œè°ƒç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ start creat copy constructor, value = 8, this = 0xffb5a510 // return å€¼ï¼Œè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ destructor, value = 8, this = 0xffb5a538 // ææ„å€¼ä¼ é€’æ‰€äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡ï¼ˆå½¢å‚ï¼‰ finish creat c3 constructed by parameter: 12, this = 0xffb5a508 // éšå¼è½¬æ¢ï¼Œè°ƒç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•° finish creat c4 assignment function, value = 5, this = 0xffb5a508 // è°ƒç”¨èµ‹å€¼å‡½æ•°ï¼Œå°† c1 èµ‹ç»™ c4 destructor, value = 5, this = 0xffb5a508 // c4 ææ„ destructor, value = 8, this = 0xffb5a510 // c3 ææ„ destructor, value = 5, this = 0xffb5a518 // c2 ææ„ destructor, value = 5, this = 0xffb5a520 // c1 ææ„ */ ç©ºç±»çš„æˆå‘˜å‡½æ•° 1 2 3 4 5 6 7 8 9 10 class Empty { public: Empty(); Empty(const Empty\u0026amp; ); ~Empty(); Empty\u0026amp; operator=(consy Empty\u0026amp; ); Empty* operator\u0026amp; (); // å–åœ°å€è¿ç®—ç¬¦ const Empty* operator\u0026amp; () const; // const ç±»å‹å–åœ°å€è¿ç®—ç¬¦ }; ç¼ºçœæ„é€ å‡½æ•°ã€‚ ç¼ºçœæ‹·è´æ„é€ å‡½æ•°ã€‚ ç¼ºçœææ„å‡½æ•°ã€‚ èµ‹å€¼è¿ç®—ç¬¦ã€‚ å–å€è¿ç®—ç¬¦ã€‚ å–å€è¿ç®—ç¬¦ const ã€‚ æœ‰äº›ä¹¦ä¸Šåªæ˜¯ç®€å•çš„ä»‹ç»äº†å‰å››ä¸ªå‡½æ•°ã€‚æ²¡æœ‰æåŠåé¢è¿™ä¸¤ä¸ªå‡½æ•°ã€‚ä½†åé¢è¿™ä¸¤ä¸ªå‡½æ•°ä¹Ÿæ˜¯ç©ºç±»çš„é»˜è®¤å‡½æ•°ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å½“å®é™…ä½¿ç”¨è¿™äº›å‡½æ•°çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨æ‰ä¼šå»å®šä¹‰å®ƒä»¬ã€‚\nåˆå§‹åŒ–åˆ—è¡¨ ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„åŸå›  åˆå§‹åŒ–ç±»çš„æˆå‘˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼ŒäºŒæ˜¯åœ¨æ„é€ å‡½æ•°ä½“å†…è¿›è¡Œèµ‹å€¼æ“ä½œã€‚\nä¸»è¦æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå¯¹äºå†…ç½®ç±»å‹ï¼Œå¦‚ int, float ç­‰ï¼Œä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å’Œåœ¨æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–å·®åˆ«ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯å¯¹äºç±»ç±»å‹æ¥è¯´ï¼Œæœ€å¥½ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œå› ä¸ºä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å°‘äº†ä¸€æ¬¡è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°çš„è¿‡ç¨‹ï¼Œè¿™å¯¹äºæ•°æ®å¯†é›†å‹çš„ç±»æ¥è¯´ï¼Œæ˜¯éå¸¸é«˜æ•ˆçš„ï¼ˆå‚è€ƒä¸‹æ–‡ä»£ç æ®µä¾‹1ï¼‰ã€‚\nå¿…é¡»ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æƒ…å†µ ï¼ˆåªèƒ½ä½¿ç”¨åˆå§‹åŒ–è€Œä¸èƒ½èµ‹å€¼ï¼‰ã€PRIMER 259ã€‘\nåˆå§‹åŒ–å’Œèµ‹å€¼çš„åŒºåˆ«äº‹å…³åº•å±‚æ•ˆç‡ï¼šå‰è€…ç›´æ¥åˆå§‹åŒ–æ•°æ®æˆå‘˜ï¼Œåè€…åˆ™å…ˆåˆå§‹åŒ–å†èµ‹å€¼ã€‚\né™¤äº†æ•ˆç‡é—®é¢˜ä¹‹å¤–ï¼Œæœ‰äº›æ—¶å€™åˆå§‹åŒ–åˆ—è¡¨æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶å¿…é¡»ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼š\nå¸¸é‡æˆå‘˜ï¼Œå› ä¸ºå¸¸é‡åªèƒ½åˆå§‹åŒ–ä¸èƒ½èµ‹å€¼ï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨åˆå§‹åŒ–åˆ—è¡¨é‡Œé¢ï¼›\nå¼•ç”¨ç±»å‹ï¼Œå¼•ç”¨å¿…é¡»åœ¨å®šä¹‰çš„æ—¶å€™åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¸èƒ½é‡æ–°èµ‹å€¼ï¼Œæ‰€ä»¥ä¹Ÿè¦å†™åœ¨åˆå§‹åŒ–åˆ—è¡¨é‡Œé¢ï¼›\næ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°çš„ç±»ç±»å‹ï¼ˆæ¯”å¦‚æ„é€ å‡½æ•°ä¸ºç§æœ‰ï¼‰ï¼Œå› ä¸ºä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å¯ä»¥ä¸å¿…è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚ï¼ˆå‚è€ƒä¸‹æ–‡ä»£ç æ®µä¾‹1ï¼‰\nå¦‚æœåœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­éœ€è¦åˆå§‹åŒ–çˆ¶ç±»çš„ private æˆå‘˜ã€‚ç›´æ¥å¯¹å…¶èµ‹å€¼æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ‰èƒ½å®Œæˆå¯¹å®ƒçš„åˆå§‹åŒ–ã€‚ï¼ˆå‚è€ƒä¸‹æ–‡ä»£ç æ®µä¾‹2ï¼‰\nã€æ€»ç»“ã€‘å½“ç±»ä¸­å«æœ‰ const å¸¸é‡ã€reference æˆå‘˜å˜é‡ï¼›åŸºç±»çš„æ„é€ å‡½æ•°éƒ½éœ€è¦åˆå§‹åŒ–åˆ—è¡¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // ä¾‹1 class A { public: int num; A() // æ— å‚æ„é€ å‡½æ•° { cout \u0026lt;\u0026lt; \u0026#34;Construct A\u0026#34; \u0026lt;\u0026lt; endl; } A(const A \u0026amp;obj) // æ‹·è´æ„é€ å‡½æ•° { cout \u0026lt;\u0026lt; \u0026#34;Copy constructor for A\u0026#34; \u0026lt;\u0026lt; endl; this-\u0026gt;num = obj.num; } A \u0026amp;operator=(const A \u0026amp;obj) // èµ‹å€¼è¿ç®—ç¬¦ { cout \u0026lt;\u0026lt; \u0026#34;assignment for A\u0026#34; \u0026lt;\u0026lt; endl; this-\u0026gt;num = obj.num; return *this; } }; class B { public: A a; B(A \u0026amp;obj) { a = obj; } // ã€1ã€‘ //B(A \u0026amp;obj) : a(obj) {} // ã€2ã€‘ }; int main() { A a; B b(a); return 0; } /** * å¼€æ”¾ã€1ã€‘æ³¨é‡Šã€2ã€‘æ‰“å° * Construct A // main å‡½æ•°é‡Œçš„ A a æ‰“å° * Construct A // å› ä¸ºåœ¨ class B ä¸­ï¼Œè¯­å¥ A a è°ƒç”¨äº†é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–å°±ä¸è°ƒç”¨å®ƒï¼Œè½¬è€Œå»è°ƒç”¨æ‹·è´æ„é€ å‡½æ•° * assignment for A * å¼€æ”¾ã€2ã€‘æ³¨é‡Šã€1ã€‘æ‰“å° * Construct A * Copy constructor for A */ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // ä¾‹2 class A { private: int a; public: A(int x) : a(x) {} }; class B : public A { private: int b; public: B(int x, int y) : A(x) { // a = x;\t// a ä¸º privateï¼Œæ— æ³•åœ¨å­ç±»ä¸­è¢«è®¿é—® // A(x);\t// åœ¨å‡½æ•°ä½“å†…è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸åˆæ³• b = y; } }; åˆå§‹åŒ–é¡ºåº æˆå‘˜æ˜¯æŒ‰ç…§ä»–ä»¬åœ¨ç±»ä¸­å‡ºç°çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–çš„ï¼Œè€Œä¸æ˜¯æŒ‰ç…§ä»–ä»¬åœ¨åˆå§‹åŒ–åˆ—è¡¨å‡ºç°çš„é¡ºåºåˆå§‹åŒ–çš„ã€‚\n1 2 3 4 5 6 class foo { public: int i; int j; foo(int x): i(x), j(i) {} // ok, å…ˆåˆå§‹åŒ– iï¼Œååˆå§‹åŒ– j }; å†çœ‹ä¸‹é¢çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 class foo { public: int i; int j; foo(int x): j(x), i(j) {} // i å€¼æœªå®šä¹‰ /* è¿™é‡Œ i çš„å€¼æ˜¯æœªå®šä¹‰ã€‚å› ä¸ºè™½ç„¶ j åœ¨åˆå§‹åŒ–åˆ—è¡¨é‡Œé¢å‡ºç°åœ¨ i å‰é¢ï¼Œ ä½†æ˜¯ i å…ˆäº j å®šä¹‰ï¼Œæ‰€ä»¥å…ˆåˆå§‹åŒ– iï¼Œè€Œ i ç”± j åˆå§‹åŒ–ï¼Œ æ­¤æ—¶ j å°šæœªåˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯¼è‡´ i çš„å€¼æœªå®šä¹‰ã€‚ ä¸€ä¸ªå¥½çš„ä¹ æƒ¯æ˜¯ï¼ŒæŒ‰ç…§æˆå‘˜å®šä¹‰çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ã€‚ */ }; å‹å…ƒ å‹å…ƒå‡½æ•° å‹å…ƒå‡½æ•°å£°æ˜åªèƒ½å‡ºç°åœ¨ç±»å®šä¹‰çš„å†…éƒ¨ï¼Œåœ¨ç±»å†…éƒ¨å‡ºç°çš„ä½ç½®ä¸é™ï¼ˆä¸€èˆ¬åœ¨ç±»å®šä¹‰çš„å¼€å§‹æˆ–ç»“æŸå‰çš„ä½ç½®é›†ä¸­å£°æ˜å‹å…ƒï¼‰ã€‚å‹å…ƒä¸æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œä¹Ÿä¸å—å®ƒæ‰€åœ¨åŒºåŸŸè®¿é—®æ§åˆ¶çº§åˆ«çš„çº¦æŸã€‚\nå‹å…ƒå£°æ˜ä»…ä»…æŒ‡å®šäº†è®¿é—®æƒé™ï¼Œè€Œå¹¶éä¸€ä¸ªé€šå¸¸æ„ä¹‰ä¸Šçš„å‡½æ•°å£°æ˜ã€‚å¦‚æœå¸Œæœ›ç±»çš„ç”¨æˆ·èƒ½è°ƒç”¨æŸä¸ªå‹å…ƒå‡½æ•°ï¼Œå°±å¿…é¡»åœ¨å‹å…ƒå£°æ˜ä¹‹å¤–å†ä¸“é—¨å¯¹å‡½æ•°è¿›è¡Œä¸€æ¬¡å£°æ˜ï¼ˆéƒ¨åˆ†ç¼–è¯‘å™¨æ²¡æœ‰è¯¥é™åˆ¶ï¼‰ã€‚\nä¸ºäº†ä½¿å‹å…ƒå¯¹ç±»çš„ç”¨æˆ·å¯è§ï¼Œé€šå¸¸ä¼šæŠŠå‹å…ƒçš„å£°æ˜ï¼ˆç±»çš„å¤–éƒ¨ï¼‰ä¸ç±»æœ¬èº«æ”¾åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ã€‚\nå‹å…ƒå‡½æ•°çš„å®šä¹‰åœ¨ç±»å¤–éƒ¨ï¼Œä½†ä¸æˆå‘˜å‡½æ•°æœ‰ç›¸åŒçš„æƒé™ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰ç§æœ‰ï¼ˆprivateï¼‰æˆå‘˜å’Œä¿æŠ¤ï¼ˆprotectedï¼‰æˆå‘˜ã€‚\nå‹å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¢«ç§°ä¸ºå‹å…ƒå‡½æ•°ã€‚å‹å…ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ï¼Œè¯¥ç±»è¢«ç§°ä¸ºå‹å…ƒç±»ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•´ä¸ªç±»åŠå…¶æ‰€æœ‰æˆå‘˜éƒ½æ˜¯å‹å…ƒã€‚\nã€PRIMER 241, 242ã€‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // Sales_data.h class Sales_data { // friend declarations for nonmember Sales_data operations added friend Sales_data add(const Sales_data\u0026amp;, const Sales_data\u0026amp;); friend std::istream \u0026amp;read(std::istream\u0026amp;, Sales_data\u0026amp;); friend std::ostream \u0026amp;print(std::ostream\u0026amp;, const Sales_data\u0026amp;); // other members and access specifiers as before public: Sales_data() = default; Sales_data(const std::string \u0026amp;s, unsigned n, double p): bookNo(s), units_sold(n), revenue(p*n) { } Sales_data(const std::string \u0026amp;s): bookNo(s) { } Sales_data(std::istream\u0026amp;); std::string isbn() const { return bookNo; } Sales_data \u0026amp;combine(const Sales_data\u0026amp;); private: std::string bookNo; unsigned units_sold = 0; double revenue = 0.0; }; // declarations for nonmember parts of the Sales_data interface Sales_data add(const Sales_data\u0026amp;, const Sales_data\u0026amp;); std::istream \u0026amp;read(std::istream\u0026amp;, Sales_data\u0026amp;); std::ostream \u0026amp;print(std::ostream\u0026amp;, const Sales_data\u0026amp;); å‹å…ƒç±» é™¤äº†æ™®é€šå‡½æ•°ï¼Œç±»è¿˜å¯ä»¥æŠŠå…¶ä»–ç±»æˆ–å…¶ä»–ç±»çš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºå‹å…ƒã€‚å‹å…ƒç±»çš„æˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®æ­¤ç±»åŒ…æ‹¬éå…¬æœ‰æˆå‘˜åœ¨å†…çš„æ‰€æœ‰æˆå‘˜ã€‚\n1 2 3 4 5 6 class Screen { // Window_mgr members can access the private parts of class Screen friend class Window_mgr; // ... rest of the Screen class }; å‹å…ƒå…³ç³»ä¸å­˜åœ¨ä¼ é€’æ€§ã€‚\næŠŠå…¶ä»–ç±»çš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºå‹å…ƒæ—¶ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šè¯¥å‡½æ•°æ‰€å±çš„ç±»åã€‚\nå¦‚æœç±»æƒ³æŠŠä¸€ç»„é‡è½½å‡½æ•°å£°æ˜ä¸ºå‹å…ƒï¼Œéœ€è¦å¯¹è¿™ç»„å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªåˆ†åˆ«å£°æ˜ã€‚\n1 2 3 4 5 6 class Screen { // Window_mgr::clear must have been declared before class Screen friend void Window_mgr::clear(ScreenIndex); // ... rest of the Screen class }; å‹å…ƒå‡½æ•°å¯ä»¥ç›´æ¥å®šä¹‰åœ¨ç±»çš„å†…éƒ¨ï¼Œè¿™ç§å‡½æ•°æ˜¯éšå¼å†…è”çš„ã€‚ä½†æ˜¯å¿…é¡»åœ¨ç±»å¤–éƒ¨æä¾›ç›¸åº”å£°æ˜ä»¤å‡½æ•°å¯è§ã€‚å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 struct X { friend void f() { /* friend function can be defined in the class body */ } X() { f(); } // error: no declaration for f void g(); void h(); }; void X::g() { return f(); } // error: f hasn\u0026#39;t been declared void f(); // declares the function defined inside X void X::h() { return f(); } // ok: declaration for f is now in scope ã€PRIMER 250~252ã€‘\nå‹å…ƒè®¿é—®æ§åˆ¶ä¸ç»§æ‰¿ ä¸€ä¸ªç±»å¯ä»¥ä½¿ç”¨protectedå…³é”®å­—æ¥å£°æ˜å¤–éƒ¨ä»£ç æ— æ³•è®¿é—®ï¼Œä½†æ˜¯æ´¾ç”Ÿç±»å¯¹è±¡å¯ä»¥è®¿é—®çš„æˆå‘˜ã€‚\næ´¾ç”Ÿç±»çš„æˆå‘˜æˆ–å‹å…ƒåªèƒ½è®¿é—®æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†çš„protectedæˆå‘˜ã€‚å¯¹äºæ™®é€šçš„åŸºç±»å¯¹è±¡ä¸­çš„protectedæˆå‘˜æ²¡æœ‰ä»»ä½•è®¿é—®æƒé™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Base { protected: int prot_mem; // protected member }; class Sneaky : public Base { friend void clobber(Sneaky\u0026amp;); // can access Sneaky::prot_mem friend void clobber(Base\u0026amp;); // can\u0026#39;t access Base::prot_mem int j; // j is private by default }; // ok: clobber can access the private and protected members in Sneaky objects void clobber(Sneaky \u0026amp;s) { s.j = s.prot_mem = 0; } // error: clobber can\u0026#39;t access the protected members in Base void clobber(Base \u0026amp;b) { b.prot_mem = 0; } ã€PRIMER 543ã€‘\nå†…è”å‡½æ•° C++ å†…è”å‡½æ•°æ˜¯é€šå¸¸ä¸ç±»ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æ˜¯å†…è”çš„ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠè¯¥å‡½æ•°çš„ä»£ç å‰¯æœ¬æ”¾ç½®åœ¨æ¯ä¸ªè°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ã€‚åœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°éƒ½æ˜¯å†…è”å‡½æ•°ï¼Œå³ä½¿ä¸ç”¨ inline è¯´æ˜ç¬¦ã€‚å®šä¹‰ä¸åœ¨ç±»é‡Œé¢ï¼Œä¸”å£°æ˜å’Œå®šä¹‰éƒ½æ²¡æœ‰inlineï¼Œå°±ä¸ä¼šéšå¼å†…è”ã€‚C++ç±»é‡Œé¢çš„å“ªäº›æˆå‘˜å‡½æ•°æ˜¯å†…è”å‡½æ•°ï¼Ÿ\nå¼•å…¥å†…è”å‡½æ•°çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³ç¨‹åºä¸­å‡½æ•°è°ƒç”¨çš„æ•ˆç‡é—®é¢˜ï¼Œå› ä¸ºç¼–è¯‘å™¨ä½¿ç”¨ç›¸åŒçš„å‡½æ•°ä»£ç ä»£æ›¿å‡½æ•°è°ƒç”¨ï¼Œå¯¹äºå†…è”ä»£ç ï¼Œç¨‹åºæ— éœ€è·³è½¬åˆ°å¦ä¸€ä¸ªä½ç½®æ‰§è¡Œä»£ç ï¼Œå†è·³å›æ¥ã€‚å› æ­¤å†…è”å‡½æ•°çš„è¿è¡Œé€Ÿåº¦æ¯”å¸¸è§„å‡½æ•°ç¨å¿«ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦å ç”¨æ›´å¤šçš„å†…å­˜ã€‚å¦‚æœåœ¨ç¨‹åºçš„å¤šä¸ªä¸åŒçš„åœ°æ–¹è°ƒç”¨å†…è”å‡½æ•°ï¼Œè¯¥ç¨‹åºå°†åŒ…å«è¯¥å†…è”å‡½æ•°çš„å¤šä¸ªå‰¯æœ¬ã€‚æ€»çš„æ¥è¯´å°±æ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´ã€‚æ‰€ä»¥å†…è”å‡½æ•°ä¸€èˆ¬éƒ½æ˜¯1-5è¡Œçš„å°å‡½æ•°ã€‚å…³äºå†…è”å‡½æ•°å¯ä»¥æ€»ç»“ä¸ºï¼š\nç›¸å½“äºæŠŠå†…è”å‡½æ•°é‡Œé¢çš„å†…å®¹å†™åœ¨è°ƒç”¨å†…è”å‡½æ•°å¤„ï¼› ç›¸å½“äºä¸ç”¨æ‰§è¡Œè¿›å…¥å‡½æ•°çš„æ­¥éª¤ï¼Œç›´æ¥æ‰§è¡Œå‡½æ•°ä½“ï¼› ç›¸å½“äºå®ï¼Œå´æ¯”å®å¤šäº†ç±»å‹æ£€æŸ¥ï¼ŒçœŸæ­£å…·æœ‰å‡½æ•°ç‰¹æ€§ï¼› ä¸èƒ½åŒ…å«å¾ªç¯ã€é€’å½’ã€switch ç­‰å¤æ‚æ“ä½œï¼› åœ¨ç±»å£°æ˜ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œé™¤äº†è™šå‡½æ•°çš„å…¶ä»–å‡½æ•°éƒ½ä¼šè‡ªåŠ¨éšå¼åœ°å½“æˆå†…è”å‡½æ•°ã€‚åœ¨ç±»å¤–å®šä¹‰éœ€è¦æ˜¾å¼å†…è”ï¼› ä½¿ç”¨å†…è”å‡½æ•°ä¸è¿‡æ˜¯å‘ç¼–è¯‘å™¨æå‡ºä¸€ç§ç”³è¯·ï¼Œç¼–è¯‘å™¨å¯ä»¥æ‹’ç»ä½ çš„ç”³è¯·ã€‚ å†…è”å‡½æ•°ä¸å®çš„åŒºåˆ« å†…è”å‡½æ•°åœ¨ç¼–è¯‘æ—¶å±•å¼€ï¼Œå®åœ¨é¢„ç¼–è¯‘ï¼ˆé¢„å¤„ç†ï¼‰æ—¶å±•å¼€ï¼› åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå†…è”å‡½æ•°å¯ä»¥ç›´æ¥è¢«é•¶åµŒåˆ°ç›®æ ‡ä»£ç é‡Œï¼Œè€Œå®åªæ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼› å†…è”å‡½æ•°å¯ä»¥å®Œæˆè¯¸å¦‚ç±»å‹æ£€æµ‹ã€è¯­å¥æ˜¯å¦æ­£ç¡®ç­‰ç¼–è¯‘åŠŸèƒ½ï¼Œå®å°±ä¸å…·æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼› å†…è”å‡½æ•°æ˜¯å‡½æ•°ï¼Œå®ä¸æ˜¯å‡½æ•°ï¼› å®åœ¨å®šä¹‰æ—¶è¦å°å¿ƒå¤„ç†å®å‚æ•°ï¼ˆç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼‰ï¼Œå¦åˆ™ä¼šå‡ºç°äºŒä¹‰æ€§ï¼Œè€Œå†…è”å‡½æ•°å®šä¹‰æ—¶ä¸ä¼šå‡ºç°äºŒä¹‰æ€§ volatile volatile å…³é”®å­—æ˜¯ä¸€ç§ç±»å‹ä¿®é¥°ç¬¦ï¼Œç”¨å®ƒå£°æ˜çš„ç±»å‹å˜é‡è¡¨ç¤ºè¿™ä¸ªå˜é‡å¯èƒ½è¢«æ„æƒ³ä¸åˆ°çš„ä¿®æ”¹ï¼ˆæ¯”å¦‚ï¼šæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶æˆ–è€…å…¶å®ƒçº¿ç¨‹ç­‰ï¼‰ã€‚é‡åˆ°è¿™ä¸ªå…³é”®å­—å£°æ˜çš„å˜é‡ï¼Œç¼–è¯‘å™¨å¯¹è®¿é—®è¯¥å˜é‡çš„ä»£ç å°±ä¸å†è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œå¯ä»¥æä¾›å¯¹ç‰¹æ®Šåœ°å€çš„ç¨³å®šè®¿é—®ã€‚å½“è¦æ±‚ä½¿ç”¨ volatile å£°æ˜çš„å˜é‡çš„å€¼çš„æ—¶å€™ï¼Œç³»ç»Ÿæ€»æ˜¯é‡æ–°ä»å®ƒæ‰€åœ¨çš„å†…å­˜è¯»å–æ•°æ®ï¼Œå³ä½¿å®ƒå‰é¢çš„æŒ‡ä»¤åˆšåˆšä»è¯¥å¤„è¯»å–è¿‡æ•°æ®ã€‚\nè™½ç„¶volatileåœ¨åµŒå…¥å¼æ–¹é¢åº”ç”¨æ¯”è¾ƒå¤šï¼Œä½†æ˜¯åœ¨PCè½¯ä»¶çš„å¤šçº¿ç¨‹ä¸­ï¼Œvolatileä¿®é¥°çš„ä¸´ç•Œå˜é‡ä¹Ÿæ˜¯éå¸¸å®ç”¨çš„ã€‚\nèŠèŠC++çš„mutableå’Œvolatile\nä¸€ä¸ªå‚æ•°å¯ä»¥æ—¢æ˜¯ const åˆæ˜¯ volatile å— å¯ä»¥ï¼Œç”¨constå’ŒvolatileåŒæ—¶ä¿®é¥°å˜é‡ï¼Œè¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨ç¨‹åºå†…éƒ¨æ˜¯åªè¯»çš„ï¼Œä¸èƒ½æ”¹å˜çš„ï¼Œåªåœ¨ç¨‹åºå¤–éƒ¨æ¡ä»¶å˜åŒ–ä¸‹æ”¹å˜ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¸ä¼šä¼˜åŒ–è¿™ä¸ªå˜é‡ã€‚æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå˜é‡æ—¶ï¼Œéƒ½è¦å°å¿ƒåœ°å»å†…å­˜è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯å»å¯„å­˜å™¨è¯»å–å®ƒçš„å¤‡ä»½ã€‚\næ³¨æ„ï¼šåœ¨æ­¤ä¸€å®šè¦æ³¨æ„constçš„æ„æ€ï¼Œconståªæ˜¯ä¸å…è®¸ç¨‹åºä¸­çš„ä»£ç æ”¹å˜æŸä¸€å˜é‡ï¼Œå…¶åœ¨ç¼–è¯‘æœŸå‘æŒ¥ä½œç”¨ï¼Œå®ƒå¹¶æ²¡æœ‰å®é™…åœ°ç¦æ­¢æŸæ®µå†…å­˜çš„è¯»å†™ç‰¹æ€§ã€‚\nexplicit æ™®é€šå‡½æ•°æ˜¯èƒ½å¤Ÿè¢«éšå¼è°ƒç”¨ï¼ˆå¦‚ä½¿ç”¨=ï¼‰ï¼Œè€Œ explicit æ„é€ å‡½æ•°åªèƒ½è¢«æ˜¾å¼è°ƒç”¨ã€‚\nexplicit æ˜¯ç”¨æ¥é˜²æ­¢éšå¼è½¬æ¢çš„ï¼Œå®ƒåªå¯¹ä¸€ä¸ªå®å‚çš„æ„é€ å‡½æ•°æœ‰æ•ˆï¼Œä¸”åªå…è®¸å‡ºç°åœ¨ç±»å†…çš„æ„é€ å‡½æ•°å£°æ˜å¤„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 class Test1 { public: int num; char *str; Test1(int n, char *s) { num = n, str = s; cout \u0026lt;\u0026lt; \u0026#34;call Test1(int n, char *s)\\n\u0026#34;; } }; class Test2 { public: int num; char *str; string type_info; explicit Test2(int n, char *s) : num(n), str(s) { cout \u0026lt;\u0026lt; \u0026#34;call explicit Test2(int n, char *s)\\n\u0026#34;; } explicit Test2(string) : type_info(\u0026#34;call explicit Test2(string)\\n\u0026#34;) { cout \u0026lt;\u0026lt; type_info; } explicit Test2(char) : type_info(\u0026#34;call explicit Test2(char)\\n\u0026#34;) { cout \u0026lt;\u0026lt; type_info; } Test2(int) : type_info(\u0026#34;call explicit Test2(int)\\n\u0026#34;) { cout \u0026lt;\u0026lt; type_info; } explicit Test2(short) : type_info(\u0026#34;call explicit Test2(short)\\n\u0026#34;) { cout \u0026lt;\u0026lt; type_info; } }; int main(int argc, char *argv[]) { Test1 t1 = {12, \u0026#34;hello...\u0026#34;}; // éšå¼è°ƒç”¨æˆåŠŸ //Test2 t2 = { 12, \u0026#34;hello...\u0026#34; };\t// ç¼–è¯‘é”™è¯¯ï¼Œä¸èƒ½éšå¼è°ƒç”¨å…¶æ„é€ å‡½æ•° Test2 t3(12, \u0026#34;hello...\u0026#34;); // æ˜¾å¼è°ƒç”¨æˆåŠŸ short n = 42; Test2 t4 = n; // è™½ç„¶ n æ˜¯ short ç±»å‹ï¼Œä½†å› ä¸º explicit Test2(short) ä¸èƒ½éšå¼è°ƒç”¨ï¼Œæ•…é€€è€Œæ±‚å…¶æ¬¡æŠŠ n è½¬æ¢æˆ int è°ƒç”¨ Test2(int) Test2 t5(n); // æ˜¾ç¤ºè°ƒç”¨ explicit Test2(short) } /* æ‰“å° call Test1(int n, char *s) call explicit Test2(int n, char *s) call explicit Test2(int) call explicit Test2(short) */ const 1 2 3 const Stock \u0026amp;Stock::topval(const Stock \u0026amp; s) const {......} //æœ‰ä¸¤åªè‚¡ç¥¨ï¼Œè¿”å›ä»·æ ¼é«˜çš„é‚£ä¸€åªè‚¡ç¥¨ã€PLUS 363ï¼Œ365ã€‘ è¯¥å‡½æ•°æ˜¾å¼çš„è®¿é—®ä¸€ä¸ªå¯¹è±¡ï¼ˆå‚æ•°ï¼‰ï¼Œåˆéšå¼çš„è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆè°ƒç”¨çš„å¯¹è±¡ï¼‰ï¼Œå¹¶è¿”å›å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å‚æ•°ä¸­çš„ const è¡¨æ˜ï¼Œè¯¥å‡½æ•°ä¸ä¼šä¿®æ”¹è¢«æ˜¾å¼è®¿é—®çš„å¯¹è±¡ï¼ˆä¸ä¼šä¿®æ”¹å‚æ•°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼‰ï¼Œè€Œæ‹¬å·åçš„ const è¡¨æ˜ï¼Œè¯¥å‡½æ•°ä¸ä¼šä¿®æ”¹è¢«éšå¼åœ°è®¿é—®çš„å¯¹è±¡ï¼ˆè¯¥ç±»æ–¹æ³• Stock::topval() ä¸ä¼šä¿®æ”¹ç±»é‡Œçš„æ•°æ®ï¼‰ï¼Œæœ€å‰é¢çš„ const è¡¨æ˜å‡½æ•°çš„è¿”å›å€¼ä¸èƒ½è¢«ä¿®æ”¹ã€‚\nconstå½¢å‚å’Œå®å‚ å½“å½¢å‚æœ‰é¡¶å±‚constæ—¶ï¼Œä¼ é€’ç»™å®ƒå¸¸é‡å¯¹è±¡æˆ–éå¸¸é‡å¯¹è±¡éƒ½æ˜¯å¯ä»¥çš„ã€‚\nå¯ä»¥ä½¿ç”¨éå¸¸é‡å¯¹è±¡åˆå§‹åŒ–ä¸€ä¸ªåº•å±‚constå½¢å‚ï¼Œä½†æ˜¯åè¿‡æ¥ä¸è¡Œã€‚\næŠŠå‡½æ•°ä¸ä¼šæ”¹å˜çš„å½¢å‚å®šä¹‰æˆæ™®é€šå¼•ç”¨ä¼šæå¤§åœ°é™åˆ¶å‡½æ•°æ‰€èƒ½æ¥å—çš„å®å‚ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿä¼šç»™åˆ«äººä¸€ç§è¯¯å¯¼ï¼Œå³å‡½æ•°å¯ä»¥ä¿®æ”¹å®å‚çš„å€¼ã€‚\né¡¶å±‚cosntä½œå½¢å‚ï¼Œä¸ä¼šé‡è½½ã€‚å¦‚ï¼š\n1 2 void fun(const int *i) { do_something }; void fun(int *i) { do_something }; // é”™è¯¯ï¼Œé‡å¤å®šä¹‰äº†fun(int) ã€PRIMER 191ï¼Œ 207ã€‘\nå‡½æ•°è¿”å›å¼•ç”¨ è¿”å›å¼•ç”¨èƒ½èŠ‚çœè°ƒç”¨æ‹·è´ï¼ˆå¤åˆ¶ï¼‰æ„é€ å‡½æ•°ç”Ÿæˆçš„å‰¯æœ¬æ‰€éœ€çš„æ—¶é—´å’Œææ„å‡½æ•°åˆ é™¤å‰¯æœ¬æ‰€éœ€çš„æ—¶é—´ã€‚ä½†å¹¶ä¸æ€»æ˜¯å¯ä»¥è¿”å›å¼•ç”¨ï¼Œå‡½æ•°ä¸èƒ½è¿”å›åœ¨å‡½æ•°ä¸­åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡çš„å¼•ç”¨ï¼Œå› ä¸ºå½“å‡½æ•°ç»“æŸï¼Œä¸´æ—¶å¯¹è±¡å°±æ¶ˆå¤±äº†ã€‚ ã€PLUS 526ã€‘\nå¼•ç”¨è¿”å›å·¦å€¼ã€PRIMER 202ã€‘\nä¸€èˆ¬åœ°ï¼šå¯ä»¥å–åœ°å€ï¼Œæœ‰åå­—çš„å°±æ˜¯å·¦å€¼ï¼›åä¹‹ï¼Œå³å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 char \u0026amp;get_val (string \u0026amp;str, string::size_type ix) { return str[ix]; } int main() { string s(\u0026#34;a value\u0026#34;); get_val(s, 0) = \u0026#39;A\u0026#39;; // å‡½æ•°è¿”å›å¼•ç”¨å¯ä½œä¸ºå·¦å€¼ï¼ˆå¦‚æœæ˜¯å¸¸é‡å¼•ç”¨åˆ™ä¸å¯ï¼‰ï¼Œå°†s[0]çš„å€¼æ”¹ä¸ºA return 0; } constä½œç”¨ ä¿®é¥°å˜é‡ï¼Œè¯´æ˜è¯¥å˜é‡ä¸å¯ä»¥è¢«æ”¹å˜ï¼›\nä¿®é¥°æŒ‡é’ˆï¼Œåˆ†ä¸ºæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆå’ŒæŒ‡é’ˆå¸¸é‡ï¼›\nä¿®é¥°å‡½æ•°å¼•ç”¨å‚æ•°ï¼Œå³é¿å…äº†æ‹·è´ï¼Œåˆé¿å…äº†å‡½æ•°å¯¹å¼•ç”¨å€¼çš„ä¿®æ”¹ï¼›\nå¦‚void fun(A const \u0026amp;a);Aæ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ã€‚ç›¸æ¯”äºå€¼ä¼ é€’å‡å°‘äº†ä¸´æ—¶å¯¹è±¡çš„æ„é€ ã€å¤åˆ¶ã€ææ„è¿‡ç¨‹ï¼Œç”¨ const ä¿®é¥°å¼•ç”¨ï¼Œé¿å…å‡½æ•°é€šè¿‡å¼•ç”¨ä¿®æ”¹ aã€‚\nä¿®é¥°å‡½æ•°è¿”å›å€¼ï¼Œè¯´æ˜è¯¥è¿”å›å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¸”è¯¥è¿”å›å€¼åªèƒ½èµ‹å€¼ç»™åŠ  const ä¿®é¥°çš„åŒç±»å‹å˜é‡\nä¿®é¥°ç±»çš„æˆå‘˜å‡½æ•°ï¼Œè¯´æ˜åœ¨è¯¥æˆå‘˜å‡½æ•°å†…ä¸èƒ½ä¿®æ”¹æˆå‘˜å˜é‡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œconstå¯¹è±¡è¢«è®¾å®šæˆä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆã€‚å½“å¤šä¸ªæ–‡ä»¶ä¸­å‡ºç°äº†åŒåçš„constå˜é‡æ—¶ï¼Œå…¶å®ç­‰åŒäºåœ¨ä¸åŒæ–‡ä»¶ä¸­åˆ†åˆ«å®šä¹‰äº†ç‹¬ç«‹çš„å˜é‡ã€‚ã€PRIMER 54ã€‘\nå¦‚æœæƒ³åœ¨å¤šä¸ªæ–‡ä»¶é—´å…±äº«constå¯¹è±¡ï¼š\nè‹¥constå¯¹è±¡çš„å€¼åœ¨ç¼–è¯‘æ—¶å·²ç»ç¡®å®šï¼Œåˆ™åº”è¯¥å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­ã€‚å…¶ä»–æºæ–‡ä»¶åŒ…å«è¯¥å¤´æ–‡ä»¶æ—¶ï¼Œä¸ä¼šäº§ç”Ÿé‡å¤å®šä¹‰é”™è¯¯ã€‚\nè‹¥constå¯¹è±¡çš„å€¼ç›´åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šï¼Œåˆ™åº”è¯¥åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œåœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ã€‚æ­¤æ—¶constå˜é‡çš„å£°æ˜å’Œå®šä¹‰å‰éƒ½åº”è¯¥æ·»åŠ externå…³é”®å­—ã€‚\n1 2 3 4 // file_1.cc å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªå¸¸é‡ï¼Œè¯¥å¸¸é‡èƒ½è¢«å…¶å®ƒæ–‡ä»¶è®¿é—® extern const int bufSize = fcn(); // file_1.h extern const int bufSize; // ä¸file_1.ccä¸­å®šä¹‰çš„æ˜¯åŒä¸€ä¸ª constä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // ç±» class A { private: const int a; // å¸¸å¯¹è±¡æˆå‘˜ï¼Œåªèƒ½åœ¨åˆå§‹åŒ–åˆ—è¡¨èµ‹å€¼ public: // æ„é€ å‡½æ•° A() : a(0) { }; A(int x) : a(x) { }; // åˆå§‹åŒ–åˆ—è¡¨ // åç½®constå¯ç”¨äºå¯¹é‡è½½å‡½æ•°çš„åŒºåˆ† int getValue(); // æ™®é€šæˆå‘˜å‡½æ•° int getValue() const; // å¸¸æˆå‘˜å‡½æ•°ï¼Œä¸å¾—ä¿®æ”¹ç±»ä¸­çš„ä»»ä½•æ•°æ®æˆå‘˜çš„å€¼ }; void function() { // å¯¹è±¡ A b; // æ™®é€šå¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨å…¨éƒ¨æˆå‘˜å‡½æ•° const A a; // å¸¸å¯¹è±¡ï¼Œåªèƒ½è°ƒç”¨å¸¸æˆå‘˜å‡½æ•°ã€æ›´æ–°å¸¸æˆå‘˜å˜é‡ const A *p = \u0026amp;a; // å¸¸æŒ‡é’ˆ const A \u0026amp;q = a; // å¸¸å¼•ç”¨ // æŒ‡é’ˆ char greeting[] = \u0026#34;Hello\u0026#34;; char* p1 = greeting; // æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘å­—ç¬¦æ•°ç»„å˜é‡ const char* p2 = greeting; // æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘å­—ç¬¦æ•°ç»„å¸¸é‡ char* const p3 = greeting; // å¸¸æŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦æ•°ç»„å˜é‡ const char* const p4 = greeting; // å¸¸æŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦æ•°ç»„å¸¸é‡ } // å‡½æ•° void function1(const int Var); // ä¼ é€’è¿‡æ¥çš„å‚æ•°åœ¨å‡½æ•°å†…ä¸å¯å˜ void function2(const char* Var); // å‚æ•°æŒ‡é’ˆæ‰€æŒ‡å†…å®¹ä¸ºå¸¸é‡ void function3(char* const Var); // å‚æ•°æŒ‡é’ˆä¸ºå¸¸æŒ‡é’ˆ void function4(const int\u0026amp; Var); // å¼•ç”¨å‚æ•°åœ¨å‡½æ•°å†…ä¸ºå¸¸é‡ // å‡½æ•°è¿”å›å€¼ const int function5(); // è¿”å›ä¸€ä¸ªå¸¸æ•° const int* function6(); // è¿”å›ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆå˜é‡ï¼Œä½¿ç”¨ï¼šconst int *p = function6(); int* const function7(); // è¿”å›ä¸€ä¸ªæŒ‡å‘å˜é‡çš„å¸¸æŒ‡é’ˆï¼Œä½¿ç”¨ï¼šint* const p = function7(); constä¿®é¥°æŒ‡é’ˆ æŒ‡é’ˆæœ¬èº«æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œå®ƒåˆå¯ä»¥æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥æŒ‡é’ˆå’Œ const åŒæ—¶ä½¿ç”¨æ—¶ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼šã€PRIMER 57ã€‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 int i = 0; int *const j = \u0026amp;i; // é¡¶å±‚ const // æŒ‡é’ˆå¸¸é‡,æŒ‡å‘ä¸å¯å˜åœ°å€çš„æŒ‡é’ˆï¼Œä½†å¯ä»¥å¯¹å®ƒæŒ‡å‘çš„å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚ // æŒ‡é’ˆjæŒ‡å‘iï¼Œconstä¿®é¥°æŒ‡é’ˆjæœ¬èº«ï¼Œ // æ‰€ä»¥ä¸å…è®¸ä¿®æ”¹jï¼Œä½†å¯ä»¥é€šè¿‡jä¿®æ”¹içš„å€¼ const int *k = \u0026amp;i; // åº•å±‚ const // å¸¸é‡æŒ‡é’ˆï¼ŒæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘çš„åœ°å€é‡Œçš„å†…å®¹ä¸å¯å˜ã€‚ // æŒ‡é’ˆkæŒ‡å‘iï¼Œconstä¿®é¥°kæŒ‡å‘çš„iï¼Œ // æ‰€ä»¥å¯ä»¥ä¿®æ”¹kï¼Œä½†ä¸å¯ä»¥é€šè¿‡kä¿®æ”¹içš„å€¼ int const *p = \u0026amp;i; // åº•å±‚ const // å³ const int *pï¼ŒåŒä¸Šï¼Œä¸ºå¸¸é‡æŒ‡é’ˆã€‚ // const ä¿®é¥°ç¦»å³è¾¹æœ€è¿‘çš„é‚£ä¸€ä¸ªï¼Œint const *p ç­‰ä»·äº const int *p // éƒ½å¯ä»¥ç†è§£ä¸º const ä¿®é¥°ï¼ˆ*pï¼‰è€Œä¸æ˜¯ pï¼Œé‚£ä¹ˆ p å¯å˜,p æŒ‡å‘çš„å€¼ä¸å¯å˜ const int * const p = \u0026amp;i; // p åªèƒ½æŒ‡å‘ iï¼Œä¸” p æŒ‡å‘çš„ i ä¹Ÿä¸å¯å˜ constexprå’Œå¸¸é‡è¡¨è¾¾å¼ ã€PRIMER 58ã€‘\nå¸¸é‡è¡¨è¾¾å¼ï¼ˆconstant expressionsï¼‰æŒ‡å€¼ä¸ä¼šæ”¹å˜å¹¶ä¸”åœ¨ç¼–è¯‘è¿‡ç¨‹å°±èƒ½å¾—åˆ°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼ã€‚\nä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºå¸¸é‡è¡¨è¾¾å¼ç”±å®ƒçš„æ•°æ®ç±»å‹å’Œåˆå§‹å€¼å…±åŒå†³å®šã€‚\n1 2 3 4 const int max_files = 20; // max_files is a constant expression const int limit = max_files + 1; // limit is a constant expression int staff_size = 27; // staff_size is not a constant expression const int sz = get_size(); // sz is not a constant expression C++11å…è®¸å°†å˜é‡å£°æ˜ä¸ºconstexprç±»å‹ä»¥ä¾¿ç”±ç¼–è¯‘å™¨æ¥éªŒè¯å˜é‡çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ã€‚\n1 2 3 constexpr int mf = 20; // 20 is a constant expression constexpr int limit = mf + 1; // mf + 1 is a constant expression constexpr int sz = size(); // ok only if size is a constexpr function æŒ‡é’ˆå’Œå¼•ç”¨éƒ½èƒ½å®šä¹‰æˆconstexprï¼Œä½†æ˜¯åˆå§‹å€¼å—åˆ°ä¸¥æ ¼é™åˆ¶ã€‚constexpræŒ‡é’ˆçš„åˆå§‹å€¼å¿…é¡»æ˜¯0ã€nullptræˆ–è€…æ˜¯å­˜å‚¨åœ¨æŸä¸ªå›ºå®šåœ°å€ä¸­çš„å¯¹è±¡ã€‚\nå‡½æ•°ä½“å†…å®šä¹‰çš„æ™®é€šå˜é‡ä¸€èˆ¬å¹¶éå­˜æ”¾åœ¨å›ºå®šåœ°å€ä¸­ï¼Œå› æ­¤constexpræŒ‡é’ˆä¸èƒ½æŒ‡å‘è¿™æ ·çš„å˜é‡ã€‚ç›¸åï¼Œå‡½æ•°ä½“å¤–å®šä¹‰çš„å˜é‡åœ°å€å›ºå®šä¸å˜ï¼Œå¯ä»¥ç”¨æ¥åˆå§‹åŒ–constexpræŒ‡é’ˆã€‚\nåœ¨constexprå£°æ˜ä¸­å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œé™å®šç¬¦constexprä»…å¯¹æŒ‡é’ˆæœ¬èº«æœ‰æ•ˆï¼Œä¸æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡æ— å…³ã€‚constexpræŠŠå®ƒæ‰€å®šä¹‰çš„å¯¹è±¡ç½®ä¸ºäº†é¡¶å±‚constã€‚\n1 2 3 const int *p = \u0026amp;i;\t// pæ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹å¸¸é‡çš„æŒ‡é’ˆï¼šåº•å±‚constï¼Œpå¯å˜ï¼Œä½†pæŒ‡å‘çš„å†…å­˜é‡Œçš„å€¼ä¸å¯è¢«ä¿®æ”¹ã€‚ constexpr int *p2 = \u0026amp;i; // p2æ˜¯æŒ‡å‘æ•´æ•°çš„å¸¸é‡æŒ‡é’ˆï¼šé¡¶å±‚constï¼Œp2ä¸å¯å˜ï¼Œä½†å¯é€šè¿‡p2ä¿®æ”¹å…¶æŒ‡å‘çš„å†…å­˜é‡Œé¢çš„å€¼ constexpr const int *p3 = \u0026amp;i; // p3æ˜¯æŒ‡å‘const intçš„constæŒ‡é’ˆï¼Œå¯ä»¥ç†è§£ä¸ºconst int *const p3 = \u0026amp;i; constå’Œconstexpré™å®šçš„å€¼éƒ½æ˜¯å¸¸é‡ã€‚ä½†constexprå¯¹è±¡çš„å€¼å¿…é¡»åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šï¼Œè€Œconstå¯¹è±¡çš„å€¼å¯ä»¥å»¶è¿Ÿåˆ°è¿è¡ŒæœŸé—´ç¡®å®šã€‚\nå»ºè®®ä½¿ç”¨constexprä¿®é¥°è¡¨ç¤ºæ•°ç»„å¤§å°çš„å¯¹è±¡ï¼Œå› ä¸ºæ•°ç»„çš„å¤§å°å¿…é¡»åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šä¸”ä¸èƒ½æ”¹å˜ã€‚\nconst ä¸ #define 1 2 #define PI 3.1415926 const float pi = 3.1415926; const å¸¸é‡æœ‰æ•°æ®ç±»å‹ï¼Œè€Œå®å¸¸é‡æ²¡æœ‰æ•°æ®ç±»å‹ã€‚ç¼–è¯‘å™¨å¯ä»¥å¯¹å‰è€…è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥ã€‚è€Œå¯¹åè€…åªè¿›è¡Œå­—ç¬¦æ›¿æ¢ï¼Œæ²¡æœ‰ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œå¹¶ä¸”åœ¨å­—ç¬¦æ›¿æ¢å¯èƒ½ä¼šäº§ç”Ÿæ„æ–™ä¸åˆ°çš„é”™è¯¯ ã€‚ å®å®šä¹‰æ˜¯ç›´æ¥æ›¿æ¢ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ­¢äºç¼–è¯‘æœŸï¼Œä¸ä¼šåˆ†é…å†…å­˜ï¼Œå­˜å‚¨äºç¨‹åºçš„ä»£ç æ®µä¸­ï¼› const å¸¸é‡å­˜åœ¨äºç¨‹åºçš„æ•°æ®æ®µï¼Œå¹¶åˆ†é…äº†å®é™…çš„å†…å­˜ã€‚ mutable ä½¿ç”¨å…³é”®å­—mutableå¯ä»¥å£°æ˜å¯å˜æ•°æ®æˆå‘˜ï¼ˆmutable data memberï¼‰ã€‚å¯å˜æ•°æ®æˆå‘˜æ°¸è¿œä¸ä¼šæ˜¯constçš„ï¼Œå³ä½¿å®ƒåœ¨constå¯¹è±¡å†…ã€‚å› æ­¤constæˆå‘˜å‡½æ•°å¯ä»¥ä¿®æ”¹å¯å˜æˆå‘˜çš„å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 class Screen { public: void some_member() const; private: mutable size_t access_ctr; // may change even in a const object // other members as before }; void Screen::some_member() const { ++access_ctr; // keep a count of the calls to any member function // whatever other work this member needs to do } å­˜å‚¨ç±» auto C++ 11 ä»¥æ¥ï¼Œauto å…³é”®å­—ç”¨äºä¸¤ç§æƒ…å†µï¼šå£°æ˜å˜é‡æ—¶æ ¹æ®åˆå§‹åŒ–è¡¨è¾¾å¼è‡ªåŠ¨æ¨æ–­è¯¥å˜é‡çš„ç±»å‹ã€å£°æ˜å‡½æ•°æ—¶å‡½æ•°è¿”å›å€¼çš„å ä½ç¬¦ã€‚\nautoæ˜¯ç±»å‹æ¨å¯¼ï¼Œè®©ä½¿ç”¨è€…è·å¾—åŠ¨æ€è¯­è¨€çš„ä½¿ç”¨ä½“éªŒï¼›ä½†æ˜¯æœ‰åŒºåˆ«ï¼Œé‚£å°±æ˜¯ auto å£°æ˜çš„å˜é‡ç±»å‹ï¼Œä½ å¯ä»¥ä¸çŸ¥é“ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¸€å®šè¦çŸ¥é“ï¼Œè¿™æ ·æ‰ä¸ä¼šæŠ¥é”™ã€‚\næ ¹æ®åˆå§‹åŒ–è¡¨è¾¾å¼è‡ªåŠ¨æ¨æ–­è¢«å£°æ˜çš„å˜é‡çš„ç±»å‹ï¼Œå¦‚ï¼š\n1 2 3 4 5 6 7 8 9 auto a; // æŠ¥é”™ï¼aæœªåˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨æ¨ç®—ä¸å‡ºæ¥ a æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå°±ä¸çŸ¥é“è¦å¼€è¾Ÿå¤šå¤§çš„ç©ºé—´ã€‚ auto f = 3.14; // double auto s(\u0026#34;hello\u0026#34;); // const char* auto z = new auto(9); // int* auto x1 = 5, x2 = 5.0, x3 = \u0026#39;r\u0026#39;; // æŠ¥é”™ï¼ /* å½“åœ¨åŒä¸€è¡Œä¸­å®šä¹‰å¤šä¸ªå˜é‡æ—¶ï¼Œç¼–è¯‘å™¨åªå¯¹ç¬¬ä¸€ä¸ªç±»å‹è¿›è¡Œæ¨å¯¼ï¼Œ ç„¶åç”¨æ¨å¯¼å‡ºæ¥çš„ç±»å‹å®šä¹‰å…¶å®ƒå˜é‡ */ æ³¨æ„ï¼š\nauto ä¸å¯ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼šå‚æ•°è¦è¢«ç¼–è¯‘æˆæŒ‡ä»¤ï¼Œauto åšå‚æ•°ï¼Œä¼šä¸çŸ¥é“è¦å¼€è¾Ÿå¤šå¤§çš„ç©ºé—´ã€‚ auto ä¸å¯ç›´æ¥ç”¨æ¥å£°æ˜æ•°ç»„ï¼šå› ä¸ºä¸çŸ¥é“è¦å¼€è¾Ÿå¤šå¤§ç©ºé—´ã€‚ auto åœ¨å®é™…ä¸­æœ€å¸¸è§çš„ä¼˜åŠ¿ç”¨æ³•æ˜¯ C++11 æä¾›çš„æ–°å¼ for å¾ªç¯ï¼Œè¿˜æœ‰ lambda è¡¨è¾¾å¼ç­‰è¿›è¡Œé…åˆä½¿ç”¨ã€‚\nstaticä½œç”¨ ä¿®é¥°å˜é‡ï¼šä¿®æ”¹å˜é‡çš„å­˜å‚¨åŒºåŸŸå’Œç”Ÿå‘½å‘¨æœŸï¼Œä½¿å˜é‡å­˜å‚¨åœ¨é™æ€åŒºï¼Œå˜é‡åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚\nå½“ä¿®é¥°å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå°±æ˜¯é™æ€å…¨å±€å˜é‡ã€‚é™æ€å…¨å±€å˜é‡ä¸éé™æ€å…¨å±€å˜é‡éƒ½æ˜¯å­˜å‚¨åœ¨é™æ€åŒºï¼Œä½†æ˜¯å®ƒä»¬çš„ä½œç”¨åŸŸä¸ä¸€æ ·ï¼šé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸåªåœ¨è¯¥æ–‡ä»¶é‡Œæœ‰æ•ˆï¼ˆæ–‡ä»¶ä½œç”¨åŸŸï¼‰ï¼Œè€Œéé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸæ˜¯åœ¨æ•´ä¸ªæºç¨‹åºé‡Œæœ‰æ•ˆã€‚ å½“ä¿®é¥°å±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œä¸€èˆ¬ç”¨åœ¨å‡½æ•°ä½“ä¸­ï¼Œé™æ€å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä¸æ™®é€šå±€éƒ¨å˜é‡ä¸€æ ·ï¼Œåªåœ¨è¯¥å‡½æ•°ä¸­æœ‰æ•ˆï¼Œä½†é™æ€å±€éƒ¨å˜é‡å­˜å‚¨åœ¨é™æ€åŒºï¼Œåœ¨å‡½æ•°è°ƒç”¨ç»“æŸä¼šç»´æŒå…¶å€¼ä¸å˜ï¼Œä¸‹æ¬¡è°ƒç”¨è¯¥å‡½æ•°ä¸ä¼šåˆå§‹åŒ–è€Œæ˜¯ç›´æ¥ä½¿ç”¨ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„å€¼ã€‚ ä¿®é¥°æ™®é€šå‡½æ•°ï¼šè¡¨æ˜å‡½æ•°çš„ä½œç”¨èŒƒå›´ï¼Œä»…åœ¨å®šä¹‰è¯¥å‡½æ•°çš„æ–‡ä»¶å†…æ‰èƒ½ä½¿ç”¨ã€‚åœ¨å¤šäººå¼€å‘é¡¹ç›®æ—¶ï¼Œä¸ºäº†é˜²æ­¢ä¸ä»–äººå‘½åçš„å‡½æ•°é‡åï¼Œå¯ä»¥å°†å‡½æ•°å®šä¹‰ä¸º staticã€‚\nä¿®é¥°æˆå‘˜å˜é‡ï¼šé™æ€æˆå‘˜å˜é‡ç”¨æ¥è¡¨ç¤ºå”¯ä¸€çš„ã€å¯å…±äº«çš„æˆå‘˜å˜é‡ã€‚å®ƒå¯ä»¥åœ¨åŒä¸€ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ä¸­è¢«è®¿é—®ã€‚é™æ€æˆå‘˜å˜é‡åªæœ‰å”¯ä¸€çš„ä¸€ä»½å®ä½“ã€‚ä¸éœ€è¦ç”Ÿæˆå¯¹è±¡å°±å¯ä»¥è®¿é—®è¯¥æˆå‘˜ã€‚\nstatic æˆå‘˜å˜é‡å¿…é¡»åœ¨ç±»å£°æ˜çš„å¤–éƒ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥ç¤ºä¸æ™®é€šæ•°æ®æˆå‘˜çš„åŒºåˆ«ã€‚åœ¨ç±»å¤–éƒ¨å®šä¹‰é™æ€æˆå‘˜æ—¶ï¼Œä¸èƒ½é‡å¤staticå…³é”®å­—ï¼Œå…¶åªèƒ½ç”¨äºç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ã€‚ã€PRIMER 270ã€‘\nä¾‹å¦‚ï¼šint Class_name::static_val = 5;\nstatic æˆå‘˜å˜é‡å’Œæ™®é€š static å˜é‡ä¸€æ ·ï¼Œéƒ½åœ¨å†…å­˜åˆ†åŒºçš„å…¨å±€æ•°æ®åŒºåˆ†é…å†…å­˜ï¼Œåˆ°ç¨‹åºç»“æŸåé‡Šæ”¾ã€‚è¿™å°±æ„å‘³ç€ï¼Œstatic æˆå‘˜å˜é‡ä¸éšå¯¹è±¡çš„åˆ›å»ºè€Œåˆ†é…å†…å­˜ï¼Œä¹Ÿä¸éšå¯¹è±¡çš„é”€æ¯è€Œé‡Šæ”¾å†…å­˜ã€‚è€Œæ™®é€šæˆå‘˜å˜é‡åœ¨å¯¹è±¡åˆ›å»ºæ—¶åˆ†é…å†…å­˜ï¼Œåœ¨å¯¹è±¡é”€æ¯æ—¶é‡Šæ”¾å†…å­˜ã€‚\nä¿®é¥°æˆå‘˜å‡½æ•°ï¼šé™æ€æˆå‘˜å‡½æ•°ä½¿å¾—ä¸éœ€è¦ç”Ÿæˆå¯¹è±¡å°±å¯ä»¥è®¿é—®è¯¥å‡½æ•°ã€‚é™æ€æˆå‘˜å‡½æ•°å’Œé™æ€æˆå‘˜å˜é‡ä¸€æ ·ï¼Œä¸å±äºç±»ï¼Œæ‰€ä»¥é™æ€æˆå‘˜å‡½æ•°ä¸å« this æŒ‡é’ˆï¼Œä¹Ÿå°±æ— æ³•è®¿é—®ç±»çš„éé™æ€æˆå‘˜ã€‚\nã€å¯¹1ï¼Œ2æ¡çš„æ€»ç»“ã€‘\nstatic æœ€é‡è¦çš„ä¸€æ¡åœ¨äºä¿®é¥°æ™®é€šå˜é‡ä¸æ™®é€šå‡½æ•°æ—¶ï¼Œéšè—æ™®é€šå˜é‡ä¸æ™®é€šå‡½æ•°ã€‚å› ä¸ºæœªåŠ  static å‰ç¼€çš„å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½å…·æœ‰å…¨å±€å¯è§æ€§ã€‚\né™æ€æ•°æ®æˆå‘˜ä¸å…¨å±€å˜é‡ç›¸æ¯”çš„ä¼˜åŠ¿ é™æ€æ•°æ®æˆå‘˜æ²¡æœ‰è¿›å…¥ç¨‹åºçš„å…¨å±€å‘½åç©ºé—´ï¼Œå› æ­¤ä¸å­˜åœ¨ä¸å…¶ä»–å…¨å±€å˜é‡åå­—å†²çªçš„å¯èƒ½ï¼› ä½¿ç”¨é™æ€æ•°æ®æˆå‘˜å¯ä»¥éšè—ä¿¡æ¯ã€‚å› ä¸ºé™æ€æ•°æ®æˆå‘˜å¯ä»¥æ˜¯ private æˆå‘˜ï¼Œè€Œå…¨å±€å˜é‡ä¸èƒ½ï¼› extern extern å­˜å‚¨ç±»ç”¨äºæä¾›ä¸€ä¸ªå…¨å±€å˜é‡çš„å¼•ç”¨ï¼Œå…¨å±€å˜é‡å¯¹æ‰€æœ‰çš„ç¨‹åºæ–‡ä»¶éƒ½å¯è§ã€‚ä½¿ç”¨ \u0026rsquo;extern\u0026rsquo; æ—¶ï¼Œå¯¹äºæ— æ³•åˆå§‹åŒ–çš„å˜é‡ï¼Œä¼šæŠŠå˜é‡åæŒ‡å‘ä¸€ä¸ªä¹‹å‰å®šä¹‰è¿‡çš„å­˜å‚¨ä½ç½®(å®šä¹‰åªæœ‰ä¸€æ¬¡ï¼Œä¸å¯é‡å¤å®šä¹‰)ã€‚\nå¤šä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨çš„å…¨å±€å˜é‡æˆ–å‡½æ•°æ—¶ï¼Œå¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨ extern æ¥å¾—åˆ°å·²å®šä¹‰çš„å˜é‡æˆ–å‡½æ•°çš„å¼•ç”¨ã€‚å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œextern æ˜¯ç”¨æ¥åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡æˆ–å‡½æ•°ã€‚\nç±»å‹è½¬æ¢è¿ç®—ç¬¦ C++ ä¸­å››ç§ç±»å‹è½¬æ¢æ˜¯ï¼šstatic_cast, dynamic_cast, const_cast, reinterpret_cast 1 2 cast-name\u0026lt;type\u0026gt;(expression) // typeæ˜¯è½¬æ¢çš„ç›®æ ‡ç±»å‹ï¼Œexpression æ˜¯è¢«è½¬æ¢çš„å€¼ã€‚ const_cast(å¸¸é‡è½¬æ¢)\nç”¨äºå°† const å˜é‡è½¬ä¸ºé const ï¼Œä¹Ÿå¯ä»¥å»é™¤ volatileï¼Œé™¤æ­¤ä¹‹å¤–ä¸å…è®¸ä»»ä½•ç±»å‹è½¬æ¢ã€‚å³å¸¸é‡æŒ‡é’ˆè¢«è½¬æ¢æˆéå¸¸é‡æŒ‡é’ˆï¼Œå¹¶ä¸”ä»ç„¶æŒ‡å‘åŸæ¥çš„å¯¹è±¡ï¼›å¸¸é‡å¼•ç”¨è¢«è½¬æ¢æˆéå¸¸é‡å¼•ç”¨ï¼Œå¹¶ä¸”ä»ç„¶å¼•ç”¨åŸæ¥çš„å¯¹è±¡ã€‚\nstatic_cast(é™æ€è½¬æ¢)\nä»»ä½•ç¼–å†™ç¨‹åºæ—¶èƒ½å¤Ÿæ˜ç¡®çš„ç±»å‹è½¬æ¢éƒ½å¯ä»¥ä½¿ç”¨ static_castï¼ˆstatic_cast ä¸èƒ½è½¬æ¢æ‰åº•å±‚ constï¼Œvolatile å’Œ __unaligned å±æ€§ï¼‰ã€‚ç”±äºä¸æä¾›è¿è¡Œæ—¶çš„æ£€æŸ¥ï¼Œæ‰€ä»¥å« static_castï¼Œå› æ­¤ï¼Œéœ€è¦åœ¨ç¼–å†™ç¨‹åºæ—¶ç¡®è®¤è½¬æ¢çš„å®‰å…¨æ€§ã€‚\nä¸»è¦åœ¨ä»¥ä¸‹å‡ ç§åœºåˆä¸­ä½¿ç”¨ï¼š\nç”¨äºç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œçˆ¶ç±»å’Œå­ç±»ä¹‹é—´æŒ‡é’ˆå’Œå¼•ç”¨çš„è½¬æ¢ï¼›è¿›è¡Œä¸Šè¡Œè½¬æ¢ï¼ŒæŠŠå­ç±»å¯¹è±¡çš„æŒ‡é’ˆ/å¼•ç”¨è½¬æ¢ä¸ºçˆ¶ç±»æŒ‡é’ˆ/å¼•ç”¨ï¼Œè¿™ç§è½¬æ¢æ˜¯å®‰å…¨çš„ï¼›è¿›è¡Œä¸‹è¡Œè½¬æ¢ï¼ŒæŠŠçˆ¶ç±»å¯¹è±¡çš„æŒ‡é’ˆ/å¼•ç”¨è½¬æ¢æˆå­ç±»æŒ‡é’ˆ/å¼•ç”¨ï¼Œè¿™ç§è½¬æ¢æ˜¯ä¸å®‰å…¨çš„ï¼Œéœ€è¦ç¼–å†™ç¨‹åºæ—¶æ¥ç¡®è®¤ï¼› ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œä¾‹å¦‚æŠŠ int è½¬ charï¼Œint è½¬ enum ç­‰ï¼Œéœ€è¦ç¼–å†™ç¨‹åºæ—¶æ¥ç¡®è®¤å®‰å…¨æ€§ï¼› æŠŠ void æŒ‡é’ˆè½¬æ¢æˆç›®æ ‡ç±»å‹çš„æŒ‡é’ˆï¼ˆè¿™æ˜¯æå…¶ä¸å®‰å…¨çš„ï¼‰ï¼› dynamic_cast(åŠ¨æ€è½¬æ¢)\nç”¨äºåŠ¨æ€ç±»å‹è½¬æ¢ã€‚åªèƒ½ç”¨äºå«æœ‰è™šå‡½æ•°çš„ç±»ï¼Œç”¨äºç±»å±‚æ¬¡é—´çš„å‘ä¸Šå’Œå‘ä¸‹è½¬åŒ–ï¼Œåªèƒ½è½¬æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚å‘ä¸‹è½¬åŒ–æ—¶ï¼Œå¦‚æœæ˜¯éæ³•çš„å¯¹äºæŒ‡é’ˆè¿”å› nullptrï¼Œå¯¹äºå¼•ç”¨æŠ›å¼‚å¸¸ã€‚è¦æ·±å…¥äº†è§£å†…éƒ¨è½¬æ¢çš„åŸç†ã€‚\nå‘ä¸Šè½¬æ¢ï¼šæŒ‡çš„æ˜¯å­ç±»å‘åŸºç±»çš„è½¬æ¢ã€‚æ­¤æ—¶ä¸ static_cast å’Œéšå¼è½¬æ¢ä¸€æ ·ï¼Œéƒ½æ˜¯éå¸¸å®‰å…¨çš„ã€‚ æ³¨æ„è±å½¢ç»§æ‰¿ä¸­çš„å‘ä¸Šè½¬æ¢è¦æŒ‡æ˜è·¯å¾„ã€‚\nå‘ä¸‹è½¬æ¢ï¼šæŒ‡çš„æ˜¯åŸºç±»å‘å­ç±»çš„è½¬æ¢ï¼›\nå®ƒé€šè¿‡å˜é‡è¿è¡Œæ—¶çš„ç±»å‹å’Œè¦è½¬æ¢çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œæ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œå‘ä¸‹è½¬æ¢ã€‚\nä¸ºä»€ä¹ˆåªèƒ½ç”¨äºå«æœ‰è™šå‡½æ•°çš„ç±»ï¼Ÿ\nå› ä¸ºç±»ä¸­å­˜åœ¨è™šå‡½æ•°ï¼Œè¯´æ˜å®ƒå¯èƒ½æœ‰å­ç±»ï¼Œè¿™æ ·æ‰æœ‰ç±»å‹è½¬æ¢çš„æƒ…å†µå‘ç”Ÿï¼Œç”±äºè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥éœ€è¦è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼Œè€Œè¿™ä¸ªä¿¡æ¯å­˜å‚¨åœ¨ç±»çš„è™šå‡½æ•°è¡¨ä¸­ï¼Œåªæœ‰å®šä¹‰äº†è™šå‡½æ•°çš„ç±»æ‰æœ‰è™šå‡½æ•°è¡¨ã€‚\nreinterpret_cast(é‡è§£é‡Š)\nå‡ ä¹ä»€ä¹ˆéƒ½å¯ä»¥è½¬ï¼Œæ¯”å¦‚å°† int è½¬æŒ‡é’ˆï¼Œå¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œå°½é‡å°‘ç”¨ï¼›\nä¸ºä»€ä¹ˆä¸ä½¿ç”¨ C çš„å¼ºåˆ¶è½¬æ¢ C çš„å¼ºåˆ¶è½¬æ¢è¡¨é¢ä¸Šçœ‹èµ·æ¥åŠŸèƒ½å¼ºå¤§ä»€ä¹ˆéƒ½èƒ½è½¬ï¼Œä½†æ˜¯è½¬åŒ–ä¸å¤Ÿæ˜ç¡®ï¼Œä¸èƒ½è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™ã€‚\nthisæŒ‡é’ˆ æ¯ä¸ªéé™æ€æˆå‘˜å‡½æ•°ï¼ˆåŒ…å«æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ªthisæŒ‡é’ˆï¼ŒthisæŒ‡é’ˆæŒ‡å‘è°ƒç”¨å¯¹è±¡ï¼Œthisæ˜¯åœ°å€ï¼Œå¦‚æœè¦å¼•ç”¨è°ƒç”¨å¯¹è±¡æœ¬èº«ï¼Œç”¨*thisã€‚\nï¼ˆåªæœ‰æˆå‘˜å‡½æ•°æ‰æœ‰ this æŒ‡é’ˆï¼Œé™æ€æˆå‘˜å‡½æ•°å’Œå‹å…ƒå‡½æ•°éƒ½ä¸å« this æŒ‡é’ˆï¼‰\nå½“ä¸€ä¸ªæˆå‘˜å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨å‘å®ƒä¼ é€’ä¸€ä¸ªéšå«çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªæˆå‘˜å‡½æ•°æ‰€åœ¨çš„å¯¹è±¡çš„æŒ‡é’ˆã€‚this æŒ‡é’ˆè¢«éšå«åœ°å£°æ˜ä¸º: ClassName *const thisï¼Œè¿™æ„å‘³ç€ä¸èƒ½ç»™ this æŒ‡é’ˆèµ‹å€¼ï¼›åœ¨ ClassName ç±»çš„ const æˆå‘˜å‡½æ•°ä¸­ï¼Œthis æŒ‡é’ˆçš„ç±»å‹ä¸ºï¼šconst ClassName* constï¼Œè¿™è¯´æ˜ this æŒ‡é’ˆæ‰€æŒ‡å‘çš„è¿™ç§å¯¹è±¡æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼ˆå³ä¸èƒ½å¯¹è¿™ç§å¯¹è±¡çš„æ•°æ®æˆå‘˜è¿›è¡Œèµ‹å€¼æ“ä½œï¼‰ã€‚\nä¸€ä¸ªç±»çš„æˆå‘˜å‡½æ•°åªæœ‰ä¸€ä»½ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå¯¹è±¡å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„æˆå‘˜å‡½æ•°ä½“ï¼Œè€Œæˆå‘˜å‡½æ•°ä¹‹æ‰€ä»¥èƒ½æŠŠå±äºæ­¤ç±»çš„å„ä¸ªå¯¹è±¡çš„æ•°æ®åŒºåˆ†å¼€ï¼Œå°±åœ¨äºæ¯æ¬¡æ‰§è¡Œç±»æˆå‘˜å‡½æ•°æ—¶ï¼Œéƒ½ä¼šæŠŠå½“å‰çš„thisæŒ‡é’ˆï¼ˆå¯¹è±¡é¦–åœ°å€ï¼‰ä¼ å…¥æˆå‘˜å‡½æ•°ï¼Œå‡½æ•°ä½“å†…æ‰€æœ‰å¯¹ç±»æ•°æ®æˆå‘˜çš„è®¿é—®éƒ½ä¼šè½¬åŒ–ä¸ºthis-\u0026gt;æ•°æ®æˆå‘˜çš„æ–¹å¼ã€‚\nã€PLUS 364ã€‘\nã€æ³¨æ„ã€‘é™æ€æˆå‘˜å‡½æ•°é‡Œï¼Œä¸èƒ½ä½¿ç”¨ this æŒ‡é’ˆï¼š\né™æ€æˆå‘˜å‡½æ•°å¹¶ä¸æ˜¯é’ˆå¯¹æŸä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œæ˜¯å±äºæ•´ä¸ªç±»çš„ï¼Œä¸ºæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹æ‰€å…±æœ‰ã€‚ä»–åœ¨ä½œç”¨åŸŸçš„èŒƒå›´å†…æ˜¯å…¨å±€çš„ï¼Œç‹¬ç«‹äºç±»çš„å¯¹è±¡ä¹‹å¤–çš„ã€‚ä»–åªå¯¹ç±»å†…éƒ¨çš„é™æ€æˆå‘˜å˜é‡åšæ“ä½œã€‚å½“å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶å€™ï¼Œé‡Œé¢ä¸å­˜åœ¨é™æ€æˆå‘˜çš„ã€‚this æŒ‡é’ˆæ˜¯ç›¸å½“äºä¸€ä¸ªç±»çš„å®ä¾‹çš„æŒ‡é’ˆï¼Œthis æ˜¯ç”¨æ¥æ“ä½œå¯¹è±¡å®ä¾‹çš„å†…å®¹çš„ï¼Œæ—¢ç„¶é™æ€æˆå‘˜å‡½æ•°å’Œå˜é‡éƒ½æ˜¯ç‹¬ç«‹äºç±»çš„å®ä¾‹å¯¹è±¡ä¹‹å¤–çš„ï¼Œå®ƒå°±ä¸èƒ½ç”¨ this æŒ‡é’ˆï¼Œä¹Ÿä¸èƒ½æ“ä½œéé™æ€æˆå‘˜ã€‚\nè™šå‡½æ•° 1 2 3 4 5 6 7 /*BrassPlus æ˜¯ Brass çš„å­ç±»ï¼Œ ViewAcct() æ˜¯ä¸¤ä¸ªç±»ä¸­éƒ½æœ‰çš„æ–¹æ³•ã€‚ ç”±äº bpæ˜¯çˆ¶ç±»æŒ‡é’ˆï¼Œå¦‚æœåŸºç±»ä¸ç”¨è™šæ–¹æ³•é‚£ä¹ˆå°±ä¼šè°ƒç”¨åŸºç±»çš„ ViewAcct() æ–¹æ³• è‹¥åœ¨åŸºç±»ä¸­å°† ViewAcct() å£°æ˜ä¸ºè™šï¼Œåˆ™ bp-\u0026gt;ViewAcct() æ ¹æ®å¯¹è±¡ç±»å‹ï¼ˆBrassPlusï¼‰è°ƒç”¨ BrassPlue::ViewAcct()æ–¹æ³•*/ BrassPlus ophelia; Brass *bp; bp = \u0026amp;ophelia; bp-\u0026gt;ViewAcct(); // æ˜¯è°ƒç”¨å­ç±»è¿˜æ˜¯çˆ¶ç±»çš„ ViewAcct() æ–¹æ³•ï¼Ÿ ã€PLUS 503ã€‘\nå½“ä¸”ä»…å½“é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œæ‰ä¼šåœ¨è¿è¡Œè¿‡ç¨‹è§£æè¯¥è°ƒç”¨ï¼Œä¹Ÿåªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹å¯¹è±¡çš„åŠ¨æ€ç±»å‹æœ‰å¯èƒ½ä¸é™æ€ç±»å‹ä¸åŒã€‚\nåœ¨æ´¾ç”Ÿç±»ä¸­è¦†ç›–æŸä¸ªè™šå‡½æ•°æ—¶ï¼Œå¯ä»¥å†æ¬¡ä½¿ç”¨virtualå…³é”®å­—è¯´æ˜å‡½æ•°æ€§è´¨ï¼Œä½†è¿™å¹¶éå¼ºåˆ¶è¦æ±‚ã€‚å› ä¸ºä¸€æ—¦æŸä¸ªå‡½æ•°è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™åœ¨æ‰€æœ‰æ´¾ç”Ÿç±»ä¸­å®ƒéƒ½æ˜¯è™šå‡½æ•°ã€‚\nåœ¨æ´¾ç”Ÿç±»ä¸­è¦†ç›–æŸä¸ªè™šå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°åœ¨åŸºç±»ä¸­çš„å½¢å‚å¿…é¡»ä¸æ´¾ç”Ÿç±»ä¸­çš„å½¢å‚ä¸¥æ ¼åŒ¹é…ã€‚\næ´¾ç”Ÿç±»å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸åŸºç±»ä¸­çš„è™šå‡½æ•°åå­—ç›¸åŒä½†å½¢å‚åˆ—è¡¨ä¸åŒçš„å‡½æ•°ï¼Œä½†ç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¯¥å‡½æ•°ä¸åŸºç±»ä¸­åŸæœ‰çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ­¤æ—¶æ´¾ç”Ÿç±»çš„å‡½æ•°å¹¶æ²¡æœ‰è¦†ç›–æ‰åŸºç±»ä¸­çš„ç‰ˆæœ¬ã€‚è¿™å¾€å¾€ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬åŸæœ¬å¸Œæœ›æ´¾ç”Ÿç±»å¯ä»¥è¦†ç›–åŸºç±»ä¸­çš„è™šå‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸å°å¿ƒæŠŠå½¢å‚åˆ—è¡¨å†™é”™äº†ã€‚æƒ³è°ƒè¯•å¹¶å‘ç°è¿™æ ·çš„é”™è¯¯éå¸¸å›°éš¾ï¼ŒC++11å…è®¸æ´¾ç”Ÿç±»ä½¿ç”¨overrideå…³é”®å­—æ˜¾å¼åœ°æ³¨æ˜è™šå‡½æ•°ã€‚å¦‚æœoverrideæ ‡è®°äº†æŸä¸ªå‡½æ•°ï¼Œä½†è¯¥å‡½æ•°å¹¶æ²¡æœ‰è¦†ç›–å·²å­˜åœ¨çš„è™šå‡½æ•°ï¼Œç¼–è¯‘å™¨å°†æŠ¥å‘Šé”™è¯¯ã€‚overrideä½äºå‡½æ•°å‚æ•°åˆ—è¡¨ä¹‹åã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 struct B { virtual void f1(int) const; virtual void f2(); void f3(); }; struct D1 : B { void f1(int) const override; // æ­£ç¡®ï¼šf1() ä¸åŸºç±»ä¸­çš„ f1() åŒ¹é… void f2(int) override; // é”™è¯¯ï¼šB æ²¡æœ‰å½¢å¦‚ f2(int) çš„å‡½æ•° void f3() override; // é”™è¯¯ï¼šf3() ä¸æ˜¯è™šå‡½æ•° void f4() override; // é”™è¯¯ï¼šB æ²¡æœ‰åä¸º f4() çš„å‡½æ•° } ä¸ç¦æ­¢ç±»ç»§æ‰¿ç±»ä¼¼ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ finalå…³é”®å­—æ¥ç¦æ­¢è¦†ç›–æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 struct D2 : B { // ä» B ç»§æ‰¿ f2() å’Œ f3(),è¦†ç›– f1(int) void f1(int) const final; // ä¸å…è®¸åç»­çš„å…¶ä»–ç±»è¦†ç›– f1(int) }; struct D3 : D2 { void f2();\t// æ­£ç¡®ï¼šè¦†ç›–ä» B ç»§æ‰¿è€Œæ¥çš„ f2() void f1(int) const;\t// é”™è¯¯ï¼šD2 å·²ç»å°† f1 å£°æ˜æˆ finalã€‚ } finalå’Œoverrideå…³é”®å­—å‡ºç°åœ¨å½¢å‚åˆ—è¡¨ï¼ˆåŒ…æ‹¬ä»»ä½•constæˆ–å¼•ç”¨ä¿®é¥°ç¬¦ï¼‰ä»¥åŠå°¾ç½®è¿”å›ç±»å‹ä¹‹åã€‚\nè™šå‡½æ•°ä¹Ÿå¯ä»¥æœ‰é»˜è®¤å®å‚ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨çš„é»˜è®¤å®å‚å€¼ç”±æœ¬æ¬¡è°ƒç”¨çš„é™æ€ç±»å‹å†³å®šã€‚å¦‚æœé€šè¿‡åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨å‡½æ•°ï¼Œåˆ™ä½¿ç”¨åŸºç±»ä¸­å®šä¹‰çš„é»˜è®¤å®å‚ï¼Œå³ä½¿å®é™…è¿è¡Œçš„æ˜¯æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°ç‰ˆæœ¬ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nå¦‚æœè™šå‡½æ•°ä½¿ç”¨é»˜è®¤å®å‚ï¼Œåˆ™åŸºç±»å’Œæ´¾ç”Ÿç±»ä¸­å®šä¹‰çš„é»˜è®¤å®å‚å€¼æœ€å¥½ä¸€è‡´ã€‚\nã€PRIMER 536~538ã€‘\nå›é¿è™šå‡½æ•° åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è™šå‡½æ•°çš„è°ƒç”¨ä¸è¦è¿›è¡ŒåŠ¨æ€ç»‘å®šï¼Œè€Œæ˜¯å¼ºè¿«æ‰§è¡Œè™šå‡½æ•°çš„æŸä¸€ä¸ªç‰¹å®šç‰ˆæœ¬ã€‚ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦::å¯ä»¥å¼ºåˆ¶æ‰§è¡Œè™šå‡½æ•°çš„æŸä¸ªç‰ˆæœ¬ï¼Œä¸è¿›è¡ŒåŠ¨æ€ç»‘å®šã€‚\n1 2 // å¼ºè¡Œè°ƒç”¨åŸºç±»ä¸­å®šä¹‰çš„å‡½æ•°ç‰ˆæœ¬è€Œä¸ç®¡ baseP çš„åŠ¨æ€ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆ double undiscounted = baseP-\u0026gt;Quote::net_price(42); é€šå¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰æˆå‘˜å‡½æ•°æˆ–å‹å…ƒä¸­çš„ä»£ç æ‰éœ€è¦ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥å›é¿è™šå‡½æ•°çš„åŠ¨æ€ç»‘å®šæœºåˆ¶ã€‚\nå¦‚æœä¸€ä¸ªæ´¾ç”Ÿç±»è™šå‡½æ•°éœ€è¦è°ƒç”¨å®ƒçš„åŸºç±»ç‰ˆæœ¬ï¼Œä½†æ²¡æœ‰ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦ï¼Œåˆ™åœ¨è¿è¡Œæ—¶è¯¥è°ƒç”¨ä¼šè¢«è§£æä¸ºå¯¹æ´¾ç”Ÿç±»ç‰ˆæœ¬è‡ªèº«çš„è°ƒç”¨ï¼Œä»è€Œå¯¼è‡´æ— é™é€’å½’ã€‚\nã€PRIMER 539ã€‘\nè™šå‡½æ•°æ˜¯æ€ä¹ˆå®ç°çš„ è™šå‡½æ•°æ˜¯é€šè¿‡è™šå‡½æ•°è¡¨å®ç°çš„ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªè™šå‡½æ•°ï¼Œåˆ™ç³»ç»Ÿä¼šä¸ºè¿™ä¸ªç±»åˆ†é…ä¸€ä¸ªæŒ‡é’ˆæˆå‘˜æŒ‡å‘ä¸€å¼ è™šå‡½æ•°è¡¨ï¼ˆvtblï¼‰ï¼Œè¡¨ä¸­æ¯ä¸€é¡¹æŒ‡å‘ä¸€ä¸ªè™šå‡½æ•°åœ°å€ï¼Œè™šå‡½æ•°è¡¨å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæ•°ç»„ã€‚\nC++è™šå‡½æ•°åŸç†\nè™šå‡½æ•°æ˜¯å¦å¯ä»¥å†…è” è™šå‡½æ•°å¯ä»¥æ˜¯å†…è”å‡½æ•°ï¼Œå†…è”æ˜¯å¯ä»¥ä¿®é¥°è™šå‡½æ•°çš„ï¼Œä½†æ˜¯å½“è™šå‡½æ•°è¡¨ç°å¤šæ€æ€§çš„æ—¶å€™ä¸èƒ½å†…è”ã€‚ å†…è”æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç¼–è¯‘å™¨å†…è”ï¼Œè€Œè™šå‡½æ•°çš„å¤šæ€æ€§åœ¨è¿è¡ŒæœŸï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“è¿è¡ŒæœŸè°ƒç”¨å“ªä¸ªä»£ç ï¼Œå› æ­¤è™šå‡½æ•°è¡¨ç°ä¸ºå¤šæ€æ€§æ—¶ï¼ˆè¿è¡ŒæœŸï¼‰ä¸å¯ä»¥å†…è”ã€‚ inline virtual å”¯ä¸€å¯ä»¥å†…è”çš„æ—¶å€™æ˜¯ï¼šç¼–è¯‘å™¨çŸ¥é“æ‰€è°ƒç”¨çš„å¯¹è±¡æ˜¯å“ªä¸ªç±»ï¼Œè¿™åªæœ‰åœ¨ç¼–è¯‘å™¨å…·æœ‰å®é™…å¯¹è±¡è€Œä¸æ˜¯å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ—¶æ‰ä¼šå‘ç”Ÿã€‚ è™šææ„å‡½æ•° 1 2 3 4 // Employee æ˜¯åŸºç±»ï¼ŒSinger æ˜¯æ´¾ç”Ÿç±» Employee *pe = new Singer; ... delete pe; // call ~Employee() or ~Singer()? å¦‚æœåŸºç±»ä¸­çš„ææ„å‡½æ•°ä¸æ˜¯è™šçš„ï¼Œå°±åªè°ƒç”¨å¯¹åº”äºæŒ‡é’ˆç±»å‹(Employee)çš„ææ„å‡½æ•°ï¼Œä½†å®é™…ä¸­ï¼Œæ˜¯æƒ³è°ƒç”¨æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ã€‚å¦‚æœåŸºç±»çš„ææ„å‡½æ•°æ˜¯è™šçš„ï¼Œå°†è°ƒç”¨ç›¸åº”å¯¹è±¡ç±»å‹(Singer)çš„ææ„å‡½æ•°ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ã€‚å› æ­¤ï¼Œä½¿ç”¨è™šææ„å‡½æ•°å¯ä»¥ä¿è¯æ­£ç¡®çš„ææ„å‡½æ•°åºåˆ—è¢«è°ƒç”¨ã€‚ ã€PLUS 501ï¼Œ505ã€‘\n1 2 3 4 5 // Employee æ˜¯åŸºç±»ï¼ŒSinger æ˜¯æ´¾ç”Ÿç±» Singer *pe = new Singer; ... delete pe; // å…ˆè°ƒç”¨ ~Singer() å†è°ƒç”¨ ~Employee()ï¼Œ // å› ä¸º pe æ˜¯ Singer* ç±»å‹æŒ‡é’ˆï¼Œè€Œä¸æ˜¯ Employee* ç±»å‹æŒ‡é’ˆã€‚ é™æ€è”ç¼–å’ŒåŠ¨æ€è”ç¼– å°†æºç¨‹åºä¸­çš„å‡½æ•°è°ƒç”¨è§£é‡Šä¸ºæ‰§è¡Œç‰¹å®šçš„å‡½æ•°ä»£ç å—è¢«ç§°ä¸ºå‡½æ•°åè”ç¼–ã€‚åœ¨ C è¯­è¨€ä¸­ç”±äºä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œè¿™å¾ˆå®¹æ˜“ï¼Œåœ¨ C++ ä¸­ï¼Œç”±äºæ”¯æŒå‡½æ•°é‡è½½ï¼Œç¼–è¯‘å™¨å¿…é¡»æŸ¥çœ‹å‡½æ•°çš„å‚æ•°æ‰çŸ¥é“è°ƒç”¨çš„æ˜¯å“ªä¸€ä¸ªå‡½æ•°ã€‚C++ åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å¯ä»¥å®Œæˆè¿™ç§è”ç¼–ï¼Œæ•…ç§°ä¸ºé™æ€è”ç¼–ï¼Œåˆç§°ä¸ºæ—©æœŸè”ç¼–ã€‚ç¼–è¯‘å™¨æ€»æ˜¯å¯¹éè™šæ–¹æ³•ä½¿ç”¨é™æ€è”ç¼–ã€‚\nç„¶è€Œè™šå‡½æ•°ä½¿ç¼–è¯‘å™¨ä¸çŸ¥é“åœ¨ç¼–è¯‘æ—¶åˆ°åº•ç”¨å“ªä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“ç”¨æˆ·å°†é€‰æ‹©å“ªç§ç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¿…é¡»ç”Ÿæˆèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶é€‰æ‹©æ­£ç¡®çš„è™šå‡½æ•°çš„ä»£ç ï¼Œè¿™è¢«ç§°ä¹‹ä¸ºåŠ¨æ€è”ç¼–ï¼Œä¹Ÿè¢«ç§°ä¸ºæ™šæœŸè”ç¼–ã€‚\nã€PLUS 501ã€‘\næœ‰å…³è™šå‡½æ•°çš„æ³¨æ„äº‹é¡¹ æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°ã€‚å…ˆæ„é€ çˆ¶ç±»å¯¹è±¡ï¼Œç„¶åæ‰èƒ½æ˜¯å­ç±»å¯¹è±¡ï¼Œå¦‚æœæ„é€ å‡½æ•°è®¾ä¸ºè™šå‡½æ•°ï¼Œé‚£ä¹ˆå½“ä½ åœ¨æ„é€ çˆ¶ç±»çš„æ„é€ å‡½æ•°æ—¶å°±ä¸å¾—ä¸æ˜¾å¼çš„è°ƒç”¨æ„é€ ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯ä¸ºäº†é˜²é”™ï¼Œè¯•æƒ³å¦‚æœä½ åœ¨å­ç±»ä¸­ä¸€ä¸å°å¿ƒé‡å†™äº†ä¸ªè·Ÿçˆ¶ç±»æ„é€ å‡½æ•°ä¸€æ ·çš„å‡½æ•°ï¼Œé‚£ä¹ˆä½ çš„çˆ¶ç±»çš„æ„é€ å‡½æ•°å°†è¢«è¦†ç›–ï¼Œå³ä¸èƒ½å®Œæˆçˆ¶ç±»çš„æ„é€ ï¼Œå°±ä¼šå‡ºé”™ã€‚ ææ„å‡½æ•°åº”å½“æ˜¯è™šå‡½æ•°ï¼Œé™¤éç±»ä¸ç”¨åšåŸºç±»ã€‚å³ä½¿ç±»ä¸ç”¨ä½œåŸºç±»ï¼Œé€šå¸¸åº”ç»™åŸºç±»æä¾›ä¸€ä¸ªè™šææ„å‡½æ•° å‹å…ƒä¸èƒ½æ˜¯è™šå‡½æ•°ï¼Œå› ä¸ºå‹å…ƒä¸æ˜¯ç±»æˆå‘˜ï¼Œåªæœ‰ç±»æˆå‘˜æ‰èƒ½æ˜¯è™šå‡½æ•° å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰é‡æ–°å®šä¹‰å‡½æ•°ï¼Œå°†ä½¿ç”¨è¯¥å‡½æ•°çš„åŸºç±»ç‰ˆæœ¬ã€‚å¦‚æœæ´¾ç”Ÿç±»ä½äºæ´¾ç”Ÿé“¾ä¸­ï¼Œåˆ™å°†ä½¿ç”¨æœ€æ–°çš„è™šå‡½æ•°ç‰ˆæœ¬ å¦‚æœæ´¾ç”Ÿç±»é‡æ–°å®šä¹‰å‡½æ•°ï¼Œå°†éšè—åŒååŸºç±»æ–¹æ³•ï¼Œè¿™ä¸åŒäºé‡è½½ æ¨¡æ¿å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°ã€‚å› ä¸ºï¼Œç±»ä¼šåœ¨vtblä¸­å­˜æ”¾ç±»ä¸­çš„æ‰€æœ‰çš„è™šå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œè€Œä¸€ä¸ªæ¨¡æ¿å‡½æ•°å¦‚æœè®¾è®¡ä¸ºè™šå‡½æ•°æ˜¯æ— æ³•è·æ‚‰è¿™ä¸ªæ¨¡æ¿å‡½æ•°ä¼šè¢«å®ä¾‹åŒ–ä¸ºå“ªäº›å…·ä½“çš„å‡½æ•°ã€‚ ã€PLUS 503ï¼Œ504ã€‘\né™¤æ„é€ å‡½æ•°ä¹‹å¤–çš„ä»»ä½•éé™æ€å‡½æ•°éƒ½èƒ½å®šä¹‰ä¸ºè™šå‡½æ•°ã€‚virtualå…³é”®å­—åªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ä¹‹å‰è€Œä¸èƒ½ç”¨äºç±»å¤–éƒ¨çš„å‡½æ•°å®šä¹‰ã€‚å¦‚æœåŸºç±»æŠŠä¸€ä¸ªå‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­éšå¼åœ°ä¹Ÿæ˜¯è™šå‡½æ•°ã€‚ æˆå‘˜å‡½æ•°å¦‚æœæ²¡æœ‰è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™å…¶è§£æè¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µè€Œéè¿è¡Œé˜¶æ®µã€‚ ã€PRIMER 528ã€‘\nçº¯è™šå‡½æ•° çº¯è™šå‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„è™šå‡½æ•°ï¼Œçº¯è™šå‡½æ•°åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯è®©æ´¾ç”Ÿç±»å®ç°ç»†èŠ‚çš„ï¼Œåœ¨çº¯è™šå‡½æ•°ä¸­ä¹Ÿå¯ä»¥å®šä¹‰å…·ä½“å®ç°ï¼Œä½†æ²¡æ„ä¹‰ã€‚**åŒ…å«çº¯è™šå‡½æ•°çš„ç±»æ˜¯æŠ½è±¡åŸºç±»ï¼ˆABCï¼Œabstract base classï¼‰ï¼Œå®ƒåªèƒ½ä½œä¸ºåŸºç±»ï¼Œä¸èƒ½åˆ›å»ºå¯¹è±¡ã€‚**å¯ä»¥ä»æŠ½è±¡åŸºç±»æ´¾ç”Ÿå‡ºå…·ä½“ç±»ï¼ˆæ™®é€šç±»ï¼‰ï¼Œè¿™äº›ç±»å¯ä»¥åˆ›å»ºå¯¹è±¡ã€‚\n1 2 3 4 5 class C public: virtual int f1() = 0; //å‡½æ•°åŸå‹ä¸­çš„ =0 ä½¿è™šå‡½æ•°æˆä¸ºçº¯è™šå‡½æ•° virtual double area() const = 0; virtual ~C() {} ã€PLUS 509ï¼Œ510ã€‘\nè™šå‡½æ•°ã€çº¯è™šå‡½æ•° ç±»é‡Œå¦‚æœå£°æ˜äº†è™šå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å®ç°çš„ï¼Œå“ªæ€•æ˜¯ç©ºå®ç°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½è®©è¿™ä¸ªå‡½æ•°åœ¨å®ƒçš„å­ç±»é‡Œé¢å¯ä»¥è¢«è¦†ç›–ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥ä½¿ç”¨åæœŸç»‘å®šæ¥è¾¾åˆ°å¤šæ€äº†ã€‚çº¯è™šå‡½æ•°åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯ä¸ªå‡½æ•°çš„å£°æ˜è€Œå·²ï¼Œå®ƒè¦ç•™åˆ°å­ç±»é‡Œå»å®ç°ã€‚ è™šå‡½æ•°åœ¨å­ç±»é‡Œé¢ä¹Ÿå¯ä»¥ä¸é‡è½½çš„ï¼›ä½†çº¯è™šå‡½æ•°å¿…é¡»åœ¨å­ç±»å»å®ç°ã€‚ è™šå‡½æ•°çš„ç±»ç”¨äº â€œå®ä½œç»§æ‰¿â€ï¼Œç»§æ‰¿æ¥å£çš„åŒæ—¶ä¹Ÿç»§æ‰¿äº†çˆ¶ç±»çš„å®ç°ã€‚å½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥å®Œæˆè‡ªå·±çš„å®ç°ã€‚çº¯è™šå‡½æ•°å…³æ³¨çš„æ˜¯æ¥å£çš„ç»Ÿä¸€æ€§ï¼Œå®ç°ç”±å­ç±»å®Œæˆã€‚ å¸¦çº¯è™šå‡½æ•°çš„ç±»å«æŠ½è±¡ç±»ï¼ˆè™šåŸºç±»ï¼‰ï¼Œè¿™ç§ç±»ä¸èƒ½ç›´æ¥ç”Ÿæˆå¯¹è±¡ï¼Œè€Œåªæœ‰è¢«ç»§æ‰¿ï¼Œå¹¶é‡å†™å…¶è™šå‡½æ•°åï¼Œæ‰èƒ½ä½¿ç”¨ã€‚æŠ½è±¡ç±»å’Œå¤§å®¶å£å¤´å¸¸è¯´çš„è™šåŸºç±»è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œåœ¨ C# ä¸­ç”¨ abstract å®šä¹‰æŠ½è±¡ç±»ï¼Œè€Œåœ¨ C++ ä¸­æœ‰æŠ½è±¡ç±»çš„æ¦‚å¿µï¼Œä½†æ˜¯æ²¡æœ‰è¿™ä¸ªå…³é”®å­—ã€‚æŠ½è±¡ç±»è¢«ç»§æ‰¿åï¼Œå­ç±»å¯ä»¥ç»§ç»­æ˜¯æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€šç±»ï¼Œè€Œè™šåŸºç±»ï¼Œæ˜¯å«æœ‰çº¯è™šå‡½æ•°çš„ç±»ï¼Œå®ƒå¦‚æœè¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆå­ç±»å°±å¿…é¡»å®ç°è™šåŸºç±»é‡Œé¢çš„æ‰€æœ‰çº¯è™šå‡½æ•°ï¼Œå…¶å­ç±»ä¸èƒ½æ˜¯æŠ½è±¡ç±»ã€‚ ç»§æ‰¿ ç±»æ´¾ç”Ÿåˆ—è¡¨ä¸­çš„è®¿é—®è¯´æ˜ç¬¦ç”¨äºæ§åˆ¶æ´¾ç”Ÿç±»ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„æˆå‘˜æ˜¯å¦å¯¹æ´¾ç”Ÿç±»çš„ç”¨æˆ·å¯è§ã€‚\nå¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰è¦†ç›–å…¶åŸºç±»çš„æŸä¸ªè™šå‡½æ•°ï¼Œåˆ™è¯¥è™šå‡½æ•°çš„è¡Œä¸ºç±»ä¼¼äºå…¶ä»–çš„æ™®é€šå‡½æ•°ï¼Œæ´¾ç”Ÿç±»ä¼šç›´æ¥ç»§æ‰¿å…¶åœ¨åŸºç±»ä¸­çš„ç‰ˆæœ¬ã€‚\nC++æ ‡å‡†å¹¶æ²¡æœ‰æ˜ç¡®è§„å®šæ´¾ç”Ÿç±»çš„å¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•åˆ†å¸ƒï¼Œä¸€ä¸ªå¯¹è±¡ä¸­ç»§æ‰¿è‡ªåŸºç±»çš„éƒ¨åˆ†å’Œæ´¾ç”Ÿç±»è‡ªå®šä¹‰çš„éƒ¨åˆ†ä¸ä¸€å®šæ˜¯è¿ç»­å­˜å‚¨çš„ã€‚\næ¯ä¸ªç±»æ§åˆ¶å®ƒè‡ªå·±çš„æˆå‘˜åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ´¾ç”Ÿç±»å¿…é¡»ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å®ƒçš„åŸºç±»éƒ¨åˆ†ã€‚æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨æ¥å°†å®å‚ä¼ é€’ç»™åŸºç±»æ„é€ å‡½æ•°ã€‚\n1 2 3 4 // class Bulk_quote : public Quote Bulk_quote(const std::string\u0026amp; book, double p, std::size_t qty, double disc) : Quote(book, p), min_qty(qty), discount(disc) { } é™¤éç‰¹åˆ«æŒ‡å‡ºï¼Œå¦åˆ™æ´¾ç”Ÿç±»å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†ä¼šåƒæ•°æ®æˆå‘˜ä¸€æ ·æ‰§è¡Œé»˜è®¤åˆå§‹åŒ–ã€‚\næ´¾ç”Ÿç±»åˆå§‹åŒ–æ—¶é¦–å…ˆåˆå§‹åŒ–åŸºç±»éƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§å£°æ˜çš„é¡ºåºä¾æ¬¡åˆå§‹åŒ–æ´¾ç”Ÿç±»æˆå‘˜ã€‚\næ´¾ç”Ÿç±»å¯ä»¥è®¿é—®åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜ã€‚\nå¦‚æœåŸºç±»å®šä¹‰äº†ä¸€ä¸ªé™æ€æˆå‘˜ï¼Œåˆ™åœ¨æ•´ä¸ªç»§æ‰¿ä½“ç³»ä¸­åªå­˜åœ¨è¯¥æˆå‘˜çš„å”¯ä¸€å®šä¹‰ã€‚å¦‚æœæŸé™æ€æˆå‘˜æ˜¯å¯è®¿é—®çš„ï¼Œåˆ™æ—¢èƒ½é€šè¿‡åŸºç±»ä¹Ÿèƒ½é€šè¿‡æ´¾ç”Ÿç±»ä½¿ç”¨å®ƒã€‚\nåªæœ‰å£°æ˜å¹¶å®šä¹‰çš„ç±»æ‰èƒ½è¢«ç”¨ä½œåŸºç±»ã€‚\n1 2 3 class Base { /* ... */ } ; class D1: public Base { /* ... */ }; class D2: public D1 { /* ... */ }; Baseæ˜¯D1çš„ç›´æ¥åŸºç±»ï¼ˆdirect baseï¼‰ï¼Œæ˜¯D2çš„é—´æ¥åŸºç±»ï¼ˆindirect baseï¼‰ã€‚æœ€ç»ˆçš„æ´¾ç”Ÿç±»å°†åŒ…å«å®ƒç›´æ¥åŸºç±»çš„å­å¯¹è±¡ä»¥åŠæ¯ä¸ªé—´æ¥åŸºç±»çš„å­å¯¹è±¡ã€‚\nC++11ä¸­ï¼Œåœ¨ç±»ååé¢æ·»åŠ finalå…³é”®å­—å¯ä»¥ç¦æ­¢å…¶ä»–ç±»ç»§æ‰¿å®ƒã€‚\n1 2 3 4 5 6 class NoDerived final { /* */ }; // NoDerived can\u0026#39;t be a base class class Base { /* */ }; // Last is final; we cannot inherit from Last class Last final : Base { /* */ }; // Last can\u0026#39;t be a base class class Bad : NoDerived { /* */ }; // error: NoDerived is final class Bad2 : Last { /* */ }; // error: Last is final ã€PRIMER 529~533ã€‘\nè®¿é—®æ§åˆ¶ åŸºç±»ä¸­æˆå‘˜çš„è®¿é—®è¯´æ˜ç¬¦å’Œæ´¾ç”Ÿåˆ—è¡¨ä¸­çš„è®¿é—®è¯´æ˜ç¬¦éƒ½ä¼šå½±å“æŸä¸ªç±»å¯¹å…¶ç»§æ‰¿æˆå‘˜çš„è®¿é—®æƒé™ã€‚\næ´¾ç”Ÿè®¿é—®è¯´æ˜ç¬¦å¯¹äºæ´¾ç”Ÿç±»çš„æˆå‘˜åŠå‹å…ƒèƒ½å¦è®¿é—®å…¶ç›´æ¥åŸºç±»çš„æˆå‘˜æ²¡æœ‰å½±å“ï¼Œå¯¹åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™åªä¸åŸºç±»ä¸­çš„è®¿é—®è¯´æ˜ç¬¦æœ‰å…³ã€‚\næ´¾ç”Ÿè®¿é—®è¯´æ˜ç¬¦çš„ä½œç”¨æ˜¯æ§åˆ¶æ´¾ç”Ÿç±»ï¼ˆåŒ…æ‹¬æ´¾ç”Ÿç±»çš„æ´¾ç”Ÿç±»ï¼‰ç”¨æˆ·å¯¹äºåŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ã€‚\nå¦‚æœä½¿ç”¨å…¬æœ‰ç»§æ‰¿ï¼Œåˆ™åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­å±æ€§ä¸å‘ç”Ÿæ”¹å˜ã€‚ å¦‚æœä½¿ç”¨å—ä¿æŠ¤ç»§æ‰¿ï¼Œåˆ™åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­å˜ä¸ºå—ä¿æŠ¤æˆå‘˜ã€‚ å¦‚æœä½¿ç”¨ç§æœ‰ç»§æ‰¿ï¼Œåˆ™åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­å˜ä¸ºç§æœ‰æˆå‘˜ã€‚ æ´¾ç”Ÿç±»åˆ°åŸºç±»è½¬æ¢çš„å¯è®¿é—®æ€§ï¼ˆå‡å®šDç»§æ‰¿è‡ªBï¼‰ï¼š\nåªæœ‰å½“Då…¬æœ‰åœ°ç»§æ‰¿Bæ—¶ï¼Œç”¨æˆ·ä»£ç æ‰èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»åˆ°åŸºç±»çš„è½¬æ¢ã€‚ ä¸è®ºDä»¥ä»€ä¹ˆæ–¹å¼ç»§æ‰¿Bï¼ŒDçš„æˆå‘˜å‡½æ•°å’Œå‹å…ƒéƒ½èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»åˆ°åŸºç±»çš„è½¬æ¢ã€‚ å¦‚æœDç»§æ‰¿Bçš„æ–¹å¼æ˜¯å…¬æœ‰çš„æˆ–è€…å—ä¿æŠ¤çš„ï¼Œåˆ™Dçš„æ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°å’Œå‹å…ƒå¯ä»¥ä½¿ç”¨Dåˆ°Bçš„ç±»å‹è½¬æ¢ï¼›åä¹‹ï¼Œå¦‚æœDç»§æ‰¿Bçš„æ–¹å¼æ˜¯ç§æœ‰çš„ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ã€‚ å¯¹äºä»£ç ä¸­çš„æŸä¸ªç»™å®šèŠ‚ç‚¹æ¥è¯´ï¼Œå¦‚æœåŸºç±»çš„å…¬æœ‰æˆå‘˜æ˜¯å¯è®¿é—®çš„ï¼Œåˆ™æ´¾ç”Ÿç±»åˆ°åŸºç±»çš„ç±»å‹è½¬æ¢ä¹Ÿæ˜¯å¯è®¿é—®çš„ã€‚\nå‹å…ƒå¯¹åŸºç±»çš„è®¿é—®æƒé™ç”±åŸºç±»è‡ªèº«æ§åˆ¶ï¼Œå³ä½¿å¯¹äºæ´¾ç”Ÿç±»ä¸­çš„åŸºç±»éƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nå‹å…ƒå…³ç³»ä¸èƒ½ç»§æ‰¿ï¼Œæ¯ä¸ªç±»è´Ÿè´£æ§åˆ¶å„è‡ªæˆå‘˜çš„è®¿é—®æƒé™ã€‚\nc++ æ´¾ç”Ÿç±»å‘åŸºç±»è½¬æ¢çš„å¯è®¿é—®æ€§\næ”¹å˜æˆå‘˜çš„å¯è®¿é—®æ€§ ä½¿ç”¨usingå£°æ˜å¯ä»¥æ”¹å˜æ´¾ç”Ÿç±»ç»§æ‰¿çš„æŸä¸ªåå­—çš„è®¿é—®çº§åˆ«ã€‚æ–°çš„è®¿é—®çº§åˆ«ç”±è¯¥usingå£°æ˜ä¹‹å‰çš„è®¿é—®è¯´æ˜ç¬¦å†³å®šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Base { public: std::size_t size() const { return n; } protected: std::size_t n; }; class Derived : private Base // æ³¨æ„: ç§æœ‰ç»§æ‰¿ã€‚ç»§æ‰¿è€Œæ¥çš„ size() å’Œ n éƒ½æ˜¯ç§æœ‰çš„ { public: // using æ”¹å˜ size() çš„å¯è®¿é—®æ€§ä¸º public using Base::size; protected: // using æ”¹å˜ n çš„å¯è®¿é—®æ€§ä¸º protected using Base::n; }; æ´¾ç”Ÿç±»åªèƒ½ä¸ºé‚£äº›å®ƒå¯ä»¥è®¿é—®çš„åå­—æä¾›usingå£°æ˜ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨classå…³é”®å­—å®šä¹‰çš„æ´¾ç”Ÿç±»æ˜¯ç§æœ‰ç»§æ‰¿çš„ï¼Œè€Œä½¿ç”¨structå…³é”®å­—å®šä¹‰çš„æ´¾ç”Ÿç±»æ˜¯å…¬æœ‰ç»§æ‰¿çš„ã€‚\nå»ºè®®æ˜¾å¼åœ°å£°æ˜æ´¾ç”Ÿç±»çš„ç»§æ‰¿æ–¹å¼ï¼Œä¸è¦ä»…ä»…ä¾èµ–äºé»˜è®¤è®¾ç½®ã€‚\nä¸å­˜åœ¨ä»åŸºç±»å‘æ´¾ç”Ÿç±»çš„éšå¼è½¬æ¢ ä¹‹æ‰€ä»¥å­˜åœ¨æ´¾ç”Ÿç±»å‘åŸºç±»çš„éšå¼è½¬æ¢ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªåŸºç±»éƒ¨åˆ†ï¼Œè€ŒåŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆå¯ä»¥ç»‘å®šåˆ°è¯¥åŸºç±»éƒ¨åˆ†ä¸Šã€‚ä¸€ä¸ªåŸºç±»æ—¢å¯ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ´¾ç”Ÿç±»çš„ä¸€éƒ¨åˆ†å­˜åœ¨ã€‚å¦‚æœåŸºç±»å¯¹è±¡ä¸æ˜¯æ´¾ç”Ÿç±»å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™å®ƒåªå«æœ‰åŸºç±»å®šä¹‰çš„æˆå‘˜ï¼Œè€Œä¸å«æœ‰æ´¾ç”Ÿç±»å®šä¹‰çš„æˆå‘˜ï¼Œæ‰€ä»¥ç”¨åŸºç±»çš„æŒ‡é’ˆå»è®¿é—®æ´¾ç”Ÿç±»ä¸­åŸºç±»æ²¡æœ‰çš„æ–¹æ³•æˆ–æˆå‘˜ï¼Œå¿…ç„¶å‡ºç°é”™è¯¯ã€‚ï¼ˆæ‰¿è¯ºè¿‡å¤šï¼‰ã€PRIMER 534ã€‘\nå¤šé‡ç»§æ‰¿ä¸è™šç»§æ‰¿ä»¥åŠæ¶ˆé™¤äºŒä¹‰æ€§æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 class Person { string s = \u0026#34;Person\u0026#34;; public: void sleep() { cout \u0026lt;\u0026lt; s + \u0026#34; sleep\u0026#34; \u0026lt;\u0026lt; endl; } void eat() { cout \u0026lt;\u0026lt; s + \u0026#34; eat\u0026#34; \u0026lt;\u0026lt; endl; } }; class Author : public Person\t// æ ‡è®°ã€1ã€‘Author puplic ç»§æ‰¿è‡ª Person { string s = \u0026#34;Author\u0026#34;; public: void writeBook() { cout \u0026lt;\u0026lt; s + \u0026#34; wirte book\u0026#34; \u0026lt;\u0026lt; endl; } }; class Programmer : public Person\t// æ ‡è®°ã€2ã€‘ { string s = \u0026#34;Programmer\u0026#34;; public: void writeCode() { cout \u0026lt;\u0026lt; s + \u0026#34; write Code\u0026#34; \u0026lt;\u0026lt; endl; } }; class Programmer_Author : public Programmer, public Author // å¤šé‡ç»§æ‰¿ { string s = \u0026#34;Programmer_Author\u0026#34;; }; int main(int argc, char* argv[]) { Programmer_Author pa; pa.writeBook(); pa.writeCode(); //pa.eat();\t// æ ‡è®°ã€3ã€‘ç¼–è¯‘é”™è¯¯ pa.Person::eat(); pa.Programmer::sleep(); return 0; } /* æ‰“å° Author wirte book Programmer write Code Person eat Person sleep */ æ ‡è®°ã€3ã€‘å¤„ç¼–è¯‘é”™è¯¯ï¼Œæ˜¯å› ä¸ºé€šè¿‡å¤šé‡ç»§æ‰¿ Programmer_Author ç±»æ‹¥æœ‰ Programmer ç±»å’Œ Author ç±»çš„ä¸€ä»½æ‹·è´ï¼Œè€Œ Programmer ç±»å’Œ Author ç±»éƒ½åˆ†åˆ«æ‹¥æœ‰ Person ç±»çš„ä¸€ä»½æ‹·è´ï¼Œæ‰€ä»¥ Programmer_Author ç±»æ‹¥æœ‰ Person çš„ä¸¤ä»½æ‹·è´ï¼Œåœ¨è°ƒç”¨ Person ç±»çš„ä¸¤ä»½æ¥å£æ—¶ï¼Œç¼–è¯‘å™¨ä¸æ¸…æ¥šéœ€è¦è°ƒç”¨å“ªä¸€ä»½æ‹·è´ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ã€‚\nå¯¹äºè¿™ä¸ªé—®é¢˜é€šå¸¸æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š\nåŠ ä¸ŠèŒƒå›´è§£æè¿ç®—ç¬¦ï¼ˆåŸŸåŒºåˆ†ç¬¦ï¼‰ç¡®å®šè°ƒç”¨å“ªä¸€ä»½æ‹·è´ã€‚æ¯”å¦‚ pa.Programmer::sleep();\nä½¿ç”¨è™šæ‹Ÿç»§æ‰¿ï¼Œä½¿å¾—å¤šé‡ç»§æ‰¿ç±» Programmer_Author åªæœ‰ Person ç±»çš„ä¸€ä»½æ‹·è´ã€‚\n1 2 3 // åœ¨ä¸Šé¢ä»£ç æ ‡è®°ã€1ã€‘æ ‡è®°ã€2ã€‘å¤„åŠ å…¥ virtual å³å¯ï¼Œè¿™æ · pa.eat(); å°±ä¸ä¼šäº§ç”Ÿé”™è¯¯äº†ã€‚ class Author : virtual public Person\t// æ ‡è®°ã€1ã€‘ class Programmer : virtual public Person\t// æ ‡è®°ã€2ã€‘ ã€æ€»ç»“ã€‘å¤šé‡ç»§æ‰¿çš„ä¼˜ç‚¹æ˜¯å¯¹è±¡å¯ä»¥è°ƒç”¨å¤šä¸ªåŸºç±»ä¸­çš„æ¥å£ï¼Œä½†æ˜¯å®¹æ˜“å‡ºç°ç»§æ‰¿ä¸Šçš„äºŒä¹‰æ€§ã€‚\nå¤šç»§æ‰¿ä¸­æ„é€ å‡½æ•°çš„è°ƒç”¨é¡ºåº å¤šç»§æ‰¿ä¸­æ„é€ å‡½æ•°çš„è°ƒç”¨é¡ºåºæ€»ç»“ï¼Œæ„é€ é¡ºåºä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼š\nä»»ä½•è™šæ‹ŸåŸºç±»çš„æ„é€ å‡½æ•°æŒ‰ç…§å®ƒä»¬è¢«ç»§æ‰¿çš„é¡ºåºæ„é€ ï¼ˆè€Œä¸æ˜¯æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨çš„é¡ºåºï¼‰ï¼› ä»»ä½•éè™šæ‹ŸåŸºç±»çš„æ„é€ å‡½æ•°æŒ‰ç…§å®ƒä»¬è¢«æ„é€ çš„é¡ºåºæ„é€ ï¼› ä»»ä½•æˆå‘˜å¯¹è±¡çš„æ„é€ æŒ‰ç…§å®ƒä»¬å£°æ˜çš„é¡ºåºæ„é€ ï¼Œè€Œä¸æ˜¯åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„é¡ºåºï¼› ç±»è‡ªèº«çš„æ„é€ å‡½æ•°ï¼› å³å€¼å¼•ç”¨ å³å€¼å¼•ç”¨å°±æ˜¯å¿…é¡»ç»‘å®šåˆ°å³å€¼çš„å¼•ç”¨ã€‚å¯ä»¥é€šè¿‡\u0026amp;\u0026amp;æ¥è·å¾—å³å€¼å¼•ç”¨ã€‚\nä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªå·¦å€¼è¡¨è¾¾å¼è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„èº«ä»½ï¼Œè€Œä¸€ä¸ªå³å€¼è¡¨è¾¾å¼è¡¨ç¤ºçš„æ˜¯å¯¹è±¡çš„å€¼ã€‚\n1 2 3 4 5 6 int i = 42;\t// okï¼ši æ˜¯å·¦å€¼ int \u0026amp;r = i; // okï¼šr æ˜¯å·¦å€¼å¼•ç”¨ int \u0026amp;\u0026amp;rr = i; // error: ä¸èƒ½å°†ä¸€ä¸ªå³å€¼å¼•ç”¨ç»‘å®šåˆ°å·¦å€¼ä¸Š int \u0026amp;r2 = i * 42; // error: i * 42 æ˜¯å³å€¼ï¼Œè€Œ r2 æ˜¯å·¦å€¼å¼•ç”¨ const int \u0026amp;r3 = i * 42; // ok: å¯ä»¥ç»‘å®šä¸€ä¸ª const å·¦å€¼å¼•ç”¨åˆ°å³å€¼ int \u0026amp;\u0026amp;rr2 = i * 42; // ok: å°†å³å€¼å¼•ç”¨ rr2 ç»‘å®šåˆ°å³å€¼ä¸Š å³å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°å³å°†è¢«é”€æ¯ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–ç”¨æˆ·çš„ä¸´æ—¶å¯¹è±¡ä¸Šã€‚ä½¿ç”¨å³å€¼å¼•ç”¨çš„ä»£ç å¯ä»¥è‡ªç”±åœ°æ¥ç®¡æ‰€å¼•ç”¨å¯¹è±¡çš„èµ„æºã€‚\nå˜é‡è¡¨è¾¾å¼éƒ½æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ä¸èƒ½å°†ä¸€ä¸ªå³å€¼å¼•ç”¨ç›´æ¥ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸Šï¼Œå³ä½¿è¿™ä¸ªå˜é‡çš„ç±»å‹æ˜¯å³å€¼å¼•ç”¨ä¹Ÿä¸è¡Œã€‚\n1 2 3 4 5 6 7 int \u0026amp;\u0026amp;rr1 = 42; // ok: rr1 æ˜¯å³å€¼å¼•ç”¨ //int \u0026amp;\u0026amp;rr2 = rr1; // error: ä½†æ­¤æ—¶ä½œä¸ºè¡¨è¾¾å¼çš„ rr1 æ˜¯å·¦å€¼ï¼Œè€Œ rr2 å´æ˜¯å³å€¼å¼•ç”¨ int \u0026amp;\u0026amp;rr3 = std::move(rr1); int \u0026amp;\u0026amp;rr4 = rr1 * 1; rr1 = 5; cout \u0026lt;\u0026lt; \u0026#34;rr1 =\u0026#34; \u0026lt;\u0026lt; rr1 \u0026lt;\u0026lt; \u0026#34; rr3 = \u0026#34; \u0026lt;\u0026lt; rr3 \u0026lt;\u0026lt; \u0026#34; rr4 = \u0026#34; \u0026lt;\u0026lt; rr4 \u0026lt;\u0026lt; endl; // æ‰“å°: rr1 =5 rr3 = 5 rr4 = 42 è°ƒç”¨moveå‡½æ•°å¯ä»¥è·å¾—ç»‘å®šåœ¨å·¦å€¼ä¸Šçš„å³å€¼å¼•ç”¨ï¼Œæ­¤å‡½æ•°å®šä¹‰åœ¨å¤´æ–‡ä»¶utilityä¸­ã€‚\nå·¦å€¼ä¸å³å€¼ å·¦å€¼æŒä¹…ï¼Œå³å€¼çŸ­æš‚ï¼šå·¦å€¼æœ‰æŒä¹…çš„çŠ¶æ€ï¼Œè€Œå³å€¼è¦ä¹ˆæ˜¯å­—é¢å¸¸é‡ï¼Œè¦ä¹ˆæ˜¯è¡¨è¾¾å¼æ±‚å€¼çš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ã€‚\nç”±äºå³å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°ä¸´æ—¶çš„ å¯¹è±¡ä¸Šï¼Œå¯çŸ¥ï¼š\næ‰€å¼•ç”¨çš„å¯¹è±¡å°†è¦è¢«é”€æ¯ è¯¥å¯¹è±¡æ²¡æœ‰å…¶ä»–ç”¨æˆ· è¿™ä¸¤ä¸ªç‰¹æ€§æ„å‘³ç€ï¼šä½¿ç”¨å³å€¼å¼•ç”¨çš„ä»£ç å¯ä»¥è‡ªç”±åœ°æ¥ç®¡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„èµ„æºã€‚\nã€PRIMER 471, 472ã€‘\næ™ºèƒ½æŒ‡é’ˆ æ™ºèƒ½æŒ‡é’ˆä¸»è¦ç”¨äºç®¡ç†åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜ï¼Œå®ƒå°†æ™®é€šçš„æŒ‡é’ˆå°è£…ä¸ºä¸€ä¸ªæ ˆå¯¹è±¡ã€‚å½“æ ˆå¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸç»“æŸåï¼Œä¼šåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾æ‰ç”³è¯·çš„å†…å­˜ï¼Œä»è€Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚C++ 11ä¸­æœ€å¸¸ç”¨çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹ä¸ºshared_ptrï¼Œå®ƒé‡‡ç”¨å¼•ç”¨è®¡æ•°çš„æ–¹æ³•ï¼Œè®°å½•å½“å‰å†…å­˜èµ„æºè¢«å¤šå°‘ä¸ªæ™ºèƒ½æŒ‡é’ˆå¼•ç”¨ã€‚è¯¥å¼•ç”¨è®¡æ•°çš„å†…å­˜åœ¨å †ä¸Šåˆ†é…ã€‚å½“æ–°å¢ä¸€ä¸ªæ—¶å¼•ç”¨è®¡æ•°åŠ  1 ï¼Œå½“è¿‡æœŸæ—¶å¼•ç”¨è®¡æ•°å‡ä¸€ã€‚åªæœ‰å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œæ™ºèƒ½æŒ‡é’ˆæ‰ä¼šè‡ªåŠ¨é‡Šæ”¾å¼•ç”¨çš„å†…å­˜èµ„æºã€‚å¯¹shared_ptrè¿›è¡Œåˆå§‹åŒ–æ—¶ä¸èƒ½å°†ä¸€ä¸ªæ™®é€šæŒ‡é’ˆç›´æ¥èµ‹å€¼ç»™æ™ºèƒ½æŒ‡é’ˆï¼Œå› ä¸ºä¸€ä¸ªæ˜¯æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯ç±»ï¼Œå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥æ™®é€šæŒ‡é’ˆã€‚ï¼ˆ ä»auto_pträ¹Ÿå¸¦ä¸€ç‚¹ï¼Œè™½ç„¶C++ 11å·²ç»é—å¼ƒï¼‰\nstd::auto_ptr\u0026lt;string\u0026gt; ptr(new string);\nstd::shared_ptr\u0026lt;string\u0026gt; p1;\nstd::shared_ptr\u0026lt;list\u0026lt;int\u0026gt;\u0026gt; p2;\n1 2 3 4 5 6 7 auto_ptr\u0026lt;char*\u0026gt; ap(new char*); *ap = \u0026#34;ap1\u0026#34;; *ap = \u0026#34;ap2\u0026#34;; char **bp = new char*; *bp = \u0026#34;bp1\u0026#34;; cout \u0026lt;\u0026lt; *ap \u0026lt;\u0026lt; endl;\t// \u0026#34;ap2\u0026#34; cout \u0026lt;\u0026lt; *bp \u0026lt;\u0026lt; endl;\t// \u0026#34;bp1\u0026#34; 1 2 3 4 #include \u0026lt;memory\u0026gt; double *p = new double; shared_ptr\u0026lt;double\u0026gt; pshared(p);\t// åˆæ³•ï¼Œæ˜¾ç¤ºè½¬æ¢ï¼Œexplicit conversion //shared_ptr\u0026lt;double\u0026gt; pshared = p; // ä¸åˆæ³•ï¼Œéšå¼è½¬æ¢ï¼Œimplicit conversion 1 2 3 4 5 6 7 8 int main(int argc, char* argv[]) { string str(\u0026#34;hello world!\u0026#34;); // ç¨‹åºèƒ½è¿è¡Œï¼Œä½†æ˜¯åœ¨è¦é‡Šæ”¾ pshared æŒ‡å‘çš„å†…å­˜æ—¶ä¼šå‡ºé”™ // å› ä¸º str ä¸æ˜¯å­˜åœ¨å †ä¸­ï¼Œå½“ pshared è¿‡æœŸæ—¶ï¼Œdelete è¿ç®—ç¬¦ä¼šç”¨äºéå †å†…å­˜ï¼Œé€ æˆé”™è¯¯ shared_ptr\u0026lt;string\u0026gt; pshared(\u0026amp;str); cout \u0026lt;\u0026lt; *pshared \u0026lt;\u0026lt; endl; getchar(); } auto_ptr æ˜¯C++98æä¾›çš„è§£å†³æ–¹æ¡ˆï¼ŒC++11å·²ç»æ‘’å¼ƒï¼Œå¹¶æä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆ\nshared_ptr è¢«ç§°ä¸ºå…±äº«æŒ‡é’ˆï¼Œç”¨äºç®¡ç†å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå…±åŒæ‹¥æœ‰çš„åŠ¨æ€åˆ†é…å¯¹è±¡ï¼Œ\nunique_ptr å”¯ä¸€æ‹¥æœ‰æŒ‡å®šçš„å¯¹è±¡ï¼Œç›¸æ¯”æ™®é€šæŒ‡é’ˆï¼Œæ‹¥æœ‰ RAII çš„ç‰¹æ€§ä½¿å¾—ç¨‹åºå‡ºç°å¼‚å¸¸æ—¶ï¼ŒåŠ¨æ€èµ„æºå¯ä»¥å¾—åˆ°é‡Šæ”¾ã€‚\nRAIIï¼ŒResource Acquisition Is Initializationï¼Œèµ„æºè·å–å³åˆå§‹åŒ–ï¼š å…¶æ ¸å¿ƒæ˜¯æŠŠèµ„æºå’Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œå¯¹è±¡åˆ›å»ºè·å–èµ„æºï¼Œå¯¹è±¡é”€æ¯é‡Šæ”¾èµ„æº\nweak_ptr æ˜¯ä¸ºäº†é…åˆshared_ptrè€Œå¼•å…¥çš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆï¼Œå› ä¸ºå®ƒä¸å…·æœ‰æ™®é€šæŒ‡é’ˆçš„è¡Œä¸ºï¼Œæ²¡æœ‰é‡è½½operator*å’Œ-\u0026gt;,å®ƒçš„æœ€å¤§ä½œç”¨åœ¨äºååŠ©shared_ptrå·¥ä½œï¼Œåƒæ—è§‚è€…é‚£æ ·è§‚æµ‹èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚\næ™ºèƒ½æŒ‡é’ˆçš„å†…å­˜æ³„éœ²ä»¥åŠè§£å†³æ–¹æ³• å½“ä¸¤ä¸ªå¯¹è±¡ç›¸äº’ä½¿ç”¨ä¸€ä¸ª shared_ptr æˆå‘˜å˜é‡æŒ‡å‘å¯¹æ–¹ï¼Œä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä½¿å¼•ç”¨è®¡æ•°å¤±æ•ˆï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nä¸ºäº†è§£å†³å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œå¼•å…¥äº† weak_ptr å¼±æŒ‡é’ˆï¼Œweak_ptr çš„æ„é€ å‡½æ•°ä¸ä¼šä¿®æ”¹å¼•ç”¨è®¡æ•°çš„å€¼ï¼Œä»è€Œä¸ä¼šå¯¹å¯¹è±¡çš„å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå…¶ç±»ä¼¼ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼Œä½†ä¸æŒ‡å‘å¼•ç”¨è®¡æ•°çš„å…±äº«å†…å­˜ï¼Œä½†æ˜¯å…¶å¯ä»¥æ£€æµ‹åˆ°æ‰€ç®¡ç†çš„å¯¹è±¡æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ï¼Œä»è€Œé¿å…éæ³•è®¿é—®ã€‚\nä¸ºä»€ä¹ˆæ‘’å¼ƒ auto_ptr 1 2 3 4 auto_ptr\u0026lt;string\u0026gt; p1(new string(\u0026#34;hello\u0026#34;)); auto_ptr\u0026lt;string\u0026gt; p2; p2 = p1;\t// å½“ p1, p2 è¿‡æœŸæ—¶ï¼Œå°†åˆ é™¤åŒä¸€ä¸ªå¯¹è±¡ä¸¤æ¬¡ è§£å†³ä¹‹é“ï¼š\nå®šä¹‰å¤åˆ¶è¿ç®—ç¬¦ï¼Œä½¿ä¹‹æ‰§è¡Œæ·±å¤åˆ¶ å»ºç«‹æ‰€æœ‰æƒæ¦‚å¿µï¼Œä½¿åŒæ—¶åªæœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆå¯æ‹¥æœ‰å®ƒã€‚è¿™æ ·ï¼Œåªæœ‰æ‹¥æœ‰å¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆæœ‰æƒææ„è¯¥å¯¹è±¡ï¼Œè¿™æ˜¯auto_ptr çš„ç­–ç•¥ï¼Œunique_ptr çš„ç­–ç•¥æ›´ä¸¥æ ¼ã€‚ åˆ›å»ºæ™ºèƒ½æ›´é«˜çš„æŒ‡é’ˆï¼Œè·Ÿè¸ªå¼•ç”¨ç‰¹å®šå¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆæ•°ã€‚è¿™ç§°ä¸ºå¼•ç”¨è®¡æ•°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 int main(int argc, char* argv[]) { auto_ptr\u0026lt;string\u0026gt; p1(new string(\u0026#34;hello\u0026#34;)); auto_ptr\u0026lt;string\u0026gt; p2; cout \u0026lt;\u0026lt; *p1 \u0026lt;\u0026lt; endl; // æ­£å¸¸æ‰“å° p2 = p1;\t// p1 ä¸§å¤±äº†å¯¹ string å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œp1 æ­¤æ—¶æ˜¯ç©ºæŒ‡é’ˆ cout \u0026lt;\u0026lt; *p1 \u0026lt;\u0026lt; endl; // ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿è¡Œæ—¶æŠ¥é”™ï¼Œå› ä¸ºè¯•å›¾æé¢†ç©ºæŒ‡é’ˆ getchar(); } //\tå°† auto_ptr æ¢æˆ unique_ptrï¼Œç¼–è¯‘å™¨è®¤ä¸ºè¯­å¥ p2 = p1; éæ³•ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™ï¼ˆå› ä¸º p1 ä¸æ˜¯ä¸´æ—¶å³å€¼ï¼‰ã€‚ //\tå°† auto_ptr æ¢æˆ shared_ptrï¼Œç¼–è¯‘è¿è¡Œé˜¶æ®µéƒ½æ²¡é—®é¢˜ï¼Œæ­£å¸¸æ‰“å°ã€‚ //\tshared_ptr é‡‡ç”¨çš„ç­–ç•¥æ˜¯å¼•ç”¨è®¡æ•°ï¼Œèµ‹å€¼æ—¶ï¼Œè®¡æ•°åŠ ä¸€ï¼Œè¿‡æœŸæ—¶ï¼Œè®¡æ•°å‡ä¸€ã€‚ä»…å½“æœ€åä¸€ä¸ªæŒ‡é’ˆè¿‡æœŸæ—¶ï¼Œæ‰è°ƒç”¨ deleteã€‚ 1 2 shared_ptr\u0026lt;string\u0026gt; p1(new string(\u0026#34;hello\u0026#34;)); shared_ptr\u0026lt;string\u0026gt; p2(p1);\t// åˆæ³•ï¼Œå°†å³å€¼ p1 èµ‹ç»™ p2 1 2 3 unique_ptr\u0026lt;string\u0026gt; p1(new string(\u0026#34;hello\u0026#34;)); //shared_ptr\u0026lt;string\u0026gt; p2(p1);\t// ä¸åˆæ³•ï¼Œå³å€¼ p1 æ˜¯ unique_ptrï¼Œè‹¥èƒ½èµ‹ç»™ p2ï¼Œåˆ™ p1ï¼Œp2 æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¯¼è‡´ p1 ä¸åˆæ³•ï¼Œæ­¤è¯­å¥ç¼–è¯‘ä¸é€šè¿‡ //unique_ptr\u0026lt;string\u0026gt; p2(p1);\t// ä¸åˆæ³•ï¼Œp1 ä¸æ˜¯ä¸´æ—¶å³å€¼ï¼Œæ³¨æ„ä¸´æ—¶ã€‚ 1 2 3 4 5 6 7 8 unique_ptr\u0026lt;string\u0026gt; foo() { unique_ptr\u0026lt;string\u0026gt; p1(new string(\u0026#34;hello\u0026#34;)); return p1; } // å‡½æ•°è¿”å›çš„ unique_ptr\u0026lt;string\u0026gt; ä¸ºä¸´æ—¶å³å€¼ï¼Œæ­¤æ—¶å¯èµ‹ç»™å¦ä¸€ä¸ª unique_ptr å‹æŒ‡é’ˆ int main(int argc, char* argv[]) { unique_ptr\u0026lt;string\u0026gt; p2(foo()); } å·¦å€¼ï¼Œå³å€¼\næ›´å¤šç”¨æ³•ï¼ˆC++ 11ï¼‰ shared_ptrå’Œunique_ptréƒ½æ”¯æŒçš„æ“ä½œï¼š\nshared_ptrç‹¬æœ‰çš„æ“ä½œï¼š\nmake_sharedå‡½æ•°ï¼ˆå®šä¹‰åœ¨å¤´æ–‡ä»¶memoryä¸­ï¼‰åœ¨åŠ¨æ€å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–å®ƒï¼Œè¿”å›æŒ‡å‘æ­¤å¯¹è±¡çš„shared_ptrã€‚\næ™ºèƒ½æŒ‡é’ˆä¸æ™®é€šæŒ‡é’ˆçš„è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 void show(string s) { cout \u0026lt;\u0026lt; s \u0026lt;\u0026lt; endl; } int main() { std::shared_ptr\u0026lt;std::string\u0026gt; s = std::make_shared\u0026lt;std::string\u0026gt;(\u0026#34;hello\\n\u0026#34;); show(*s.get()); // s.get() è·å¾—å†…ç½®æŒ‡é’ˆ string *ï¼Œéœ€è¦è§£å¼•ç”¨ä¼ åˆ°show()ä¸­ // ç‰¹åˆ«æ³¨æ„ï¼Œä¸è¦ä½¿ç”¨get()åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ã€‚ return 0; } 1 2 3 4 5 6 7 shared_ptr\u0026lt;int\u0026gt; p(new int(42)); // reference count is 1 int *q = p.get(); // ok: but don\u0026#39;t use q in any way that might delete its pointer { // new block // undefined: two independent shared_ptrs point to the same memory shared_ptr\u0026lt;int\u0026gt;(q); } // block ends, q is destroyed, and the memory to which q points is freed int foo = *p; // undefined; the memory to which p points was freed æ™ºèƒ½æŒ‡é’ˆçš„getå‡½æ•°è¿”å›ä¸€ä¸ªå†…ç½®æŒ‡é’ˆï¼ŒæŒ‡å‘æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„å¯¹è±¡ã€‚ä¸»è¦ç”¨äºå‘ä¸èƒ½ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„ä»£ç ä¼ é€’å†…ç½®æŒ‡é’ˆã€‚ä½¿ç”¨getè¿”å›æŒ‡é’ˆçš„ä»£ç ä¸èƒ½deleteæ­¤æŒ‡é’ˆã€‚\nä¸è¦ä½¿ç”¨getåˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ã€‚\nã€PRIMER 414ã€‘\nshared_ptræ˜¯å¦çº¿ç¨‹å®‰å…¨ std::shared_ptrçš„å¼•ç”¨è®¡æ•°æœ¬èº«æ˜¯å®‰å…¨ä¸”æ— é”çš„ï¼Œä½†å¯¹è±¡çš„è¯»å†™åˆ™ä¸æ˜¯ã€‚ä¹Ÿå°±æ˜¯è¯´std::shared_ptrå¯¹è±¡çš„åˆ›å»ºææ„æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¤šçº¿ç¨‹è¯»å†™std::shared_ptrå¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚std::shared_ptr å†…å­˜æ˜¯ç”±äºä¸¤ä¸ªç»„æˆéƒ¨åˆ†ï¼š æŒ‡å‘ç®¡ç†å¯¹è±¡çš„æŒ‡é’ˆ å’Œ å¼•ç”¨è®¡æ•°å™¨ã€‚åœ¨è¯»/å†™æ—¶ï¼Œæ˜¯ç›´æ¥å¯¹ä¸¤ä¸ªå˜é‡æ“ä½œï¼Œä¸å¯èƒ½æ˜¯åŸå­ç±»å‹çš„ã€‚å› ä¸º std::shared_ptr æœ‰ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼Œè¯»å†™æ“ä½œä¸èƒ½åŸå­åŒ–ã€‚ä½¿å¾—å¤šçº¿ç¨‹è¯»å†™åŒä¸€ä¸ª std::shared_ptr å¯¹è±¡éœ€è¦åŠ é”ã€‚\nunique_ptr ä¸shared_pträ¸åŒï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªunique_ptræŒ‡å‘ç»™å®šçš„å¯¹è±¡ã€‚å½“unique_ptrè¢«é”€æ¯æ—¶ï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¹Ÿä¼šè¢«é”€æ¯ã€‚\nmake_uniqueå‡½æ•°ï¼ˆC++14æ–°å¢ï¼Œå®šä¹‰åœ¨å¤´æ–‡ä»¶memoryä¸­ï¼‰åœ¨åŠ¨æ€å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–å®ƒï¼Œè¿”å›æŒ‡å‘æ­¤å¯¹è±¡çš„unique_ptrã€‚\n1 2 3 unique_ptr\u0026lt;int\u0026gt; p1(new int(42)); // C++14 unique_ptr\u0026lt;int\u0026gt; p2 = make_unique\u0026lt;int\u0026gt;(42); ç”±äºunique_ptrç‹¬å å…¶æŒ‡å‘çš„å¯¹è±¡ï¼Œå› æ­¤unique_pträ¸æ”¯æŒæ™®é€šçš„æ‹·è´æˆ–èµ‹å€¼æ“ä½œã€‚\nunique_ptræ“ä½œï¼š\nreleaseå‡½æ•°è¿”å›unique_ptrå½“å‰ä¿å­˜çš„æŒ‡é’ˆå¹¶å°†å…¶ç½®ä¸ºç©ºã€‚\nresetå‡½æ•°æˆå‘˜æ¥å—ä¸€ä¸ªå¯é€‰çš„æŒ‡é’ˆå‚æ•°ï¼Œé‡æ–°è®¾ç½®unique_pträ¿å­˜çš„æŒ‡é’ˆã€‚å¦‚æœunique_pträ¸ä¸ºç©ºï¼Œåˆ™å®ƒåŸæ¥æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«é‡Šæ”¾ã€‚\n1 2 3 4 5 // å°†æ‰€æœ‰æƒä» p1 (which points to the string Stegosaurus) è½¬ç§»ç»™ p2 unique_ptr\u0026lt;string\u0026gt; p2(p1.release()); // release makes p1 null unique_ptr\u0026lt;string\u0026gt; p3(new string(\u0026#34;Trex\u0026#34;)); // transfers ownership from p3 to p2 p2.reset(p3.release()); // reset deletes the memory to which p2 had pointed è°ƒç”¨releaseä¼šåˆ‡æ–­unique_ptrå’Œå®ƒåŸæ¥ç®¡ç†çš„å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚releaseè¿”å›çš„æŒ‡é’ˆé€šå¸¸è¢«ç”¨æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ç»™æ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ã€‚å¦‚æœæ²¡æœ‰ç”¨å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆä¿å­˜releaseè¿”å›çš„æŒ‡é’ˆï¼Œç¨‹åºå°±è¦è´Ÿè´£èµ„æºçš„é‡Šæ”¾ã€‚\n1 2 p2.release(); // WRONG: p2 won\u0026#39;t free the memory and we\u0026#39;ve lost the pointer auto p = p2.release(); // ok, but we must remember to delete(p) ä¸èƒ½æ‹·è´unique_ptrçš„è§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå¯ä»¥æ‹·è´æˆ–èµ‹å€¼ä¸€ä¸ªå³å°†è¢«é”€æ¯çš„unique_ptrï¼ˆç§»åŠ¨æ„é€ ã€ç§»åŠ¨èµ‹å€¼ï¼‰ã€‚\n1 2 3 4 5 6 unique_ptr\u0026lt;int\u0026gt; clone(int p) { unique_ptr\u0026lt;int\u0026gt; ret(new int (p)); // . . . return ret; } è€ç‰ˆæœ¬çš„æ ‡å‡†åº“åŒ…å«äº†ä¸€ä¸ªåä¸ºauto_ptrçš„ç±»ï¼Œ\nç±»ä¼¼shared_ptrï¼Œé»˜è®¤æƒ…å†µä¸‹unique_ptrç”¨deleteé‡Šæ”¾å…¶æŒ‡å‘çš„å¯¹è±¡ã€‚unique_ptrçš„åˆ é™¤å™¨åŒæ ·å¯ä»¥é‡è½½ï¼Œä½†unique_ptrç®¡ç†åˆ é™¤å™¨çš„æ–¹å¼ä¸shared_pträ¸åŒã€‚å®šä¹‰unique_ptræ—¶å¿…é¡»åœ¨å°–æ‹¬å·ä¸­æä¾›åˆ é™¤å™¨ç±»å‹ã€‚åˆ›å»ºæˆ–resetè¿™ç§unique_ptrç±»å‹çš„å¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆåˆ é™¤å™¨ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 // p points to an object of type objT and uses an object of type delT to free that object // it will call an object named fcn of type delT unique_ptr\u0026lt;objT, delT\u0026gt; p (new objT, fcn); void f(destination \u0026amp;d /* other needed parameters */) { connection c = connect(\u0026amp;d); // open the connection // when p is destroyed, the connection will be closed unique_ptr\u0026lt;connection, decltype(end_connection)*\u0026gt; p(\u0026amp;c, end_connection); // use the connection // when f exits, even if by an exception, the connection will be properly closed } // å½“ p è¢«æ‘§æ¯æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ end_connection å‡½æ•° weak_ptr weak_ptræ˜¯ä¸€ç§ä¸æ§åˆ¶æ‰€æŒ‡å‘å¯¹è±¡ç”Ÿå­˜æœŸçš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªç”±shared_ptrç®¡ç†çš„å¯¹è±¡ã€‚å°†weak_ptrç»‘å®šåˆ°shared_pträ¸ä¼šæ”¹å˜shared_ptrçš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœshared_ptrè¢«é”€æ¯ï¼Œå³ä½¿æœ‰weak_ptræŒ‡å‘å¯¹è±¡ï¼Œå¯¹è±¡ä»ç„¶æœ‰å¯èƒ½è¢«é‡Šæ”¾ã€‚\nåˆ›å»ºä¸€ä¸ªweak_ptræ—¶ï¼Œéœ€è¦ä½¿ç”¨shared_ptræ¥åˆå§‹åŒ–å®ƒã€‚weak_ptråªèƒ½é…åˆstd::shared_pträ½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚\n1 2 auto p = make_shared\u0026lt;int\u0026gt;(42); weak_ptr\u0026lt;int\u0026gt; wp(p); // wp weakly shares with p; use count in p is unchanged ä½¿ç”¨weak_ptrè®¿é—®å¯¹è±¡æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨lockå‡½æ•°ã€‚è¯¥å‡½æ•°æ£€æŸ¥weak_ptræŒ‡å‘çš„å¯¹è±¡æ˜¯å¦ä»ç„¶å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›æŒ‡å‘å…±äº«å¯¹è±¡çš„shared_ptrï¼Œå¦åˆ™è¿”å›ç©ºæŒ‡é’ˆã€‚\n1 2 3 4 5 if (shared_ptr\u0026lt;int\u0026gt; np = wp.lock()) { // true if np is not null // inside the if, np shares its object with p } ä½¿ç”¨weak_ptré˜²æ­¢å¾ªç¯å¼•ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #include \u0026lt;memory\u0026gt; #include \u0026lt;iostream\u0026gt; class Foo : public std::enable_shared_from_this\u0026lt;Foo\u0026gt; { public: Foo() { std::cout \u0026lt;\u0026lt; __PRETTY_FUNCTION__ \u0026lt;\u0026lt; std::endl; } ~Foo() { std::cout \u0026lt;\u0026lt; __PRETTY_FUNCTION__ \u0026lt;\u0026lt; std::endl; } void self() { mPtr = shared_from_this(); } private: // std::shared_ptr\u0026lt;Foo\u0026gt; mPtr; // ã€1ã€‘ç”±äºå¾ªç¯å¼•ç”¨ï¼Œä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œæ”¹ mPtr ä¸º std::weak_ptr ç±»å‹å³å¯ std::weak_ptr\u0026lt;Foo\u0026gt; mPtr; //ã€2ã€‘ }; int main() { { std::shared_ptr\u0026lt;Foo\u0026gt; c = std::make_shared\u0026lt;Foo\u0026gt;(); c-\u0026gt;self(); } return 0; } /** æ³¨é‡Šã€1ã€‘æ‰“å¼€ã€2ã€‘ï¼Œæ‰“å° Foo::Foo() Foo::~Foo() æ³¨é‡Šã€2ã€‘æ‰“å¼€ã€1ã€‘ï¼Œæ‰“å° Foo::Foo() ç”±äºå¾ªç¯å¼•ç”¨ï¼Œä¸ä¼šè°ƒç”¨ææ„å‡½æ•° */ std::enable_shared_from_this\u0026lt;T\u0026gt;::shared_from_this æ˜¯ä¸ªä¾µå…¥å¼è®¾è®¡ã€‚ä¸ºçš„è§£å†³ä¼ å…¥thiså¯¼è‡´å¯¹è±¡è¢«ææ„ä¸¤æ¬¡çš„é—®é¢˜ã€‚\nä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ shared_from_this()? ç”¨äºè¿”å›å½“å‰å¯¹è±¡ thisçš„std::shared_ptrç±»å‹æŒ‡é’ˆæ—¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include \u0026lt;memory\u0026gt; #include \u0026lt;iostream\u0026gt; class Foo : public std::enable_shared_from_this\u0026lt;Foo\u0026gt; { public: Foo() { std::cout \u0026lt;\u0026lt; \u0026#34;Foo()\\n\u0026#34;; } ~Foo() { std::cout \u0026lt;\u0026lt; \u0026#34;~Foo()\\n\u0026#34;; } std::shared_ptr\u0026lt;Foo\u0026gt; getSelf() { return shared_from_this(); } }; int main() { Foo *foo = new Foo; std::shared_ptr\u0026lt;Foo\u0026gt; sp1(foo); std::shared_ptr\u0026lt;Foo\u0026gt; sp2 = sp1-\u0026gt;getSelf(); // ã€1ã€‘ä¸ºäº†å¯¹ fooå¯¹è±¡è¿›è¡Œå…±äº« //std::shared_ptr\u0026lt;Foo\u0026gt; sp2(foo); // ã€2ã€‘ // std::boolalpha çš„ä½œç”¨æ˜¯ä½¿ bool å‹å˜é‡æŒ‰ç…§ falseã€true çš„æ ¼å¼è¾“å‡ºã€‚å¦‚ä¸ä½¿ç”¨è¯¥æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆç»“æœä¼šæŒ‰ç…§ 1ã€0 çš„æ ¼å¼è¾“å‡º std::cout \u0026lt;\u0026lt; std::boolalpha \u0026lt;\u0026lt; (sp2.get() == foo) \u0026lt;\u0026lt; std::endl; std::cout \u0026lt;\u0026lt; sp1.use_count() \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; sp2.use_count() \u0026lt;\u0026lt; std::endl; } /* æ‰“å° Foo() true 2 2 ~Foo() */ å¦‚æœæ³¨é‡Šã€1ã€‘æ‰“å¼€ã€2ã€‘ï¼Œåˆ™ä¼šææ„ä¸¤æ¬¡ï¼Œäº§ç”Ÿæœªå®šä¹‰çš„è¡Œä¸ºï¼Œæ‰“å°å¦‚ä¸‹\n1 2 3 4 5 6 7 Foo() true 1 1 ~Foo() ~Foo() free(): double free detected in tcache 2 å·²æ”¾å¼ƒ (æ ¸å¿ƒå·²è½¬å‚¨) å°½ç®¡sp1å’Œsp2éƒ½æŒ‡å‘äº†fooï¼Œä½†æ˜¯å´ä¸å…±äº«è®¡æ•°ï¼Œå½“ææ„çš„æ—¶å€™å°±ä¼šè¢«ææ„ä¸¤æ¬¡ï¼Œäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚ std::weak_ptrå¯ä»¥æ¥å—std::shared_ptrå‚æ•°æ¥æ„é€ è‡ªå·±ï¼Œstd::shared_pträ¹Ÿå…·æœ‰æ¥å—std::weak_ptrå‚æ•°æ¥æ„é€ è‡ªå·±ã€‚\nenable_shared_from_this å‡½æ•°åŸå‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 template\u0026lt;typename _Tp\u0026gt; class enable_shared_from_this { protected: ... public: shared_ptr\u0026lt;_Tp\u0026gt; shared_from_this() { return shared_ptr\u0026lt;_Tp\u0026gt;(this-\u0026gt;_M_weak_this); } shared_ptr\u0026lt;const _Tp\u0026gt; shared_from_this() const { return shared_ptr\u0026lt;const _Tp\u0026gt;(this-\u0026gt;_M_weak_this); } private: ... mutable weak_ptr\u0026lt;_Tp\u0026gt; _M_weak_this; } enable_shared_from_thisçš„å­ç±»éœ€è¦è¿”å›è‡ªèº«çš„std::shared_ptræŒ‡é’ˆï¼Œé‚£ä¹ˆå°±éœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ã€‚\næˆå‘˜å˜é‡ä¸ºä»€ä¹ˆæ˜¯weak_ptrç±»å‹\nå› ä¸ºå¦‚æœæ˜¯std::shared_ptrç±»å‹ï¼Œé‚£ä¹ˆå°±æ°¸è¿œæ— æ³•ææ„å¯¹è±¡è‡ªèº«ã€‚\nè¿™ä¸ª_M_weak_thisä¸æ˜¯è¿™ä¸ªç±»ä¸­åˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨shared_pträ¸­åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–çš„å€¼å°±æ˜¯thisã€‚å› æ­¤å¦‚æœæ™ºèƒ½æŒ‡é’ˆç±»å‹æ˜¯std::shared_ptrï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå¼•ç”¨è®¡æ•°å°±æ˜¯1ï¼Œé‚£ä¹ˆæ°¸è¿œä¹Ÿæ— æ³•ææ„ã€‚\nä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼ å›this\nstd::shared_ptrçš„å¼•ç”¨è®¡æ•°å¢åŠ æ˜¯éœ€è¦ç”¨operator=å®ç°çš„ã€‚\nåŸºäºå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆå®ç° æºç åœ¨./sources/mine/SmartPtr.cpp\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 #include \u0026lt;iostream\u0026gt; #define showfunc std::cout \u0026lt;\u0026lt; __PRETTY_FUNCTION__ \u0026lt;\u0026lt; std::endl; template \u0026lt;class T\u0026gt; class SmartPtr { private: T *mPtr; size_t *mRef; public: SmartPtr(T *p = 0); SmartPtr(const SmartPtr \u0026amp;src); // åŠ ä¸Š explicit å¯ä»¥æ‹’ç»éšå¼æ‹·è´æ„é€  SmartPtr \u0026amp;operator=(const SmartPtr \u0026amp;rhs); T *operator-\u0026gt;() const; T \u0026amp;operator*() const; ~SmartPtr(); private: void decRef(); //åªä¼šè¢«å…¶å®ƒæˆå‘˜å‡½æ•°æ‰€è°ƒç”¨ public: // for debug int get_ref_count() const; }; template \u0026lt;class T\u0026gt; SmartPtr\u0026lt;T\u0026gt;::SmartPtr(T *p) : mPtr(p), // mPtr æŒ‡å‘ p æ‰€æŒ‡å‘çš„å†…å­˜ mRef(new size_t(1)) // å¼•ç”¨è®¡æ•°åˆå§‹åŒ–ä¸º 1 { showfunc; } template \u0026lt;class T\u0026gt; SmartPtr\u0026lt;T\u0026gt;::SmartPtr(const SmartPtr \u0026amp;src) { showfunc; mPtr = src.mPtr; mRef = src.mRef; ++*mRef; } template \u0026lt;class T\u0026gt; SmartPtr\u0026lt;T\u0026gt; \u0026amp;SmartPtr\u0026lt;T\u0026gt;::operator=(const SmartPtr\u0026lt;T\u0026gt; \u0026amp;rhs) { showfunc; ++*rhs.mRef; decRef(); mPtr = rhs.mPtr; mRef = rhs.mRef; return *this; } template \u0026lt;class T\u0026gt; T *SmartPtr\u0026lt;T\u0026gt;::operator-\u0026gt;() const { showfunc; if (mPtr) { return mPtr; } throw std::runtime_error(\u0026#34;dereference of nullptr pointer\u0026#34;); } template \u0026lt;class T\u0026gt; T \u0026amp;SmartPtr\u0026lt;T\u0026gt;::operator*() const { showfunc; if (mPtr) { return *mPtr; } throw std::runtime_error(\u0026#34;dereference of nullptr pointer\u0026#34;); } template \u0026lt;class T\u0026gt; SmartPtr\u0026lt;T\u0026gt;::~SmartPtr() { showfunc; decRef(); } template \u0026lt;class T\u0026gt; void SmartPtr\u0026lt;T\u0026gt;::decRef() //åªä¼šè¢«å…¶å®ƒæˆå‘˜å‡½æ•°æ‰€è°ƒç”¨ { std::cout \u0026lt;\u0026lt; \u0026#34;after call decRef(): *mPtr = \u0026#34; \u0026lt;\u0026lt; *mPtr \u0026lt;\u0026lt; \u0026#34;, *mRef = \u0026#34; \u0026lt;\u0026lt; *mRef - 1 \u0026lt;\u0026lt; std::endl; if (0 == --*mRef) // å¼•ç”¨è®¡æ•°å…ˆè‡ªå‡ï¼Œä¸º 0 åï¼Œé‡Šæ”¾å†…å­˜ { delete mPtr; delete mRef; std::cout \u0026lt;\u0026lt; \u0026#34;real delete\u0026#34; \u0026lt;\u0026lt; std::endl; } } template \u0026lt;class T\u0026gt; int SmartPtr\u0026lt;T\u0026gt;::get_ref_count() const { return *mRef; } int main() { SmartPtr\u0026lt;int\u0026gt; p1(new int(999)); SmartPtr\u0026lt;int\u0026gt; p2(new int(888)); SmartPtr\u0026lt;int\u0026gt; p3(p1); p2 = p3; // æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ SmartPtr\u0026lt;int\u0026gt; p4 = p2; // éšå¼æ‹·è´æ„é€  } /* SmartPtr\u0026lt;T\u0026gt;::SmartPtr(T*) [with T = int] SmartPtr\u0026lt;T\u0026gt;::SmartPtr(T*) [with T = int] SmartPtr\u0026lt;T\u0026gt;::SmartPtr(const SmartPtr\u0026lt;T\u0026gt;\u0026amp;) [with T = int] SmartPtr\u0026lt;T\u0026gt;\u0026amp; SmartPtr\u0026lt;T\u0026gt;::operator=(const SmartPtr\u0026lt;T\u0026gt;\u0026amp;) [with T = int] after call decRef(): *mPtr = 888, *mRef = 0 real delete SmartPtr\u0026lt;T\u0026gt;::SmartPtr(const SmartPtr\u0026lt;T\u0026gt;\u0026amp;) [with T = int] SmartPtr\u0026lt;T\u0026gt;::~SmartPtr() [with T = int] after call decRef(): *mPtr = 999, *mRef = 3 SmartPtr\u0026lt;T\u0026gt;::~SmartPtr() [with T = int] after call decRef(): *mPtr = 999, *mRef = 2 SmartPtr\u0026lt;T\u0026gt;::~SmartPtr() [with T = int] after call decRef(): *mPtr = 999, *mRef = 1 SmartPtr\u0026lt;T\u0026gt;::~SmartPtr() [with T = int] after call decRef(): *mPtr = 999, *mRef = 0 real delete */ åŸºäºèŒƒå›´çš„ for å¾ªç¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 int main(int argc, char* argv[]) { int arr[10] = {1, 2, 3, 4, 5, 6}; for (int \u0026amp;x : arr)\t// åªæœ‰ä½¿ç”¨å¼•ç”¨ \u0026amp; æ‰èƒ½é€šè¿‡ x ä¿®æ”¹ arr é‡Œçš„å€¼ { cout \u0026lt;\u0026lt; (x % 2 ? \u0026#34;å¥‡\u0026#34; : \u0026#34;å¶\u0026#34;) \u0026lt;\u0026lt; \u0026#39; \u0026#39;; x = x + 1; } cout \u0026lt;\u0026lt; endl; for (int x : arr) cout \u0026lt;\u0026lt; x \u0026lt;\u0026lt; \u0026#39; \u0026#39;; getchar(); } //\tå¥‡ å¶ å¥‡ å¶ å¥‡ å¶ å¶ å¶ å¶ å¶ //\t2 3 4 5 6 7 1 1 1 1 å¤„ç†å¤šç»´æ•°ç»„ ä½¿ç”¨èŒƒå›´forè¯­å¥å¤„ç†å¤šç»´æ•°ç»„æ—¶ï¼Œä¸ºäº†é¿å…æ•°ç»„è¢«è‡ªåŠ¨è½¬æ¢æˆæŒ‡é’ˆï¼Œè¯­å¥ä¸­çš„å¤–å±‚å¾ªç¯æ§åˆ¶å˜é‡å¿…é¡»å£°æ˜æˆå¼•ç”¨ç±»å‹ã€‚\n1 2 3 for (const auto \u0026amp;row : ia) // for every element in the outer array for (auto col : row) // for every element in the inner array cout \u0026lt;\u0026lt; col \u0026lt;\u0026lt; endl; å¦‚æœrowä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œç¼–è¯‘å™¨åˆå§‹åŒ–rowæ—¶ä¼šè‡ªåŠ¨å°†æ•°ç»„å½¢å¼çš„å…ƒç´ è½¬æ¢æˆæŒ‡å‘è¯¥æ•°ç»„å†…é¦–å…ƒç´ çš„æŒ‡é’ˆï¼Œè¿™æ ·å¾—åˆ°çš„rowå°±æ˜¯int*ç±»å‹ï¼Œè€Œä¹‹åçš„å†…å±‚å¾ªç¯åˆ™è¯•å›¾åœ¨ä¸€ä¸ªint*å†…éå†ï¼Œç¨‹åºå°†æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚\n1 2 for (auto row : ia) for (auto col : row) ä½¿ç”¨èŒƒå›´forè¯­å¥å¤„ç†å¤šç»´æ•°ç»„æ—¶ï¼Œé™¤äº†æœ€å†…å±‚çš„å¾ªç¯ï¼Œå…¶ä»–æ‰€æœ‰å¤–å±‚å¾ªç¯çš„æ§åˆ¶å˜é‡éƒ½åº”è¯¥å®šä¹‰æˆå¼•ç”¨ç±»å‹ã€‚\nlambda è¡¨è¾¾å¼ find_ifå‡½æ•°æ¥å—ä¸¤ä¸ªè¿­ä»£å™¨å‚æ•°å’Œä¸€ä¸ªè°“è¯å‚æ•°ã€‚è¿­ä»£å™¨å‚æ•°ç”¨äºæŒ‡å®šåºåˆ—èŒƒå›´ï¼Œä¹‹åå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ç»™å®šè°“è¯ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªä½¿è°“è¯è¿”å›é0å€¼çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›å°¾è¿­ä»£å™¨ã€‚\nå¯¹äºä¸€ä¸ªå¯¹è±¡æˆ–è¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥å¯¹å…¶ä½¿ç”¨è°ƒç”¨è¿ç®—ç¬¦()ï¼Œåˆ™ç§°å®ƒä¸ºå¯è°ƒç”¨å¯¹è±¡ï¼ˆcallable objectï¼‰ã€‚å¯ä»¥å‘ç®—æ³•ä¼ é€’ä»»ä½•ç±»åˆ«çš„å¯è°ƒç”¨å¯¹è±¡ã€‚\nä¸€ä¸ªlambdaè¡¨è¾¾å¼è¡¨ç¤ºä¸€ä¸ªå¯è°ƒç”¨çš„ä»£ç å•å…ƒï¼Œç±»ä¼¼æœªå‘½åçš„å†…è”å‡½æ•°ï¼Œä½†å¯ä»¥å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ã€‚å…¶å½¢å¼å¦‚ä¸‹ï¼š\n1 [capture list] (parameter list) -\u0026gt; return type { function body } å…¶ä¸­ï¼Œcapture listï¼ˆæ•è·åˆ—è¡¨ï¼‰æ˜¯ä¸€ä¸ªç”±lambdaæ‰€åœ¨å‡½æ•°å®šä¹‰çš„å±€éƒ¨å˜é‡çš„åˆ—è¡¨ï¼ˆé€šå¸¸ä¸ºç©ºï¼‰ã€‚return typeã€parameter listå’Œfunction bodyä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿”å›ç±»å‹ã€å‚æ•°åˆ—è¡¨å’Œå‡½æ•°ä½“ã€‚ä½†ä¸æ™®é€šå‡½æ•°ä¸åŒï¼Œlambdaå¿…é¡»ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹ï¼Œä¸”ä¸èƒ½æœ‰é»˜è®¤å®å‚ã€‚\nå®šä¹‰lambdaæ—¶å¯ä»¥çœç•¥å‚æ•°åˆ—è¡¨å’Œè¿”å›ç±»å‹ï¼Œä½†å¿…é¡»åŒ…å«æ•è·åˆ—è¡¨å’Œå‡½æ•°ä½“ã€‚çœç•¥å‚æ•°åˆ—è¡¨ç­‰ä»·äºæŒ‡å®šç©ºå‚æ•°åˆ—è¡¨ã€‚çœç•¥è¿”å›ç±»å‹æ—¶ï¼Œè‹¥å‡½æ•°ä½“åªæ˜¯ä¸€ä¸ªreturnè¯­å¥ï¼Œåˆ™è¿”å›ç±»å‹ç”±è¿”å›è¡¨è¾¾å¼çš„ç±»å‹æ¨æ–­è€Œæ¥ã€‚å¦åˆ™è¿”å›ç±»å‹ä¸ºvoidã€‚\n1 2 auto f = [] { return 42; }; cout \u0026lt;\u0026lt; f() \u0026lt;\u0026lt; endl; // prints 42 lambdaå¯ä»¥ä½¿ç”¨å…¶æ‰€åœ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œä½†å¿…é¡»å…ˆå°†å…¶åŒ…å«åœ¨æ•è·åˆ—è¡¨ä¸­ã€‚æ•è·åˆ—è¡¨åªèƒ½ç”¨äºå±€éƒ¨éstaticå˜é‡ï¼Œlambdaå¯ä»¥ç›´æ¥ä½¿ç”¨å±€éƒ¨staticå˜é‡å’Œå…¶æ‰€åœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„åå­—ã€‚\n1 2 3 // get an iterator to the first element whose size() is \u0026gt;= sz auto wc = find_if(words.begin(), words.end(), [sz](const string \u0026amp;a) { return a.size() \u0026gt;= sz; }); for_eachå‡½æ•°æ¥å—ä¸€ä¸ªè¾“å…¥åºåˆ—å’Œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒå¯¹è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨æ­¤å¯¹è±¡ã€‚\n1 2 3 // print words of the given size or longer, each one followed by a space for_each(wc, words.end(), [] (const string \u0026amp;s) { cout \u0026lt;\u0026lt; s \u0026lt;\u0026lt; \u0026#34; \u0026#34;; }); lambdaæ•è·å˜é‡å’Œè¿”å› è¢«lambdaæ•è·çš„å˜é‡çš„å€¼æ˜¯åœ¨lambdaåˆ›å»ºæ—¶æ‹·è´ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶æ‹·è´ã€‚åœ¨lambdaåˆ›å»ºåä¿®æ”¹å±€éƒ¨å˜é‡ä¸ä¼šå½±å“lambdaå†…å¯¹åº”çš„å€¼ã€‚\n1 2 3 4 5 6 7 size_t v1 = 42; // local variable // copies v1 into the callable object named f auto f = [v1] { return v1; }; // auto f = [v1] { return ++v1; }; // error: increment of read-only variable â€˜v1â€™ï¼Œä¸å¯ä»¥ä¿®æ”¹ v1 // auto f = [v1] () mutable { return ++v1; }; // åœ¨å‚æ•°åˆ—è¡¨ååŠ  mutable å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚è¿”å› 43 v1 = 0; auto j = f(); // j is 42; f stored a copy of v1 when we created it é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºå€¼æ–¹å¼æ•è·çš„å˜é‡ï¼Œlambdaä¸èƒ½ä¿®æ”¹å…¶å€¼ã€‚å¦‚æœå¸Œæœ›ä¿®æ”¹ï¼Œå°±å¿…é¡»åœ¨å‚æ•°åˆ—è¡¨åæ·»åŠ å…³é”®å­—mutableã€‚\n1 2 3 4 5 size_t v1 = 42; // local variable // f can change the value of the variables it captures auto f = [v1] () mutable { return ++v1; }; v1 = 0; auto j = f(); // j is 43 lambdaå¯ä»¥ä»¥å¼•ç”¨æ–¹å¼æ•è·å˜é‡ï¼Œä½†å¿…é¡»ä¿è¯lambdaæ‰§è¡Œæ—¶å˜é‡å­˜åœ¨ã€‚\n1 2 3 4 5 size_t v1 = 42; // local variable // the object f2 contains a reference to v1 auto f2 = [\u0026amp;v1] { return ++v1; }; v1 = 0; auto j = f2(); // j is 1; f2 refers to v1; it doesn\u0026#39;t store it å¯ä»¥è®©ç¼–è¯‘å™¨æ ¹æ®lambdaä»£ç éšå¼æ•è·å‡½æ•°å˜é‡ï¼Œæ–¹æ³•æ˜¯åœ¨æ•è·åˆ—è¡¨ä¸­å†™ä¸€ä¸ª\u0026amp;æˆ–=ç¬¦å·ã€‚\u0026amp;ä¸ºå¼•ç”¨æ•è·ï¼Œ=ä¸ºå€¼æ•è·ã€‚\nå¯ä»¥æ··åˆä½¿ç”¨æ˜¾å¼æ•è·å’Œéšå¼æ•è·ã€‚æ··åˆä½¿ç”¨æ—¶ï¼Œæ•è·åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯\u0026amp;æˆ–=ç¬¦å·ï¼Œç”¨äºæŒ‡å®šé»˜è®¤æ•è·æ–¹å¼ã€‚æ˜¾å¼æ•è·çš„å˜é‡å¿…é¡»ä½¿ç”¨ä¸éšå¼æ•è·ä¸åŒçš„æ–¹å¼ã€‚\n1 2 3 4 5 6 // os implicitly captured by reference; c explicitly captured by value for_each(words.begin(), words.end(), [\u0026amp;, c] (const string \u0026amp;s) { os \u0026lt;\u0026lt; s \u0026lt;\u0026lt; c; }); // os explicitly captured by reference; c implicitly captured by value for_each(words.begin(), words.end(), [=, \u0026amp;os] (const string \u0026amp;s) { os \u0026lt;\u0026lt; s \u0026lt;\u0026lt; c; }); lambdaæ•è·åˆ—è¡¨å½¢å¼ï¼š\næœ¬å°èŠ‚åœ¨ã€PRIMER 350~354ã€‘\nå‚æ•°ç»‘å®š std::bindå¯ä»¥ç»‘å®šæ™®é€šå‡½æ•°ï¼Œä½†ä¸èƒ½åŒºåˆ†é‡è½½ï¼Œä¹Ÿå¯ä»¥ç»‘å®šç±»å†…æˆå‘˜å‡½æ•°ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å ä½ç¬¦æ–¹ä¾¿æ›´æ¢å½¢å‚ã€‚\nstd::bindåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯ä¾é å€¼ä¼ é€’ï¼Œä½¿ç”¨äº†std::refæ¥åŒ…è£¹ä¼ å…¥å‚æ•°æ‰æ˜¯ä½¿ç”¨å¼•ç”¨ä¼ é€’ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 #include \u0026lt;functional\u0026gt; #include \u0026lt;iostream\u0026gt; class Foo { public: Foo() = default; void add(const int \u0026amp;lhs, const int \u0026amp;rhs) { std::cout \u0026lt;\u0026lt; __PRETTY_FUNCTION__ \u0026lt;\u0026lt; \u0026#34; sum = \u0026#34; \u0026lt;\u0026lt; (lhs + rhs) \u0026lt;\u0026lt; std::endl; } }; void f(int n) { std::cout \u0026lt;\u0026lt; \u0026#34;void f(int n)\u0026#34; \u0026lt;\u0026lt; std::endl; } void f(double n) { std::cout \u0026lt;\u0026lt; \u0026#34;void f(double n)\u0026#34; \u0026lt;\u0026lt; std::endl; } int main() { auto g1 = [] { f(1); }; // OK auto g11 = [] { f(1.0); }; // OK //auto g2 = std::bind(f, 2); // é”™è¯¯ï¼Œå› ä¸ºæ— æ³•ç¡®å®šè¦ç»‘å®šå“ªä¸ªé‡è½½çš„ f() auto g3 = std::bind(static_cast\u0026lt;void (*)(int)\u0026gt;(f), 3.0); // OKï¼Œå¼ºè¡Œè½¬æ¢ä¸º void f(int n)ï¼Œå³ä½¿ä¼ çš„å½¢å‚æ˜¯ double g1(); g11(); g3(); Foo foo; auto g4 = std::bind(\u0026amp;Foo::add, \u0026amp;foo, 1, 2); // std::_Bind\u0026lt;void (Foo::*(Foo *, int, int)\u0026gt; g4 auto g5 = std::bind(\u0026amp;Foo::add, \u0026amp;foo, std::placeholders::_1, std::placeholders::_2); auto g6 = std::bind(\u0026amp;Foo::add, \u0026amp;foo, 1, std::placeholders::_2); g4(); // 1 + 2 = 3 g4(100); // 1 + 2 = 3 g4(100, 200); // 1 + 2 = 3 g5(3, 4); // 3 + 4 = 7 g6(3, 4); // 1 + 4 = 5 // g6(3); // error return 0; } /* void f(int n) void f(double n) void f(int n) void Foo::add(const int\u0026amp;, const int\u0026amp;) sum = 3 void Foo::add(const int\u0026amp;, const int\u0026amp;) sum = 3 void Foo::add(const int\u0026amp;, const int\u0026amp;) sum = 3 void Foo::add(const int\u0026amp;, const int\u0026amp;) sum = 7 void Foo::add(const int\u0026amp;, const int\u0026amp;) sum = 5 */ bindå‡½æ•°å®šä¹‰åœ¨å¤´æ–‡ä»¶functionalä¸­ï¼Œç›¸å½“äºä¸€ä¸ªå‡½æ•°é€‚é…å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡æ¥é€‚é…åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š\n1 auto newCallable = bind(callable, arg_list); å…¶ä¸­ï¼ŒnewCallableæœ¬èº«æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œarg_listæ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼Œå¯¹åº”ç»™å®šçš„callableçš„å‚æ•°ã€‚ä¹‹åè°ƒç”¨newCallableæ—¶ï¼ŒnewCallableä¼šå†è°ƒç”¨callableï¼Œå¹¶ä¼ é€’ç»™å®ƒarg_listä¸­çš„å‚æ•°ã€‚arg_listä¸­å¯èƒ½åŒ…å«å½¢å¦‚_nçš„åå­—ï¼Œå…¶ä¸­næ˜¯ä¸€ä¸ªæ•´æ•°ã€‚è¿™äº›å‚æ•°æ˜¯å ä½ç¬¦ï¼Œè¡¨ç¤ºnewCallableçš„å‚æ•°ï¼Œå®ƒä»¬å æ®äº†ä¼ é€’ç»™newCallableçš„å‚æ•°çš„ä½ç½®ã€‚æ•°å€¼nè¡¨ç¤ºç”Ÿæˆçš„å¯è°ƒç”¨å¯¹è±¡ä¸­å‚æ•°çš„ä½ç½®ï¼š_1ä¸ºnewCallableçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ_2ä¸ºnewCallableçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™äº›åå­—éƒ½å®šä¹‰åœ¨å‘½åç©ºé—´placeholdersä¸­ï¼Œå®ƒåˆå®šä¹‰åœ¨å‘½åç©ºé—´stdä¸­ï¼Œå› æ­¤ä½¿ç”¨æ—¶åº”è¯¥è¿›è¡ŒåŒé‡é™å®šã€‚\n1 2 3 4 5 6 7 8 9 using std::placeholders::_1; using namespace std::placeholders; bool check_size(const string \u0026amp;s, string::size_type sz); // check6 is a callable object that takes one argument of type string // and calls check_size on its given string and the value 6 auto check6 = bind(check_size, _1, 6); string s = \u0026#34;hello\u0026#34;; bool b1 = check6(s); // check6(s) calls check_size(s, 6) bindå‡½æ•°å¯ä»¥è°ƒæ•´ç»™å®šå¯è°ƒç”¨å¯¹è±¡ä¸­çš„å‚æ•°é¡ºåºã€‚\n1 2 3 4 // sort on word length, shortest to longest sort(words.begin(), words.end(), isShorter); // sort on word length, longest to shortest sort(words.begin(), words.end(), bind(isShorter, _2, _1)); é»˜è®¤æƒ…å†µä¸‹ï¼Œbindå‡½æ•°çš„éå ä½ç¬¦å‚æ•°è¢«æ‹·è´åˆ°bindè¿”å›çš„å¯è°ƒç”¨å¯¹è±¡ä¸­ã€‚ä½†æœ‰äº›ç±»å‹ä¸æ”¯æŒæ‹·è´æ“ä½œã€‚\nå¦‚æœå¸Œæœ›ä¼ é€’ç»™bindä¸€ä¸ªå¯¹è±¡è€Œåˆä¸æ‹·è´å®ƒï¼Œåˆ™å¿…é¡»ä½¿ç”¨æ ‡å‡†åº“çš„refå‡½æ•°ã€‚refå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç»™å®šçš„å¼•ç”¨ï¼Œæ­¤å¯¹è±¡æ˜¯å¯ä»¥æ‹·è´çš„ã€‚crefå‡½æ•°ç”Ÿæˆä¿å­˜constå¼•ç”¨çš„ç±»ã€‚\n1 2 ostream \u0026amp;print(ostream \u0026amp;os, const string \u0026amp;s, char c); for_each(words.begin(), words.end(), bind(print, ref(os), _1, \u0026#39; \u0026#39;)); ã€PRIMER 354~356ã€‘\nå‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ é‡è½½operator()è¿ç®—ç¬¦ å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦å¿…é¡»å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°ã€‚ä¸€ä¸ªç±»å¯ä»¥å®šä¹‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„è°ƒç”¨è¿ç®—ç¬¦ï¼Œç›¸äº’ä¹‹é—´å¿…é¡»åœ¨å‚æ•°æ•°é‡æˆ–ç±»å‹ä¸Šæœ‰æ‰€åŒºåˆ«ã€‚\nè¯¥ç±»ä¹Ÿå¯ä»¥ç§°ä¸ºå¯è°ƒç”¨å¯¹è±¡ï¼Œæˆ–å‡½æ•°å¯¹è±¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class PrintString { public: PrintString(ostream \u0026amp;o = cout, char c = \u0026#39; \u0026#39;): os(o), sep(c) { } void operator()(const string \u0026amp;s) const { os \u0026lt;\u0026lt; s \u0026lt;\u0026lt; sep; } private: ostream \u0026amp;os; // ç”¨äºå†™å…¥çš„ç›®çš„æµ char sep; // ç”¨äºå°†ä¸åŒè¾“å‡ºéš”å¼€çš„å­—ç¬¦ }; PrintString printer; // uses the defaults; prints to cout printer(s); // prints s followed by a space on cout å¦‚æœç±»å®šä¹‰äº†è°ƒç”¨è¿ç®—ç¬¦ï¼Œåˆ™è¯¥ç±»çš„å¯¹è±¡è¢«ç§°ä½œå‡½æ•°å¯¹è±¡ï¼ˆfunction objectï¼‰ï¼Œå‡½æ•°å¯¹è±¡å¸¸å¸¸ä½œä¸ºæ³›å‹ç®—æ³•çš„å®å‚ã€‚\n1 for_each(vs.begin(), vs.end(), PrintString(cerr, \u0026#39;\\n\u0026#39;)); lambdaæ˜¯å‡½æ•°å¯¹è±¡ ç¼–å†™ä¸€ä¸ªlambdaåï¼Œç¼–è¯‘å™¨ä¼šå°†è¯¥è¡¨è¾¾å¼è½¬æ¢æˆä¸€ä¸ªæœªå‘½åç±»çš„æœªå‘½åå¯¹è±¡ï¼Œç±»ä¸­å«æœ‰ä¸€ä¸ªé‡è½½çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 // sort words by size, but maintain alphabetical order for words of the same size stable_sort(words.begin(), words.end(), [](const string \u0026amp;a, const string \u0026amp;b) { return a.size() \u0026lt; b.size(); }); // acts like an unnamed object of a class that would look something like class ShorterString { public: bool operator()(const string \u0026amp;s1, const string \u0026amp;s2) const { return s1.size() \u0026lt; s2.size(); } }; lambdaé»˜è®¤ä¸èƒ½æ”¹å˜å®ƒæ•è·çš„å˜é‡ã€‚å› æ­¤åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±lambdaäº§ç”Ÿçš„ç±»ä¸­çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªconstæˆå‘˜å‡½æ•°ã€‚å¦‚æœlambdaè¢«å£°æ˜ä¸ºå¯å˜çš„ï¼Œåˆ™è°ƒç”¨è¿ç®—ç¬¦å°±ä¸å†æ˜¯constå‡½æ•°äº†ã€‚\nlambdaé€šè¿‡å¼•ç”¨æ•è·å˜é‡æ—¶ï¼Œç”±ç¨‹åºè´Ÿè´£ç¡®ä¿lambdaæ‰§è¡Œæ—¶è¯¥å¼•ç”¨æ‰€ç»‘å®šçš„å¯¹è±¡ç¡®å®å­˜åœ¨ã€‚å› æ­¤ç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å¼•ç”¨è€Œæ— é¡»åœ¨lambdaäº§ç”Ÿçš„ç±»ä¸­å°†å…¶å­˜å‚¨ä¸ºæ•°æ®æˆå‘˜ã€‚ç›¸åï¼Œé€šè¿‡å€¼æ•è·çš„å˜é‡è¢«æ‹·è´åˆ°lambdaä¸­ï¼Œæ­¤æ—¶lambdaäº§ç”Ÿçš„ç±»å¿…é¡»ä¸ºæ¯ä¸ªå€¼æ•è·çš„å˜é‡å»ºç«‹å¯¹åº”çš„æ•°æ®æˆå‘˜ï¼Œå¹¶åˆ›å»ºæ„é€ å‡½æ•°ï¼Œç”¨æ•è·å˜é‡çš„å€¼æ¥åˆå§‹åŒ–æ•°æ®æˆå‘˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // get an iterator to the first element whose size() is \u0026gt;= sz auto wc = find_if(words.begin(), words.end(), [sz](const string \u0026amp;a) { return a.size() \u0026gt;= sz; }); // would generate a class that looks something like class SizeComp { public: SizeComp(size_t n): sz(n) { } // parameter for each captured variable // call operator with the same return type, parameters, and body as the lambda bool operator()(const string \u0026amp;s) const { return s.size() \u0026gt;= sz; } private: size_t sz; // a data member for each variable captured by value }; lambdaäº§ç”Ÿçš„ç±»ä¸åŒ…å«é»˜è®¤æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦å’Œé»˜è®¤ææ„å‡½æ•°ï¼Œå®ƒæ˜¯å¦åŒ…å«é»˜è®¤æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°åˆ™é€šå¸¸è¦è§†æ•è·çš„å˜é‡ç±»å‹è€Œå®šã€‚\næ ‡å‡†åº“å®šä¹‰çš„å‡½æ•°å¯¹è±¡\næ ‡å‡†åº“åœ¨å¤´æ–‡ä»¶functionalä¸­å®šä¹‰äº†ä¸€ç»„è¡¨ç¤ºç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦çš„ç±»ï¼Œæ¯ä¸ªç±»åˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªæ‰§è¡Œå‘½åæ“ä½œçš„è°ƒç”¨è¿ç®—ç¬¦ã€‚è¿™äº›ç±»éƒ½è¢«å®šä¹‰ä¸ºæ¨¡æ¿çš„å½¢å¼ï¼Œå¯ä»¥ä¸ºå…¶æŒ‡å®šå…·ä½“çš„åº”ç”¨ç±»å‹ï¼ˆå³è°ƒç”¨è¿ç®—ç¬¦çš„å½¢å‚ç±»å‹ï¼‰ã€‚\nå…³ç³»è¿ç®—ç¬¦çš„å‡½æ•°å¯¹è±¡ç±»é€šå¸¸è¢«ç”¨æ¥æ›¿æ¢ç®—æ³•ä¸­çš„é»˜è®¤è¿ç®—ç¬¦ï¼Œè¿™äº›ç±»å¯¹äºæŒ‡é’ˆåŒæ ·é€‚ç”¨ã€‚\n1 2 3 4 5 6 vector\u0026lt;string *\u0026gt; nameTable; // vector of pointers // error: the pointers in nameTable are unrelated, so \u0026lt; is undefined sort(nameTable.begin(), nameTable.end(), [](string *a, string *b) { return a \u0026lt; b; }); // ok: library guarantees that less on pointer types is well defined sort(nameTable.begin(), nameTable.end(), less\u0026lt;string*\u0026gt;()); å¯è°ƒç”¨å¯¹è±¡ä¸function è°ƒç”¨å½¢å¼æŒ‡æ˜äº†è°ƒç”¨è¿”å›çš„ç±»å‹ä»¥åŠä¼ é€’ç»™è°ƒç”¨çš„å®å‚ç±»å‹ã€‚ä¸åŒçš„å¯è°ƒç”¨å¯¹è±¡å¯èƒ½å…·æœ‰ç›¸åŒçš„è°ƒç”¨å½¢å¼ã€‚\næ ‡å‡†åº“functionç±»å‹æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå®šä¹‰åœ¨å¤´æ–‡ä»¶functionalä¸­ï¼Œç”¨æ¥è¡¨ç¤ºå¯¹è±¡çš„è°ƒç”¨å½¢å¼ã€‚\nåˆ›å»ºä¸€ä¸ªå…·ä½“çš„functionç±»å‹æ—¶å¿…é¡»æä¾›å…¶æ‰€è¡¨ç¤ºçš„å¯¹è±¡çš„è°ƒç”¨å½¢å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ordinary function int add(int i, int j) { return i + j; } // function-object class struct div { int operator()(int denominator, int divisor) { return denominator / divisor; } }; function\u0026lt;int(int, int)\u0026gt; f1 = add; // function pointer function\u0026lt;int(int, int)\u0026gt; f2 = div(); // object of a function-object class function\u0026lt;int(int, int)\u0026gt; f3 = [](int i, int j) { return i * j; }; // lambda cout \u0026lt;\u0026lt; f1(4,2) \u0026lt;\u0026lt; endl; // prints 6 cout \u0026lt;\u0026lt; f2(4,2) \u0026lt;\u0026lt; endl; // prints 2 cout \u0026lt;\u0026lt; f3(4,2) \u0026lt;\u0026lt; endl; // prints 8 ä¸èƒ½ç›´æ¥å°†é‡è½½å‡½æ•°çš„åå­—å­˜å…¥functionç±»å‹çš„å¯¹è±¡ä¸­ï¼Œè¿™æ ·åšä¼šäº§ç”ŸäºŒä¹‰æ€§é”™è¯¯ã€‚æ¶ˆé™¤äºŒä¹‰æ€§çš„æ–¹æ³•æ˜¯ä½¿ç”¨lambdaæˆ–è€…å­˜å‚¨å‡½æ•°æŒ‡é’ˆè€Œéå‡½æ•°åå­—ã€‚\nC++11æ–°æ ‡å‡†åº“ä¸­çš„functionç±»ä¸æ—§ç‰ˆæœ¬ä¸­çš„unary_functionå’Œbinary_functionæ²¡æœ‰å…³ç³»ï¼Œåä¸¤ä¸ªç±»å·²ç»è¢«bindå‡½æ•°ä»£æ›¿ã€‚\n","date":"2021-07-08T20:18:41+08:00","permalink":"https://qiyueliuhuo.github.io/posts/c++%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/","title":"C++çŸ¥è¯†ç‚¹æ€»ç»“"},{"content":"æ­£æ–‡æµ‹è¯• è€Œè¿™äº›å¹¶ä¸æ˜¯å®Œå…¨é‡è¦ï¼Œæ›´åŠ é‡è¦çš„é—®é¢˜æ˜¯ï¼Œ å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å®¡è§†ä¸€ä¸‹å­¦ç”Ÿä¼šé€€ä¼šã€‚ æ—¢ç„¶å¦‚ä½•ï¼Œ å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼Œå­¦ç”Ÿä¼šé€€ä¼šä¸ä»…ä»…æ˜¯ä¸€ä¸ªé‡å¤§çš„äº‹ä»¶ï¼Œè¿˜å¯èƒ½ä¼šæ”¹å˜æˆ‘çš„äººç”Ÿã€‚ æˆ‘ä»¬ä¸å¾—ä¸é¢å¯¹ä¸€ä¸ªéå¸¸å°´å°¬çš„äº‹å®ï¼Œé‚£å°±æ˜¯ï¼Œ å¯æ˜¯ï¼Œå³ä½¿æ˜¯è¿™æ ·ï¼Œå­¦ç”Ÿä¼šé€€ä¼šçš„å‡ºç°ä»ç„¶ä»£è¡¨äº†ä¸€å®šçš„æ„ä¹‰ã€‚ å­¦ç”Ÿä¼šé€€ä¼šï¼Œå‘ç”Ÿäº†ä¼šå¦‚ä½•ï¼Œä¸å‘ç”Ÿåˆä¼šå¦‚ä½•ã€‚ ç»è¿‡ä¸Šè¿°è®¨è®ºï¼Œ ç”Ÿæ´»ä¸­ï¼Œè‹¥å­¦ç”Ÿä¼šé€€ä¼šå‡ºç°äº†ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è€ƒè™‘å®ƒå‡ºç°äº†çš„äº‹å®ã€‚ å­¦ç”Ÿä¼šé€€ä¼šï¼Œåˆ°åº•åº”è¯¥å¦‚ä½•å®ç°ã€‚ è¿™æ ·çœ‹æ¥ï¼Œ åœ¨è¿™ç§å›°éš¾çš„æŠ‰æ‹©ä¸‹ï¼Œæœ¬äººæ€æ¥æƒ³å»ï¼Œå¯é£Ÿéš¾å®‰ã€‚ å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼Œå­¦ç”Ÿä¼šé€€ä¼šä¸ä»…ä»…æ˜¯ä¸€ä¸ªé‡å¤§çš„äº‹ä»¶ï¼Œè¿˜å¯èƒ½ä¼šæ”¹å˜æˆ‘çš„äººç”Ÿã€‚ å°±æˆ‘ä¸ªäººæ¥è¯´ï¼Œå­¦ç”Ÿä¼šé€€ä¼šå¯¹æˆ‘çš„æ„ä¹‰ï¼Œä¸èƒ½ä¸è¯´éå¸¸é‡å¤§ã€‚ èå£«æ¯”äºšæ›¾ç»æåˆ°è¿‡ï¼Œäººçš„ä¸€ç”Ÿæ˜¯çŸ­çš„ï¼Œä½†å¦‚æœå‘åŠ£åœ°è¿‡è¿™ä¸€ç”Ÿï¼Œå°±å¤ªé•¿äº†ã€‚è¿™ä¼¼ä¹è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ã€‚ è«æ‰ç‰¹è¯´è¿‡ä¸€å¥å¯Œæœ‰å“²ç†çš„è¯ï¼Œè°å’Œæˆ‘ä¸€æ ·ç”¨åŠŸï¼Œè°å°±ä¼šå’Œæˆ‘ä¸€æ ·æˆåŠŸã€‚è¿™å¯å‘äº†æˆ‘ï¼Œ å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼Œå­¦ç”Ÿä¼šé€€ä¼šä¸ä»…ä»…æ˜¯ä¸€ä¸ªé‡å¤§çš„äº‹ä»¶ï¼Œè¿˜å¯èƒ½ä¼šæ”¹å˜æˆ‘çš„äººç”Ÿã€‚ å­¦ç”Ÿä¼šé€€ä¼šï¼Œåˆ°åº•åº”è¯¥å¦‚ä½•å®ç°ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œ ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œ è¿™ç§äº‹å®å¯¹æœ¬äººæ¥è¯´æ„ä¹‰é‡å¤§ï¼Œç›¸ä¿¡å¯¹è¿™ä¸ªä¸–ç•Œä¹Ÿæ˜¯æœ‰ä¸€å®šæ„ä¹‰çš„ã€‚ åœ¨è¿™ç§å›°éš¾çš„æŠ‰æ‹©ä¸‹ï¼Œæœ¬äººæ€æ¥æƒ³å»ï¼Œå¯é£Ÿéš¾å®‰ã€‚ äº†è§£æ¸…æ¥šå­¦ç”Ÿä¼šé€€ä¼šåˆ°åº•æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„å­˜åœ¨ï¼Œæ˜¯è§£å†³ä¸€åˆ‡é—®é¢˜çš„å…³é”®ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œ ç”Ÿæ´»ä¸­ï¼Œè‹¥å­¦ç”Ÿä¼šé€€ä¼šå‡ºç°äº†ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è€ƒè™‘å®ƒå‡ºç°äº†çš„äº‹å®ã€‚ é—®é¢˜çš„å…³é”®ç©¶ç«Ÿä¸ºä½•ï¼Ÿ è€Œè¿™äº›å¹¶ä¸æ˜¯å®Œå…¨é‡è¦ï¼Œæ›´åŠ é‡è¦çš„é—®é¢˜æ˜¯ã€‚\nå¥¥æ–¯ç‰¹æ´›å¤«æ–¯åŸºæ›¾ç»è¯´è¿‡ï¼Œå…±åŒçš„äº‹ä¸šï¼Œå…±åŒçš„æ–—äº‰ï¼Œå¯ä»¥ä½¿äººä»¬äº§ç”Ÿå¿å—ä¸€åˆ‡çš„åŠ›é‡ã€‚ã€€å¸¦ç€è¿™å¥è¯ï¼Œæˆ‘ä»¬è¿˜è¦æ›´åŠ æ…é‡çš„å®¡è§†è¿™ä¸ªé—®é¢˜ï¼š ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»åŠ¡å¿…æ…é‡çš„è€ƒè™‘è€ƒè™‘ã€‚ æ—¢ç„¶å¦‚æ­¤ï¼Œ è¿™ç§äº‹å®å¯¹æœ¬äººæ¥è¯´æ„ä¹‰é‡å¤§ï¼Œç›¸ä¿¡å¯¹è¿™ä¸ªä¸–ç•Œä¹Ÿæ˜¯æœ‰ä¸€å®šæ„ä¹‰çš„ã€‚ å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å®¡è§†ä¸€ä¸‹å­¦ç”Ÿä¼šé€€ä¼šã€‚ æˆ‘è®¤ä¸ºï¼Œ æˆ‘è®¤ä¸ºï¼Œ åœ¨è¿™ç§å›°éš¾çš„æŠ‰æ‹©ä¸‹ï¼Œæœ¬äººæ€æ¥æƒ³å»ï¼Œå¯é£Ÿéš¾å®‰ã€‚ é—®é¢˜çš„å…³é”®ç©¶ç«Ÿä¸ºä½•ï¼Ÿ æ¯ä¸ªäººéƒ½ä¸å¾—ä¸é¢å¯¹è¿™äº›é—®é¢˜ã€‚ åœ¨é¢å¯¹è¿™ç§é—®é¢˜æ—¶ï¼Œ è¦æƒ³æ¸…æ¥šï¼Œå­¦ç”Ÿä¼šé€€ä¼šï¼Œåˆ°åº•æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„å­˜åœ¨ã€‚ æˆ‘è®¤ä¸ºï¼Œ æ—¢ç„¶å¦‚æ­¤ï¼Œ æ¯ä¸ªäººéƒ½ä¸å¾—ä¸é¢å¯¹è¿™äº›é—®é¢˜ã€‚ åœ¨é¢å¯¹è¿™ç§é—®é¢˜æ—¶ï¼Œ é‚£ä¹ˆï¼Œ æˆ‘è®¤ä¸ºï¼Œ å­¦ç”Ÿä¼šé€€ä¼šå› ä½•è€Œå‘ç”Ÿã€‚\nå¼•ç”¨ æ€å¿µæ˜¯æœ€æš–çš„å¿§ä¼¤åƒä¸€åŒç¿…è†€\nè®©æˆ‘åœä¸äº†é£ä¸è¿œåœ¨è¿‡å¾€æ¸¸è¡\nä¸å‘Šè€Œåˆ«çš„ä½  å°±ç®—ä¸ºäº†æˆ‘ç€æƒ³\nè¿™ä¹ˆæ²‰ç—›çš„å‘µæŠ¤ æˆ‘æ€ä¹ˆèƒ½ç¿±ç¿”\næœ€æš–çš„æ†‚å‚· - ç”°é¦¥ç”„\nå›¾ç‰‡ 1 2 3 ![photo by florian klauer on unsplash](florian-klauer-nptlmg6jqdo-unsplash.jpg) ![photo by luca bravo on unsplash](luca-bravo-als7ewq41m8-unsplash.jpg) ![photo by helena hertz on unsplash](helena-hertz-wwzzxldpmog-unsplash.jpg) ![photo by hudai gayiran on unsplash](hudai-gayiran-3od_vkcdeaa-unsplash.jpg) ç›¸å†Œè¯­æ³•æ¥è‡ª typlog\nä»£ç  1 2 3 #!/usr/bin/env python3 def main(): print(\u0026#34;hello, world!\u0026#34;) # è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š å›¾ç‰‡å±…ä¸­æ˜¾ç¤º æ’å…¥çš„å›¾ç‰‡å‰åç•™ä¸€è¡Œç©ºè¡Œã€‚\nmath $$ \\boldsymbol{H}=\\left(\\begin{array}{cccc} \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{1} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\\\ \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{2} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\\\ \\vdots \u0026amp; \\vdots \u0026amp; \u0026amp; \\vdots \\\\ \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{1}} f(\\boldsymbol{\\theta}) \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{2}} f(\\boldsymbol{\\theta}) \u0026amp; \\cdots \u0026amp; \\frac{\\partial^{2}}{\\partial \\theta_{n} \\partial \\theta_{n}} f(\\boldsymbol{\\theta}) \\end{array}\\right) $$\nå½“latexå…¬å¼ä¸­å­˜åœ¨æ¢è¡Œæ—¶ï¼Œéœ€è¦ç”¨\\\\\\\\æ›¿ä»£\\\\ï¼Œ\\\\ ä¼šè¢« MarkDown å¤„ç†æ‰ï¼Œå…·ä½“æŸ¥çœ‹katex åˆ†æ®µå‡½æ•°ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚\n","date":"2021-06-23T11:17:44+08:00","image":"https://qiyueliuhuo.github.io/posts/%E4%B8%BB%E9%A2%98%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/helena-hertz-wWZzXlDpMog-unsplash_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_120x120_fill_q75_box_smart1.jpg","permalink":"https://qiyueliuhuo.github.io/posts/%E4%B8%BB%E9%A2%98%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/","title":"ä¸»é¢˜æµ‹è¯•æ–‡ç« "},{"content":"å‰è¨€ å¦‚ä½•è¯„ä»·ä¸€ä¸ªç®—æ³•æ¨¡å‹çš„æ£€æµ‹ç»“æœæ˜¯å¥½è¿˜æ˜¯ä¸å¥½å‘¢ï¼Ÿ\næ£€æµ‹ç»“æœçš„æ­£ç¡®/é”™è¯¯ç±»å‹ æ­£ç¡®ç»“æœ(True Positive)ï¼šç®—æ³•æ£€æµ‹åˆ°äº†æŸç±»ç‰©ä½“ (Positive)ï¼Œå›¾ä¸­ä¹Ÿç¡®å®æœ‰è¿™ä¸ªç‰©ä½“ï¼Œæ£€æµ‹ç»“æœæ­£ç¡®(True)ã€‚ï¼ˆä¸ªäººç†è§£ï¼Œè¿™é‡Œå…¶å®æˆä¸ºæ­£é˜³æ€§æ›´å‡†ç¡®ï¼‰ å‡é˜³æ€§(False Positive)ï¼šç®—æ³•æ£€æµ‹åˆ°äº†æŸç±»ç‰©ä½“ (Positive)ï¼Œä½†å›¾ä¸­å…¶å®æ²¡æœ‰è¿™ä¸ªç‰©ä½“ï¼Œæ£€æµ‹ç»“æœé”™è¯¯ (False)ã€‚é€šå¸¸æˆ‘ä»¬æŠŠå®ƒä¹Ÿç§°ä¸ºè¯¯æ£€ã€‚ å‡é˜´æ€§ (False Negative)ï¼šç®—æ³•æ²¡æœ‰æ£€æµ‹åˆ°ç‰©ä½“ (Negative)ï¼Œä½†å›¾ä¸­å…¶å®æœ‰æŸç±»ç‰©ä½“ï¼Œæ£€æµ‹ç»“æœé”™è¯¯(False)ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠå®ƒä¹Ÿç§°ä¸ºæ¼æ£€ã€‚ è¿™é‡Œæ£€æµ‹åˆ°çš„è¡¡é‡æ ‡å‡†ï¼šå¯¹äºæŸä¸ªæ£€æµ‹æ¡†ï¼Œå›¾ä¸­å­˜åœ¨åŒç±»å‹çš„çœŸå€¼æ¡†ä¸”ä¸ä¹‹äº¤å¹¶æ¯”å¤§äºé˜ˆå€¼ï¼ˆé€šå¸¸å–0.5ï¼‰ ä¾‹å­ï¼š ä¸Šé¢æ£€æµ‹æœ‰ 7 å¼ å›¾åƒï¼Œå…¶ä¸­ç»¿è‰²è¾¹ç•Œæ¡†è¡¨ç¤º 15 ä¸ªçœŸå€¼æ¡†ï¼Œçº¢è‰²è¾¹ç•Œæ¡†è¡¨ç¤º 24 ä¸ªæ£€æµ‹æ¡†ã€‚æ¯ä¸ªæ£€æµ‹åˆ°çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç½®ä¿¡åº¦ï¼Œå¹¶ç”±ä¸€ä¸ªå­—æ¯ (A,B,\u0026hellip;,Y) æ ‡è¯†ã€‚\nä¸Šè¡¨æ˜¾ç¤ºäº†è¾¹ç•Œæ¡†åŠå…¶ç›¸åº”çš„ç½®ä¿¡åº¦ã€‚æœ€åä¸€åˆ—å°†æ£€æµ‹æ ‡è¯†ä¸º TP æˆ– FPã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ IOU å¤§äº30% åˆ™è®¤ä¸º TPï¼Œå¦åˆ™ä¸º FPã€‚é€šè¿‡æŸ¥çœ‹ä¸Šé¢çš„å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´åˆ¤æ–­æ£€æµ‹æ˜¯ TP è¿˜æ˜¯ FP\næ›´å…·ä½“çš„åˆ†æï¼Œå¯ä»¥å‚è€ƒ ç›®æ ‡æ£€æµ‹æŒ‡æ ‡\nç›®æ ‡æ£€æµ‹è¯„ä»·æŒ‡æ ‡ å¬å›ç‡ã€å‡†ç¡®ç‡ çœŸå€¼æ¡†æ€»æ•°ä¸æ£€æµ‹ç®—æ³•æ— å…³ï¼Œå› æ­¤åªéœ€å°†æ£€æµ‹ç»“æœåŒºåˆ†ä¸ºTPå’ŒFPå³å¯è®¡ç®— recall å’Œ precision\nä¸¤ç§æç«¯æƒ…å†µï¼š\næ£€æµ‹å™¨å°†æ‰€æœ‰é”šæ¡†éƒ½åˆ¤æ–­ä¸ºç‰©ä½“ï¼šå¬å›ç‡â‰ˆ100%ï¼Œä½†å¤§é‡èƒŒæ™¯æ¡†é¢„æµ‹ä¸ºç‰©ä½“ï¼ŒFPå¾ˆé«˜ï¼Œå‡†ç¡®ç‡å¾ˆä½ï¼› æ£€æµ‹å™¨åªè¾“å‡ºç¡®ä¿¡åº¦æœ€é«˜çš„1ä¸ªæ£€æµ‹æ¡†ï¼šä»¥å¾ˆå¤§æ¦‚ç‡æ£€æµ‹æ­£ç¡®ï¼Œå‡†ç¡®ç‡=100%ï¼Œä½†å› ä¸ºå¤§é‡ç‰©ä½“è¢«é¢„æµ‹ä¸ºèƒŒæ™¯ï¼ŒFNå¾ˆé«˜ï¼Œå¬å›ç‡å¾ˆä½ã€‚ ç†æƒ³æƒ…å†µï¼š ä¸€ä¸ªå®Œç¾çš„æ£€æµ‹å™¨åº”è¯¥æœ‰100%å¬å›ç‡å’Œ100%çš„å‡†ç¡®ç‡ï¼›åœ¨ç®—æ³•èƒ½åŠ›æœ‰é™çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å¹³è¡¡äºŒè€…ã€‚\né€šå¸¸åšæ³•ï¼š å°†æ£€æµ‹æ¡†æŒ‰ç½®ä¿¡åº¦æ’åºï¼Œä»…è¾“å‡ºç½®ä¿¡åº¦å¤§äºæŸä¸ªé˜ˆå€¼çš„è‹¥å¹²ä¸ªæ¡†ã€‚\nAPï¼ˆAverage Precisionï¼‰ ä¸ºå¾—åˆ°é˜ˆå€¼æ— å…³çš„è¯„åˆ†ï¼Œå¯ä»¥éå†é˜ˆå€¼ï¼Œå¹¶å¯¹ Precision å’Œ Recall æ±‚å¹³å‡ã€‚\nå…·ä½“åšæ³•ï¼š\næ£€æµ‹æ¡†æŒ‰ç½®ä¿¡åº¦æ’åºï¼Œå–å‰Kä¸ªæ¡†è®¡ç®— Precision å’Œ Recallã€‚ éå†Kä»1è‡³å…¨éƒ¨æ£€æµ‹æ¡†ï¼Œå°†å¾—åˆ°çš„ Precision å’Œ Recall å€¼ç»˜åˆ¶åœ¨åæ ‡ç³»ä¸Šï¼Œå¾—åˆ° PR æ›²çº¿ã€‚ å®šä¹‰ Average Precision = Precision å¯¹ Recall çš„å¹³å‡å€¼,å³ PR æ›²çº¿ä¸‹çš„é¢ç§¯,ä½œä¸ºæ£€æµ‹å™¨çš„æ€§èƒ½è¡¡é‡æŒ‡æ ‡ã€‚ ç¬”è€…è§‰å¾—è¿™ä¸ªæŒ‡æ ‡å¾ˆä¸ç§‘å­¦ï¼\nåŸå› æ˜¯ï¼šä¸€ä¸ªå¥½çš„æ£€æµ‹å™¨åªéœ€è¦åœ¨æŸä¸ªç½®ä¿¡åº¦é˜ˆå€¼ä¸‹èƒ½å¤Ÿæ£€æµ‹å‡ºæ‰€æœ‰çœŸå®çš„ç›®æ ‡ï¼Œå¹¶ä¸”æ²¡æœ‰æ¼æ£€å’Œè¯¯æ£€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¡®å®šè¯¥æ£€æµ‹å™¨éå¸¸å¥½ï¼Œè€Œä¸éœ€è¦åœ¨å…¶ä»–ç½®ä¿¡åº¦é˜ˆå€¼ä¸‹éƒ½è¡¨ç°å¥½ã€‚\nMean AP åˆ†ç±»åˆ«ç»Ÿè®¡APï¼Œå¹¶æŒ‰ç±»åˆ«å¹³å‡å³å¾—åˆ° Mean APã€‚\néƒ¨åˆ†æ•°æ®é›†ï¼ˆå¦‚ COCO)è¿˜è¦æ±‚åœ¨ä¸åŒçš„ loU (ä¸Šé¢æåˆ°çš„IOU å¤§äº30% )é˜ˆå€¼ä¸‹è®¡ç®— Mean AP å¹¶å¹³å‡ï¼Œä½œä¸ºæœ€ç»ˆè¯„åˆ†ï¼›ä»0.5 ~ 0.05ï¼Œæ¯ä¸ª0.05éƒ½ä¼šå–ä¸€ä¸ªIoUçš„é˜ˆå€¼ï¼Œè®¡ç®— Mean APï¼Œæœ€ç»ˆå°†è¿™å‡ ä¸ªå€¼è¿›è¡Œå¹³å‡ï¼Œä½œä¸ºæœ€ç»ˆçš„ä¸€ä¸ªè¯„åˆ†ã€‚\nå¯è¡¡é‡æ£€æµ‹å™¨åœ¨ä¸åŒå®šä½ç²¾åº¦è¦æ±‚ä¸‹çš„æ€§èƒ½ã€‚\n","date":"2021-06-21T10:45:26+08:00","permalink":"https://qiyueliuhuo.github.io/posts/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AF%84%E4%BC%B0%E6%96%B9%E6%B3%95/","title":"ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è¯„ä¼°æ–¹æ³•"},{"content":"åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ å’Œç¥ç»ç½‘ç»œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºæ¨¡å‹å‚æ•°å’Œæ¨¡å‹è®¡ç®—é‡éœ€è¦åšå‡ºè¯„ä¼°ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»å‡ ç§å¸¸è§æ“ä½œå¯¹æ¨¡å‹å¸¦æ¥çš„å‚æ•°é‡å’Œè®¡ç®—é‡ï¼Œæ›´ä¸“ä¸šçš„è¡¨ç¤ºä¸ºç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦ï¼Œåç»­å†è¡¥å……ã€‚\næ³¨æ„ï¼šä¸‹é¢è®¡ç®—çš„æ˜¯éƒ½æ˜¯å•å±‚çš„å‚æ•°é‡å’Œè®¡ç®—é‡ï¼Œå¹¶ä¸”æ˜¯å¯¹äºä¸€ä¸ªæ ·æœ¬çš„è®¡ç®—é‡ï¼Œå¦‚æœè®¡ç®—æ‰¹é‡æ ·æœ¬ï¼Œéœ€è¦ç»™ä¸‹é¢è®¡ç®—é‡ä¹˜ä»¥BatchSizeã€‚\nå·ç§¯å±‚ å·ç§¯è¿ç®—çš„å‚æ•°é‡ è®¡ç®—å…¬å¼ï¼š$parameter = (k_{w} \\times k_{h} \\times C_{in} + 1 )\\times filter\\ number$ï¼›\nå³ï¼š$å‚æ•°é‡\\ =ï¼ˆkernal_wide \\times kernal_high \\times è¾“å…¥çš„ç‰¹å¾å›¾çš„é€šé“æ•° + åç½® ï¼‰\\times å½“å‰å±‚filteræ•°é‡$ï¼›\nä»¥VGG-16æ¨¡å‹çš„Conv1-1å·ç§¯ä¸ºä¾‹ï¼Œè¾“å…¥$224 \\times 224 \\times 3$ï¼Œæœ‰$64$ä¸ª$3 \\times 3$å¤§å°filterï¼Œè¾“å‡ºfeature mapä¸º$224 \\times 224 \\times 64$ï¼Œé‚£ä¹ˆè¯¥å±‚å…·æœ‰çš„å‚æ•°é‡ä¸ºï¼š$(3 \\times 3 \\times 3 + 1)\\times 64 = 1792$\nå·ç§¯è¿ç®—çš„è®¡ç®—é‡ FLOPs(Floating Point Operations)ï¼Œæµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼Œç”¨æ¥è¡¡é‡ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼› FLOPS(Floating Point Operations per Seconds)ï¼Œå•ä½æ—¶é—´æµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼Œç”¨æ¥è¡¡é‡ç¡¬ä»¶è®¡ç®—æ€§èƒ½ã€‚ $FLOPs=\\left[\\left(C_{i n} \\times k_{w} \\times k_{h}\\right)+\\left(C_{i n} \\times k_{w} \\times k_{h}-1\\right)+1\\right] \\times C_{o u t} \\times W_{out} \\times H_{out}$\n$k_{w}$ å’Œ $k_{h}$ åˆ†åˆ«è¡¨ç¤ºå·ç§¯æ ¸çš„å®½å’Œé«˜ï¼Œå…¶ä¸­ $C_{i n} \\times k_{w} \\times k_{h}$ è¡¨ç¤ºä¹˜æ³•è®¡ç®—é‡, $C_{i n} \\times k_{w} \\times k_{h}-1$ è¡¨ç¤ºåŠ æ³•è®¡ç®—é‡(å¯ä»¥è¿™æ ·ç†è§£ï¼Œéœ€è¦æŠŠä¹˜æ³•è®¡ç®—å¾—åˆ°çš„$C_{i n} \\times k_{w} \\times k_{h}$ä¸ªæ•°å­—åŠ è¿™ä¹ˆå¤šæ¬¡), $+1$ è¡¨ç¤ºåç½®, $C_{\\text {out }} \\times W_{out} \\times H_{out}$ è¡¨ç¤º feature $\\operatorname{map}$ ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ $W_{out} \\text{ã€} H_{out}$ è¡¨ç¤ºfeature mapçš„å®½å’Œé«˜ã€‚\nå…¨è¿æ¥å±‚ å…¨è¿æ¥è¿ç®—çš„å‚æ•°é‡ è®¡ç®—å…¬å¼: $parameter =\\left(N_{i n}+1\\right) \\times N_{\\text {out }}$\n$N_{i n}$ è¡¨ç¤ºè¾“å…¥ç‰¹å¾å‘é‡çš„ç»´æ•°, +1è¡¨ç¤ºåç½®, $N_{out}$ è¡¨ç¤ºè¾“å‡ºå‘é‡çš„ç»´æ•°\nå…¨è¿æ¥è¿ç®—çš„è®¡ç®—é‡ $FLOPs=[N_{in}+(N_{in}-1)+1] \\times N_{out}$\n$N_{in}$ å’Œ $N_{out}$ åˆ†åˆ«è¡¨ç¤ºè¾“å…¥çš„ç‰¹å¾æ•°å’Œè¾“å‡ºçš„ç‰¹å¾æ•°ã€‚\nå…¶ä¸­$N_{in}$è¡¨ç¤ºä¹˜æ³•è¿ç®—é‡, $N_{in}-1$ è¡¨ç¤ºåŠ æ³•è¿ç®—é‡ï¼Œ+1è¡¨ç¤ºåç½®ã€‚\næ± åŒ–å±‚ æ± åŒ–å±‚è¿ç®—çš„å‚æ•°é‡ æ— å‚æ•°ã€‚\næ± åŒ–å±‚è¿ç®—çš„è®¡ç®—é‡ $FLOPs=C_{out} \\times H_{out} \\times W_{out} \\times k \\times k$\n$k \\times k$ ä»£è¡¨åœ¨åŸç‰¹å¾å›¾åŒºåŸŸ$k \\times k$ çš„ max ï¼Œsumæˆ–è€…avgæ± åŒ–æ“ä½œï¼›\n$H_{out} \\times W_{out}$ä»£è¡¨è¾“å‡ºç‰¹å¾å›¾å¤§å°ï¼Œ$C_{out}$ä»£è¡¨è¾“å‡ºé€šé“æ•°ã€‚\næ¡ˆä¾‹ å‚æ•°é‡ VGG-19æ¨¡å‹ï¼Œè¾“å…¥å›¾ç‰‡å¤§å°ä¸º$3 \\times 224 \\times 224$ï¼Œè¡¨ç¤ºä¸º$3$é€šé“$224 \\times 224$å°ºå¯¸çš„å›¾åƒè¾“å…¥ï¼Œæ¨¡å‹åˆ†ä¸ºäº”ç»„å·ç§¯å’Œä¸‰å±‚å…¨è¿æ¥å±‚ã€‚\n$(3 \\times 3 \\times 3 + 1) \\times 64 + (3 \\times 3 \\times 64 + 1) \\times 64 + (3 \\times 3 \\times 64 + 1) \\times 128 + (3 \\times 3 \\times 128 + 1) \\times 128 +$ $(3 \\times 3 \\times 128 + 1) \\times 256 + (3 \\times 3 \\times 256 + 1) \\times 256 + (3 \\times 3 \\times 256 + 1) \\times 256 + (3 \\times 3 \\times 256 + 1) \\times 256 +$ $(3 \\times 3 \\times 256 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 +$ $(3 \\times 3 \\times 512 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 + (3 \\times 3 \\times 512 + 1) \\times 512 +$ $(512 \\times 7 \\times 7 + 1) \\times 4096 + (4096 + 1) \\times 4096 + (4096 + 1) \\times 1000$\nè®¡ç®—å¾—143667240ï¼Œä¹˜ä»¥ä¸€ä¸ªæµ®ç‚¹æ•°å 4ä¸ªå­—èŠ‚ï¼Œå¾—574668960å­—èŠ‚ï¼Œä¸º548.04MBï¼Œå’Œè®ºæ–‡ä¸­çš„æ•°é‡å¤§è‡´ç›¸ç­‰ã€‚\nè®¡ç®—é‡ VGG-19æ¨¡å‹ï¼Œè¾“å…¥å›¾ç‰‡å¤§å°ä¸º$3 \\times 224 \\times 224$ï¼Œè¡¨ç¤ºä¸º$3$é€šé“$224 \\times 224$å°ºå¯¸çš„å›¾åƒè¾“å…¥ï¼Œæ¨¡å‹åˆ†ä¸ºäº”ç»„å·ç§¯å’Œä¸‰å±‚å…¨è¿æ¥å±‚ã€‚\nç¬¬ä¸€ç»„å·ç§¯ $(3 \\times 3 \\times 3 + 3 \\times 3 \\times 3 - 1 + 1) \\times 64 \\times 224 \\times 224 = 173408256$ $(64 \\times 3 \\times 3 + 64 \\times 3 \\times 3 - 1 + 1) \\times 64 \\times 224 \\times 224 = 3699376128$ æ± åŒ– $64 \\times 112 \\times 112 \\times 2 \\times 2 = 3211264$ ç¬¬äºŒç»„å·ç§¯ $(64 \\times 3 \\times 3 + 64 \\times 3 \\times 3 - 1 + 1) \\times 128 \\times 112 \\times 112 = 1849688064$ $(128 \\times 3 \\times 3 + 128 \\times 3 \\times 3 - 1 + 1) \\times 128 \\times 112 \\times 112 = 3699376128$ æ± åŒ– $128 \\times 56 \\times 56 \\times 2 \\times 2 = 1605632$ ç¬¬ä¸‰ç»„å·ç§¯ $(128 \\times 3 \\times 3 + 128 \\times 3 \\times 3 - 1 + 1) \\times 256 \\times 56 \\times 56 = 1849688064$ $(256 \\times 3 \\times 3 + 256 \\times 3 \\times 3 - 1 + 1) \\times 256 \\times 56 \\times 56 = 3699376128$ $(256 \\times 3 \\times 3 + 256 \\times 3 \\times 3 - 1 + 1) \\times 256 \\times 56 \\times 56 = 3699376128$ $(256 \\times 3 \\times 3 + 256 \\times 3 \\times 3 - 1 + 1) \\times 256 \\times 56 \\times 56 = 3699376128$ æ± åŒ– $256 \\times 28 \\times 28 \\times 2 \\times 2 = 802816$ ç¬¬å››ç»„å·ç§¯ $(256 \\times 3 \\times 3 + 256 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 28 \\times 28 = 1849688064$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 28 \\times 28 = 3699376128$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 28 \\times 28 = 3699376128$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 28 \\times 28 = 3699376128$ æ± åŒ– $512 \\times 14 \\times 14 \\times 2 \\times 2 = 401408$ ç¬¬äº”ç»„å·ç§¯ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 14 \\times 14 = 924844032$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 14 \\times 14 = 924844032$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 14 \\times 14 = 924844032$ $(512 \\times 3 \\times 3 + 512 \\times 3 \\times 3 - 1 + 1) \\times 512 \\times 14 \\times 14 = 924844032$ æ± åŒ– $512 \\times 7 \\times 7 \\times 2 \\times 2 = 100352$ ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ $(512 \\times 7 \\times 7 + 512 \\times 7 \\times 7 - 1 + 1) \\times 4096 = 205520896$ ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ $(4096 + 4096 - 1 + 1) * 4096 = 33554432$ ç¬¬ä¸‰ä¸ªå…¨è¿æ¥å±‚ $(4096 + 4096 - 1 + 1) * 1000 = 8192000$ å…±è®¡ï¼š39264124928 = 39.2 bilionæ¬¡è¿ç®—ï¼Œå°†è¿™ä¸ªå€¼æ¢ç®—ä¸ºmultiply-addsè¿ç®—ï¼Œéœ€è¦é™¤ä»¥2ï¼Œå¾—åˆ°19.6bilionï¼Œè¯¥å€¼ä¸è®ºæ–‡ä¸­çš„è®¡ç®—é‡ä¸€è‡´ã€‚ï¼ˆæ­¤æ¬¡è¿ç®—å¿½ç•¥äº†ReLuæ¿€æ´»å±‚çš„è®¡ç®—é‡ï¼Œè¯¥è®¡ç®—é‡è¾ƒå°ï¼Œå¯ä»¥å¿½ç•¥ï¼‰ å·¥å…· torchinfo torchinfo è¯¥å·¥å…·å¯ä»¥è‡ªåŠ¨ç»Ÿè®¡ç½‘ç»œæ¨¡å‹çš„å‚æ•°é‡å’Œè®¡ç®—é‡ã€‚\nä¾‹å­ï¼š\n1 2 3 4 5 from torchinfo import summary model = ConvNet() batch_size = 16 summary(model, input_size=(batch_size, 1, 28, 28)) ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ========================================================================================== Layer (type:depth-idx) Output Shape Param # ========================================================================================== â”œâ”€Conv2d: 1-1 [16, 10, 24, 24] 260 â”œâ”€Conv2d: 1-2 [16, 20, 8, 8] 5,020 â”œâ”€Dropout2d: 1-3 [16, 20, 8, 8] -- â”œâ”€Linear: 1-4 [16, 50] 16,050 â”œâ”€Linear: 1-5 [16, 10] 510 ========================================================================================== Total params: 21,840 Trainable params: 21,840 Non-trainable params: 0 Total mult-adds (M): 7.69 ========================================================================================== Input size (MB): 0.05 Forward/backward pass size (MB): 0.91 Params size (MB): 0.09 Estimated Total Size (MB): 1.05 ========================================================================================== å‚è€ƒï¼š https://zhuanlan.zhihu.com/p/135861716\nhttps://zhuanlan.zhihu.com/p/49842046\nhttps://zhuanlan.zhihu.com/p/31575074\næ›´æ–°è®°å½• å¢åŠ ç½‘ç»œæ¨¡å‹ç»Ÿè®¡å·¥å…·ï¼Œè‡ªåŠ¨è¿›è¡Œç½‘ç»œå‚æ•°å’Œè®¡ç®—é‡ç»Ÿè®¡ã€‚ â€”â€” 2022.07.19\n","date":"2021-04-25T21:41:56Z","permalink":"https://qiyueliuhuo.github.io/posts/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%AE%97%E5%AD%90%E5%8F%82%E6%95%B0%E9%87%8F%E5%92%8C%E8%AE%A1%E7%AE%97%E9%87%8F%E4%BC%B0%E8%AE%A1/","title":"ç¥ç»ç½‘ç»œä¸­å¸¸ç”¨ç®—å­å‚æ•°é‡å’Œè®¡ç®—é‡ä¼°è®¡"},{"content":"Module nn.BNReLU2d æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 class BNReLU2d(nnq.BatchNorm2d): r\u0026#34;\u0026#34;\u0026#34; A BNReLU2d module is a fused module of BatchNorm2d and ReLU We adopt the same interface as :class:`torch.nn.quantized.BatchNorm2d`. Attributes: Same as torch.nn.quantized.BatchNorm2d \u0026#34;\u0026#34;\u0026#34; _FLOAT_MODULE = torch.nn.intrinsic.BNReLU2d def __init__(self, num_features, eps=1e-5, momentum=0.1): super(BNReLU2d, self).__init__(num_features, eps=eps, momentum=momentum) def forward(self, input): # Temporarily using len(shape) instead of ndim due to JIT issue # https://github.com/pytorch/pytorch/issues/23890 if len(input.shape) != 4: raise ValueError(\u0026#34;Input shape must be `(N, C, H, W)`!\u0026#34;) return torch.ops.quantized.batch_norm2d_relu( input, self.weight, self.bias, self.running_mean, self.running_var, self.eps, self.scale, self.zero_point) def _get_name(self): return \u0026#39;QuantizedBNReLU2d\u0026#39; @classmethod def from_float(cls, mod): # TODO: Add qat support for BNReLU2d return super(BNReLU2d, cls).from_float(mod)) nn.BatchNorm2d 1 2 3 4 5 class BatchNorm2d(_BatchNorm): def _check_input_dim(self, input): if input.dim() != 4: raise ValueError(\u0026#39;expected 4D input (got {}D input)\u0026#39; .format(input.dim())) torch.nn.BatchNorm2ç±»å¦‚ä¸Šé¢æºç æ‰€ç¤ºï¼Œè¯¥ç±»å…·ä½“å®ç°éƒ¨åˆ†åŸºæœ¬ä¸Šéƒ½æ¥è‡ªç»§æ‰¿_BatchNormè¿™ä¸ªå†…éƒ¨ç±»ï¼Œè€Œåè€…ç±»é‡Œé¢å…·ä½“å®ç°ä¸æ˜¯ç”¨pythonå®ç°çš„ï¼Œè€Œæ˜¯ç”¨c++ã€cudaå®ç°çš„ï¼Œè¿™é‡Œæˆ‘å°±ä¸å…·ä½“åˆ†æåº•å±‚æºç äº†ã€‚\nä¸‹é¢åˆ†æè¿™ä¸ªç±»åŠŸèƒ½ï¼š\nè¿™ç¯‡è®ºæ–‡ä¸­Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shiftæå‡ºäº†BNå±‚ã€‚é¦–å…ˆè¯¥ç±»çš„è¾“å…¥ä¸ºå°æ‰¹é‡å¸¦é€šé“çš„äºŒç»´è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥çš„å¤§å°ä¸º(N,C,H,W)ã€‚å¯¹è¾“å…¥çš„æ•°æ®åšå¦‚ä¸‹å…¬å¼çš„å˜æ¢ï¼š $$ y = \\frac{x - \\mathrm{E}[x]}{ \\sqrt{\\mathrm{Var}[x] + \\epsilon}} * \\gamma + \\beta $$ å¹³å‡å€¼å’Œæ ‡å‡†å·®æ˜¯æŒ‰å°æ‰¹é‡çš„æ¯ä¸ªç»´åº¦è®¡ç®—ï¼Œ$\\gamma$å’Œ$\\beta$ä¸ºé€šé“ç»´åº¦ä¸Šçš„å¯å­¦ä¹ çš„å‚æ•°å‘é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ$\\gamma$ä¸º1ï¼Œ$\\beta$ä¸º0ã€‚\n","date":"2021-03-14T15:53:39Z","permalink":"https://qiyueliuhuo.github.io/posts/pytorch%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%89/","title":"Pytorchæºç é˜…è¯»(ä¸‰)ï¼šBatchNorm Module"},{"content":" æ³¨ï¼šç¬”è€…é˜…è¯»çš„pytorchç‰ˆæœ¬ä¸º1.7.0ï¼Œtorchvisionç‰ˆæœ¬ä¸º0.6\nå‰è¨€ åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä¸»è¦æ¥å†™å…³äºpytorchä¸­transformsæ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å¯¹å›¾åƒå„ç§é¢„å¤„ç†æ–¹æ³•ï¼Œä½äºtorchvision/transforms/transforms.pyï¼Œè¿™äº›æ–¹æ³•ä¼šåº”ç”¨åœ¨æ¨¡å‹è®­ç»ƒæ¨ç†å‰ï¼Œå¯¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼Œå†å°†å¤„ç†åçš„å›¾åƒé€è¿›æ·±åº¦ç½‘ç»œä¸­è®­ç»ƒä¸æ¨ç†ã€‚æˆ‘æƒ³å†™è¿™ç¯‡æ–‡ç« å¯¹è¿™äº›é¢„å¤„ç†æ–¹æ³•ï¼Œè¿›è¡Œå­¦ä¹ ç†è§£ï¼Œå°½å¯èƒ½ä»æºç è§’åº¦ï¼Œå½¢è±¡ç›´è§‚åœ°å±•ç¤ºè¿™äº›å›¾åƒé¢„å¤„ç†æ˜¯å¦‚ä½•å¯¹å›¾åƒè¿›è¡Œè½¬æ¢çš„ã€‚\ntransforms ï¼š è¯»[trÃ¦nsËˆfÉ”Ëm]ï¼Œå˜æ¢ã€è½¬æ¢ã€ç§»åŠ¨ã€‚ eg. Fourier transform å‚…é‡Œå¶å˜æ¢ï¼› It was an event that would transform my life. é‚£æ˜¯èƒ½å¤Ÿå½»åº•æ”¹å˜æˆ‘ä¸€ç”Ÿçš„ä¸€ä»¶äº‹ã€‚\ntransforms æ¨¡å—ç›¸å…³æºç åˆ†æ transforms.Composeç±» å…ˆæ¥çœ‹ä¸‹transforms.Composeåœ¨å®é™…ä»£ç ä¸­æ˜¯å¦‚ä½•è¿ç”¨çš„ï¼Œä¸‹é¢ä»£ç æ˜¯ä½¿ç”¨pytorchä¸­çš„Datasetæ–¹å¼å®šä¹‰ImageNetæ•°æ®é›†ï¼Œä¹Ÿå°±è¯´ImageNetç»§æ‰¿è‡ªdata.Datasetã€‚\n1 2 3 4 5 6 7 train_dataset = torchvision.datasets.ImageNet(train_path, transform=transforms.Compose([ transforms.Resize((32, 32)), # å°†å›¾ç‰‡ç¼©æ”¾åˆ°æŒ‡å®šå¤§å°ï¼ˆh,wï¼‰æˆ–è€…ä¿æŒé•¿å®½æ¯”å¹¶ç¼©æ”¾æœ€çŸ­çš„è¾¹åˆ°intå¤§å° transforms.CenterCrop(32), transforms.ToTensor()]) ) ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºæ¥transformsæ¨¡å—å®šä¹‰çš„å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ å…¥ç»™ImageNetï¼Œåœ¨ã€Špytorchæºç (ä¸€)ã€‹ä¸­ï¼Œäº†è§£åˆ°ï¼Œé€šè¿‡forå¾ªç¯å¯ä»¥éå†Datasetå¯¹è±¡è·å–å›¾åƒæ•°æ®ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»çš„transformsæ¨¡å—å®šä¹‰çš„ç±»ï¼Œä¸€èˆ¬åœ¨éå†Datasetè·å–å›¾åƒå‰å¯¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼Œé‚£ä¹ˆé€šè¿‡forå¾ªç¯å¾—åˆ°çš„å›¾åƒå°±æ˜¯è¿›è¡Œå¤„ç†åçš„å›¾åƒã€‚\nä¸‹é¢æ¥åˆ†ætransforms.Composeæºç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 class Compose(object): \u0026#34;\u0026#34;\u0026#34;Composes several transforms together. Args: transforms (list of ``Transform`` objects): list of transforms to compose. Example: \u0026gt;\u0026gt;\u0026gt; transforms.Compose([ \u0026gt;\u0026gt;\u0026gt; transforms.CenterCrop(10), \u0026gt;\u0026gt;\u0026gt; transforms.ToTensor(), \u0026gt;\u0026gt;\u0026gt; ]) \u0026#34;\u0026#34;\u0026#34; def __init__(self, transforms): self.transforms = transforms def __call__(self, img): for t in self.transforms: img = t(img) return img def __repr__(self): format_string = self.__class__.__name__ + \u0026#39;(\u0026#39; for t in self.transforms: format_string += \u0026#39;\\n\u0026#39; format_string += \u0026#39; {0}\u0026#39;.format(t) format_string += \u0026#39;\\n)\u0026#39; return format_string Composeæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæ˜¯å¯¹å¤šä¸ªtransformsæ¨¡å—å®šä¹‰è½¬æ¢å¯¹è±¡transformç»„åˆï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹åˆ—è¡¨çš„åŒ…è£…ï¼ˆè£…é¥°æ¨¡å¼ï¼Ÿï¼‰ã€‚\nè¿™é‡Œæˆ‘å°†è¿™äº›è½¬æ¢å¯¹è±¡ç±»å®šä¹‰ä¸ºtransformï¼ŒåŒ…æ‹¬transforms.CenterCropã€transforms.ToTensorç­‰ç­‰ã€‚\nè¯¥ç±»çš„æ„é€ å™¨(constructor)å‡½æ•°å…¥å‚ä¸ºåˆ—è¡¨ç±»å‹ï¼Œåˆ—è¡¨é‡Œæ˜¯å¤šä¸ªtransformè½¬æ¢å¯¹è±¡ï¼›åœ¨__call__ä¸­ï¼Œé€šè¿‡forå¾ªç¯éå†transformsåˆ—è¡¨ï¼Œå¯¹å›¾åƒä¾æ¬¡è¿›è¡Œè°ƒç”¨t(img)ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªtransforméƒ½æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œé€šè¿‡ä¾æ¬¡è°ƒç”¨è¿™äº›transformï¼Œå¯¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼Œè¿™äº›å¤„ç†æ˜¯æŒ‰ç…§åˆ—è¡¨é¡ºåºå¤„ç†ã€‚æ³¨ï¼šlistæ˜¯ä¸€ç§æœ‰åºçš„é›†åˆã€‚\ntransforms.Resizeç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 class Resize(object): \u0026#34;\u0026#34;\u0026#34;Resize the input PIL Image to the given size. Args: size (sequence or int): Desired output size. If size is a sequence like (h, w), output size will be matched to this. If size is an int, smaller edge of the image will be matched to this number. i.e, if height \u0026gt; width, then image will be rescaled to (size * height / width, size) interpolation (int, optional): Desired interpolation. Default is ``PIL.Image.BILINEAR`` \u0026#34;\u0026#34;\u0026#34; def __init__(self, size, interpolation=Image.BILINEAR): assert isinstance(size, int) or (isinstance(size, Iterable) and len(size) == 2) self.size = size self.interpolation = interpolation def __call__(self, img): \u0026#34;\u0026#34;\u0026#34; Args: img (PIL Image): Image to be scaled. Returns: PIL Image: Rescaled image. \u0026#34;\u0026#34;\u0026#34; return F.resize(img, self.size, self.interpolation) def __repr__(self): interpolate_str = _pil_interpolation_to_str[self.interpolation] return self.__class__.__name__ + \u0026#39;(size={0}, interpolation={1})\u0026#39;.format(self.size, interpolate_str) å…ˆåˆ†æResizeçš„æ„é€ å™¨æ–¹æ³•ï¼Œå‚æ•°sizeï¼Œä¸ºè½¬æ¢åçš„å›¾åƒåƒç´ å¤§å°ï¼Œå¦‚æœsizeå‚æ•°æ˜¯è¿™æ ·çš„åºåˆ—ï¼ˆhï¼Œwï¼‰ï¼Œè¾“å‡ºå¤§å°å°†ä¸æ­¤åŒ¹é…ã€‚å¦‚æœsizeæ˜¯intï¼Œå›¾åƒçš„è¾ƒå°è¾¹ç­‰äºæ­¤æ•°å­—ã€‚å¦‚æœheight \u0026gt; widthï¼Œåˆ™å›¾åƒå°†è¢«é‡æ–°ç¼©æ”¾åˆ°$\\left(\\text{size} \\times \\frac{\\text{height}}{\\text{width}}, \\text{size}\\right)$ã€‚å¦ä¸€ä¸ªå‚æ•°ä¸ºinterpolationï¼Œç¿»è¯‘ä¸ºæ’å€¼ï¼Œé»˜è®¤å€¼ä¸ºåŒçº¿æ€§æ’å€¼ï¼Œè¿™é‡Œæˆ‘çŒœæµ‹ä¸‹ï¼Œå½“éœ€è¦å°†å›¾åƒåˆ†è¾¨ç‡å˜å¤§ï¼Œæ¯”å¦‚300*400æé«˜è‡³600*500åˆ†è¾¨ç‡ï¼Œå› ä¸ºåˆ†è¾¨ç‡ä¹˜ç§¯ä»£è¡¨åƒç´ ç‚¹çš„ä¸ªæ•°ï¼Œåˆ†è¾¨ç‡å¢å¤§ï¼Œé‚£ä¹ˆåŸæœ‰çš„å›¾åƒåƒç´ ç‚¹ä¸å¤Ÿï¼Œéœ€è¦é€šè¿‡æ’å€¼çš„æ–¹å¼æ–°ç”Ÿæˆä¸€éƒ¨åˆ†åƒç´ ç‚¹ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯æ§åˆ¶å¦‚ä½•äº§ç”Ÿè¿™éƒ¨åˆ†çš„åƒç´ ç‚¹ï¼Œåœ¨åé¢åˆ†ææºç æˆ‘ä¼šè¯¦ç»†åœ°è¯´æ˜æ’å€¼æ–¹æ³•ã€‚\nåˆ†æ__call__æ–¹æ³•ï¼Œå®ƒçš„å†…éƒ¨çš„å®ç°ç›´æ¥è°ƒç”¨äº†torchvision/transforms/functional.pyæ¨¡å—ä¸­çš„æ–¹æ³•ï¼Œfunctional.pyæ¨¡å—åŒ…å«äº†å¾ˆå¤šå¯¹å›¾åƒè½¬æ¢çš„å…·ä½“æ–¹æ³•å®ç°ï¼Œæ¯”å¦‚resize(img, size, interpolation=Image.BILINEAR)æ–¹æ³•çš„å…·ä½“å®ç°ç­‰ç­‰ã€‚\nä¸‹é¢æˆ‘ä½¿ç”¨Resizeé€šè¿‡ä»£ç å°†475 * 300å¤§å°å›¾ç‰‡è½¬æ¢ä¸º237 * 150å¤§å°çš„å›¾ç‰‡ã€‚\n1 2 3 4 5 6 7 8 from torchvision.transforms import transforms from PIL import Image im = Image.open(\u0026#34;resources/dog-4671215_1280.jpg\u0026#34;) resize = transforms.Resize((150, 237)) im = resize(im) im.show() im.save(\u0026#39;resources/dog-150_237.jpg\u0026#39;) ç¼©å°ä¸º ä¸‹é¢æˆ‘æ¥å…·ä½“åˆ†æfunctional.pyæ¨¡å—ä¸­çš„resizeæ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 def resize(img, size, interpolation=Image.BILINEAR): r\u0026#34;\u0026#34;\u0026#34;Resize the input PIL Image to the given size. Args: img (PIL Image): Image to be resized. size (sequence or int): Desired output size. If size is a sequence like (h, w), the output size will be matched to this. If size is an int, the smaller edge of the image will be matched to this number maintaing the aspect ratio. i.e, if height \u0026gt; width, then image will be rescaled to :math:`\\left(\\text{size} \\times \\frac{\\text{height}}{\\text{width}}, \\text{size}\\right)` interpolation (int, optional): Desired interpolation. Default is ``PIL.Image.BILINEAR`` Returns: PIL Image: Resized image. \u0026#34;\u0026#34;\u0026#34; if not _is_pil_image(img): raise TypeError(\u0026#39;img should be PIL Image. Got {}\u0026#39;.format(type(img))) if not (isinstance(size, int) or (isinstance(size, Iterable) and len(size) == 2)): raise TypeError(\u0026#39;Got inappropriate size arg: {}\u0026#39;.format(size)) if isinstance(size, int): w, h = img.size if (w \u0026lt;= h and w == size) or (h \u0026lt;= w and h == size): return img if w \u0026lt; h: ow = size oh = int(size * h / w) return img.resize((ow, oh), interpolation) else: oh = size ow = int(size * w / h) return img.resize((ow, oh), interpolation) else: return img.resize(size[::-1], interpolation) resizeå‡½æ•°æ˜¯å®šä¹‰åœ¨functional.pyæ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå‰ä¸¤ä¸ªifè¯­å¥ï¼Œç”¨æ¥åšå‚æ•°ç±»å‹æ ¡éªŒï¼Œä¸»è¦ç”¨åˆ°pythonä¸­å†…ç½®çš„isinstance(x, A_tuple)å‡½æ•°ï¼Œè¿”å›å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹è¿˜æ˜¯å­ç±»çš„å®ä¾‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼Œæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªç±»å¯¹è±¡çš„å…ƒç»„ã€‚å…³äºIterableçš„ç†è§£å¯ä»¥æŸ¥çœ‹è¿™ç¯‡åšå®¢ç†è§£Pythonçš„Iterableå’ŒIteratorã€‚\nå…¶ä»–éƒ¨åˆ†çš„ä»£ç ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œisinstance(size, int)ä¸ºTrueæ—¶ï¼Œsizeä¸ºå›¾åƒè¾ƒå°çš„è¾¹çš„è¾“å‡ºå¤§å°,è¾“å‡ºå›¾åƒå¦ä¸€è¾¹çš„å¤§å°æ ¹æ®åŸå›¾çš„æ¯”ä¾‹è®¡ç®—å¾—å‡ºã€‚\næœ€åçš„elseåˆ†æ”¯ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œåœ¨è¿™é‡Œå¯ä»¥å­¦ä¹ åˆ°çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚ä½•å–å¾—ä¸€ä¸ªåˆ—è¡¨å€’åºçš„ç»“æœï¼Ÿè¿™é‡Œç”¨äº†åˆ‡ç‰‡çš„æ–¹å¼size[::-1]ï¼Œæ¥å°†å…¥å‚æ˜¯ä¼ å…¥çš„(h, w)é€†åºå˜æˆ(w, h)ï¼Œå†ä¼ å…¥PIL.Imageå¯¹è±¡çš„resize()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´pytorchæœ¬èº«æ²¡æœ‰è‡ªå·±å®ç°å¯¹å›¾åƒçš„resizeæ–¹æ³•ï¼Œè€Œæ˜¯åœ¨åº•å±‚è°ƒç”¨çš„PILå›¾åƒåº“çš„æ–¹æ³•ã€‚\nä¸‹é¢å…ˆæ’å…¥ä¸€äº›å¯¹pythonä¸­åˆ‡ç‰‡çš„å­¦ä¹ ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘æ¯æ¬¡é‡åˆ°åˆ‡ç‰‡è¡¨è¾¾æ–¹å¼éƒ½è¦é‡æ–°æŸ¥ä¸€éå„ç§åˆ‡ç‰‡å…·ä½“æ˜¯ä»£è¡¨çš„ä»€ä¹ˆå«ä¹‰ï¼ˆğŸ˜–ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 Last login: Wed Mar 10 14:19:12 on ttys001 \u0026gt;\u0026gt;\u0026gt; L = list(range(10)) \u0026gt;\u0026gt;\u0026gt; L [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] \u0026gt;\u0026gt;\u0026gt; L[::-1] # å€’åºæ’åˆ—å¹¶ä¸”æ¯1ä¸ªå–ä¸€ä¸ª [9, 8, 7, 6, 5, 4, 3, 2, 1, 0] \u0026gt;\u0026gt;\u0026gt; L[::-2] # å€’åºæ’åˆ—å¹¶ä¸”æ¯2ä¸ªå–ä¸€ä¸ª [9, 7, 5, 3, 1] \u0026gt;\u0026gt;\u0026gt; L[::2] # æ­£åºæ’åˆ—å¹¶ä¸”æ¯2ä¸ªå–ä¸€ä¸ª [0, 2, 4, 6, 8] \u0026gt;\u0026gt;\u0026gt; L[:] # åŸæ ·å¤åˆ¶ [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] \u0026gt;\u0026gt;\u0026gt; L[1:5] # å–ç¬¬ä¸€ä¸ªåˆ°ç¬¬äº”ä¸ª [1, 2, 3, 4] å‚è€ƒï¼špythonåˆ‡ç‰‡\nè‡³äºPIL.Imageå¯¹è±¡çš„resize()æ–¹æ³•å…·ä½“åˆ†æï¼Œå†…éƒ¨å®ç°æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå…ˆæš‚æ—¶çœç•¥ï¼Œåé¢å†è¡¥(ğŸ¤¦)â€ï¸ã€‚\ntransforms.CenterCropç±» CenterCropç±»çš„åŠŸèƒ½æ˜¯ä¾æ®ç»™å®šçš„sizeä»ä¸­å¿ƒè£å‰ªï¼Œåœ¨pytorchä¸­çš„å®ç°éå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥æºç äº†ï¼Œç®€å•çœ‹ä¸‹å®ƒçš„æ„é€ å™¨æ–¹æ³•ï¼Œå‚æ•°sizeä¸º(h, w)ï¼Œä»£è¡¨è£å‰ªåçš„å›¾åƒåˆ†è¾¨ç‡å¤§å°ï¼Œè€Œå¦‚æœsizeä¸ºintå‹ï¼Œé‚£ä¹ˆè£å‰ªä¸º(size, size)å¤§å°çš„æ­£æ–¹å½¢ä¸­å¿ƒå›¾åƒã€‚ä¾‹å¦‚ï¼Œä¸‹é¢åœ¨475 * 300å¤§å°å›¾åƒçš„ä¸­å¿ƒéƒ¨åˆ†è£å‰ªå‡º120 * 120å¤§å°çš„å›¾åƒï¼š è£å‰ªå‡º transforms.ToTensor 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class ToTensor(object): \u0026#34;\u0026#34;\u0026#34;Convert a ``PIL Image`` or ``numpy.ndarray`` to tensor. Converts a PIL Image or numpy.ndarray (H x W x C) in the range [0, 255] to a torch.FloatTensor of shape (C x H x W) in the range [0.0, 1.0] if the PIL Image belongs to one of the modes (L, LA, P, I, F, RGB, YCbCr, RGBA, CMYK, 1) or if the numpy.ndarray has dtype = np.uint8 In the other cases, tensors are returned without scaling. \u0026#34;\u0026#34;\u0026#34; def __call__(self, pic): \u0026#34;\u0026#34;\u0026#34; Args: pic (PIL Image or numpy.ndarray): Image to be converted to tensor. Returns: Tensor: Converted image. \u0026#34;\u0026#34;\u0026#34; return F.to_tensor(pic) def __repr__(self): return self.__class__.__name__ + \u0026#39;()\u0026#39; ToTensorä»ç±»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªç±»ä¸»è¦å°†PIL.Imageå¯¹è±¡å’Œnumpy.ndarrayå¯¹è±¡è½¬æ¢ä¸ºtorch.FloatTensorå¯¹è±¡ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ€ç»ˆçš„è½¬æ¢å¾—åˆ°çš„Tensorå¯¹è±¡çš„sizeæ˜¯(C x H x W)ï¼Œé€šé“æ•°åœ¨å‰é¢ï¼Œä¹Ÿå°±æ˜¯è¯´pytorchåœ¨å¤„ç†å›¾åƒæ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†ä¸‰ç»´çš„å›¾åƒæ’åˆ—æ˜¯(é€šé“æ•°ï¼Œé«˜åº¦ï¼Œå®½åº¦)ã€‚å¦å¤–ï¼Œè¯¥ç±»è¿˜ä¼šå°†åŸæœ¬çš„0~255çš„RGBä¸‰åŸè‰²å¼ºåº¦å€¼è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œç»Ÿä¸€é™¤ä»¥255ï¼Œä½¿å¾—å€¼åœ¨0.0~1.0ä¹‹é—´ã€‚\n","date":"2021-03-11T14:15:04Z","permalink":"https://qiyueliuhuo.github.io/posts/pytorch%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%BA%8C/","title":"Pytorchæºç é˜…è¯»(äºŒ)ï¼štransformsæ¨¡å—"},{"content":" vueå­¦ä¹ è®°å½•ã€‚\næ³¨ï¼š\nå­¦ä¹ ç›®å½•åœ¨Workplace/vueLearningã€‚ å­¦å®Œè¦ç»¼åˆå­¦è¿‡å‰ç«¯å’Œåç«¯çŸ¥è¯†ï¼Œå¼€å‘ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ï¼Œç»¼åˆåº”ç”¨çŸ¥è¯†ã€‚ ä½¿ç”¨çš„å¼€å‘IDEä¸ºWebStormã€‚ ä¸€ã€é‚‚é€…Vuejs è®¤è¯†Vuejs Vueåœ¨å›½å†…ç›¸æ¯”äºReactä½¿ç”¨æ›´åŠ å¹¿æ³›ã€æ›´ç«ã€‚\nä¸‰å¤§æ¡†æ¶ï¼šVueJsã€AngularJsã€Reactã€‚ Vueï¼šè¯»éŸ³/vju:/ï¼Œç±»ä¼¼äºviewã€‚ Vueæ˜¯ä¸€ä¸ªæ¸è¿›å¼æ¡†æ¶ï¼š\nVueå¯ä»¥ä½œä¸ºä½ åº”ç”¨çš„ä¸€éƒ¨åˆ†åµŒå…¥å…¶ä¸­ã€‚ï¼ˆä¸€ç‚¹ä¸€ç‚¹æ¸è¿›å¼å¼•å…¥Vueï¼‰ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Vueæ ¸å¿ƒåº“åŠå…¶ç”Ÿæ€ç³»ç»Ÿã€‚ï¼ˆVueå…¨å®¶æ¡¶ï¼‰ Vueçš„ç‰¹ç‚¹å’Œé«˜çº§åŠŸèƒ½ï¼šï¼ˆç›®å‰ä¸å¤ªäº†è§£ï¼Œæ…¢æ…¢å­¦ä¹ ï¼Œæ…¢æ…¢ä½“ä¼šï¼‰\nè§£è€¦è§†å›¾å’Œæ•°æ® å¯å¤ç”¨çš„ç»„ä»¶ å‰ç«¯è·¯ç”±æŠ€æœ¯ çŠ¶æ€ç®¡ç† è™šæ‹ŸDOM å­¦ä¹ Vueå‰æï¼š\nå¯ä»¥ä»é›¶å­¦ä¹ ï¼Œä¸éœ€è¦å…¶ä»–æ¡†æ¶çš„çŸ¥è¯†ä¸ºå‰æã€‚ éœ€è¦å…·å¤‡ä¸€å®šçš„HTMLã€CSSã€JavaScriptåŸºç¡€ã€‚ (JSâ€» ã€ES6â€»ã€‚ä»¥åéƒ½ä¼šç”¨ES6ï¼‰ å¦ï¼š xcode è¯»éŸ³ï¼šå‰codeã€‚ Vueä¸è¦è¯»æˆvã€uã€eã€‚ Vuejså®‰è£…æ–¹å¼ æ–¹å¼ä¸€ï¼šç›´æ¥CDNå¼•å…¥ æ–¹å¼äºŒï¼šä¸‹è½½å’Œå¼•å…¥ å¦ï¼š - ç›´æ¥ä¸‹è½½ï¼Œæ‹·è´åˆ°é¡¹ç›®é‡Œé¢å°±å¯ä»¥ä½¿ç”¨ï¼Œåªæœ‰ä¸€ä¸ªvue.jsæ–‡ä»¶ï¼Œhinæ–¹ä¾¿ã€‚\næ–¹å¼ä¸‰ï¼šNPMå®‰è£… åç»­é€šè¿‡webpackå’ŒCLIçš„ä½¿ç”¨ï¼Œç„¶åå†ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ Vuejsåˆä½“éªŒ scriptå¼•å…¥vueå¹¶ä½¿ç”¨ï¼š ä¿®æ”¹æ•°æ®ï¼š1. ç•Œé¢ä¸ç”¨æ”¹ï¼Œå£°æ˜å¼å¼€å‘ã€‚ 2. å“åº”å¼ï¼šå½“æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œç•Œé¢è‡ªåŠ¨æ”¹å˜ã€‚ åˆ›å»ºVueå¯¹è±¡æ—¶å€™ï¼Œä¼ å…¥å‚æ•°å«ä¹‰ï¼š\n{}ä¸­åŒ…å«äº†elå±æ€§ï¼šè¯¥å±æ€§å†³å®šäº†è¿™ä¸ªvueå¯¹è±¡æŒ‚è½½åˆ°å“ªä¸€ä¸ªå…ƒç´ ã€‚ {}ä¸­åŒ…å«äº†dataå±æ€§:è¯¥å±æ€§ä¸­é€šå¸¸ä¼šå­˜å‚¨ä¸€äº›æ•°æ®ã€‚ æ•°æ®å¯ä»¥æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ã€‚ ä¹Ÿå¯ä»¥æ˜¯æ¥è‡ªç½‘ç»œï¼Œä»æœåŠ¡å™¨åŠ è½½åˆ°çš„ã€‚ åˆ—è¡¨å±•ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;!--{{movies}} --\u0026gt; \u0026lt;!-- è¿™ç§ä¼šå±•ç¤ºæˆjsonæ ¼å¼æ•°æ®--\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;item in movies\u0026#34;\u0026gt;{{item}}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;../js/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const app = new Vue({ el: \u0026#39;#app\u0026#39;, data: { message: \u0026#39;ä½ å¥½å‘€\u0026#39;, movies: [\u0026#39;æ˜Ÿé™…ç©¿è¶Š\u0026#39;, \u0026#39;å¤§è¯è¥¿æ¸¸\u0026#39;, \u0026#39;ç›—å¢“ç©ºé—´\u0026#39;, \u0026#39;åˆ‡å°”è¯ºè´åˆ©\u0026#39;] } }) \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Vueè®¡æ•°å™¨æ¡ˆä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;å½“å‰è®¡æ•°ï¼š{{counter}}\u0026lt;/h2\u0026gt; \u0026lt;button v-on:click=\u0026#34;add\u0026#34;\u0026gt;+\u0026lt;/button\u0026gt; \u0026lt;button v-on:click=\u0026#34;sub\u0026#34;\u0026gt;-\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;../js/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const app = new Vue({ el: \u0026#34;#app\u0026#34;, data: { counter: 0 }, methods: { add: function () { console.log(\u0026#39;addè¢«æ‰§è¡Œ\u0026#39;); this.counter++ }, sub: function () { console.log(\u0026#39;subè¢«æ‰§è¡Œ\u0026#39;); this.counter-- } } }) \u0026lt;/script\u0026gt; å¦ï¼š ES6ä¸å†ä½¿ç”¨varå®šä¹‰å˜é‡ï¼Œè€Œæ˜¯ä½¿ç”¨letï¼Œletå®šä¹‰å˜é‡ï¼Œconstå®šä¹‰å¸¸é‡ã€‚ å¯ä»¥åœ¨æ¸¸è§ˆå™¨consoleä¸­ä¿®æ”¹æ•°æ®ï¼Œä¼šè‡ªåŠ¨å“åº”å¼å±•ç¤ºã€‚ @clickæ˜¯ v-on:clickçš„è¯­æ³•ç³–ã€‚ Vuejsçš„MVVM ä»€ä¹ˆæ˜¯MVVMï¼šç»´åŸºç™¾ç§‘MVVMã€‚ ï¼ˆéœ€è¦å†è¯¦ç»†é˜…è¯»ï¼‰ Vueçš„MVVMï¼šå›¾ä¸æ¸…æ¥šï¼Œéœ€è¦é‡æ–°æ‰¾ã€‚ åˆ›å»ºVueå®ä¾‹ä¼ å…¥çš„options el: string | HTML Element data: Object | Function (ç»„ä»¶ä¸­dataå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°) methods: { [key: string]: Function } ï¼ˆåé¢æ¢æˆES6çš„è¯­æ³•æ¥å†™ï¼‰ å¦ï¼š å¼€å‘ä¸­ä»€ä¹ˆå«æ–¹æ³•ï¼Œä»€ä¹ˆç§°ä¹‹ä¸ºå‡½æ•°ï¼Ÿ ç­”ï¼šéƒ½æ˜¯é€šè¿‡functionå®šä¹‰ï¼Œç±»é‡Œé¢å«æ–¹æ³•ï¼Œå®šä¹‰åœ¨å¤–é¢å«å‡½æ•°ã€‚ æ–¹æ³•ï¼šmethod å‡½æ•°ï¼šfunction Vueçš„ç”Ÿå‘½å‘¨æœŸï¼ˆç®€å•ç†è§£ä¸‹ï¼‰ å¦ï¼š å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼šcreatedã€mountedã€‚ äºŒã€VueåŸºç¡€è¯­æ³• ä»£ç è§„èŒƒ å‰ç«¯å¼€å‘ï¼Œç¼©è¿›ä¸¤ä¸ªç©ºæ ¼æ›´åŠ åˆé€‚ã€‚ é‡å¤ä»£ç å»ºç«‹æ¨¡æ¿ å°†é‡å¤è¾“å…¥çš„å†…å®¹è®¾ç½®åˆ°æ¨¡æ¿å½“ä¸­ï¼Œåœ¨HTMLï¼ˆéœ€è¦è®¾ç½®ï¼‰ä¸­ç›´æ¥è¾“å…¥vueï¼Œç‚¹å‡»å›è½¦ï¼Œå°±å¯ä»¥è‡ªåŠ¨å¡«å……æ¨¡æ¿ä¸­çš„å†…å®¹ã€‚\næ’å€¼è¯­æ³• Mustacheè¯­æ³• ï¼ˆä¹Ÿå°±æ˜¯åŒå¤§æ‹¬å·ï¼Œç”¨çš„æœ€å¤šï¼‰â€» 1 2 3 4 5 6 7 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;!-- mustacheè¯­æ³•ä¸­ï¼Œä¸ä»…ä»…å¯ä»¥ç›´æ¥å†™å˜é‡ï¼Œä¹Ÿå¯ä»¥å†™ä¸€äº›ç®€å•çš„è¡¨è¾¾å¼--\u0026gt; \u0026lt;h2\u0026gt;{{firstName + \u0026#39; \u0026#39; + lastName}}\u0026lt;/h2\u0026gt; \u0026lt;h2\u0026gt;{{firstName}} {{lastName}}\u0026lt;/h2\u0026gt; \u0026lt;h2\u0026gt;{{counter * 2}}\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; v-onceæŒ‡ä»¤çš„ä½¿ç”¨ åªå±•ç¤ºä¸€æ¬¡ï¼Œåé¢ç½‘é¡µç•Œé¢å†…å®¹ä¸ä¼šéšç€messageå€¼çš„æ”¹å˜è€Œæ”¹å˜ã€‚ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªh2æ ‡ç­¾æ˜¾ç¤ºçš„å†…å®¹ä¸ä¼šéšç€vueçš„appé‡Œé¢æ•°æ®æ”¹å˜ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨ï¼Œç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ã€‚\n1 2 3 4 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;h2 v-once\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; v-htmlæŒ‡ä»¤çš„ä½¿ç”¨ æ•°æ®ä»¥HTMLå½¢å¼å±•ç¤ºã€‚ v-textæŒ‡ä»¤çš„ä½¿ç”¨ ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼Œæ²¡æœ‰åŒæ‹¬å·çµæ´»ï¼‰ v-preæŒ‡ä»¤çš„ä½¿ç”¨ ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰ å°†v-preè®¾ç½®çš„æ ‡ç­¾å†…å®¹åŸå°ä¸åŠ¨å±•ç¤ºï¼Œä¸è¿›è¡Œè§£æã€‚\n1 2 3 4 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;h2 v-pre\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; v-cloakæŒ‡ä»¤çš„ä½¿ç”¨ ï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰ cloak: æ–—ç¯·ã€‚ clock: æ—¶é’Ÿã€‚\nå’Œcssæ ·å¼ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°å½“JSè„šæœ¬æœªæ‰§è¡Œå®Œï¼Œä¸æ˜¾ç¤ºå†…å®¹ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºä¸€äº›æœªæ¸²æŸ“çš„â€œä¹±ç â€ï¼Œå¯¹ç”¨æˆ·å‹å¥½ã€‚\nv-bind v-bindä¹‹å‰éƒ½æ˜¯å°†æ•°æ®æ’åˆ°å†…å®¹ä¸­ï¼Œè€Œè¿™ä¸ªæ˜¯å°†å€¼æ’åˆ°æ ‡ç­¾çš„å±æ€§ä¸­ï¼Œæ¯”å¦‚imgæ ‡ç­¾çš„srcå±æ€§ï¼Œæ”¹å˜è¿™ä¸ªå±æ€§å€¼ã€‚åˆæ¯”å¦‚aæ ‡ç­¾çš„hrefå±æ€§ã€‚ä¸èƒ½ç”¨åŒæ‹¬å·è¯­æ³•æ“ä½œï¼ŒåŒæ‹¬å·æ˜¯åœ¨æ ‡ç­¾å†…å®¹ä¸­ä½¿ç”¨çš„ã€‚\nä½œç”¨ï¼šåŠ¨æ€ç»‘å®šæ ‡ç­¾å±æ€§ã€‚\nv-bindåŸºæœ¬ä½¿ç”¨ v-bindè¯­æ³•ç³– ï¼ˆç»å¸¸ç”¨ï¼‰â€» å°†v-bind:ç®€å†™æˆ:ã€‚\nv-bindåŠ¨æ€ç»‘å®šclasså±æ€§ å¯¹è±¡è¯­æ³•ï¼šclass = \u0026quot;\u0026quot; åŒå¼•å·é‡Œé¢æ˜¯ä¸ªå¯¹è±¡ã€‚ ï¼ˆç»å¸¸ç”¨ï¼‰â€» æ•°ç»„è¯­æ³• ï¼ˆå¾ˆå°‘ç”¨ï¼‰ 1 2 3 \u0026lt;h2 class=\u0026#34;title\u0026#34; :class=\u0026#34;[active, \u0026#39;line\u0026#39;]\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;!-- activeæ˜¯ä¸ªå˜é‡ï¼Œå®šä¹‰åœ¨dataä¸­--\u0026gt; v-bindåŠ¨æ€ç»‘å®šstyle å¯¹è±¡è¯­æ³•ï¼š:style=\u0026quot;{key(å±æ€§å): value(å±æ€§å€¼)}\u0026quot; åŒå¼•å·é‡Œé¢æ˜¯ä¸ªå¯¹è±¡ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;!-- \u0026lt;h2 :style=\u0026#34;{key(å±æ€§å): value(å±æ€§å€¼)}\u0026#34;\u0026gt;{{message}}\u0026lt;/h2\u0026gt;--\u0026gt; \u0026lt;h2 :style=\u0026#34;{fontSize: finalSize, color: finalColor}\u0026#34;\u0026gt;{{message}}\u0026lt;/h2\u0026gt; \u0026lt;!-- keyä¸éœ€è¦åŠ å•å¼•å·ï¼Œä½†æ˜¯valueè¦åŠ ï¼Œå¦åˆ™20pxå½“ä½œæˆå˜é‡äº† --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;../js/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const app = new Vue({ el: \u0026#34;#app\u0026#34;, data: { message: \u0026#39;ä½ å¥½å‘€\u0026#39;, finalSize: \u0026#39;100px\u0026#39;, finalColor: \u0026#39;red\u0026#39; } }) \u0026lt;/script\u0026gt; æ•°ç»„è¯­æ³•ï¼š\u0026lt;div v-bind: style=\u0026quot;[basestyles, overridingstyles]\u0026quot;\u0026gt;/div\u0026gt; ï¼Œbasestyleså’Œoverridingstylesä¸ºå¯¹è±¡ ï¼ˆå¾ˆå°‘ç”¨ï¼‰ è®¡ç®—å±æ€§ computedï¼ˆå¾ˆé‡è¦ï¼‰â€» è®¡ç®—å±æ€§çš„ä½¿ç”¨ æ•°æ®å±•ç¤ºä¹‹å‰éœ€è¦ç»è¿‡ä¸€å®šçš„å¤„ç†ï¼Œcomputedé‡Œé¢ä¹Ÿæ˜¯å®šä¹‰çš„å‡½æ•°ï¼Œä½†æ˜¯ä¸è¦å‘½åä¸ºåŠ¨è¯ï¼Œä¸€èˆ¬å‘½åä¸ºåè¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;!-- \u0026lt;h2\u0026gt;{{firstName + \u0026#39; \u0026#39; + lastName}}\u0026lt;/h2\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;h2\u0026gt;{{fullName()}}\u0026lt;/h2\u0026gt;--\u0026gt; \u0026lt;h2\u0026gt;{{fullName}}\u0026lt;/h2\u0026gt; \u0026lt;!-- ä¸éœ€è¦åŠ å‡½æ•°çš„æ‹¬å· --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;../js/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const app = new Vue({ el: \u0026#34;#app\u0026#34;, data: { message: \u0026#39;ä½ å¥½å‘€\u0026#39;, firstName: \u0026#39;lebron\u0026#39;, lastName: \u0026#39;James\u0026#39; }, computed: { fullName: function () { return this.firstName + \u0026#39; \u0026#39; + this.lastName + \u0026#39; æ ¹æ®computedå¾—åˆ°çš„\u0026#39;; } }, methods: { // fullName: function () { // return this.firstName + \u0026#39; \u0026#39; + this.lastName; // } } }) \u0026lt;/script\u0026gt; åº”ç”¨åœºæ™¯: è´­ç‰©è½¦é€‰ä¸­å¤šä¸ªå•†å“ï¼Œè®¡ç®—æ€»ä»·æ ¼ã€‚\nå¦ï¼šè®¡ç®—å±æ€§åªè®¡ç®—ä¸€æ¬¡ï¼Œæœ‰ç¼“å­˜ï¼Œç›¸æ¯”methodè®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚\nè®¡ç®—å±æ€§setterå’Œgetter è®¡ç®—å±æ€§å’Œmethodsçš„å¯¹æ¯” â€» è®¡ç®—å±æ€§å†…éƒ¨å®ç°ç¼“å­˜ï¼Œå¦‚æœå€¼ä¸æ”¹å˜ï¼Œç›´æ¥è°ƒç”¨ç¼“å­˜ä¸­çš„å†…å®¹ï¼Œè€Œmethodsæ¯æ¬¡éƒ½ä¼šè°ƒç”¨ï¼Œæ•ˆç‡æ¯”è®¡ç®—å±æ€§å·®\nè¡¥å……ï¼šES6è¯­æ³• let/var letæœ‰ifå’Œforå—çº§ä½œç”¨åŸŸï¼Œè€Œvaræ²¡æœ‰ifå’Œforå—çº§ä½œç”¨åŸŸã€‚\nconst æ ‡è¯†ç¬¦ä¿®é¥°ä¸ºå¸¸é‡ã€‚å®šä¹‰æ—¶å°±éœ€è¦èµ‹å€¼ã€‚å¯¹è±¡ä¸èƒ½ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥æ”¹å˜å¯¹è±¡é‡Œé¢çš„å±æ€§ã€‚\nå¯¹è±¡çš„å­—é¢é‡å¢å¼ºå†™æ³• å±æ€§çš„å¢å¼ºå†™æ³• å‡½æ•°çš„å¢å¼ºå†™æ³• äº‹ä»¶ç›‘å¬ v-onçš„åŸºæœ¬ä½¿ç”¨ v-onè¯­æ³•ç³–ï¼š@\nv-onçš„å‚æ•° äº‹ä»¶ç›‘å¬çš„æ—¶å€™ï¼Œè‹¥ä¸éœ€è¦ä¼ å‚æ•°ï¼Œåˆ™å¯ä»¥ä¸å†™è°ƒç”¨çš„å°æ‹¬å·ã€‚ï¼ˆçœç•¥ï¼‰\nå¦‚ä½•ç»™äº‹ä»¶ç›‘å¬å‡½æ•°ä¼ å…¥ï¼Œæ¸¸è§ˆå™¨ç”Ÿæˆçš„eventå¯¹è±¡ï¼Ÿ\nä¼ å…¥çš„å‚æ•°ä¸º$eventå°±å¯ä»¥äº†ã€‚æ–¹æ³•å½¢å‚ä¸ºeventã€‚\nv-onçš„ä¿®é¥°ç¬¦ @click.stopé˜²æ­¢äº‹ä»¶å†’æ³¡ã€‚ @click.preventé˜»æ­¢é»˜è®¤è¡Œä¸ºçš„æ‰§è¡Œã€‚ @keyUp.enterç›‘å¬enteré”®çš„é‡Šæ”¾ã€‚ @click.onceåªç›‘å¬ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ã€‚ å…³äºäº‹ä»¶ç›‘å¬å‚è€ƒ Vueäº‹ä»¶ç›‘å¬\næ¡ä»¶åˆ¤æ–­ v-ifçš„ä½¿ç”¨ å¦ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œv-else-ifã€v-elseä¸åœ¨HTMLæ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œé€»è¾‘ä¸æ”¾åœ¨ç•Œé¢ä»£ç å¤„ã€‚\nv-showçš„ä½¿ç”¨ å†³å®šæ ‡ç­¾æ˜¯å¦åœ¨ç•Œé¢æ˜¾ç¤ºï¼š\u0026lt;h2 v-show=\u0026quot;isShow\u0026quot;\u0026gt; \u0026lt;/h2\u0026gt;\nv-if å’Œ v-showçš„åŒºåˆ«ã€‚ ï¼ˆv-ifç»å¸¸ä½¿ç”¨ï¼‰\nv-ifï¼šå½“æ¡ä»¶ä¸ºfalseæ—¶ï¼ŒåŒ…å«v-ifæŒ‡ä»¤çš„å…ƒç´ ï¼Œæ ¹æœ¬ä¸ä¼šå­˜åœ¨domä¸­ã€‚è€Œv-showï¼šå½“æ¡ä»¶ä¸ºfalseæ—¶ï¼Œåªæ˜¯ç»™å…ƒç´ æ·»åŠ äº†ä¸€ä¸ªè¡Œå†…æ ·å¼ï¼šdisplayï¼šnoneã€‚å‰è€…domä¸­å–æ‰ï¼Œåè€…æ”¹æ ·å¼ã€‚å½“å±•ç¤ºåˆ‡æ¢é¢‘ç‡å¾ˆé«˜ï¼Œç”¨v-showã€‚\nå¾ªç¯éå†v-forçš„ä½¿ç”¨ éå†æ•°ç»„ â€» 1 \u0026lt;li v-for=\u0026#34;(item, index) in movies\u0026#34;\u0026gt;{{item}}\u0026lt;/li\u0026gt; éå†å¯¹è±¡ 1 2 3 4 5 \u0026lt;!-- è·å–åˆ°çš„æ˜¯value --\u0026gt; \u0026lt;li v-for=\u0026#34;item in info\u0026#34;\u0026gt;{{item}}\u0026lt;/li\u0026gt; \u0026lt;!-- è·å–åˆ°valueå’Œkey --\u0026gt; \u0026lt;li v-for=\u0026#34;(value, key) in info\u0026#34;\u0026gt;{{value}} {{key}}\u0026lt;/li\u0026gt; v-forç»‘å®škey çœç•¥ã€‚\næ•°ç»„ä¸­å“åº”å¼æ–¹æ³•ï¼šæ•°ç»„å†…å®¹æ”¹å˜ï¼Œå±•ç¤ºå†…å®¹è·Ÿç€æ”¹å˜ã€‚ push()ã€pop()ã€shift()ã€unshift()ã€splice()ã€sort()ã€reverse()\nå¦:\nsplice() â€» letters[index] = \u0026lsquo;change\u0026rsquo; ç´¢å¼•æ–¹å¼æ”¹å˜æ•°ç»„æ˜¯éå“åº”å¼çš„ã€‚ ä¸Šé¢çš„æ–¹å¼å¯ä»¥æ”¹ç”¨ä¸ºvueå†…éƒ¨å®ç°çš„å‡½æ•°vue.set()ï¼Œæ›´æ¨èsplice()æ–¹å¼ã€‚ è¡¥å……ï¼šä¸‰ä¸ªé«˜é˜¶å‡½æ•° â€» filterã€reduceã€mapå‡½æ•°\nlet total = nums.filter(n =\u0026gt; n\u0026lt;100).map(n =\u0026gt; n * 2).reduce((pre, n) =\u0026gt; pre + n);\nv-modelåŒå‘ç»‘å®š ï¼ˆæš‚æ—¶è·³è¿‡ï¼‰ ä¸‰ã€ç»„ä»¶åŒ–å¼€å‘ â€» ä»€ä¹ˆæ˜¯ç»„ä»¶åŒ–ï¼Ÿ å°†å¤æ‚é—®é¢˜ï¼Œæ‹†åˆ†æˆå¾ˆå¤šä¸ªå°é—®é¢˜ã€‚å°†ä¸€ä¸ªé¡µé¢æ‹†åˆ†æˆä¸€ä¸ªä¸ªå°çš„åŠŸèƒ½å—ï¼Œæ¯ä¸ªåŠŸèƒ½å—å®Œæˆå±äºè‡ªå·±è¿™ä¸€éƒ¨åˆ†ç‹¬ç«‹çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæ•´ä¸ªé¡µé¢çš„ç®¡ç†å’Œç»´æŠ¤å°±å˜å¾—éå¸¸å®¹æ˜“äº†ã€‚åº”ç”¨æœ€åæŠ½è±¡ä¸ºä¸€ä¸ªç»„ä»¶æ ‘ã€‚\nç»„ä»¶åŒ–æ€æƒ³ ä»»ä½•çš„åº”ç”¨éƒ½ä¼šè¢«æŠ½è±¡æˆä¸€é¢—ç»„ä»¶æ ‘ã€‚ æœ‰äº†ç»„ä»¶åŒ–çš„æ€æƒ³ï¼Œæˆ‘ä»¬åœ¨ä¹‹åçš„å¼€å‘ä¸­å°±è¦å……åˆ†çš„åˆ©ç”¨å®ƒã€‚ å°½å¯èƒ½çš„å°†é¡µé¢æ‹†åˆ†æˆä¸€ä¸ªä¸ªå°çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚ è¿™æ ·è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ æ–¹ä¾¿ç»„ç»‡å’Œç®¡ç†ï¼Œå¹¶ä¸”æ‰©å±•æ€§ä¹Ÿæ›´å¼ºã€‚ ç»„ä»¶ä½¿ç”¨æ­¥éª¤ åˆ›å»ºç»„ä»¶æ„é€ å™¨ã€‚ æ³¨å†Œç»„ä»¶ã€‚ ä½¿ç”¨ç»„ä»¶ã€‚ å¦ï¼š\nå¼€å‘ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯å±€éƒ¨ç»„ä»¶ã€‚ ä¸€èˆ¬åªåˆ›å»ºä¸€ä¸ªVueå®ä¾‹ã€‚ å…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶ åœ¨Vueå®ä¾‹åˆ›å»ºä¹‹å¤–ï¼Œæ³¨å†Œçš„ç»„ä»¶ä¸ºå…¨å±€ç»„ä»¶ã€‚\n1 2 // æ³¨å†Œå…¨å±€ç»„ä»¶(å…¨å±€ç»„ä»¶, æ„å‘³ç€å¯ä»¥åœ¨å¤šä¸ªVueçš„å®ä¾‹ä¸‹é¢ä½¿ç”¨ï¼Œappï¼Œapp2) Vue.component(\u0026#39;cpn\u0026#39;, cpnC) åœ¨Vueå®ä¾‹åˆ›å»ºæ—¶ï¼Œæ³¨å†Œçš„ç»„ä»¶ä¸ºå±€éƒ¨ç»„ä»¶ã€‚ ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯å±€éƒ¨ç»„ä»¶ã€‚ â€» â€»\n1 2 3 4 5 6 7 8 9 10 11 const app = new Vue({ el: \u0026#39;#app\u0026#39;, data: { message: \u0026#39;ä½ å¥½å•Š\u0026#39; }, // å±€éƒ¨ç»„ä»¶ components: { // cpnä¸ºä½¿ç”¨ç»„ä»¶æ—¶çš„æ ‡ç­¾åï¼ŒcpnCä¸ºç»„ä»¶å®ä¾‹ cpn: cpnC } }) çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶çš„åŒºåˆ« â€» â€» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // 1.åˆ›å»ºç¬¬ä¸€ä¸ªç»„ä»¶æ„é€ å™¨(å­ç»„ä»¶)ï¼ŒVue.extend()è¯­æ³•å¾ˆå°‘è§äº† const cpnC1 = Vue.extend({ template: ` \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯æ ‡é¢˜1\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æˆ‘æ˜¯å†…å®¹, å“ˆå“ˆå“ˆå“ˆ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ` }) // 2.åˆ›å»ºç¬¬äºŒä¸ªç»„ä»¶æ„é€ å™¨(çˆ¶ç»„ä»¶) const cpnC2 = Vue.extend({ template: ` \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯æ ‡é¢˜2\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æˆ‘æ˜¯å†…å®¹, å‘µå‘µå‘µå‘µ\u0026lt;/p\u0026gt; \u0026lt;cpn1\u0026gt;\u0026lt;/cpn1\u0026gt; \u0026lt;/div\u0026gt; `, components: { cpn1: cpnC1 } }) æ³¨å†Œç»„ä»¶çš„è¯­æ³•ç³–å†™æ³•ï¼ˆæ¨èå†™æ³•ï¼‰â€» â€» çœç•¥ Vue.extend()ï¼Œä½¿ç”¨è¯­æ³•ç³–å†™æ³•ã€‚ åé¢å†…å®¹è®²è§£ï¼Œå°†tepmlateæŠ½ç¦»å‡ºå»ï¼Œä»£ç ä¼šæ›´åŠ æ¸…æ™°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 Vue.component(\u0026#39;cpn1\u0026#39;, { template: ` \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯æ ‡é¢˜1\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æˆ‘æ˜¯å†…å®¹, å“ˆå“ˆå“ˆå“ˆ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ` }) // 2.æ³¨å†Œå±€éƒ¨ç»„ä»¶çš„è¯­æ³•ç³– const app = new Vue({ el: \u0026#39;#app\u0026#39;, data: { message: \u0026#39;ä½ å¥½å•Š\u0026#39; }, components: { \u0026#39;cpn2\u0026#39;: { template: ` \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯æ ‡é¢˜2\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æˆ‘æ˜¯å†…å®¹, å‘µå‘µå‘µ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ` } } }) æ¨¡æ¿çš„åˆ†ç¦»å†™æ³• ä¸ºä»€ä¹ˆç»„ä»¶dataå¿…é¡»æ˜¯å‡½æ•°ï¼Ÿ â€» 1 2 3 4 5 6 7 8 9 10 // 1.æ³¨å†Œä¸€ä¸ªå…¨å±€ç»„ä»¶ Vue.component(\u0026#39;cpn\u0026#39;, { template: \u0026#39;#cpn\u0026#39;, // ç»„ä»¶æ•°æ® data() { return { title: \u0026#39;abc\u0026#39; } } }) Vueç»„ä»¶åº”è¯¥æœ‰è‡ªå·±ä¿å­˜æ•°æ®çš„åœ°æ–¹ï¼Œä¸èƒ½è®¿é—®Vueå®ä¾‹ä¸­çš„æ•°æ®ã€‚ ç»„ä»¶å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªdataå±æ€§(å‡½æ•°)ï¼Œä¹Ÿå¯ä»¥æœ‰methodsç­‰å±æ€§ã€‚ è¿™ä¸ªdataå±æ€§å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å†…éƒ¨ä¿å­˜ç€æ•°æ®ï¼Œå¤šä¸ªç›¸åŒç»„ä»¶å„è‡ªä½¿ç”¨å„è‡ªçš„æ•°æ®ã€‚ \u0026lt;script\u0026gt;æ ‡ç­¾ \u0026lt;template\u0026gt;æ ‡ç­¾ çˆ¶å­ç»„ä»¶çš„é€šä¿¡ â€» â€» â€» çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ props (å¸¸ç”¨) â€» props : properties å±æ€§\né€šè¿‡propså‘å­ç»„ä»¶ä¼ é€’æ•°æ®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;!--\u0026lt;cpn v-bind:cmovies=\u0026#34;movies\u0026#34;\u0026gt;\u0026lt;/cpn\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;cpn cmovies=\u0026#34;movies\u0026#34; cmessage=\u0026#34;message\u0026#34;\u0026gt;\u0026lt;/cpn\u0026gt;--\u0026gt; \u0026lt;!-- v-bind --\u0026gt; \u0026lt;cpn :cmessage=\u0026#34;message\u0026#34; :cmovies=\u0026#34;movies\u0026#34;\u0026gt;\u0026lt;/cpn\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;template id=\u0026#34;cpn\u0026#34;\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;item in cmovies\u0026#34;\u0026gt;{{item}}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;h2\u0026gt;{{cmessage}}\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script src=\u0026#34;../js/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; // çˆ¶ä¼ å­: props const cpn = { template: \u0026#39;#cpn\u0026#39;, // props: [\u0026#39;cmovies\u0026#39;, \u0026#39;cmessage\u0026#39;], è¿™ç§æœ‰äº›æ€ªï¼Œå­—ç¬¦ä¸²å±…ç„¶æ˜¯å˜é‡ï¼ props: { // 1.ç±»å‹é™åˆ¶ // cmovies: Array, // cmessage: String, // 2.æä¾›ä¸€äº›é»˜è®¤å€¼, ä»¥åŠå¿…ä¼ å€¼ cmessage: { type: String, default: \u0026#39;aaaaaaaa\u0026#39;, required: true }, // ç±»å‹æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„æ—¶, é»˜è®¤å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•° js ä¸­å±æ€§å’Œå‡½æ•°çš„åŒºåˆ«ï¼Ÿï¼Ÿï¼Ÿ cmovies: { type: Array, default() { return [] } } }, data() { return {} }, methods: { } } const app = new Vue({ el: \u0026#39;#app\u0026#39;, data: { message: \u0026#39;ä½ å¥½å•Š\u0026#39;, movies: [\u0026#39;æµ·ç‹\u0026#39;, \u0026#39;æµ·è´¼ç‹\u0026#39;, \u0026#39;æµ·å°”å…„å¼Ÿ\u0026#39;] }, components: { cpn // å¯¹è±¡å­—é¢é‡å¢å¼º } }) \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; é—®é¢˜ï¼š\nTODO\n1 \u0026lt;cpn :cmessage=\u0026#34;message\u0026#34; :cmovies=\u0026#34;movies\u0026#34;\u0026gt;\u0026lt;/cpn\u0026gt; å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ $emit events â€» é€šè¿‡äº‹ä»¶eventså‘çˆ¶ç»„ä»¶å‘é€æ¶ˆæ¯ã€‚\nçœ‹åˆ°P61\nwebpackçš„ä»‹ç»ä¸å®‰è£… Node, Npm å’Œ webpack\nä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œwebpackæ˜¯ä¸€ä¸ªç°ä»£çš„JavRScriptåº”ç”¨çš„é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·ã€‚ webpackå…¶ä¸­ä¸€ä¸ªæ ¸å¿ƒå°±æ˜¯è®©æˆ‘ä»¬å¯èƒ½è¿›è¡Œæ¨¡å—åŒ–å¼€å‘ï¼Œå¹¶ä¸”ä¼šå¸®åŠ©æˆ‘ä»¬å¤„ç†æ¨¡å—é—´çš„ä¾èµ–å…³ç³»ã€‚ ä¸ä»…ä»…æ˜¯JavaScriptæ–‡ä»¶ï¼Œæˆ‘ä»¬çš„CSSã€å›¾ç‰‡ã€jsonæ–‡ä»¶ç­‰ç­‰åœ¨webpackä¸­éƒ½å¯ä»¥è¢«å½“åšæ¨¡å—æ¥ä½¿ç”¨ï¼ˆåœ¨åç»­æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼‰ã€‚ è®¤è¯†webpack webpackçš„å®‰è£… webpackçš„èµ·æ­¥ webpackçš„é…ç½® loaderçš„ä½¿ç”¨ Iwebpackä¸­é…ç½®Vue pluginçš„ä½¿ç”¨ æ­å»ºæœ¬åœ°æœåŠ¡å™¨ å››ã€Vue CLIè¯¦è§£ ï¼ˆè„šæ‰‹æ¶ï¼‰â€» äº”ã€vue-router å…­ã€Vuexè¯¦è§£ ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰ ä¸ƒã€ç½‘ç»œå°è£… å…«ã€é¡¹ç›®å®æˆ˜ ä¸€æ­¥æ­¥å­¦ä¹ ï¼Œæ²¡ä»€ä¹ˆè€å¿ƒï¼Œé‚£å°±é¡¹ç›®é©±åŠ¨å­¦ä¹ å§ï¼Œå¼€å¹²ã€‚\nåˆ›å»ºé¡¹ç›® Vue CLIæ•™ç¨‹Vue CLI 1 2 sudo cnpm install -g vue-cli # å®‰è£… vue create supermall # åˆ›æ–°æ–°çš„é¡¹ç›® ç›®å½•ç»“æ„åˆ’åˆ† å‚è€ƒï¼šhttps://blog.csdn.net/weixin_42290927/article/details/94432587\nä¹ã€é¡¹ç›®éƒ¨ç½² åã€vuejsåŸç†ç›¸å…³ ","date":"2021-01-06T22:02:52Z","permalink":"https://qiyueliuhuo.github.io/posts/vue%E5%AD%A6%E4%B9%A0/","title":"Vueå­¦ä¹ "},{"content":"é˜…è¯»å¼€æºä»£ç æ˜¯æé«˜å†™ä»£ç èƒ½åŠ›æœ€å¥½çš„æ–¹å¼ä¹‹ä¸€ï¼Œç°åœ¨å…¥å‘æœºå™¨å­¦ä¹ é¢†åŸŸï¼Œåœ¨ä¼—å¤šæ¡†æ¶ä¸­é€‰æ‹©pytorchæ¡†æ¶ä½œä¸ºè‡ªå·±åŸºæœ¬çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œç°åœ¨å¼€å§‹ä»æœ€ç®€å•çš„pytorchä»£ç éƒ¨åˆ†é˜…è¯»ï¼Œå­¦ä¹ ä¸‹pythonæŠ€å·§é¡ºä¾¿æ·±å…¥å­¦ä¹ ä¸‹ç¥ç»ç½‘ç»œçš„ä»£ç å®è·µã€‚\nå…³äºé˜…è¯»æºç ï¼Œæˆ‘ä¸€å¼€å§‹åœ¨é¡¹ç›®ä¸­è°ƒç”¨pytorchæ¨¡å—å’Œç±»ï¼Œé€šè¿‡pycharmè¿½è¸ªæºç ï¼Œåœ¨pycharmä¸­å¯ä»¥ç›´æ¥æŸ¥çœ‹ä¾èµ–åŒ…torchä¸­æºç ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¸æ–¹ä¾¿é˜…è¯»torchæºç ï¼Œä¸€ä¸ªåŸå› æ˜¯pycharmä¸­æŸ¥çœ‹ä¾èµ–åŒ…çš„æºç å†…å®¹ï¼ŒæŸ¥çœ‹æºç æ–‡ä»¶çš„æ–¹å¼æ˜¯åªè¯»æ¨¡å¼ï¼Œæ²¡æ³•åœ¨é‡Œé¢æ³¨é‡Šä¸€äº›è‡ªå·±ç†è§£çš„ä¸œè¥¿ï¼Œå¦ä¸€ä¸ªåŸå› æ˜¯é€šè¿‡å•æ­¥è°ƒè¯•é˜…è¯»ä»£ç æ˜¯æœ€å®¹æ˜“ç†è§£ä»£ç çš„æ–¹å¼ï¼Œæƒ³äº†æƒ³pytorchæºç é‡Œé¢åº”è¯¥æœ‰å¯¹æºç çš„æµ‹è¯•ä»£ç å¯ä»¥ç›´æ¥è·‘èµ·æ¥ï¼Œç„¶åä¸€æ­¥æ­¥è¿è¡Œï¼Œè¿™æ ·çœ‹ç€æ›´æ–¹ä¾¿ã€‚\nä»githubä¸Šä¸‹è½½pytorchä»£ç ï¼Œé€šè¿‡CONTRIBUTING.mdæ–‡ä»¶ä¸­æŒ‡å¯¼ç¼–è¯‘æºç ï¼Œæ³¨æ„ä½¿ç”¨ï¼špython setup.py develop ä»¥å¼€å‘æ¨¡å¼æ„å»ºä»£ç ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨æˆ‘çš„ç”µè„‘ä¸Šè¦è·‘å°†è¿‘ä¸¤å°æ—¶ã€‚ã€‚ã€‚å¿˜äº†ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘è·‘äº†ä¸¤æ¬¡ã€‚ã€‚ã€‚å››ä¸ªå°æ—¶æ²¡äº†(å‘œå‘œ\u0026hellip;) å…ˆä»åŠ è½½å’Œå¤„ç†æ•°æ®æºç äº†è§£ã€‚\næ³¨ï¼šç¬”è€…é˜…è¯»çš„pytorchç‰ˆæœ¬ä¸º1.7.0ï¼Œtorchvisionç‰ˆæœ¬ä¸º0.6\nDataset ç›¸å…³æºç  MNISTç±» ç±»ç»§æ‰¿å›¾ï¼š\nå…ˆæ¥çœ‹çœ‹æœ€å¸¸ç”¨çš„mnistæ•°æ®é›†çš„ä½¿ç”¨ï¼Œä¸‹é¢ä¸¤è¡Œä½¿ç”¨torchvisionä¸­æä¾›çš„MNISTæ•°æ®é›†ç±»å®šä¹‰äº†ä¸¤ä¸ªæ•°æ®é›†ç±»ï¼Œåˆ†åˆ«ä¸ºè®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦å®šä¹‰ä¸¤ä¸ªåŒæ ·çš„æ•°æ®é›†å‘¢ï¼Ÿå…¶ä¸­ä¸€ä¸ªå› ä¸ºæ˜¯è®­ç»ƒå’Œæµ‹è¯•ä½¿ç”¨çš„æ•°æ®é›†ä¸ä¸€æ ·ï¼›å¦ä¸€ä¸ªåŸå› æ˜¯è®­ç»ƒå’Œæµ‹è¯•æ—¶å€™å¯¹åº”çš„batch_sizeå¤§å°ä¸ä¸€æ ·ã€‚ä¸‹é¢è¿›ä¸€æ­¥åˆ†ædatasets.MNISTä»£ç ã€‚\n1 2 3 4 5 6 dataset1 = datasets.MNIST(\u0026#39;../data\u0026#39;, train=True, download=True, transform=transform) dataset2 = datasets.MNIST(\u0026#39;../data\u0026#39;, train=False, transform=transform) train_loader = torch.utils.data.DataLoader(dataset1,**train_kwargs) test_loader = torch.utils.data.DataLoader(dataset2, **test_kwargs) ä¸‹é¢çš„ä»£ç æ¥è‡ªtorchvision.datasets.mnistæ¨¡å—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 from .vision import VisionDataset import warnings from PIL import Image import os import os.path import numpy as np import torch import codecs import string from .utils import download_url, download_and_extract_archive, extract_archive, \\ verify_str_arg class MNIST(VisionDataset): resources = [ (\u0026#34;http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz\u0026#34;, \u0026#34;f68b3c2dcbeaaa9fbdd348bbdeb94873\u0026#34;), (\u0026#34;http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz\u0026#34;, \u0026#34;d53e105ee54ea40749a09fcbcd1e9432\u0026#34;), (\u0026#34;http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz\u0026#34;, \u0026#34;9fb629c4189551a2d022fa330f9573f3\u0026#34;), (\u0026#34;http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz\u0026#34;, \u0026#34;ec29112dd5afa0611ce80d1b7f02629c\u0026#34;) ] training_file = \u0026#39;training.pt\u0026#39; test_file = \u0026#39;test.pt\u0026#39; classes = [\u0026#39;0 - zero\u0026#39;, \u0026#39;1 - one\u0026#39;, \u0026#39;2 - two\u0026#39;, \u0026#39;3 - three\u0026#39;, \u0026#39;4 - four\u0026#39;, \u0026#39;5 - five\u0026#39;, \u0026#39;6 - six\u0026#39;, \u0026#39;7 - seven\u0026#39;, \u0026#39;8 - eight\u0026#39;, \u0026#39;9 - nine\u0026#39;] @property def train_labels(self): warnings.warn(\u0026#34;train_labels has been renamed targets\u0026#34;) return self.targets @property def test_labels(self): warnings.warn(\u0026#34;test_labels has been renamed targets\u0026#34;) return self.targets @property def train_data(self): warnings.warn(\u0026#34;train_data has been renamed data\u0026#34;) return self.data @property def test_data(self): warnings.warn(\u0026#34;test_data has been renamed data\u0026#34;) return self.data ç±»MNISTç»§æ‰¿è‡ªVisionDatasetï¼Œä»åç§°å¯ä»¥çŸ¥é“VisionDatasetæ˜¯å¯¹æµè¡Œçš„è§†è§‰æ•°æ®é›†çš„æŠ½è±¡ç±»ï¼Œæˆ‘ä»å­ç±»å¼€å§‹åˆ†æï¼Œåé¢å†é˜…è¯»åˆ†æVisionDatasetç±»ã€‚MNISTç±»å‰é¢å®šä¹‰äº†å››ä¸ªå±æ€§ï¼Œå…¶ä¸­training_fileã€test_fileä¿å­˜å°†åŸå§‹Minstæ•°æ®å¤„ç†ä¹‹åçš„tensoræ ¼å¼çš„è®­ç»ƒå’Œæµ‹è¯•æ•°æ®çš„æ–‡ä»¶åã€‚å¦å¤–æœ‰å››ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯train_labelsã€test_labelsã€train_dataã€test_dataï¼Œå®ƒä»¬éƒ½è¢«@propertyæ³¨è§£æ‰€ä¿®é¥°ï¼Œ@propertyè¿™ç§æ³¨è§£è£…é¥°å™¨æ¥åˆ›å»ºåªè¯»å±æ€§ï¼Œ@propertyè£…é¥°å™¨ä¼šå°†æ–¹æ³•è½¬æ¢ä¸ºç›¸åŒåç§°çš„åªè¯»å±æ€§ï¼Œå¯ä»¥ä¸æ‰€å®šä¹‰çš„å±æ€§é…åˆä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å±æ€§è¢«ä¿®æ”¹ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡mnist.train_labelså¾—åˆ°å®ä¾‹çš„ç§æœ‰å±æ€§ï¼Œè€Œå®é™…ä¸Šè¯¥è¿‡ç¨‹è°ƒç”¨çš„æ˜¯train_labels()å‡½æ•°ã€‚ä¸Šé¢éƒ¨åˆ†é™¤äº†@propertyå…¶ä»–çš„éƒ½å¾ˆå¥½ç†è§£äº†ã€‚ä¸‹é¢æ¥çœ‹è¿™ä¸ªç±»çš„å…¶ä½™éƒ¨åˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 def __init__(self, root, train=True, transform=None, target_transform=None, download=False): super(MNIST, self).__init__(root, transform=transform, target_transform=target_transform) self.train = train # training set or test set if download: self.download() if not self._check_exists(): raise RuntimeError(\u0026#39;Dataset not found.\u0026#39; + \u0026#39; You can use download=True to download it\u0026#39;) if self.train: data_file = self.training_file else: data_file = self.test_file self.data, self.targets = torch.load(os.path.join(self.processed_folder, data_file)) def __getitem__(self, index): \u0026#34;\u0026#34;\u0026#34; Args: index (int): Index Returns: tuple: (image, target) where target is index of the target class. \u0026#34;\u0026#34;\u0026#34; img, target = self.data[index], int(self.targets[index]) # doing this so that it is consistent with all other datasets # to return a PIL Image img = Image.fromarray(img.numpy(), mode=\u0026#39;L\u0026#39;) # @3 if self.transform is not None: img = self.transform(img) # @1 if self.target_transform is not None: target = self.target_transform(target) # @2 return img, target def __len__(self): return len(self.data) __init__è¯¥ç±»çš„æ„é€ å™¨(constructor)å‡½æ•°å…¥å‚transformå’Œtarget_transformåˆ†åˆ«ä¼ å…¥å¯¹æ•°æ®å›¾åƒå’Œæ ‡ç­¾çš„é¢„å¤„ç†ï¼Œåœ¨@1å’Œ@2å¤„å¯ä»¥çœ‹åˆ°åœ¨æ¯ä¸€å¼ å›¾åƒè¿”å›å‰åˆ†åˆ«å¯¹å›¾åƒå’Œæ ‡ç­¾è¿›è¡Œç”¨æˆ·è‡ªå®šä¹‰é¢„å¤„ç†ã€‚ä¼ å…¥çš„trainå‚æ•°æ¥å†³å®šè¯¥MNISTçš„datasetä¼šè¿”å›è®­ç»ƒé›†oræµ‹è¯•é›†ä¸­çš„æ•°æ®ã€‚\n__getitem__æ ¹æ®python3ä¸­å®šä¹‰ï¼Œå¦‚æœåœ¨ç±»ä¸­å®šä¹‰äº†__getitem__()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®ä¾‹å¯¹è±¡ï¼ˆå‡è®¾ä¸ºPï¼‰å°±å¯ä»¥ä»¥P[key]å½¢å¼å–å€¼ï¼Œå½“å®ä¾‹å¯¹è±¡åšP[key]è¿ç®—æ—¶ï¼Œå°±ä¼šè°ƒç”¨ç±»ä¸­çš„__getitem__()æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€ä¹Ÿå¾ˆæœ‰ç”¨çš„ç‰¹æ€§ã€‚å…·ä½“åˆ°è¿™ä¸ªç±»çš„keyä¸ºè®­ç»ƒæ ·æœ¬çš„idexä¸ºintç±»å‹ä»£è¡¨ç¬¬å‡ ä¸ªæ•°æ®æ ·æœ¬ã€‚åœ¨**@3**å¤„å°†å›¾åƒè½¬æˆPILå›¾åƒå¯¹è±¡ï¼Œè¯¥PILå¯¹è±¡æœ€ç»ˆä¼šé€šè¿‡transformé¢„å¤„ç†ä¸ºtonsorå¯¹è±¡ã€‚ç±»MNISTå‰©ä½™éƒ¨åˆ†æœ€ä¸»è¦å°±æ˜¯ä¸‹è½½downloadå‡½æ•°ï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 @property def raw_folder(self): return os.path.join(self.root, self.__class__.__name__, \u0026#39;raw\u0026#39;) @property def processed_folder(self): return os.path.join(self.root, self.__class__.__name__, \u0026#39;processed\u0026#39;) @property def class_to_idx(self): return {_class: i for i, _class in enumerate(self.classes)} def _check_exists(self): return (os.path.exists(os.path.join(self.processed_folder, self.training_file)) and os.path.exists(os.path.join(self.processed_folder, self.test_file))) def download(self): \u0026#34;\u0026#34;\u0026#34;Download the MNIST data if it doesn\u0026#39;t exist in processed_folder already.\u0026#34;\u0026#34;\u0026#34; if self._check_exists(): # @4 return os.makedirs(self.raw_folder, exist_ok=True) os.makedirs(self.processed_folder, exist_ok=True) # download files for url, md5 in self.resources: filename = url.rpartition(\u0026#39;/\u0026#39;)[2] download_and_extract_archive(url, download_root=self.raw_folder, filename=filename, md5=md5) # process and save as torch files print(\u0026#39;Processing...\u0026#39;) training_set = ( read_image_file(os.path.join(self.raw_folder, \u0026#39;train-images-idx3-ubyte\u0026#39;)), read_label_file(os.path.join(self.raw_folder, \u0026#39;train-labels-idx1-ubyte\u0026#39;)) ) test_set = ( read_image_file(os.path.join(self.raw_folder, \u0026#39;t10k-images-idx3-ubyte\u0026#39;)), read_label_file(os.path.join(self.raw_folder, \u0026#39;t10k-labels-idx1-ubyte\u0026#39;)) ) with open(os.path.join(self.processed_folder, self.training_file), \u0026#39;wb\u0026#39;) as f: torch.save(training_set, f) with open(os.path.join(self.processed_folder, self.test_file), \u0026#39;wb\u0026#39;) as f: torch.save(test_set, f) print(\u0026#39;Done!\u0026#39;) def extra_repr(self): return \u0026#34;Split: {}\u0026#34;.format(\u0026#34;Train\u0026#34; if self.train is True else \u0026#34;Test\u0026#34;) downloadå‡½æ•°ä¸‹è½½åŸå§‹mnistæ•°æ®å¹¶å°†è®­ç»ƒå›¾åƒæ•°æ®ã€è®­ç»ƒæ ‡ç­¾æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªtraining_fileæ–‡ä»¶ä¸­ï¼Œå°†æµ‹è¯•å›¾åƒæ•°æ®ã€æµ‹è¯•æ ‡ç­¾æ•°æ®å­˜åœ¨test_fileæ–‡ä»¶ä¸­ï¼Œ@4å¤„å¯ä»¥çœ‹åˆ°å½“processed_folderç›®å½•ä¸‹å­˜åœ¨è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¸ä¼šé€šè¿‡ç½‘ç»œä¸‹è½½ï¼Œç›´æ¥è¯»å–æœ¬åœ°è®­ç»ƒæµ‹è¯•æ•°æ®æ–‡ä»¶ã€‚å¦å¤–ï¼Œåƒdownload_and_extract_archiveå‡½æ•°çš„å…·ä½“å®ç°ï¼Œå¹¶æ²¡æœ‰åœ¨ä¸Šé¢ç»™å‡ºï¼Œè¿™ä¸ªå°±æ˜¯æ›´åŠ ç»†èŠ‚çš„ä»£ç å®ç°ï¼Œæ­¤æ¬¡ä»£ç é˜…è¯»ä¼šå¿½ç•¥å¾ˆå¤šå…·ä½“ç»†èŠ‚å®ç°ï¼Œä¸“æ³¨äºå¤§çš„æ¡†æ¶å®ç°ã€‚\nMNISTç±»ç»§æ‰¿è‡ªVisionDatasetç±»ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç±»ä¸­æŠ½è±¡å‡ºäº†å“ªäº›åŠŸèƒ½ã€‚\nVisionDatasetç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 class VisionDataset(data.Dataset): _repr_indent = 4 def __init__(self, root, transforms=None, transform=None, target_transform=None): if isinstance(root, torch._six.string_classes): root = os.path.expanduser(root) self.root = root has_transforms = transforms is not None has_separate_transform = transform is not None or target_transform is not None if has_transforms and has_separate_transform: raise ValueError(\u0026#34;Only transforms or transform/target_transform can \u0026#34; \u0026#34;be passed as argument\u0026#34;) # for backwards-compatibility @5 self.transform = transform self.target_transform = target_transform if has_separate_transform: transforms = StandardTransform(transform, target_transform) # @6 self.transforms = transforms def __getitem__(self, index): raise NotImplementedError def __len__(self): raise NotImplementedError def __repr__(self): head = \u0026#34;Dataset \u0026#34; + self.__class__.__name__ body = [\u0026#34;Number of datapoints: {}\u0026#34;.format(self.__len__())] if self.root is not None: body.append(\u0026#34;Root location: {}\u0026#34;.format(self.root)) body += self.extra_repr().splitlines() if hasattr(self, \u0026#34;transforms\u0026#34;) and self.transforms is not None: body += [repr(self.transforms)] lines = [head] + [\u0026#34; \u0026#34; * self._repr_indent + line for line in body] return \u0026#39;\\n\u0026#39;.join(lines) def _format_transform_repr(self, transform, head): lines = transform.__repr__().splitlines() return ([\u0026#34;{}{}\u0026#34;.format(head, lines[0])] + [\u0026#34;{}{}\u0026#34;.format(\u0026#34; \u0026#34; * len(head), line) for line in lines[1:]]) def extra_repr(self): return \u0026#34;\u0026#34; VisionDatasetç±»ä¸­åœ¨**@5å¤„æ³¨é‡Šå‘åå…¼å®¹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ„é€ å™¨ï¼ˆconstructorï¼‰çš„å…¥å‚æœ‰transformsã€transformã€target_transformä¸‰ä¸ªé¢„å¤„ç†å˜é‡ï¼Œé‚£ä¹ˆå“ªä¸€ç§æ˜¯æ–¹å¼æ˜¯é‡æ„åæ–°å¼•å…¥çš„é¢„å¤„ç†æ–¹å¼å‘¢ï¼Ÿå…¶å®ä»@6**å¤„å°±å¯ä»¥çŸ¥é“ï¼Œä¸ºäº†å…¼å®¹transformã€target_transformä¼ å…¥æ–¹å¼ï¼Œå°†å®ƒä»¬ä¸¤ä¸ªæ„é€ ä¸ºStandardTransformï¼Œä¹Ÿå°±æ˜¯è¯´é‡æ„åï¼Œå¸Œæœ›ç”¨transforms(æ³¨æ„æœ‰ä¸ªs)å…¥å‚å–ä»£åŸæœ‰çš„æ–¹å¼ã€‚å¹¶ä¸”ï¼Œæœºæ™ºçš„æˆ‘ï¼ˆå˜¿å˜¿ï¼‰é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶çš„ä¿®æ”¹å†å²ï¼Œå¦‚ä¸‹å›¾ï¼Œå°±å¯ä»¥çœ‹åˆ°æºç ä½œè€…çš„é‡æ„çš„æ„å›¾ã€‚\nå†æ¥çœ‹çœ‹VisionDatasetç±»ä¸­__repr__()çš„ä½œç”¨ï¼Œç®€å•ç†è§£å°±æ˜¯ï¼Œpythonä¸­å®šä¹‰å½“è¾“å‡ºprint(instance)æ—¶ï¼Œç­‰åŒäºæ‰§è¡Œprint(instance.__repr__())ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡å®ç°è‡ªå·±çš„__repr__å‡½æ•°æ¥æ§åˆ¶æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ__repr__() ä¼šè¿”å›å’Œè°ƒç”¨è€…æœ‰å…³çš„ â€œç±»å+object at+å†…å­˜åœ°å€â€ä¿¡æ¯ã€‚å¦å¤–ï¼Œè‹¥è°ƒç”¨repr(instance)ä¹Ÿä¼šæ‰§è¡Œ__repr__()å‡½æ•°ã€‚\nVisionDatasetç±»ç»§æ‰¿è‡ªdata.Datasetç±»ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç±»ä¸­æœ‰å“ªäº›å±æ€§å’Œæ–¹æ³•ã€‚\nDataset torch.utils.data.datasetæ¨¡å—ä¸­å®šä¹‰äº†å‡ ä¸ªæ•°æ®ç±»ï¼Œæ˜¯å¯¹pytorchæ­å»ºç¥ç»ç½‘ç»œè®­ç»ƒå’Œæµ‹è¯•æ‰€éœ€è¦çš„æ•°æ®é›†çš„å°è£…å’ŒæŠ½è±¡ã€‚å…¶ä¸­Datasetç±»æ˜¯æ‰€æœ‰æ•°æ®é›†ç±»çš„çˆ¶ç±»ï¼Œé‚£ä¹ˆæ¥çœ‹çœ‹è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä»€ä¹ˆå†…å®¹å§~\nä¸‹é¢ä»£ç æ˜¯æˆ‘ä»pytorchæºä»£ç ä¸­æ‹·è´è¿‡æ¥çš„ï¼Œçœç•¥äº†ä¸€äº›æ¨¡å—å’Œç±»çš„å¯¼å…¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 T_co = TypeVar(\u0026#39;T_co\u0026#39;, covariant=True) T = TypeVar(\u0026#39;T\u0026#39;) class Dataset(Generic[T_co]): r\u0026#34;\u0026#34;\u0026#34;An abstract class representing a :class:`Dataset`. All datasets that represent a map from keys to data samples should subclass it. All subclasses should overwrite :meth:`__getitem__`, supporting fetching a data sample for a given key. Subclasses could also optionally overwrite :meth:`__len__`, which is expected to return the size of the dataset by many :class:`~torch.utils.data.Sampler` implementations and the default options of :class:`~torch.utils.data.DataLoader`. .. note:: :class:`~torch.utils.data.DataLoader` by default constructs a index sampler that yields integral indices. To make it work with a map-style dataset with non-integral indices/keys, a custom sampler must be provided. \u0026#34;\u0026#34;\u0026#34; def __getitem__(self, index) -\u0026gt; T_co: raise NotImplementedError def __add__(self, other: \u0026#39;Dataset[T_co]\u0026#39;) -\u0026gt; \u0026#39;ConcatDataset[T_co]\u0026#39;: return ConcatDataset([self, other]) å‰ä¸¤è¡Œå®šä¹‰ä¸¤ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ³›å‹ï¼Œè¿™ç§æ³›å‹ç¼–ç¨‹è‡ªpython3.5èµ·å¼€å§‹å¼•å…¥åˆ°pythonä¸­ï¼Œæœ‰ç‚¹ç±»ä¼¼äºc++ä¸­æ³›å‹ç¼–ç¨‹ï¼ˆä¸æ€ä¹ˆç”¨ï¼Œå¿˜å¾—å·®ä¸å¤šäº†ï¼‰ï¼Œc++ä¸­æ³›å‹ä¼šåœ¨ç¼–è¯‘å™¨åšç±»å‹æ£€æŸ¥å’Œæ›¿æ¢ï¼Œå±äºå¼ºåˆ¶ç±»å‹æ£€æŸ¥ï¼Œè€Œåœ¨pythonä¸­å› ä¸ºpythonç±»å‹éƒ½æ˜¯å¼±ç±»å‹ï¼Œæ‰€ä»¥è¿™ç§æ³›å‹ç¼–ç¨‹æ›´å¤šçš„æ˜¯ç»™é™æ€ç±»å‹æ£€æµ‹å·¥å…·æä¾›è¯´æ˜ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ä»£ç ç¼–å†™é˜¶æ®µæ­£ç¡®ä½¿ç”¨å’Œä¼ é€’pythonå˜é‡ã€‚ç›®å‰ï¼Œå…ˆå¿½ç•¥è¿™äº›æ³›å‹ç±»å‹ã€‚\nåœ¨Datasetç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªåŸºæœ¬å‡½æ•°ï¼Œ__getitem__å®ç°key-valueç»“æ„ï¼Œ__add__å®šä¹‰ä¸¤ä¸ªæ•°æ®é›†å åŠ çš„æ“ä½œã€‚\nä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹torchvisionä¸­å…¶ä»–çš„datasetã€‚\nç±»ç»§æ‰¿å›¾ï¼š\nImageFolder ä¸‹é¢æºç æ‘˜æŠ„è‡ªtorchvision.datasets.folderæ¨¡å—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 class ImageFolder(DatasetFolder): \u0026#34;\u0026#34;\u0026#34;A generic data loader where the images are arranged in this way: :: root/dog/xxx.png root/dog/xxy.png root/dog/xxz.png root/cat/123.png root/cat/nsdf3.png root/cat/asd932_.png Args: root (string): Root directory path. transform (callable, optional): A function/transform that takes in an PIL image and returns a transformed version. E.g, ``transforms.RandomCrop`` target_transform (callable, optional): A function/transform that takes in the target and transforms it. loader (callable, optional): A function to load an image given its path. is_valid_file (callable, optional): A function that takes path of an Image file and check if the file is a valid file (used to check of corrupt files) Attributes: classes (list): List of the class names. class_to_idx (dict): Dict with items (class_name, class_index). imgs (list): List of (image path, class_index) tuples \u0026#34;\u0026#34;\u0026#34; def __init__(self, root, transform=None, target_transform=None, loader=default_loader, is_valid_file=None): super(ImageFolder, self).__init__(root, loader, IMG_EXTENSIONS if is_valid_file is None else None, transform=transform, target_transform=target_transform, is_valid_file=is_valid_file) self.imgs = self.samples ImageFolderæ˜¯ä¸€ä¸ªé€šç”¨çš„å›¾åƒæ•°æ®é›†ç±»ï¼Œå®ƒè¦æ±‚æ•°æ®æŒ‰ç…§ï¼š\nroot/label01/xxx.png\nroot/label01/xxy.png\nroot/label01/xxz.png\nroot/label02/123.png\nroot/label02/nsdf3.png\nroot/label02/asd932_.png\nçš„æ ¼å¼å­˜æ”¾ã€‚è¿™æ˜¯åˆ†ç±»æ•°æ®é›†çš„æ•°æ®å’Œæ ‡ç­¾è¡¨ç¤ºçš„å¦ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ç›®å½•åå½“ä½œæ ‡ç­¾æ¥å­˜æ”¾å›¾åƒæ•°æ®ï¼Œå¯¹äºåˆ¶ä½œè‡ªå®šä¹‰æ•°æ®é›†è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚\nImageFolderç»§æ‰¿è‡ªDatasetFolderï¼Œä»åç§°å°±å¯ä»¥çŸ¥é“ImageFolderæ˜¯ç±»DatasetFolderçš„å…·ä½“åŒ–ï¼Œå®ƒåªç”¨æ¥å¤„ç†å›¾åƒæ•°æ®é›†ï¼Œä¸€èˆ¬å¤„ç†IMG_EXTENSIONS = ('.jpg', '.jpeg', '.png', '.ppm', '.bmp', '.pgm', '.tif', '.tiff', '.webp') ä¸­çš„å›¾åƒæ ¼å¼ã€‚ImageFolderè¯»å–æ•°æ®é›†åï¼Œå¾—åˆ°ä¸‰ä¸ªå±æ€§ï¼šclassesã€class_to_idxã€imgsã€‚\nSampler ç›¸å…³æºç  æºç ä½äº torch/utils/data/sampler.pyï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰Samplerç›¸å…³ç±»å‘¢ï¼Ÿæˆ‘è§‰å¾—å¯ä»¥è¿™æ ·ç†è§£ï¼šDatasetæ˜¯ä¸ºæ•°æ®çš„æ€»ä½“ï¼Œæ¯æ¬¡è®­ç»ƒæˆ–è€…æµ‹è¯•è¦ä»æ€»ä½“ä¸­éšæœºæˆ–é¡ºåºæŠ½å–ä¸€ä¸ªæ ·æœ¬æˆ–è€…ä¸€æ‰¹æ ·æœ¬ï¼Œé‚£ä¹ˆä¸åŒçš„Samplerå­ç±»å°±è¡¨ç¤ºä»æ•°æ®é›†ä¸­ä¸åŒçš„æŠ½å–æ–¹å¼ã€‚\nSamplerï¼šæ‰€æœ‰Samplerçš„çˆ¶ç±»ã€‚ SequentialSamplerï¼šé¡ºåºä¾æ¬¡è·å–ä¸‹æ ‡ã€‚ RandomSamplerï¼šä¹±åºè·å–ä¸‹æ ‡ã€‚ SubsetRandomSamplerï¼šæŸä¸ªå­é›†å†…ä¹±åºè·å–ä¸‹æ ‡ã€‚ WeightedRandomSamplerï¼šä¸ºæ¯ä¸ªæ ·æœ¬è®¾ç½®æƒé‡ï¼Œæƒé‡å¤§è¡¨ç¤ºè·å–æ¦‚ç‡é«˜ã€‚ BatchSamplerï¼šå³å°†è‹¥å¹²ä¸ªæ ·æœ¬å½¢æˆä¸€ä¸ªbatchã€‚ Sampler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 class Sampler(Generic[T_co]): r\u0026#34;\u0026#34;\u0026#34;Base class for all Samplers. Every Sampler subclass has to provide an :meth:`__iter__` method, providing a way to iterate over indices of dataset elements, and a :meth:`__len__` method that returns the length of the returned iterators. .. note:: The :meth:`__len__` method isn\u0026#39;t strictly required by :class:`~torch.utils.data.DataLoader`, but is expected in any calculation involving the length of a :class:`~torch.utils.data.DataLoader`. \u0026#34;\u0026#34;\u0026#34; def __init__(self, data_source: Optional[Sized]) -\u0026gt; None: pass def __iter__(self) -\u0026gt; Iterator[T_co]: raise NotImplementedError # NOTE [ Lack of Default `__len__` in Python Abstract Base Classes ] # # Many times we have an abstract class representing a collection/iterable of # data, e.g., `torch.utils.data.Sampler`, with its subclasses optionally # implementing a `__len__` method. In such cases, we must make sure to not # provide a default implementation, because both straightforward default # implementations have their issues: # # + `return NotImplemented`: # Calling `len(subclass_instance)` raises: # TypeError: \u0026#39;NotImplementedType\u0026#39; object cannot be interpreted as an integer # # + `raise NotImplementedError()`: # This prevents triggering some fallback behavior. E.g., the built-in # `list(X)` tries to call `len(X)` first, and executes a different code # path if the method is not found or `NotImplemented` is returned, while # raising an `NotImplementedError` will propagate and and make the call # fail where it could have use `__iter__` to complete the call. # # Thus, the only two sensible things to do are # # + **not** provide a default `__len__`. # # + raise a `TypeError` instead, which is what Python uses when users call # a method that is not defined on an object. # (@ssnl verifies that this works on at least Python 3.7.) Samplerç±»æ˜¯æ‰€æœ‰Samplerçš„çˆ¶ç±»ï¼Œç±»ä¸­__init__è¯¥ç±»çš„æ„é€ å™¨(constructor)å‡½æ•°ï¼Œ__iter__æä¾›è¿­ä»£æ•°æ®é›†å…ƒç´ ç´¢å¼•çš„æ–¹æ³•ã€‚\nDataLoaderç›¸å…³æºç  æºç ä½äºpytorchæºç ç›®å½•çš„torch/utils/data/dataloader.pyï¼ŒDataLoaderç±»éå¸¸é‡è¦ï¼Œå®ƒæ˜¯æˆ‘ä»¬ä½œä¸ºæ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒä¸å¼€å‘è¿‡ç¨‹ä¸­ç›´æ¥ç”¨åˆ°çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡å®ƒæ¥å°†æˆ‘ä»¬çš„æ•°æ®é›†æ•°æ®åŠ è½½åˆ°ç¨‹åºä¸­ï¼Œé€šå¸¸æ˜¯ç”¨ä¸€ä¸ªforå¾ªç¯éå†å®ƒï¼ŒDataLoaderç±»ä¾èµ–Datasetç±»å’ŒSamplerç±»åœ¨å†…éƒ¨ä¸ºæˆ‘ä»¬å®ç°äº†å¾ˆå¤šæ•°æ®é›†éå†çš„æ–¹å¼ï¼Œæ–¹ä¾¿äºå¤šç§åœºæ™¯ä¸‹ä½¿ç”¨ã€‚\nåˆ†æDataLoaderç±»ä¹‹å‰ï¼Œæˆ‘å…ˆåœ¨ä¹‹å‰å­¦ä¹ pytorchçš„å­¦ä¹ ææ–™ä¸­ï¼Œæ‘˜æŠ„äº†ä¸€éƒ¨åˆ†ä½¿ç”¨DataLoaderçš„ä»£ç ï¼Œå…ˆçœ‹çœ‹å…·ä½“å¦‚ä½•ä½¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 trainset = torchvision.datasets.CIFAR10(root=\u0026#39;./data\u0026#39;, train=True, download=True, transform=transform) trainloader = torch.utils.data.DataLoader(trainset, batch_size=4, shuffle=True, num_workers=2) # ... çœç•¥éƒ¨åˆ†ä»£ç  # è®­ç»ƒç½‘ç»œ for epoch in range(2): # loop over the dataset multiple times running_loss = 0.0 for i, data in enumerate(trainloader, 0): # get the inputs inputs, labels = data # zero the parameter gradients optimizer.zero_grad() # forward + backward + optimize outputs = net(inputs) loss = criterion(outputs, labels) loss.backward() optimizer.step() # print statistics running_loss += loss.item() if i % 2000 == 1999: # print every 2000 mini-batches print(\u0026#39;[%d, %5d] loss: %.3f\u0026#39; % (epoch + 1, i + 1, running_loss / 2000)) running_loss = 0.0 print(\u0026#39;Finished Training\u0026#39;) ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„è®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨Datasetå’ŒDataLoaderå¾ˆæ–¹ä¾¿åœ°ä¸ºæ¨¡å‹è®­ç»ƒæä¾›æ•°æ®åŠ è½½ã€æ‰“ä¹±ã€é¢„å¤„ç†ã€ç”šè‡³æ˜¯å¤šè¿›ç¨‹åŠ è½½ã€‚ä½œä¸ºpytorchçš„ä½¿ç”¨è€…ï¼Œå‡†ç¡®è¯¦ç»†çš„äº†è§£pytorchå„ç§åŒ…ï¼Œå¯ä»¥ç†Ÿç»ƒå¿«é€Ÿå¼€å‘æˆ‘ä»¬è‡ªå·±çš„è®­ç»ƒç¨‹åºï¼Œä¸‹é¢å…ˆå…·ä½“åˆ†æä¸‹DataLoaderçš„æ¥å£ã€‚\næºç æ¯”è¾ƒé•¿ï¼Œæˆ‘åˆ†æè¿™æ ·æ¯”è¾ƒé•¿çš„æºç ï¼Œå°†æ¯”è¾ƒç®€å•éƒ¨åˆ†çš„ä»£ç è§£é‡Šç›´æ¥å†™åœ¨æºç é‡Œï¼Œä½œä¸ºæ³¨é‡Šï¼›å°†å¤æ‚éƒ¨åˆ†é€šè¿‡@ç¬¦å·æ ‡æ³¨ï¼Œç„¶ååœ¨æºç åé¢éƒ¨åˆ†åˆ†æã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 class DataLoader(Generic[T_co]): r\u0026#34;\u0026#34;\u0026#34; åŸæ³¨é‡Šçœç•¥ã€‚ \u0026#34;\u0026#34;\u0026#34; dataset: Dataset[T_co] batch_size: Optional[int] num_workers: int pin_memory: bool drop_last: bool timeout: float sampler: Sampler prefetch_factor: int _iterator : Optional[\u0026#39;_BaseDataLoaderIter\u0026#39;] __initialized = False def __init__(self, dataset: Dataset[T_co], batch_size: Optional[int] = 1, shuffle: bool = False, sampler: Optional[Sampler[int]] = None, batch_sampler: Optional[Sampler[Sequence[int]]] = None, num_workers: int = 0, collate_fn: _collate_fn_t = None, pin_memory: bool = False, drop_last: bool = False, timeout: float = 0, worker_init_fn: _worker_init_fn_t = None, multiprocessing_context=None, generator=None, *, prefetch_factor: int = 2, persistent_workers: bool = False): torch._C._log_api_usage_once(\u0026#34;python.data_loader\u0026#34;) # type: ignore if num_workers \u0026lt; 0: raise ValueError(\u0026#39;num_workers option should be non-negative; \u0026#39; \u0026#39;use num_workers=0 to disable multiprocessing.\u0026#39;) if timeout \u0026lt; 0: raise ValueError(\u0026#39;timeout option should be non-negative\u0026#39;) if num_workers == 0 and prefetch_factor != 2: raise ValueError(\u0026#39;prefetch_factor option could only be specified in multiprocessing.\u0026#39; \u0026#39;let num_workers \u0026gt; 0 to enable multiprocessing.\u0026#39;) assert prefetch_factor \u0026gt; 0 if persistent_workers and num_workers == 0: raise ValueError(\u0026#39;persistent_workers option needs num_workers \u0026gt; 0\u0026#39;) self.dataset = dataset self.num_workers = num_workers self.prefetch_factor = prefetch_factor self.pin_memory = pin_memory self.timeout = timeout self.worker_init_fn = worker_init_fn self.multiprocessing_context = multiprocessing_context # Arg-check dataset related before checking samplers because we want to # tell users that iterable-style datasets are incompatible with custom # samplers first, so that they don\u0026#39;t learn that this combo doesn\u0026#39;t work # after spending time fixing the custom sampler errors. if isinstance(dataset, IterableDataset): self._dataset_kind = _DatasetKind.Iterable # NOTE [ Custom Samplers and IterableDataset ] # # `IterableDataset` does not support custom `batch_sampler` or # `sampler` since the key is irrelevant (unless we support # generator-style dataset one day...). # # For `sampler`, we always create a dummy sampler. This is an # infinite sampler even when the dataset may have an implemented # finite `__len__` because in multi-process data loading, naive # settings will return duplicated data (which may be desired), and # thus using a sampler with length matching that of dataset will # cause data lost (you may have duplicates of the first couple # batches, but never see anything afterwards). Therefore, # `Iterabledataset` always uses an infinite sampler, an instance of # `_InfiniteConstantSampler` defined above. # # A custom `batch_sampler` essentially only controls the batch size. # However, it is unclear how useful it would be since an iterable-style # dataset can handle that within itself. Moreover, it is pointless # in multi-process data loading as the assignment order of batches # to workers is an implementation detail so users can not control # how to batchify each worker\u0026#39;s iterable. Thus, we disable this # option. If this turns out to be useful in future, we can re-enable # this, and support custom samplers that specify the assignments to # specific workers. if shuffle is not False: raise ValueError( \u0026#34;DataLoader with IterableDataset: expected unspecified \u0026#34; \u0026#34;shuffle option, but got shuffle={}\u0026#34;.format(shuffle)) elif sampler is not None: # See NOTE [ Custom Samplers and IterableDataset ] raise ValueError( \u0026#34;DataLoader with IterableDataset: expected unspecified \u0026#34; \u0026#34;sampler option, but got sampler={}\u0026#34;.format(sampler)) elif batch_sampler is not None: # See NOTE [ Custom Samplers and IterableDataset ] raise ValueError( \u0026#34;DataLoader with IterableDataset: expected unspecified \u0026#34; \u0026#34;batch_sampler option, but got batch_sampler={}\u0026#34;.format(batch_sampler)) else: self._dataset_kind = _DatasetKind.Map if sampler is not None and shuffle: raise ValueError(\u0026#39;sampler option is mutually exclusive with \u0026#39; \u0026#39;shuffle\u0026#39;) if batch_sampler is not None: # auto_collation with custom batch_sampler if batch_size != 1 or shuffle or sampler is not None or drop_last: raise ValueError(\u0026#39;batch_sampler option is mutually exclusive \u0026#39; \u0026#39;with batch_size, shuffle, sampler, and \u0026#39; \u0026#39;drop_last\u0026#39;) batch_size = None drop_last = False elif batch_size is None: # no auto_collation if drop_last: raise ValueError(\u0026#39;batch_size=None option disables auto-batching \u0026#39; \u0026#39;and is mutually exclusive with drop_last\u0026#39;) if sampler is None: # give default samplers if self._dataset_kind == _DatasetKind.Iterable: # See NOTE [ Custom Samplers and IterableDataset ] sampler = _InfiniteConstantSampler() else: # map-style if shuffle: # Cannot statically verify that dataset is Sized # Somewhat related: see NOTE [ Lack of Default `__len__` in Python Abstract Base Classes ] sampler = RandomSampler(dataset, generator=generator) # type: ignore else: sampler = SequentialSampler(dataset) if batch_size is not None and batch_sampler is None: # auto_collation without custom batch_sampler batch_sampler = BatchSampler(sampler, batch_size, drop_last) self.batch_size = batch_size self.drop_last = drop_last self.sampler = sampler self.batch_sampler = batch_sampler self.generator = generator if collate_fn is None: if self._auto_collation: collate_fn = _utils.collate.default_collate else: collate_fn = _utils.collate.default_convert self.collate_fn = collate_fn self.persistent_workers = persistent_workers self.__initialized = True self._IterableDataset_len_called = None # See NOTE [ IterableDataset and __len__ ] self._iterator = None def _get_iterator(self) -\u0026gt; \u0026#39;_BaseDataLoaderIter\u0026#39;: if self.num_workers == 0: return _SingleProcessDataLoaderIter(self) else: return _MultiProcessingDataLoaderIter(self) @property def multiprocessing_context(self): return self.__multiprocessing_context @multiprocessing_context.setter def multiprocessing_context(self, multiprocessing_context): if multiprocessing_context is not None: if self.num_workers \u0026gt; 0: if not multiprocessing._supports_context: raise ValueError(\u0026#39;multiprocessing_context relies on Python \u0026gt;= 3.4, with \u0026#39; \u0026#39;support for different start methods\u0026#39;) if isinstance(multiprocessing_context, string_classes): valid_start_methods = multiprocessing.get_all_start_methods() if multiprocessing_context not in valid_start_methods: raise ValueError( (\u0026#39;multiprocessing_context option \u0026#39; \u0026#39;should specify a valid start method in {!r}, but got \u0026#39; \u0026#39;multiprocessing_context={!r}\u0026#39;).format(valid_start_methods, multiprocessing_context)) # error: Argument 1 to \u0026#34;get_context\u0026#34; has incompatible type \u0026#34;Union[str, bytes]\u0026#34;; expected \u0026#34;str\u0026#34; [arg-type] multiprocessing_context = multiprocessing.get_context(multiprocessing_context) # type: ignore if not isinstance(multiprocessing_context, python_multiprocessing.context.BaseContext): raise TypeError((\u0026#39;multiprocessing_context option should be a valid context \u0026#39; \u0026#39;object or a string specifying the start method, but got \u0026#39; \u0026#39;multiprocessing_context={}\u0026#39;).format(multiprocessing_context)) else: raise ValueError((\u0026#39;multiprocessing_context can only be used with \u0026#39; \u0026#39;multi-process loading (num_workers \u0026gt; 0), but got \u0026#39; \u0026#39;num_workers={}\u0026#39;).format(self.num_workers)) self.__multiprocessing_context = multiprocessing_context def __setattr__(self, attr, val): if self.__initialized and attr in ( \u0026#39;batch_size\u0026#39;, \u0026#39;batch_sampler\u0026#39;, \u0026#39;sampler\u0026#39;, \u0026#39;drop_last\u0026#39;, \u0026#39;dataset\u0026#39;, \u0026#39;persistent_workers\u0026#39;): raise ValueError(\u0026#39;{} attribute should not be set after {} is \u0026#39; \u0026#39;initialized\u0026#39;.format(attr, self.__class__.__name__)) super(DataLoader, self).__setattr__(attr, val) # We quote \u0026#39;_BaseDataLoaderIter\u0026#39; since it isn\u0026#39;t defined yet and the definition can\u0026#39;t be moved up # since \u0026#39;_BaseDataLoaderIter\u0026#39; references \u0026#39;DataLoader\u0026#39;. def __iter__(self) -\u0026gt; \u0026#39;_BaseDataLoaderIter\u0026#39;: # When using a single worker the returned iterator should be # created everytime to avoid reseting its state # However, in the case of a multiple workers iterator # the iterator is only created once in the lifetime of the # DataLoader object so that workers can be reused if self.persistent_workers and self.num_workers \u0026gt; 0: if self._iterator is None: self._iterator = self._get_iterator() else: self._iterator._reset(self) return self._iterator else: return self._get_iterator() @property def _auto_collation(self): return self.batch_sampler is not None @property def _index_sampler(self): # The actual sampler used for generating indices for `_DatasetFetcher` # (see _utils/fetch.py) to read data at each time. This would be # `.batch_sampler` if in auto-collation mode, and `.sampler` otherwise. # We can\u0026#39;t change `.sampler` and `.batch_sampler` attributes for BC # reasons. if self._auto_collation: return self.batch_sampler else: return self.sampler def __len__(self) -\u0026gt; int: if self._dataset_kind == _DatasetKind.Iterable: # NOTE [ IterableDataset and __len__ ] # # For `IterableDataset`, `__len__` could be inaccurate when one naively # does multi-processing data loading, since the samples will be duplicated. # However, no real use case should be actually using that behavior, so # it should count as a user error. We should generally trust user # code to do the proper thing (e.g., configure each replica differently # in `__iter__`), and give us the correct `__len__` if they choose to # implement it (this will still throw if the dataset does not implement # a `__len__`). # # To provide a further warning, we track if `__len__` was called on the # `DataLoader`, save the returned value in `self._len_called`, and warn # if the iterator ends up yielding more than this number of samples. # Cannot statically verify that dataset is Sized length = self._IterableDataset_len_called = len(self.dataset) # type: ignore if self.batch_size is not None: # IterableDataset doesn\u0026#39;t allow custom sampler or batch_sampler from math import ceil if self.drop_last: length = length // self.batch_size else: length = ceil(length / self.batch_size) return length else: return len(self._index_sampler) ","date":"2020-12-05T23:21:34Z","permalink":"https://qiyueliuhuo.github.io/posts/pytorch%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-%E4%B8%80/","title":"Pytorchæºç é˜…è¯»(ä¸€)ï¼šDatasetå’ŒDataLoader"},{"content":"\nå‰è¨€ æ”¯æŒå‘é‡æœºå³Support Vector Machineï¼Œç®€ç§°SVMã€‚æˆ‘æœ€å¼€å§‹å¬è¯´è¿™ä¸ªæœºå™¨çš„æ—¶å€™ï¼Œä¸€å¤´é›¾æ°´ï¼Œâ€œæ”¯æŒâ€ï¼Œâ€œå‘é‡â€ï¼Œâ€œæœºâ€ï¼Œè¿™ä¸‰ä¸ªè¯ç»„åˆåœ¨ä¸€èµ·è®©æˆ‘åœ¨ä¸€å¼€å§‹è§‰å¾—è¿™ä¸ªä¸œè¥¿å¥½æŠ½è±¡ã€‚é¦–å…ˆï¼ŒSVMå®é™…ä¸Šæ˜¯ä¸€ä¸ªäºŒåˆ†ç±»æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è§£å†³å›å½’é—®é¢˜ã€‚äº†è§£è¿‡ä¸€äº›åŸç†åï¼Œæˆ‘è§‰å¾—è¿™ç§æ¨¡å‹ï¼ˆæ–¹æ³•ï¼‰è¢«ç§°ä¸ºVector Support Machineæ›´å¥½ä¸€äº›ï¼Œç®€å•ä¸”ä¸ä¸¥è°¨çš„ç†è§£æ˜¯: è¿™ç§æ¨¡å‹é€šè¿‡æŸäº›å‘é‡ï¼ˆé«˜ç»´ç©ºé—´ä¸­çš„ç‚¹ï¼‰æ”¯æŒï¼ˆæ”¯æ’‘ï¼‰è€Œå½¢æˆçš„ä¸€ç§æœºå™¨ï¼ˆæ–¹æ³•ï¼‰ï¼Œæˆ–è€…ç§°ä¹‹ä¸ºæ¨¡å‹ã€‚\nå¼•ç”¨Free Mindåœ¨ä»‹ç»SVMä¸­ä¸€å¥è¯ï¼šâ€œSVM ä¸€ç›´è¢«è®¤ä¸ºæ˜¯æ•ˆæœæœ€å¥½çš„ç°æˆå¯ç”¨çš„åˆ†ç±»ç®—æ³•ä¹‹ä¸€ï¼ˆå…¶å®æœ‰å¾ˆå¤šäººéƒ½ç›¸ä¿¡ï¼Œâ€œä¹‹ä¸€â€æ˜¯å¯ä»¥å»æ‰çš„ï¼‰â€ã€‚åˆšå¼€å§‹æ¥è§¦æœºå™¨å­¦ä¹ ï¼ˆå¤§åŠå¹´ğŸ¤¦â€â™‚ï¸ï¼‰ï¼Œç›®å‰æ²¡æœ‰åšå¤ªå¤šå®è·µï¼Œå¹¶ä¸æ¸…æ¥šSVMçš„æ•ˆæœæœ‰å¤šå¥½ï¼Œåé¢åº”è¯¥å¤šäº†è§£äº›SVMçš„å®é™…åº”ç”¨ã€‚\næ”¯æŒå‘é‡æœºåŸç† ç°åœ¨æœ‰ä¸€äº›æ•°æ®$\\mathbf{x}={\\boldsymbol{x_1}, \\boldsymbol{x_2}, \\boldsymbol{x_3}, \u0026hellip;, \\boldsymbol{x_n}}$ï¼Œè¿™äº›æ•°æ®çš„æ ‡ç­¾ä¹Ÿå·²çŸ¥$\\mathbf{y}={y_1, y_2, y_3, \u0026hellip;, y_n}$ã€‚å…¶ä¸­æ¯ä¸ªæ•°æ®$\\boldsymbol{x_i}$ä¸ºæœ‰ä¸¤ä¸ªç‰¹å¾å€¼ï¼Œå³$\\boldsymbol{x_i} = (x_{i1}, x_{i2})$ï¼Œä¸ºäºŒç»´ç©ºé—´ä¸Šçš„ä¸€ç‚¹ï¼Œæ ‡ç­¾$y_i\\in{-1, +1}$ï¼Œä¸€èˆ¬æˆ‘ä»¬å°†$+1$ç§°ä½œæ­£ç±»ï¼Œå°†$-1$ç§°ä¸ºè´Ÿç±»ã€‚è¿™é‡Œå‡è®¾$\\boldsymbol{x_i}$åªæœ‰ä¸¤ä¸ªç‰¹å¾å€¼æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨äºŒç»´åæ ‡ä¸­å°†æ•°æ®è¡¨ç¤ºå‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ã€‚æ›´ä¸€èˆ¬åœ°ï¼Œ$\\boldsymbol{x}_{i} \\in \\mathbb{R}^{n}$ï¼Œå³æ¯ä¸ªæ•°æ®æœ‰$n$ä¸ªç‰¹å¾å€¼ï¼Œæ¯ä¸ªæ•°æ®éƒ½æ˜¯$n$ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ã€‚\nä¸‹å›¾åœ¨äºŒç»´åæ ‡ç³»ä¸­å°†è¿™äº›æ•°æ®è¡¨ç¤ºå‡ºæ¥ï¼Œå…¶ä¸­çº¢è‰²ä»£è¡¨æ­£ç±»ï¼Œè“è‰²ä»£è¡¨è´Ÿç±»ã€‚ å¯èƒ½æœ‰äººè¦é—®äº†ï¼šä¸ºä»€ä¹ˆè¿™äº›ç‚¹åˆ†å¸ƒçš„å¾ˆæœ‰è§„å¾‹ï¼ˆç‰¹ç‚¹ï¼‰ï¼Ÿå³æ­£ç±»çš„è¿™äº›çº¢è‰²ç‚¹éƒ½åˆ†å¸ƒåœ¨ä¸€è¾¹ï¼Œè€Œè“è‰²çš„è¿™äº›æ•°æ®ç‚¹åˆ†å¸ƒåœ¨å¦å¤–ä¸€è¾¹ã€‚çš„ç¡®ï¼Œç°å®ä¸­çš„æ•°æ®å¾€å¾€ä¸ä¼šè¿™ä¹ˆç†æƒ³ï¼Œå¯èƒ½ä¼šæ˜¯ä¸¤éƒ¨åˆ†æ•°æ®äº¤å‰åœ¨ä¸€èµ·ï¼Œå¹¶ä¸æ˜¯ç›´è§‚ä¸Šé‚£ä¹ˆæ˜æ˜¾çš„åˆ†ä¸ºä¸¤è¾¹ï¼Œè¿™é‡Œæˆ‘ä»¬ä»æœ€ç®€å•çš„åŸæ•°æ®çº¿æ€§å¯åˆ†çš„é—®é¢˜å…¥æ‰‹ï¼Œæ‰€ä»¥å…ˆå‡è®¾æ•°æ®æ¯”è¾ƒç†æƒ³ã€‚ä¹‹åæˆ‘ä»¬ä¼šæ…¢æ…¢ä»‹ç»ä¸€äº›å¤æ‚æ•°æ®çš„æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚\né‚£ä¹ˆå¦‚æœæœ‰ä¸Šå›¾ä¸€äº›è¾ƒä¸ºç†æƒ³çš„æ•°æ®ï¼Œéœ€è¦å¯»æ‰¾åˆ°ä¸€ä¸ªçº¿æ€§è¾¹ç•Œå°†å®ƒä»¬åˆ’åˆ†å¼€æ¥ï¼Œå¦‚ä½•æ‰¾åˆ°è¿™ä¸ªçº¿æ€§è¾¹ç•Œå‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å¤§æ¦‚å°å­¦ç”Ÿä¹Ÿèƒ½åšåˆ°ã€‚å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åœ¨çº¢è‰²æ•°æ®ç‚¹å’Œè“è‰²æ•°æ®ç‚¹ä¹‹é—´ç”»ä¸€æ¡ç›´çº¿ï¼Œä½¿å¾—ä¸¤ç±»ç‚¹åˆ†å‰²åˆ°ç›´çº¿çš„ä¸¤è¾¹ï¼Œè¿™æ¡ç›´çº¿æ˜¾ç„¶å°±æ˜¯ä¸€ä¸ªçº¿æ€§è¾¹ç•Œï¼Œå¹¶ä¸”å¯ä»¥æ­£ç¡®åœ°å°†æ‰€ç»™çš„æ•°æ®é›†åˆ†ä¸ºä¸¤ç±»ã€‚ ç„¶è€Œï¼Œæˆ–è®¸ä½ æƒ³è¯´ä½ ç”»å‡ºæ¥çš„ç›´çº¿å’Œä¸Šå›¾ä¸ä¸€æ ·ï¼Œå®ƒæˆ–è®¸æ˜¯ä¸‹å›¾ä¸­çš„æŸä¸€æ¡ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°è¿™æ ·çš„ç›´çº¿æœ‰æ— æ•°æ¡ã€‚ç”¨è¿™äº›ç›´çº¿å¯¹äºå·²çŸ¥çš„ä¸Šå›¾æ•°æ®åˆ†ç±»ï¼Œå®ƒä»¬çš„ç¡®éƒ½å¯ä»¥äº§ç”Ÿæ­£ç¡®çš„åˆ†ç±»ç»“æœã€‚ç„¶è€Œï¼Œæœºå™¨å­¦ä¹ å»ºæ¨¡çš„ç›®çš„å¹¶ä¸æ˜¯å¯¹äºå·²çŸ¥ç‚¹ï¼ˆæ ‡ç­¾å·²çŸ¥ï¼‰æˆåŠŸåˆ†ç±»å³å¯ï¼Œå­¦ä¹ çš„ç›®çš„æ˜¯éœ€è¦å¯¹äºæœªçŸ¥æƒ…å†µä¹Ÿèƒ½å¤Ÿé€‚ç”¨ï¼Œå³å¯¹äºä¸€ä¸ªæœªçŸ¥åˆ†ç±»çš„æ•°æ®ç‚¹ï¼Œæˆ‘ä»¬çš„å»ºç«‹çš„æ¨¡å‹éœ€è¦å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ•°æ®ç‚¹å®ƒæ˜¯å±äºå“ªä¸€ç±»çš„ï¼Œæ­£ç±»æˆ–è€…æ˜¯è´Ÿç±»ã€‚æœºå™¨å­¦ä¹ å»ºç«‹çš„æ¨¡å‹è¯•å›¾å»å¯»æ‰¾æ•°æ®ä¸­ä¸€èˆ¬çš„è§„å¾‹ï¼Œè€Œä¸æ˜¯å¯¹äºå·²æœ‰æ•°æ®æ­£ç¡®çš„è¡¨ç¤ºã€‚\nå‡å¦‚å¯¹äºä¸€ä¸ªæ–°çš„æœªçŸ¥åˆ†ç±»çš„æ•°æ®ï¼Œå®ƒåœ¨äºŒç»´åæ ‡ä½ç½®ä¸ºXæ‰€åœ¨çš„ä½ç½®å¦‚ä¸‹å›¾ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸Šé¢å¾—åˆ°çš„è¿™äº›ç›´çº¿å¯¹æ–°çš„æ•°æ®Xåˆ†ç±»ï¼Œ$l_1$ç›´çº¿å’Œå…¶ä»–ç›´çº¿åˆ†ç±»çš„ç»“æœå¹¶ä¸ä¸€æ ·ï¼Œå®ƒå¤„åœ¨$l_1$å³ä¾§ï¼Œå°†å®ƒæ ‡è®°ä¸ºè´Ÿç±»ï¼›å®ƒå¤„åœ¨å…¶ä»–ç›´çº¿çš„å·¦ä¾§ï¼Œå°†å®ƒæ ‡è®°ä¸ºæ­£ç±»ã€‚ä¸åŒçš„çº¿æ€§æ¨¡å‹å¯¹äºæ–°çš„æ•°æ®çš„åˆ†ç±»ç»“æœä¸ä¸€æ ·ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è¡¡é‡è¿™äº›ç›´çº¿çš„å¥½åï¼Œå“ªä¸€ä¸ªç›´çº¿æœ€å¥½ï¼Œæ›´èƒ½ä»£è¡¨è¿™äº›æ•°æ®ä¸­çš„ä¸€èˆ¬è§„å¾‹å‘¢ï¼Ÿ\nSVMç»™å‡ºçš„ç­”æ¡ˆæ˜¯ï¼šæ±‚è§£èƒ½å¤Ÿæ­£ç¡®åˆ’åˆ†è®­ç»ƒæ•°æ®é›†å¹¶ä¸”å‡ ä½•é—´éš”æœ€å¤§çš„åˆ†ç¦»è¶…å¹³é¢ã€‚ è¿™ä¹Ÿæ˜¯SVMå­¦ä¹ çš„åŸºæœ¬æƒ³æ³•ã€‚\nè¿™é‡Œçš„å‡ ä½•é—´éš”æœ€å¤§å«ä¹‰æ˜¯ï¼šåœ¨æ— æ•°æ­£ç¡®åˆ’åˆ†æ•°æ®é›†çš„åˆ†ç¦»è¶…å¹³é¢ä¸­ï¼Œæ‰¾åˆ°è¿™æ ·çš„è¶…å¹³é¢ï¼Œè¯¥è¶…å¹³é¢ç¦»æœ€è¿‘çš„æ•°æ®ç‚¹çš„è·ç¦»æœ€å¤§ã€‚ç”¨æ•°å­¦è¯­è¨€æè¿°ä¸ºä¸‹é¢çš„çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š $$ \\begin{array}{ll} \\max \\limits_{\\boldsymbol{w}, \\boldsymbol{b}} \u0026amp; \\gamma \\ \\text { s.t. } \u0026amp; y_{i}\\left(\\frac{\\boldsymbol{w}}{|\\boldsymbol{w}|} \\cdot \\boldsymbol{x_{i}}+\\frac{b}{|\\boldsymbol{w}|}\\right) \\geqslant \\gamma, \\quad i=1,2, \\cdots, N \\end{array} $$ å…¶ä¸­ï¼Œç¬¬ä¸€è¡Œä»£è¡¨ä¼˜åŒ–é—®é¢˜ä¸­ç›®æ ‡å‡½æ•°ï¼Œç¬¬äºŒè¡Œä»£è¡¨çº¦æŸæ¡ä»¶ï¼Œ$s.t.$æŒ‡çš„æ˜¯subject to ï¼Œå—é™äºã€‚\nè¦ç†è§£ä¸Šé¢çš„å¼å­ï¼Œè®©æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹è¶…å¹³é¢çš„å…¬å¼ä»¥åŠç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»å…¬å¼ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« çš„æ¨å¯¼è¶…å¹³é¢å…¬å¼åŠç‚¹åˆ°è¶…å¹³é¢è·ç¦»ï¼Œè¶…å¹³é¢çš„å…¬å¼ä¸ºï¼š $$ \\boldsymbol{w}^{T} \\boldsymbol{x}+b=0 $$ å…¶ä¸­ï¼Œ$w$æ˜¯è¶…å¹³é¢çš„æ³•å‘é‡ï¼Œæ­¤å¤„ä¸ºåˆ—å‘é‡ï¼Œç®€å•çš„ç†è§£ä¸ºï¼š$w^{T} x$ä¸ºæ³•å‘é‡å’Œè¶…å¹³é¢ä¸­çš„ç‚¹å‘é‡ï¼ˆåŸç‚¹åˆ°è¶…å¹³é¢ç‚¹å½¢æˆçš„å‘é‡ï¼‰çš„å†…ç§¯ï¼Œè¯¥å†…ç§¯ä»£è¡¨ç‚¹å‘é‡åœ¨æ³•å‘é‡ä¸ŠæŠ•å½±çš„è·ç¦»ï¼›å¦‚æœå¯¹è¶…ç©ºé—´ä¸­çš„è‡ªç”±ç‚¹æ–½åŠ ä¸€ä¸ªæ³•å‘é‡æŠ•å½±è·ç¦»ä¸º$-b$æ—¶çš„æ‹˜æŸæ¡ä»¶ï¼Œé‚£ä¹ˆæ‰€æœ‰æ»¡è¶³çº¦æŸæ¡ä»¶çš„æ‰€æœ‰ç‚¹å¤„äºè¶…å¹³é¢å†…ã€‚\nè¶…ç©ºé—´ä¸­ï¼Œç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»å…¬å¼ä¸ºï¼š $$ d=\\frac{|\\boldsymbol{w}^{T} \\boldsymbol{x}+b|}{|\\boldsymbol{w}|} $$ å…¶ä¸­$|\\boldsymbol{w}|$ä»£è¡¨$\\boldsymbol{w}$å‘é‡çš„ç¬¬äºŒèŒƒæ•°ï¼Œä¹Ÿç§°æ¬§å‡ é‡Œå¾—èŒƒæ•°ï¼ˆè·ç¦»ï¼‰ï¼›å…¶ä¸¥æ ¼è¡¨ç¤ºåº”è¯¥ä¸º$|\\boldsymbol{w}|_2$ï¼Œå› ä¸ºæ¯”è¾ƒå¸¸ç”¨å¸¸å¸¸çœç•¥å³ä¸‹è§’æ ‡2ã€‚\nè®©æˆ‘ä»¬å›åˆ°ä¸Šé¢çš„SVMçº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š $$ \\begin{array}{ll} \\max \\limits_{\\boldsymbol{w}, \\boldsymbol{b}} \u0026amp; \\gamma \u0026amp;\u0026amp; (1) \\ \\text { s.t. } \u0026amp; y_{i}\\left(\\frac{\\boldsymbol{w}}{|\\boldsymbol{w}|} \\cdot \\boldsymbol{x_{i}}+\\frac{b}{|\\boldsymbol{w}|}\\right) \\geqslant \\gamma, \\quad i=1,2, \\cdots, N \u0026amp;\u0026amp; (2) \\end{array} $$ $\\gamma$ä»£è¡¨çš„æ˜¯æ•°æ®ç‚¹åˆ°è¶…å¹³é¢çš„å‡ ä½•è·ç¦»ï¼Œ$(2)$å¼æ‹¬å·å†…ä»£è¡¨çš„æ˜¯æ¯ä¸ªç‚¹åˆ°è¶…å¹³é¢çš„å‡ ä½•è·ç¦»ï¼Œç„¶è€Œï¼Œä¸åŒäºä¸Šé¢çš„è·ç¦»å…¬å¼ï¼Œè¯¥å…¬å¼æ²¡æœ‰åŠ ç»å¯¹å€¼ï¼Œæ‹¬å·éƒ¨åˆ†çš„å€¼å¯æ­£å¯è´Ÿï¼Œæ˜¾ç„¶ï¼Œæ­£è´Ÿå¯¹åº”äºè¶…å¹³é¢çš„ä¸¤ä¾§ï¼Œä¸€å¼€å§‹æˆ‘ä»¬æœ‰çº¦å®šæ ‡ç­¾$y_i\\in{-1, +1}$ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬çº¦å®šæ‹¬å·éƒ¨åˆ†å€¼ä¸ºè´Ÿçš„é‚£ä¸€ä¾§ä»£è¡¨è´Ÿç±»ï¼Œå³$y_i=-1$ï¼›ä¸ºæ­£çš„é‚£ä¸€ä¾§ä»£è¡¨æ­£ç±»ï¼Œå³$y_i=+1$ï¼Œè¿™é‡Œæ›´å¤šçš„æ˜¯ä¸€ç§çº¦å®šçš„é—®é¢˜ï¼Œè¿™ç§çº¦å®šæ–¹ä¾¿æˆ‘ä»¬å»ºæ¨¡æ±‚è§£é—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥è¯•ç€ç†è§£ä¸‹$(1) (2)$ä¸¤å¼ï¼Œå½“æœ‰æŸäº›æ•°æ®ç‚¹è¢«åˆ†é”™æ—¶ï¼Œ$(2)$å·¦ä¾§ç»“æœä¸ºè´Ÿå€¼ï¼Œé‚£ä¹ˆ$\\gamma$ä¹Ÿä¸ºè´Ÿå€¼ï¼Œæ­¤æ—¶$\\gamma$è‚¯å®šä¸æ˜¯æœ€å¤§å€¼ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æ•°æ®ç‚¹éƒ½è¢«æ­£ç¡®åˆ†ç±»æ—¶ï¼ˆ$\\gamma$ä¸ºæ­£ï¼‰ï¼Œè€Œä¸”è¶…å¹³é¢è·ç¦»æœ€è¿‘çš„ç‚¹çš„è·ç¦»æœ€è¿œæ—¶ï¼Œ$\\gamma$è¾¾åˆ°æœ€å¤§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„æ±‚è§£æ–¹æ³•æ˜¯å¯¹å‚æ•°é€æ­¥è¿­ä»£è¾¾åˆ°$\\gamma$æœ€å¤§æ—¶ï¼Œé‚£ä¹ˆä¸€å¼€å§‹æ˜¯ç”±è¯¯åˆ†ç±»ç‚¹é©±åŠ¨ï¼Œä¹‹åæ ¹æ®å‡ ä½•é—´éš”æœ€å¤§é©±åŠ¨å‚æ•°æ›´æ–°ã€‚ ä¸Šé¢æœ€ä¼˜åŒ–å»ºæ¨¡å®Œç¾å¾—åˆ°äº†æ­£ç¡®åˆ’åˆ†è®­ç»ƒæ•°æ®é›†å¹¶ä¸”å‡ ä½•é—´éš”æœ€å¤§çš„ç›®çš„ã€‚\nSVMçº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ï¼š\n$$ \\begin{array}{ll} \\max \\limits_{w, b} \u0026amp; \\gamma \u0026amp; {(1)} \\\n\\text { s.t. } \u0026amp; y_{i}\\left(\\frac{w}{|w|} \\cdot x_{i}+\\frac{b}{|w|}\\right) \\geqslant \\gamma, \\quad i=1,2, \\cdots, N \u0026amp; {(2)} \\end{array} $$\nåç»­è®¨è®ºï¼š\næ•°æ®å¹¶ä¸æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚ æ•°æ®å­˜åœ¨è¯¯å·®ï¼Œè½¯é—´éš”ã€‚ SVMä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ æœ‰ä¸¥æ ¼çš„æ•°å­¦ç†è®ºæ”¯æŒï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œä¸ä¾é ç»Ÿè®¡æ–¹æ³•ï¼Œä»è€Œç®€åŒ–äº†é€šå¸¸çš„åˆ†ç±»å’Œå›å½’é—®é¢˜ï¼› èƒ½æ‰¾å‡ºå¯¹ä»»åŠ¡è‡³å…³é‡è¦çš„å…³é”®æ ·æœ¬ï¼ˆå³ï¼šæ”¯æŒå‘é‡ï¼‰ï¼› é‡‡ç”¨æ ¸æŠ€å·§ä¹‹åï¼Œå¯ä»¥å¤„ç†éçº¿æ€§åˆ†ç±»/å›å½’ä»»åŠ¡ï¼› æœ€ç»ˆå†³ç­–å‡½æ•°åªç”±å°‘æ•°çš„æ”¯æŒå‘é‡æ‰€ç¡®å®šï¼Œè®¡ç®—çš„å¤æ‚æ€§å–å†³äºæ”¯æŒå‘é‡çš„æ•°ç›®ï¼Œè€Œä¸æ˜¯æ ·æœ¬ç©ºé—´çš„ç»´æ•°ï¼Œè¿™åœ¨æŸç§æ„ä¹‰ä¸Šé¿å…äº†â€œç»´æ•°ç¾éš¾â€ã€‚ ç¼ºç‚¹ è®­ç»ƒæ—¶é—´é•¿ã€‚å½“é‡‡ç”¨ SMO ç®—æ³•æ—¶ï¼Œç”±äºæ¯æ¬¡éƒ½éœ€è¦æŒ‘é€‰ä¸€å¯¹å‚æ•°ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º$O\\left(N^{2}\\right)$ï¼Œå…¶ä¸­ N ä¸ºè®­ç»ƒæ ·æœ¬çš„æ•°é‡ï¼› å½“é‡‡ç”¨æ ¸æŠ€å·§æ—¶ï¼Œå¦‚æœéœ€è¦å­˜å‚¨æ ¸çŸ©é˜µï¼Œåˆ™ç©ºé—´å¤æ‚åº¦ä¸º$O\\left(N^{2}\\right)$ï¼› æ¨¡å‹é¢„æµ‹æ—¶ï¼Œé¢„æµ‹æ—¶é—´ä¸æ”¯æŒå‘é‡çš„ä¸ªæ•°æˆæ­£æ¯”ã€‚å½“æ”¯æŒå‘é‡çš„æ•°é‡è¾ƒå¤§æ—¶ï¼Œé¢„æµ‹è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ã€‚ ç›®å‰åªé€‚åˆå°æ‰¹é‡æ ·æœ¬çš„ä»»åŠ¡ï¼Œæ— æ³•é€‚åº”ç™¾ä¸‡ç”šè‡³ä¸Šäº¿æ ·æœ¬çš„ä»»åŠ¡ã€‚ SVMä½¿ç”¨åœºæ™¯ ç°æœ‰çš„ä¸€äº›æ”¯æŒå‘é‡æœºè½¯ä»¶åŒ… LIBSVM \u0026ndash; A Library for Support Vector Machines\nä¸€äº›åºŸè¯ å‚è€ƒï¼š\nsupport-vector-machines\nç†è§£SVMçš„ä¸‰å±‚å¢ƒç•Œ\n(https://zhuanlan.zhihu.com/p/77750026)\n","date":"2020-07-14T17:46:32Z","permalink":"https://qiyueliuhuo.github.io/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/","title":"æœºå™¨å­¦ä¹ ä¹‹æ”¯æŒå‘é‡æœº"},{"content":"å‰è¨€ äººå·¥ç¥ç»ç½‘ç»œï¼ˆArtificial Neural Networkï¼ŒANNï¼‰æ˜¯ä¸€é—¨é‡è¦çš„æœºå™¨å­¦ä¹ æŠ€æœ¯ã€‚å®ƒæ˜¯ç›®å‰æœ€ä¸ºç«çƒ­çš„ç ”ç©¶æ–¹å‘\u0026ndash;æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰çš„åŸºç¡€ã€‚å­¦ä¹ ç¥ç»ç½‘ç»œä¸ä»…å¯ä»¥è®©ä½ æŒæ¡ä¸€é—¨å¼ºå¤§çš„æœºå™¨å­¦ä¹ æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´å¥½åœ°å¸®åŠ©ä½ ç†è§£æ·±åº¦å­¦ä¹ æŠ€æœ¯ã€‚\nå››å¹´å‰ï¼ŒéŸ©å›½å›´æ£‹ä¹æ®µæ£‹æ‰‹æä¸–çŸ³ä¸è°·æ­Œäººå·¥æ™ºèƒ½ AlphaGo ä¹‹é—´çš„å›´æ£‹æ¯”èµ›ï¼Œæœ€ç»ˆ AlphaGo ä»¥å››æ¯”ä¸€å–èƒœï¼Œè¿™è®©äººå·¥æ™ºèƒ½ AlphaGo èƒŒåçš„æŠ€æœ¯â€”â€”æ·±åº¦å­¦ä¹ ç®—æ³•å¤§ç«ï¼Œç¬”è€…ä¹Ÿæ˜¯ä»è¿™ä¸ªæ—¶å€™å¼€å§‹å…³æ³¨æ·±åº¦å­¦ä¹ ï¼Œå¯¹è®¡ç®—æœºé¢†åŸŸäº§ç”Ÿäº†å…´è¶£ã€‚æ­¤åä¸€å¹´ï¼Œè°·æ­Œåˆæ¨å‡º AlphaGo å›´æ£‹å‡çº§ç‰ˆï¼Œå¹¶é‚€è¯·ä¸–ç•Œå›´æ£‹å† å†›ã€ä¸­å›½æ£‹æ‰‹æŸ¯æ´äº 2017 å¹´ 5 æœˆä»½ä¸ä¹‹è¿›è¡Œå›´æ£‹å¤§æˆ˜ï¼Œç¬”è€…å…¨ç¨‹ç›´æ’­è§‚çœ‹äº† AlphaGo ä¸æŸ¯æ´äººæœºå›´æ£‹å¤§æˆ˜ï¼Œåœ¨çœ‹åˆ°ä½œä¸ºäººç±»æ™ºæ…§çš„é¡¶å³°æŸ¯æ´å«æ³ªè®¤è¾“åï¼Œç¬”è€…è¢« AlphaGo èƒŒåçš„æŠ€æœ¯ç¥ç»ç½‘ç»œæ‰€æ·±æ·±éœ‡æ’¼ï¼ˆè¿˜åŒ…æ‹¬å¦ä¸€ç§æŠ€æœ¯ï¼šè’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼‰ã€‚å›´æ£‹ä¸åŒäºå…¶ä»–æ£‹ï¼Œè®¡ç®—æœºç›®å‰æ— æ³•éå†å›´æ£‹çš„æ‰€æœ‰å¯èƒ½çš„ä¸‹æ³•ï¼Œæ‰€ä»¥ç®—æ³•å¿…é¡»å°è¯•æ¨¡æ‹Ÿäººç±»å¤§è„‘çš„ä¸‹æ£‹ï¼Œæ ¹æ®ä»¥å¾€å­¦ä¹ åˆ°çš„ç»éªŒåˆ¤æ–­è½æ£‹ç‚¹ï¼Œè€Œä¸æ˜¯æš´åŠ›éå†æ‰€æœ‰å¯èƒ½æ€§åé€‰æ‹©æœ€ä½³çš„ä¸‹æ£‹ç‚¹ï¼Œä»è€Œå–èƒœã€‚\nè¿™ç¯‡æ–‡ç« è¯•å›¾ä»‹ç»æ·±åº¦å­¦ä¹ ä¸­å¾ˆé‡è¦çš„æŠ€æœ¯â€”â€”ç¥ç»ç½‘ç»œï¼Œå¹¶é‡ç‚¹ä»‹ç»ç¥ç»ç½‘ç»œä¸­è¿ç”¨åˆ°åå‘ä¼ æ’­ç®—æ³•ã€‚\nåœ¨ç¬”è€…å¤§å­¦æœŸé—´ï¼Œé™¤äº†ä¸¤åœºå›´æ£‹äººæœºå¤§æˆ˜å¤–ï¼Œè¿˜æœ‰ä¸€åœºæ¯”è¾ƒæœ‰æ„æ€çš„å¤§å‹å®éªŒï¼šå¤§è´å°”å®éªŒâ€”â€”å…³äºéªŒè¯åŸºç¡€ç‰©ç†é‡å­åŠ›å­¦ä¸­éå¸¸æœ‰åä¸”é‡è¦çš„è´å°”ä¸ç­‰å¼çš„å®éªŒã€‚æ‰€è°“â€œé‡äº‹ä¸å†³ï¼Œé‡å­åŠ›å­¦â€ï¼Œè¿™ä¸ªæ¢—å°±è¡¨ç¤ºäº†é‡å­åŠ›å­¦ä¸­å­˜åœ¨ä¸€äº›æ— æ³•è§£é‡Šï¼ˆå®è§‚ä¸–ç•Œéš¾ä»¥ç†è§£ï¼‰çš„ç°è±¡ï¼Œè‹¥æœ‰å…´è¶£å¯ä»¥å†äº†è§£ä¸‹ã€‚\næ„ŸçŸ¥æœº æ„ŸçŸ¥æœºä»‹ç» é¦–å…ˆè®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ç¥ç»ç½‘ç»œä¸­æœ€ç®€å•ä¹Ÿæ˜¯æœ€åŸºç¡€çš„ä¸€ç§ç»“æ„â€”â€”æ„ŸçŸ¥æœºï¼ˆPerceptronï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š\nç ”ç©¶è€…æ¨¡æ‹Ÿç”Ÿç‰©ç¥ç»ç½‘ç»œä¸­çš„ä¸€ä¸ªç®€å•çš„ç¥ç»å…ƒçš„è¡Œä¸ºâ€”â€”ç¥ç»å…ƒå…´å¥‹è¿‡ç¨‹ï¼Œä¸ä¹‹å¯¹åº”çš„æ„ŸçŸ¥æœºåŸºç¡€æ¦‚å¿µè¢«æå‡ºï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠæƒé‡å½“ä½œçªè§¦ã€æŠŠåç½®å½“ä½œé˜ˆå€¼ä»¥åŠæŠŠæ¿€æ´»å‡½æ•°å½“ä½œç»†èƒä½“ï¼Œå½“ç»è¿‡çªè§¦çš„ä¿¡å·æ€»å’Œè¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ï¼ˆåç½®é¡¹ï¼‰ï¼Œç»†èƒä½“å°±ä¼šå…´å¥‹ï¼ˆæ¿€æ´»å‡½æ•°ï¼‰ï¼Œäº§ç”Ÿç”µè„‰å†²ï¼ˆè¾“å‡º 1ï¼‰ï¼Œè€Œå½“ä¿¡å·é‡æ€»å’Œæœªè¶…è¿‡é˜ˆå€¼ï¼Œä¸äº§ç”Ÿç”µè„‰å†²ï¼ˆè¾“å‡º 0ï¼‰ã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§æœ€ç®€å•å½¢å¼çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§äºŒå…ƒçº¿æ€§åˆ†ç±»å™¨ã€‚æ„ŸçŸ¥æœºï¼ˆå•ä¸ªç¥ç»å…ƒï¼‰ä»£è¡¨äº†ä»è¾“å…¥ç©ºé—´åˆ°è¾“å‡ºç©ºé—´çš„å¦‚ä¸‹å‡½æ•°ï¼š $$ y = f(\\sum_{i=1}^{n}w_ix_i + b) $$ ç†æƒ³ä¸­çš„æ¿€æ´»å‡½æ•°$f(Â·)$æ˜¯ä¸‹å›¾ a æ‰€ç¤ºçš„é˜¶è·ƒå‡½æ•°ï¼Œè¾“å‡ºâ€œ1â€å¯¹åº”ç¥ç»å…ƒå…´å¥‹ï¼Œè¾“å‡ºâ€œ0â€å¯¹åº”ç¥ç»å…ƒæŠ‘åˆ¶ï¼Œç„¶è€Œé˜¶è·ƒå‡½æ•°å…·æœ‰ä¸è¿ç»­ã€ä¸å…‰æ»‘ç­‰ä¸å¤ªå¥½çš„æ•°å­¦æ€§è´¨ï¼Œå› æ­¤å®é™…å¸¸ç”¨ Sigmoid å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œå¦‚ä¸‹å›¾ b æ‰€ç¤ºï¼Œè¯¥å‡½æ•°å°†å®åŸŸèŒƒå›´çš„è¾“å‡ºæŒ¤å‹åˆ°ï¼ˆ0ï¼Œ1ï¼‰èŒƒå›´è¾“å‡ºï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œæŒ¤å‹å‡½æ•°â€ã€‚ å¯¹äºæ„ŸçŸ¥æœºæ¨¡å‹çš„ç†è§£ï¼šæ„ŸçŸ¥æœºæ¨¡å‹çš„å‡è®¾ç©ºé—´ï¼ˆå®¹é‡ï¼‰æ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„æ‰€æœ‰çº¿æ€§åˆ†ç±»æ¨¡å‹æˆ–çº¿æ€§åˆ†ç±»å™¨ã€‚æ„ŸçŸ¥æœºå¯¹åº”å‡½æ•°å€¼ä¸º 0ï¼Œå³$wÂ·x + b = 0$ï¼Œå¯¹åº”äºç‰¹å¾ç©ºé—´$R^n$ä¸­çš„ä¸€ä¸ªè¶…å¹³é¢$S$ï¼Œå…¶ä¸­$w$æ˜¯è¶…å¹³é¢çš„æ³•å‘é‡ï¼Œ$b$æ˜¯è¶…å¹³é¢çš„æˆªè·ï¼Œè¿™ä¸ªè¶…å¹³é¢å°†ç‰¹å¾ç©ºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä½äºä¸¤éƒ¨åˆ†ç©ºé—´ä¸­çš„ç‚¹åˆ†åˆ«è¢«åˆ†ä¸ºæ­£ã€è´Ÿä¸¤ç±»ã€‚\næ„ŸçŸ¥æœºå­¦ä¹ ç­–ç•¥ æ„ŸçŸ¥æœºå­¦ä¹ ä»¥æœ€å°åŒ–è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢$S$çš„æ€»è·ç¦»ä¸ºç›®æ ‡ï¼Œå› æ­¤æ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•æ˜¯è¯¯åˆ†ç±»é©±åŠ¨çš„ï¼Œå…·ä½“ä½¿ç”¨æ—¶é‡‡ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•ã€‚ è¯¯åˆ†ç±»ç‚¹åˆ°è¶…å¹³é¢çš„æ€»è·ç¦»ä¸º $$ -\\frac{1}{||w||}\\sum_{x_i\\in M}y_i(wÂ·x_i + b) $$ å…¶ä¸­$(x_i, y_i)$ä¸ºæ ·æœ¬ç‚¹ï¼Œ$M$ä¸ºè¯¯åˆ†ç±»ç‚¹çš„é›†åˆï¼Œå¯¹äºè¯¯åˆ†ç±»ç‚¹æ¥è¯´$-y_i(wÂ·x_i + b) \u0026gt; 0$æˆç«‹ï¼Œä¸”å½“$(wÂ·x_i + b) \u0026gt; 0$æ—¶ï¼Œ$y_i = -1$ï¼Œå½“$(wÂ·x_i + b) \u0026lt; 0$æ—¶ï¼Œ$y_i = +1$ã€‚ ä¸è€ƒè™‘$\\frac{1}{||w||}$ï¼Œå°±å¾—åˆ°æ„ŸçŸ¥æœºå­¦ä¹ çš„æŸå¤±å‡½æ•°ä¸º $$ L(w, b) = -\\sum_{x_i\\in M}y_i(wÂ·x_i + b) $$ æŸå¤±å‡½æ•°çš„æ¢¯åº¦ä¸º $$ \\nabla_w L(w, b) = - \\sum_{x_i\\in M}y_ix_i$$ $$ \\nabla_b L(w, b) = - \\sum_{x_i\\in M}y_i$$\né‡‡ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œéšæœºé€‰å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹$(x_i, y_i)$ï¼Œå¯¹$w, b$è¿›æ€§æ›´æ–°ï¼š $$ w \\leftarrow w + \\eta y_ix_i $$ $$ b \\leftarrow b + \\eta y_i $$\nå…·ä½“æ¨å¯¼è¿‡ç¨‹åŠç®—æ³•è¿­ä»£è¿‡ç¨‹å‚è§æèˆªã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ï¼Œä»£ç å®ç°å‚è§æ­¤ githubã€‚\næ„ŸçŸ¥æœºæ¨¡å‹å­˜åœ¨çš„é—®é¢˜ æ„ŸçŸ¥æœºçš„å­¦ä¹ èƒ½åŠ›éå¸¸æœ‰é™ï¼Œä¸ã€æˆ–ã€éé—®é¢˜éƒ½æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œæ‰€ä»¥æ„ŸçŸ¥æœºå¯ä»¥å¤„ç†ï¼Œä½†æ˜¯æ„ŸçŸ¥æœºå´ä¸èƒ½è§£å†³å¼‚æˆ–ç®€å•çš„éçº¿æ€§å¯åˆ†é—®é¢˜ã€‚ å¼‚æˆ–é—®é¢˜æš´éœ²å‡ºè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå³åœ¨ç°å®ä»»åŠ¡ä¸­ï¼ŒåŸå§‹æ ·æœ¬ç©ºé—´å†…ä¹Ÿè®¸å¹¶ä¸å­˜åœ¨ä¸€ä¸ªèƒ½æ­£ç¡®åˆ’åˆ†ä¸¤ç±»æ ·æœ¬çš„è¶…å¹³é¢ï¼Œå¯¹äºè¿™æ ·çš„é—®é¢˜ï¼Œä¸€ç§æ–¹æ³•ï¼Œ1) å¯å°†æ ·æœ¬ä»åŸå§‹ç©ºé—´æ˜ å°„åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„ç‰¹å¾ç©ºé—´ï¼ˆæˆ–è€…ä¸ç”¨æ›´é«˜ç»´ä¹Ÿå¯ä»¥ï¼‰ï¼Œæ‰€è°“çš„æ ¸å‡½æ•°$\\phi$ï¼Œä½¿å¾—æ ·æœ¬åœ¨è¿™ä¸ªç‰¹å¾ç©ºé—´å†…çº¿æ€§å¯åˆ†ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå¦‚æœåŸå§‹ç©ºé—´æ˜¯æœ‰é™ç»´ï¼Œé‚£ä¹ˆä¸€å®šå­˜åœ¨ä¸€ä¸ªé«˜ç»´ç‰¹å¾ç©ºé—´ä½¿å¾—æ ·æœ¬çº¿æ€§å¯åˆ†ã€‚2) å¦ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å¢åŠ æ„ŸçŸ¥æœºçš„å±‚æ•°ï¼Œä½¿å¾—å½¢æˆä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå…¶ä¸­è¾“å…¥å±‚ç¥ç»å…ƒæ¥å—å¤–ç•Œè¾“å…¥ï¼Œéšå±‚ä¸è¾“å‡ºå±‚ç¥ç»å…ƒå¯¹ä¿¡å·è¿›è¡ŒåŠ å·¥ï¼Œæœ€ç»ˆç»“æœç”±è¾“å‡ºå±‚ç¥ç»å…ƒè¾“å‡ºã€‚ï¼ˆèŠ±ä¹¦ç†è§£ï¼šæ·±å±‚ç¥ç»ç½‘ç»œä¸­çš„éšè—å±‚å³ä»£è¡¨è¾“å…¥ç»è¿‡äº†ä¸€ä¸ªæ ¸å‡½æ•°$\\phi$å˜æ¢ï¼Œé‚£ä¹ˆä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½æ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªæ°å½“çš„æ ¸å‡½æ•°$\\phi$ï¼Œç¥ç»ç½‘ç»œçš„æ–¹å¼æ˜¯é€šè¿‡ç½‘ç»œè‡ªä¸»å­¦ä¹ å­¦åˆ°æ°å½“çš„æ ¸å‡½æ•°ï¼‰\nç¥ç»ç½‘ç»œ ç¥ç»ç½‘ç»œä»‹ç» è€ƒè™‘åˆ°æ„ŸçŸ¥æœºæ¨¡å‹å­˜åœ¨çš„é—®é¢˜ï¼Œå³åªèƒ½è§£å†³çº¿æ€§å¯åˆ†é—®é¢˜ï¼Œæˆ‘ä»¬å°†æ„ŸçŸ¥æœºè¿›è¡Œè¿æ¥ï¼Œå½¢æˆå¤šå±‚æ„ŸçŸ¥æœºâ€”â€”ç¥ç»ç½‘ç»œï¼Œå¦‚ä¸‹å›¾\nç¥ç»ç½‘ç»œå…¶å®å°±æ˜¯æŒ‰ç…§ä¸€å®šè§„åˆ™è¿æ¥èµ·æ¥çš„å¤šä¸ªç¥ç»å…ƒã€‚ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªå…¨è¿æ¥(full connected, FC)ç¥ç»ç½‘ç»œï¼Œé€šè¿‡è§‚å¯Ÿä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒçš„è§„åˆ™åŒ…æ‹¬ï¼š\nç¥ç»å…ƒæŒ‰ç…§å±‚æ¥å¸ƒå±€ã€‚æœ€å·¦è¾¹çš„å±‚å«åšè¾“å…¥å±‚ï¼Œè´Ÿè´£æ¥æ”¶è¾“å…¥æ•°æ®ï¼›æœ€å³è¾¹çš„å±‚å«è¾“å‡ºå±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™å±‚è·å–ç¥ç»ç½‘ç»œè¾“å‡ºæ•°æ®ã€‚è¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„å±‚å«åšéšè—å±‚ï¼Œå› ä¸ºå®ƒä»¬å¯¹äºå¤–éƒ¨æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚ åŒä¸€å±‚çš„ç¥ç»å…ƒä¹‹é—´æ²¡æœ‰è¿æ¥ã€‚ ç¬¬Nå±‚çš„æ¯ä¸ªç¥ç»å…ƒå’Œç¬¬N-1å±‚çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿(è¿™å°±æ˜¯full connectedçš„å«ä¹‰)ï¼Œç¬¬N-1å±‚ç¥ç»å…ƒçš„è¾“å‡ºå°±æ˜¯ç¬¬Nå±‚ç¥ç»å…ƒçš„è¾“å…¥ã€‚ æ¯ä¸ªè¿æ¥éƒ½æœ‰ä¸€ä¸ªæƒå€¼ã€‚ ä¸Šé¢è¿™äº›è§„åˆ™å®šä¹‰äº†å…¨è¿æ¥ç¥ç»ç½‘ç»œçš„ç»“æ„ã€‚äº‹å®ä¸Šè¿˜å­˜åœ¨å¾ˆå¤šå…¶å®ƒç»“æ„çš„ç¥ç»ç½‘ç»œï¼Œæ¯”å¦‚å·ç§¯ç¥ç»ç½‘ç»œ(CNN)ã€å¾ªç¯ç¥ç»ç½‘ç»œ(RNN)ï¼Œä»–ä»¬éƒ½å…·æœ‰ä¸åŒçš„è¿æ¥è§„åˆ™ã€‚\nç”¨çŸ©é˜µå½¢å¼è¡¨ç¤ºç¥ç»ç½‘ç»œè¿ç®—è¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š ç¬¬ä¸€å±‚åŠ æƒå’Œä¸º $$ A^{(1)} = XW^{(1)} + B^{(1)} $$ å…¶ä¸­ï¼Œ$X$ä¸º$N\\times2$å¤§å°çŸ©é˜µï¼Œ$N$ä»£è¡¨è¾“å…¥ç¥ç»ç½‘ç»œçš„æ•°æ®æœ‰$N$ä¸ªæ ·æœ¬ï¼Œ$2$ä»£è¡¨æ¯ä¸ªæ ·æœ¬æœ‰ä¸¤ä¸ªç‰¹å¾å€¼ï¼›$W$ä¸º$2\\times3$å¤§å°çš„çŸ©é˜µä»£è¡¨è¾“å…¥å±‚åˆ°ä¸­é—´å±‚çš„çº¿æ€§å˜æ¢æƒé‡çŸ©é˜µï¼›$B$ä¸ºåç½®é¡¹ã€‚ ç¬¬ä¸€å±‚æ¿€æ´»åä¸º $$ Z^{(1)} = sigmoid(A^{(1)}) $$ å…¶ä¸­ sigmoid å‡½æ•°ä½œç”¨äº$A^{(1)}$ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚å°†ç¬¬ä¸€å±‚çš„è¾“å‡º$Z^{(1)}$ä½œä¸ºç¬¬äºŒå±‚çš„è¾“å…¥ï¼ŒåŒç†å¾—ï¼š $$ A^{(2)} = Z^{(1)}W^{(2)} + B^{(2)} $$ æ³¨æ„ï¼š å› ä¸ºå•éšå±‚ç¥ç»ç½‘ç»œåªç»è¿‡ä¸¤å±‚ä¼ æ’­ï¼Œé‚£ä¹ˆç¬¬äºŒå±‚çš„è¾“å‡ºå°±æ˜¯ç½‘ç»œçš„è¾“å‡ºï¼Œè¿™é‡Œä¸€èˆ¬ï¼ˆ1ï¼‰å›å½’é—®é¢˜ä½¿ç”¨æ’ç­‰å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œï¼ˆ2ï¼‰åˆ†ç±»é—®é¢˜å¯ä»¥ä½¿ç”¨ softmax å‡½æ•°ã€‚æˆ‘ä»¬æŠŠæ­¤ç¥ç»ç½‘ç»œçœ‹ä½œæ˜¯åˆ†ç±»é‡‡ç”¨ softmax å‡½æ•°ï¼š $$ y_k = \\frac{exp(a_k)}{\\sum_{i=1}^{n}exp(a_i)} $$ é‚£ä¹ˆç¥ç»ç½‘ç»œçš„è¾“å‡ºä¸º $$ Y = softmax(A^{(2)}) $$ å…¶ä¸­$Y$ä¸º$N\\times2$çŸ©é˜µï¼Œå½¢å¦‚ï¼š\n$$ \\left[ \\begin{array}{ccc} 0.2650877\u0026amp; 0.7349123\\\\ \\vdots \u0026amp; \\vdots\\\\ 0.8987211 \u0026amp; 0.1012788\\\\ \\end{array} \\right] $$\nä»£è¡¨ç¬¬ä¸€ä¸ªæ ·æœ¬é¢„æµ‹ä¸ºç¬¬äºŒä¸ªåˆ†ç±»æ¦‚ç‡ä¸º 0.7349123ï¼Œå¤§äº 0.5ï¼Œå¯ä»¥è®¤ä¸ºé¢„æµ‹ä¸ºç¬¬äºŒä¸ªåˆ†ç±»ï¼›æœ€åä¸€ä¸ªæ ·æœ¬é¢„æµ‹ä¸ºç¬¬ä¸€ä¸ªåˆ†ç±»æ¦‚ç‡ä¸º 0.8987211ï¼Œå¯ä»¥è®¤ä¸ºé¢„æµ‹ä¸ºç¬¬ä¸€ä¸ªåˆ†ç±»ã€‚ï¼ˆå½“ç„¶åªæœ‰ä¸¤ä¸ªæ ·æœ¬çš„æƒ…å†µä¸‹ä¸€èˆ¬çœ‹ä½œæ­£ç±»å’Œè´Ÿç±»ï¼Œåªéœ€è¦ä¸€ä¸ªè¾“å‡ºç¥ç»å…ƒï¼Œä½¿ç”¨ sigmoid å‡½æ•°æ¿€æ´»å³å¯ã€‚ï¼‰è¯¥æ¨¡å‹ä½¿ç”¨ softmax å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥æ¨å¹¿åˆ°å¤šåˆ†ç±»æƒ…å†µä¸‹ã€‚\nç¥ç»ç½‘ç»œå­¦ä¹ ç­–ç•¥ ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ä½¿ç”¨çš„æŒ‡æ ‡ä¸ºæŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰ï¼Œå³ä»¥æœ€å°åŒ–æŸå¤±å‡½æ•°ä¸ºç›®æ ‡ï¼Œç†è®ºä¸Šï¼ŒæŸå¤±å‡½æ•°å¯ä»¥ä½¿ç”¨ä»»æ„å‡½æ•°ï¼Œä½†å®é™…ä¸­ä¸€èˆ¬ç”¨å‡æ–¹è¯¯å·®å’Œäº¤å‰ç†µè¯¯å·®ç­‰ã€‚ å‡æ–¹è¯¯å·®ä¸º $$ E = \\frac{1}{2}\\sum_{k}(y_k - t_k)^2 $$ äº¤å‰ç†µè¯¯å·®ä¸º $$ E = -\\sum_{k}t_k\\log_e{y_k} $$ å…¶ä¸­$y_k$è¡¨ç¤ºç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œ$t_k$è¡¨ç¤ºç›‘ç£æ•°æ®ï¼Œk è¡¨ç¤ºæ•°æ®çš„ç»´åº¦ï¼Œå¦‚åœ¨æ‰‹å†™æ•°å­—è¯†åˆ«ä¾‹å­ä¸­ï¼Œ$y_k$ã€$t_k$å¦‚ä¸‹ 10 ä¸ªå…ƒç´ æ„æˆçš„æ•°æ®ï¼š\n1 2 y = [0.1, 0.05, 0.6, 0.0, 0.05, 0.1, 0.0, 0.1, 0.0, 0.0] t = [0, 0, 1, 0, 0, 0, 0, 0, 0, 0] åœ¨æ‰¹é‡æ ·æœ¬å­¦ä¹ ä¸­ï¼Œå¯ä»¥å°†å¯¹æ‰€æœ‰çš„æ ·æœ¬çš„å•ä¸ªè¯¯å·®æ±‚å’Œï¼Œç„¶åå†é™¤ä»¥æ ·æœ¬æ•° Nï¼Œæ±‚å¾—å•ä¸ªæ•°æ®çš„â€œå¹³å‡æŸå¤±å‡½æ•°â€ï¼Œå°†å®ƒä½œä¸ºæŸå¤±å‡½æ•°ã€‚ ç¥ç»ç½‘ç»œå­¦ä¹ çš„ç­–ç•¥å’Œæ„ŸçŸ¥æœºå­¦ä¹ ç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜ï¼Œç¥ç»ç½‘ç»œå­¦ä¹ ä¸­ä¹Ÿæ˜¯é‡‡ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œä¸æ„ŸçŸ¥æœºå­¦ä¹ ç­–ç•¥æ›´æ–°å‚æ•°ç±»ä¼¼ï¼Œå¯¹äºç¥ç»ç½‘ç»œä»»æ„å‚æ•°ï¼ˆçº¿æ€§æƒé‡ã€çº¿æ€§åç½®ç­‰éœ€è¦å­¦ä¹ å‚æ•°ï¼‰æ›´æ–°ä¼°è®¡å¼å¦‚ä¸‹ $$ v \\leftarrow v + \\Delta v $$ æ›´æ–°å‚æ•°ä¸ºçº¿æ€§è¿æ¥æƒé‡å‚æ•°æ—¶ $$ w_{hj} \\leftarrow w_{hj} + \\Delta w_{hj} $$ é‡‡ç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼Œæœ‰ $$ w_{hj} \\leftarrow w_{hj} - \\eta \\frac{\\partial E}{\\partial w_{hj}} $$ å¯¹äºæ¢¯åº¦æ±‚è§£ï¼Œä¸€èˆ¬æœ‰è§£ææ³•å’Œæ•°å€¼æ³•ä¸¤ç§æ–¹æ³•ï¼Œéšç€ç¥ç»ç½‘ç»œç¥ç»å…ƒå¢åŠ å’Œå±‚æ•°å¢åŠ ï¼Œç›´æ¥æ±‚ä¸Šä¸‡ï¼Œç”šè‡³ä¸Šäº¿ä¸ªå‚æ•°çš„è§£æå¯¼æ•°å˜å¾—ä¸ç°å®ï¼Œè®¡ç®—é‡éå¸¸å¤§ã€‚ä¸‹é¢å°†ä»‹ç»ä¸¤ç§æ•°å€¼æ–¹å¼è®¡ç®—æ¢¯åº¦æ–¹æ³•ï¼šå¯¼æ•°å®šä¹‰æ³•å’Œåå‘ä¼ æ’­æ³•ã€‚\næ¢¯åº¦è®¡ç®— æ¢¯åº¦åœ¨ç›´è§’åæ ‡ç³»ä¸‹è®¡ç®—å…¬å¼ä¸º $$ \\nabla f(x) = (\\frac{\\partial f(x)}{\\partial x_1}, \\frac{\\partial f(x)}{\\partial x_2}, \u0026hellip;) $$ æ¢¯åº¦è®¡ç®—çš„ç»“æœæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°è®¡ç®—æ¢¯åº¦éœ€è¦æ±‚å‡½æ•°å¯¹äºå„ä¸ªè‡ªå˜é‡çš„åå¯¼æ•°ã€‚ å¯¹äºå¤šå…ƒå‡½æ•°ï¼Œåå¯¼è¡¨ç¤ºè‡ªå˜é‡æŸä¸ªç¬é—´çš„å˜åŒ–é‡ã€‚å®šä¹‰ä¸ºå¦‚ä¸‹ï¼š $$ \\frac{\\partial f(x_1, x_2, x_3\u0026hellip;x_i\u0026hellip;)}{\\partial x_i} = \\lim_{h \\to 0} \\frac{f(x_1, x_2, x_3\u0026hellip;x_i + h, \u0026hellip;)}{h} $$ åå¯¼çš„å®šä¹‰å’Œå¯¼æ•°çš„å®šä¹‰ç±»ä¼¼ï¼Œè¡¨ç¤ºè‡ªå˜é‡ä¸Šâ€œå¾®å°çš„å˜åŒ–â€å°†å¯¼è‡´å‡½æ•°$f(x)$çš„å€¼åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå‘ç”Ÿå˜åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ç¨‹åºå®ç°ä¸Šé¢çš„è®¡ç®—æ–¹å¼ï¼Œç¨‹åºä¸­æ— æ³•è¡¨ç¤º h è¶‹è¿‘ 0ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¾®å°å€¼ä»£æ›¿ï¼Œè®¡ç®—è¿‘ä¼¼è§£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æ•°å€¼æ¢¯åº¦ def numerical_gradient(f, x): h = 1e-4 # 0.0001 grad = np.zeros_like(x) # ç”Ÿæˆå’Œxå½¢çŠ¶ç›¸åŒçš„æ•°ç»„ for idx in range(x.size): tmp_val = x[idx] # è®¡ç®—f(x+h) x[idx] = tmp_val + h fxh1 = f(x) # è®¡ç®—f(x-h) x[idx] = tmp_val - h fxh2 = f(x) grad[idx] = (fxh1 - fxh2) / (2*h) x[idx] = tmp_val # è¿˜åŸxçš„å€¼ return grad ä¸Šé¢ç¨‹åºå®ç°çš„åå¯¼æ•°æ–¹å¼å’Œä¸Šé¢å…¬å¼ç¨æœ‰ä¸åŒï¼Œä½¿ç”¨ä¸­å¿ƒå·®åˆ†ï¼Œè¯¯å·®æ¯”å‰å‘å·®åˆ†å°ï¼Œå­¦è¿‡å¾®ç§¯åˆ†çš„åŒå­¦åº”è¯¥èƒ½å¤Ÿæ˜ç™½ã€‚è™½ç„¶ä¸Šé¢æ±‚åå¯¼æ•°çœ‹ç€å¾ˆæ–¹ä¾¿å¾ˆç®€å•ï¼Œä½†æ˜¯æ ¹æ®ä¸Šé¢çš„æ–¹å¼è®¡ç®—æ¢¯åº¦åœ¨é¢å¯¹ç¥ç»ç½‘ç»œè¿™ç§å…·æœ‰å¾ˆå¤§è§„æ¨¡è¾“å…¥å’Œå¾ˆå¤§è§„æ¨¡å‚æ•°æ—¶ï¼Œè®¡ç®—æ•ˆç‡ç›¸å½“æ…¢ã€‚ä¸‹é¢å°†é‡ç‚¹ä»‹ç»åå‘ä¼ æ’­ç®—æ³•è®¡ç®—æ¢¯åº¦ã€‚ï¼ˆä»‹ç»å®Œåå‘ä¼ æ’­ç®—æ³•åï¼Œè¿˜ä¼šå†ä»‹ç»ä¸¤è€…æ±‚è§£æ–¹å¼å·®å¼‚ï¼Œä¸ºä»€ä¹ˆä¸Šé¢æ–¹å¼æ±‚è§£æ¢¯åº¦é€Ÿåº¦åœ¨ç¥ç»ç½‘ç»œåº”ç”¨ä¸Šæ•ˆç‡å¤ªæ…¢ï¼‰\nè®¡ç®—å›¾ ä¸ºäº†æ›´ç²¾ç¡®åœ°æè¿°åå‘ä¼ æ’­ç®—æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨è®¡ç®—å›¾ï¼ˆcomputational graphï¼‰è¯­è¨€æ¥æè¿°ä¸€ç³»åˆ—æ“ä½œã€‚ã€Šæ·±åº¦å­¦ä¹ ã€‹èŠ±ä¹¦å’Œæ–¯å¦ç¦æé£é£ cs231n è¯¾ç¨‹å¯¹äºè®¡ç®—å›¾è¡¨ç¤ºä¸Šæœ‰äº›åŒºåˆ«ï¼Œä½†éƒ½è¡¨ç¤ºåŒä¸€ä¸ªå«ä¹‰ï¼Œå³ç”¨å›¾çš„æ–¹å¼å½¢å¼åŒ–åœ°å°†æ“ä½œæ¬¡åºè¡¨ç¤ºå‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç» cs231n è¯¾ç¨‹å¯¹äºè®¡ç®—å›¾çš„ç”»æ³•ã€‚ ä½¿ç”¨åœ†åœˆä»£è¡¨æ“ä½œèŠ‚ç‚¹ï¼ŒæŒ‡å‘èŠ‚ç‚¹çš„ç®­å¤´ä»£è¡¨è¾“å…¥å˜é‡ï¼Œä»èŠ‚ç‚¹æŒ‡å‡ºçš„ç®­å¤´ä»£è¡¨æ“ä½œå®Œåè¾“å‡ºçš„å˜é‡ã€‚ä¸Šé¢è®¡ç®—å›¾å³è¡¨ç¤ºäº†$f(x,y,z) = (x + y)z$ã€‚\nåå‘ä¼ æ’­ç®—æ³• ç®€å•æ ‡é‡åå‘ä¼ æ’­ç®—æ³• ä¸Šé¢è®¡ç®—å›¾çœŸå®å€¼è®¡ç®—çº¿è·¯å±•ç¤ºäº†è®¡ç®—çš„è§†è§‰åŒ–è¿‡ç¨‹ã€‚å‰å‘ä¼ æ’­ä»è¾“å…¥è®¡ç®—åˆ°è¾“å‡ºï¼ˆç»¿è‰²ï¼‰ï¼Œåå‘ä¼ æ’­ä»å°¾éƒ¨å¼€å§‹ï¼Œæ ¹æ®é“¾å¼æ³•åˆ™é€’å½’åœ°å‘å‰è®¡ç®—æ¢¯åº¦ï¼ˆæ˜¾ç¤ºä¸ºçº¢è‰²ï¼‰ï¼Œä¸€ç›´åˆ°ç½‘ç»œçš„è¾“å…¥ç«¯ã€‚å¯ä»¥è®¤ä¸ºï¼Œæ¢¯åº¦æ˜¯ä»è®¡ç®—é“¾è·¯ä¸­å›æµã€‚ å¦‚ä¸Šå›¾è®¡ç®—è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢å‡ ä¸ªä¸­é—´è¿‡ç¨‹åˆæˆï¼š $$ q = x + y $$ $$ f = q \\times z $$ åœ¨è¾“å…¥$x = -2, y = 5, z = -4$æƒ…å†µä¸‹ï¼Œç®­å¤´ä¸‹é¢çº¢è‰²æ•°å­—ä»£è¡¨ f å¯¹è¯¥å¤„å˜é‡çš„åå¯¼ï¼Œå³ $$ \\frac{\\partial f}{\\partial f} = 1 $$ $$ \\frac{\\partial f}{\\partial q} = \\frac{\\partial (q \\times z)}{\\partial q} = z\\vert_{z=-4}=-4 $$ $$ \\frac{\\partial f}{\\partial z} = \\frac{\\partial (q \\times z)}{\\partial z} = q\\vert_{q=3}=3 $$ æ ¹æ®æ±‚å¯¼çš„é“¾å¼æ³•åˆ™å¾— $$ \\frac{\\partial f}{\\partial x} = \\frac{\\partial f}{\\partial q}\\frac{\\partial q}{\\partial x}=1 \\cdot (-4) \\cdot 1 = -4 $$ $$ \\frac{\\partial f}{\\partial y} = \\frac{\\partial f}{\\partial q}\\frac{\\partial q}{\\partial y}=1 \\cdot (-4) \\cdot 1 = -4 $$ ç»“åˆä¸Šé¢è®¡ç®—å›¾å’Œæ±‚å¯¼çš„é“¾å¼æ³•åˆ™å¯ä»¥æœ‰ä»¥ä¸‹ç»“è®ºï¼š â€œ$è¾“å‡ºç»“æœå¯¹æŸä¸€å˜é‡çš„åå¯¼ = åå‘ä¼ æ’­æ—¶ä¸Šæ¸¸ä¼ é€’ä¸‹æ¥çš„åå¯¼æ•° \\times æœ¬åœ°åå¯¼æ•°ï¼ˆè¯¥å˜é‡è¾“å…¥çš„è®¡ç®—èŠ‚ç‚¹åå¯¼æ•°ï¼‰$â€ ä¸‹é¢ä»‹ç»ç¨å¾®å¤æ‚çš„è®¡ç®—å›¾ï¼Œå¦‚ä¸‹å›¾ã€‚ åˆ©ç”¨ä¸Šé¢å¾—åˆ°çš„ç»“è®ºå°±å¯ä»¥å¾—åˆ°æ¯ä¸ªéå†çš„åå¯¼æ•°ï¼Œè¿™ä¸ªè®¡ç®—å›¾å’Œä¸Šé¢è®¡ç®—å›¾åŒºåˆ«ä¹‹å¤„åœ¨äºï¼šåœ¨ä¹˜æ³•èŠ‚ç‚¹çš„ç»“æœè¾“å‡ºåˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯é™¤æ³•èŠ‚ç‚¹å’Œå‡æ³•èŠ‚ç‚¹ï¼Œå¯¼æ•°åå‘ä¼ æ’­æ—¶ï¼Œéœ€è¦å°†ä¸Šæ¸¸ä¼ é€’çš„ä¸¤ä¸ªå¯¼æ•°ç›¸åŠ ï¼Œå³-0.25 + 1 = 0.75 è¿™æ˜¯åŸºäºä¸‹é¢çš„å®šç†ï¼š\nå®šç†ï¼šè‹¥å‡½æ•°$u=\\varphi(t), v=\\psi(t)$åœ¨ç‚¹ t å¯å¯¼ï¼Œ$z=f(u,v)$åœ¨ç‚¹(u,v)å¤„åå¯¼è¿ç»­ï¼Œåˆ™å¤åˆå‡½æ•°$z=f(\\varphi(t),\\psi(t))$åœ¨ç‚¹ t å¯å¯¼ï¼Œåˆ™æœ‰é“¾å¼æ³•åˆ™ $$ \\frac{\\mathrm{d} z }{\\mathrm{d} t} = \\frac{\\partial z}{\\partial u} \\cdot \\frac{\\mathrm{d} u }{\\mathrm{d} t} + \\frac{\\partial z}{\\partial v} \\cdot \\frac{\\mathrm{d} v }{\\mathrm{d} t} $$\nçŸ©é˜µå½¢å¼åå‘ä¼ æ’­ç®—æ³• ä¸‹é¢ä»‹ç»çŸ©é˜µå½¢å¼è®¡ç®—å›¾åŠåå‘ä¼ æ’­å…¬å¼ï¼Œå¦‚ä¸‹å›¾ç¥ç»ç½‘ç»œ Affine å±‚ã€‚ Affine å±‚ï¼šç¥ç»ç½‘ç»œåœ¨æ­£å‘ä¼ æ’­ä¸­è¿›è¡Œçš„çŸ©é˜µçš„ä¹˜ç§¯è¿ç®—åœ¨å‡ ä½•å­¦é¢†åŸŸè¢«ç§°ä¸ºâ€œä»¿å°„å˜æ¢â€ã€‚å› æ­¤ï¼Œè¿™é‡Œå°†è¿›è¡Œçš„ä»¿å°„å˜æ¢çš„å¤„ç†ç§°ä¸ºâ€œAffine å±‚â€ã€‚\nç¥ç»ç½‘ç»œä¸­è¿˜æœ‰å…¶ä»–æ¯”è¾ƒå¤æ‚çš„å±‚ï¼Œæ¢¯åº¦æ¨å¯¼æ¯”ä¸Šé¢ Affine å±‚çº¿æ€§åå¯¼æ•°æ¨å¯¼æ›´ä¸ºå¤æ‚ï¼Œåœ¨æ­¤ç•¥è¿‡ä»‹ç»åŠæ¨å¯¼ï¼Œä½†è¿ç”¨åˆ°çš„çŸ¥è¯†ä¸ä¸Šé¢æ–¹å¼ç±»ä¼¼ï¼Œå¼ºçƒˆå»ºè®®è‡ªå·±æ‰‹åŠ¨æ¨å¯¼ä¸‹ Affine å±‚åå‘ä¼ æ’­ï¼Œå¯¹è‡ªå·±ç†è§£æœ‰å¸®åŠ©ã€‚\nå‰é¢ä»‹ç»ç¥ç»ç½‘ç»œå­¦ä¹ ç­–ç•¥ä¹Ÿæ˜¯ä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜ï¼Œå³ $$ loss \\ function = E = \\varphi(y, t) $$ æŸå¤±å‡½æ•°/ç›®æ ‡å‡½æ•°ä¸ºé¢„æµ‹å€¼$y$å’Œç›‘ç£æ•°æ®$t$çš„å‡½æ•°ï¼Œå…¶ä¸­$y$æ˜¯ç»è¿‡ç¥ç»ç½‘ç»œæ­£å‘ä¼ æ’­å¾—åˆ°çš„é¢„æµ‹å€¼ï¼Œæ‰€ä»¥$y$æ˜¯ç¥ç»ç½‘ç»œæ‰€æœ‰å‚æ•°$W$çš„å‡½æ•°ï¼Œé‚£ä¹ˆç›®æ ‡å‡½æ•°æ˜¯å…³äºå‚æ•°$W$çš„å‡½æ•°ï¼ˆå‡¸å‡½æ•°ï¼‰ï¼Œå³ $$ loss \\ function = \\psi(\\textbf{W}) $$ æ ¹æ®æ¢¯åº¦ä¸‹é™æ³•ï¼Œéœ€è¦æ±‚å¾— $$ \\frac{\\partial L}{\\partial \\textbf{W}} $$ è¿™é‡Œçš„$L$è¡¨ç¤º$loss function$ï¼Œä¹Ÿå³æ˜¯$E$ã€‚æ ¹æ®ä¸Šé¢çš„ç¥ç»ç½‘ç»œåå‘ä¼ æ’­ç®—æ³•é€å±‚ä¼ æ’­æ¢¯åº¦ï¼Œå³å¯ä»¥é«˜æ•ˆåœ°æ±‚è§£æŸå¤±å‡½æ•°å¯¹å‚æ•°çš„æ¢¯åº¦ï¼Œå†æ ¹æ®éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼Œä¸æ–­æ›´æ–°æƒé‡å‚æ•°$W$ï¼Œæœ€å°åŒ–ç›®æ ‡å‡½æ•°ï¼Œå®Œæˆç®€å•ç¥ç»ç½‘ç»œçš„è®­ç»ƒå­¦ä¹ ã€‚\nåå‘ä¼ æ’­ç®—æ³•ç‰¹åˆ«ä¹‹å¤„ ç°ä»£çš„ç¥ç»ç½‘ç»œè§„æ¨¡å’Œå±‚æ•°ä¸æ–­å¢åŠ ï¼Œä¸€ä¸ªå¤æ‚çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¯èƒ½æ¯ä¸€å±‚æœ‰æˆç™¾é‡çº§ç¥ç»å…ƒï¼Œæœ‰ä¸Šç™¾å±‚æ·±åº¦ï¼Œä¸‹å›¾æ˜¾ç¤ºä¸€ä¸ªè¾ƒå¤æ‚çš„ç¥ç»ç½‘ç»œã€‚ å¦‚æœé‡‡ç”¨å¯¼æ•°å®šä¹‰æ–¹å¼ï¼Œå³$\\frac{\\partial L(w)}{\\partial w} = \\lim_{w \\to 0} \\frac{f(w + h)}{w}$æ±‚è§£ï¼Œé‚£ä¹ˆåœ¨æ±‚è§£æ¯ä¸€ä¸ªæƒé‡ï¼ˆå³ä¸€æ¡è¿æ¥è¾¹ï¼‰å‚æ•°çš„åå¯¼æ•°æ—¶ç¥ç»ç½‘ç»œéƒ½éœ€è¦å‘å‰ä¼ é€’ä¸€æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°å› ä¸ºè¶Šé åçš„ç¥ç»å…ƒè¢«é‡å¤è®¡ç®—çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œéšç€ç¥ç»å…ƒä¸ªæ•°å’Œå±‚æ•°çš„å¢åŠ ï¼Œè¿™å°†ä¼šæ˜¯ä¸ªæŒ‡æ•°å¢åŠ çš„æ—¶é—´å¤æ‚åº¦ã€‚ç„¶è€Œï¼Œåˆ©ç”¨äº†å‡½æ•°æ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼Œä»è¾“å‡ºå±‚åˆ°è¾“å…¥å±‚é€å±‚è®¡ç®—æ¨¡å‹å‚æ•°çš„æ¢¯åº¦å€¼ï¼Œå¯ä»¥çœ‹åˆ°æŒ‰ç…§è¿™ä¸ªæ–¹å‘è®¡ç®—æ¢¯åº¦ï¼Œå„ä¸ªç¥ç»å•å…ƒåªè®¡ç®—äº†ä¸€æ¬¡ï¼Œæ²¡æœ‰é‡å¤è®¡ç®—ã€‚è¿™ä¸ªè®¡ç®—æ–¹å‘èƒ½å¤Ÿé«˜æ•ˆçš„æ ¹æœ¬åŸå› æ˜¯ï¼šåœ¨è®¡ç®—æ¢¯åº¦æ—¶å‰é¢çš„å•å…ƒæ˜¯ä¾èµ–åé¢çš„å•å…ƒçš„è®¡ç®—ï¼Œè€Œâ€œä»åå‘å‰â€çš„è®¡ç®—é¡ºåºæ­£å¥½â€œè§£è€¦â€äº†è¿™ç§ä¾èµ–å…³ç³»ï¼Œå…ˆç®—åé¢çš„å•å…ƒï¼Œå¹¶ä¸”è®°ä½åé¢å•å…ƒçš„æ¢¯åº¦å€¼ï¼Œè®¡ç®—å‰é¢å•å…ƒçš„æ¢¯åº¦æ—¶å°±å¯ä»¥å……åˆ†åˆ©ç”¨å·²ç»è®¡ç®—å‡ºæ¥çš„ç»“æœï¼Œé¿å…äº†é‡å¤è®¡ç®—ã€‚\næ€»ç»“ä¸æ€è€ƒ å¦‚ä»Šäººå·¥æ™ºèƒ½é¢†åŸŸä¸­æœ€é‡è¦çš„ç®—æ³•â€”â€”åå‘ä¼ æ’­ç®—æ³•å…¶ä¸»è¦æ€æƒ³æœ¬è´¨ä¹Ÿæ˜¯åˆ©ç”¨äº†åŠ¨æ€è§„åˆ’ï¼Œè¿™ç§æ–¹æ³•ç»“åˆäº†è§£ææ³•è®¡ç®—æ¢¯åº¦å’Œæ•°å€¼æ³•è®¡ç®—æ¢¯åº¦ï¼Œåˆ©ç”¨ç©ºé—´æ¢å–æ—¶é—´ï¼Œç¼©çŸ­æ±‚è§£å¤§é‡å‚æ•°æ¢¯åº¦çš„æ—¶é—´ï¼Œä»è€ŒåŠ é€Ÿç¥ç»ç½‘ç»œçš„è®­ç»ƒã€‚åå‘ä¼ æ’­ç®—æ³•çœ‹ä¸Šå»é«˜å¤§ä¸Šï¼Œä½†ä¹Ÿä¸è§å¾—æ˜¯ç”¨äº†å¤šé«˜çº§çš„æ–¹æ³•å’Œé«˜æ·±çš„çŸ¥è¯†ã€‚\nå‚è€ƒèµ„æ–™ï¼š\nç»´åŸºç™¾åº¦-æ„ŸçŸ¥å™¨\nç»´åŸºç™¾åº¦-äººå·¥ç¥ç»ç½‘ç»œ\nè®¡ç®—æœºçš„æ½œæ„è¯†\nã€ŠDeep Learning form Scratchã€‹\nã€Šæ·±åº¦å­¦ä¹ ã€‹\nå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹\nã€Šæ·±åº¦å­¦ä¹ [èŠ±ä¹¦]ã€‹\næèˆªã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹\né›¶åŸºç¡€å…¥é—¨æ·±åº¦å­¦ä¹ (3) - ç¥ç»ç½‘ç»œå’Œåå‘ä¼ æ’­ç®—æ³•(ç‰›é€¼)\n","date":"2020-06-13T13:47:01Z","permalink":"https://qiyueliuhuo.github.io/posts/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/","title":"ç¥ç»ç½‘ç»œä¹‹åå‘ä¼ æ’­ç®—æ³•"}]